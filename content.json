{"meta":{"title":"Vollate's Blog","subtitle":"","description":"Personal blog","author":"Vollate","url":"http://blog.vollate.top","root":"/"},"pages":[{"title":"About Me","date":"2023-08-31T03:48:42.000Z","updated":"2024-05-10T18:01:09.000Z","comments":true,"path":"about/index.html","permalink":"http://blog.vollate.top/about/index.html","excerpt":"","text":"å¤´åƒæ¥æºï¼šCorelDRAW çš„ä¸€ç§é»˜è®¤å›¾æ¡ˆå¡«å……ï¼ŒåŸå› æ˜¯ ä¸æƒ³è¢«å½“æˆå‚»é€¼äºŒæ¬¡å…ƒ åœ¨ä¸çŸ¥é“è¯¥ç”¨ä»€ä¹ˆå¥½çš„æƒ…å†µä¸‹éšæ‰‹æˆªçš„ ä»£ç åå¥½ è¯­è¨€: C++, Rust, ShellScript, Python, JAVA, Go, ECMAScript, C GNU/Linux å‘è¡Œç‰ˆ: Arch, Debian, NixOS ç¼–è¾‘å™¨: Vim, Jetbrains IDE, VScode çˆ±å¥½ çœ‹ç•ª, è½»å°è¯´ å…»è€ fps é€‰æ‰‹ï¼Œåº•åŠ›ä¸è¶³éŸ³æ¸¸äººï¼Œæ—®æ—¯ç»™æœ¨ç©å®¶ ç¡è§‰ è»Šä¸‡(ä¸€åº¦éå¸¸å–œæ¬¢ï¼Œä½†æ˜¯ç°åœ¨çƒ­æƒ…æ·¡äº†) ç›®æ ‡ æœ‰ä¸€ä¸ªå¥åº·çš„ä½œæ¯ é”»ç‚¼èº«ä½“ å¥½å¥½æ´»ç€ Painted by shnva"},{"title":"categories","date":"2023-08-31T03:48:42.000Z","updated":"2023-08-31T03:48:42.000Z","comments":false,"path":"categories/index.html","permalink":"http://blog.vollate.top/categories/index.html","excerpt":"","text":""},{"title":"links","date":"2023-08-31T03:48:42.000Z","updated":"2023-08-31T03:48:42.000Z","comments":true,"path":"links/index.html","permalink":"http://blog.vollate.top/links/index.html","excerpt":"","text":""},{"title":"Repository","date":"2023-08-31T03:48:42.000Z","updated":"2023-12-15T08:54:40.000Z","comments":false,"path":"repository/index.html","permalink":"http://blog.vollate.top/repository/index.html","excerpt":"","text":""},{"title":"tags","date":"2023-08-31T03:48:42.000Z","updated":"2023-08-31T03:48:42.000Z","comments":false,"path":"tags/index.html","permalink":"http://blog.vollate.top/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"CMake ä»å…¥é—¨åˆ°èƒ½ç”¨å°±è¡Œ","slug":"cmake-introduction","date":"2024-10-12T17:49:55.000Z","updated":"2024-10-13T04:39:25.000Z","comments":true,"path":"2024/10/12/cmake-introduction/","permalink":"http://blog.vollate.top/2024/10/12/cmake-introduction/","excerpt":"","text":"æ„å»ºç³»ç»Ÿå‘å±•å†å² æ‰‹å·¥ç¼–è¯‘ (1950s - 1960s): ç¼–ç¨‹è¯­è¨€åˆšåˆšè¯ç”Ÿï¼Œç¨‹åºå‘˜éœ€è¦æ‰‹å·¥ç¼–è¯‘ç¨‹åºï¼Œå°†æºä»£ç è½¬æ¢ä¸ºæœºå™¨ç ã€‚ æ‰¹å¤„ç†è„šæœ¬ (1960s - 1970s)ï¼š ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬æˆ– shell è„šæœ¬è‡ªåŠ¨åŒ–ç¼–è¯‘å‘½ä»¤ï¼Œå‡å°‘äº†æ‰‹å·¥è¾“å…¥ã€‚ Make ç³»ç»Ÿ (1970s)ï¼š Make å¼•å…¥äº†å¢é‡ç¼–è¯‘çš„æ¦‚å¿µï¼Œåªé‡æ–°ç¼–è¯‘ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Œå¤§å¹…æå‡æ•ˆç‡ã€‚ é…ç½®å’Œç”Ÿæˆå·¥å…· (1980s - 1990s)ï¼š Autotools ç­‰å·¥å…·é€šè¿‡è‡ªåŠ¨ç”Ÿæˆè·¨å¹³å°çš„æ„å»ºè„šæœ¬ï¼Œæ”¯æŒå¤šå¹³å°å¼€å‘ï¼Œé¿å…äº†æ‰‹å†™ Makefile çš„æƒ…å†µã€‚ ç°ä»£æ„å»ºç³»ç»Ÿ (2000s - 2010s)ï¼š CMake å’Œ Meson ç­‰å·¥å…·é‡‡ç”¨å£°æ˜å¼è¯­æ³•ï¼Œç®€åŒ–äº†å¤æ‚é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ã€‚ ä¸“ç”¨æ„å»ºç³»ç»Ÿå’Œæ„å»ºå·¥å…·é“¾ (2010s - Present)ï¼šNinjaã€Gradleã€Bazelã€Buck ç­‰ä¸“æ³¨äºåŠ é€Ÿå¤§å‹é¡¹ç›®çš„æ„å»ºï¼Œæä¾›é«˜åº¦çš„è‡ªå®šä¹‰åŠŸèƒ½ã€‚ äº‘åŸç”Ÿå’Œåˆ†å¸ƒå¼æ„å»º (2010s - Now)ï¼š æ”¯æŒäº‘åŸç”Ÿå’Œåˆ†å¸ƒå¼å¼€å‘åœºæ™¯çš„æ„å»ºç³»ç»Ÿï¼Œé›†æˆäº†å®¹å™¨åŒ–å’Œ CI/CD å·¥å…·ã€‚ å¢é‡ç¼–è¯‘æ˜¯æŒ‡æ¯æ¬¡åªç¼–è¯‘ä¿®æ”¹è¿‡çš„ç¼–è¯‘å•å…ƒï¼Œé¿å…äº†æ— æ•ˆç¼–è¯‘ã€‚ ä¾‹å¦‚ï¼Œåœ¨ C/C++ ä¸­ï¼Œæ¯ä¸ªæºæ–‡ä»¶å¯¹åº”ä¸€ä¸ªç¼–è¯‘å•å…ƒï¼Œåªæœ‰ä¿®æ”¹è¿‡çš„æºæ–‡ä»¶æ‰éœ€è¦é‡æ–°ç¼–è¯‘ã€‚åŒæ—¶ç”±äºé¢„å¤„ç†çš„åŸå› ï¼Œå¤´æ–‡ä»¶çš„å˜æ›´ä¼šé€’å½’å½±å“åˆ°æ‰€æœ‰ç›´æ¥æˆ–é—´æ¥å¼•ç”¨è¯¥å¤´æ–‡ä»¶çš„æºæ–‡ä»¶ã€‚ GNU Make Make æ˜¯ä¸€ä¸ªæ„å»ºå·¥å…·ï¼Œé€šè¿‡ Makefile æ–‡ä»¶å®šä¹‰é¡¹ç›®çš„æ„å»ºè§„åˆ™ã€‚Makefile æ–‡ä»¶åŒ…å«äº†ä¸€ç³»åˆ—è§„åˆ™ï¼Œæ¯ä¸ªè§„åˆ™ç”±ä¸€ä¸ªç›®æ ‡ã€ä¾èµ–å’Œå‘½ä»¤ç»„æˆã€‚ 1234567891011121314151617181920# VariableCC = clangCFLAGS = -Wall -Wextra -Werror# Targetall: programfoo.o: foo.c $(CC) $(CFLAGS) -c foo.c -o $@# $@ refers to the target# $&lt; refers to the first dependency# $^ refers to all dependenciesmain.o: main.c $(CC) $(CFLAGS) -c main.c -o $@program: main.o foo.o $(CC) $(CFLAGS) main.o foo.o -o programinclude subdir/Makefile make æ˜¯ä¸€ä¸ªè¿‡ç¨‹åŒ–çš„æ„å»ºå·¥å…·ï¼Œéœ€è¦æ‰‹åŠ¨ä¹¦å†™æ„å»ºå‘½ä»¤ï¼Œçµæ´»åº¦é«˜ä½†å¯ç»´æŠ¤æ€§å·®ã€‚ CMake CMake ä½œä¸ºå…ƒæ„å»ºç³»ç»Ÿï¼Œå¯ä»¥ç”Ÿæˆ Makeã€Ninjaã€Visual Studio ç­‰æ„å»ºç³»ç»Ÿæ‰€éœ€çš„é…ç½®æ–‡ä»¶ï¼Œæ–¹ä¾¿çš„å®ç°é¡¹ç›®çš„è·¨å¹³å°ã€‚CMake çš„é…ç½®æ–‡ä»¶æ˜¯ CMakeLists.txtï¼Œé€šè¿‡ç¼–å†™ CMakeLists.txt æ–‡ä»¶ï¼Œå¯ä»¥å®šä¹‰é¡¹ç›®çš„æ„å»ºè§„åˆ™ã€‚ Version cmake ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å‘½ä»¤å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œæ–°ç‰ˆå¯èƒ½ä¼šæ·»åŠ æ–°çš„å‘½ä»¤ï¼Œå¹¶ä¸”ä¼šåºŸå¼ƒä¸€äº›æ—§çš„å‘½ä»¤ï¼ˆä½†å¤§éƒ¨åˆ†æƒ…å†µä»ç„¶å¯ç”¨ï¼‰, æ‰€ä»¥åœ¨ç¼–å†™ CMakeLists.txt æ–‡ä»¶æ—¶ï¼Œéœ€è¦é™å®š CMake çš„æœ€ä½ç‰ˆæœ¬ã€‚ cmake_minimum_required(VERSION 3.16) # minimum cmake version# This is a line comment in cmake#[[ This is a block comment in cmake ]] Project Project å‘½ä»¤ç”¨äºå®šä¹‰é¡¹ç›®çš„åç§°å’Œæ”¯æŒçš„è¯­è¨€ã€‚å¯¹äºæ”¯æŒçš„è¯­è¨€ï¼Œå¯ä»¥ä½¿ç”¨ Cã€CXXã€CUDAã€Fortranã€ASM ç­‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCMake ä¼šè‡ªåŠ¨æ£€æµ‹é¡¹ç›®ä¸­çš„æºæ–‡ä»¶ï¼Œå¹¶æ ¹æ®æ–‡ä»¶åç¼€åæ¨æ–­è¯­è¨€ç±»å‹ã€‚ Project æ”¯æŒè®¾ç½®é¡¹ç›®çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥é€šè¿‡ VERSION é€‰é¡¹æŒ‡å®šé¡¹ç›®çš„ç‰ˆæœ¬å·ã€‚ project(hello_world) # project nameproject(hello_wrold VERSION 5.14 LANGUAGES CXX CUDA) # project name with languages Variable CMake ä¸­çš„å˜é‡åˆ†ä¸ºå¦‚ä¸‹å‡ ç§ï¼šæ™®é€šå˜é‡ï¼Œç¼“å­˜å˜é‡ï¼Œç¯å¢ƒå˜é‡ã€‚ æ™®é€šå˜é‡ä»…åœ¨æœ¬æ¬¡è¿è¡ŒcmakeæœŸé—´æœ‰æ•ˆï¼›ç¼“å­˜å˜é‡ä¼šè¢«å­˜å‚¨åˆ°ç”Ÿæˆé¡¹ç›®ç›®å½•çš„ CMakeCache.txt æ–‡ä»¶ä¸­ï¼Œç”¨é€”ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š é¿å…ç”¨æˆ·å†æ¬¡è¿è¡Œ cmake é‡æ–°è®¾ç½®å˜é‡ å­˜å‚¨æŸäº›è¿è¡Œæ—¶ä¿¡æ¯ï¼Œå¯¹ç”¨æˆ·ä¸å¯è§ã€‚å¦‚ç³»ç»Ÿåº“çš„è·¯å¾„ã€ç¼–è¯‘å™¨çš„è·¯å¾„ç­‰ã€‚ ç¯å¢ƒå˜é‡å–å†³äºè¿è¡Œ cmake çš„ç¯å¢ƒ 123456set(SRC_FILES main.cpp lib.cpp) # set Variableset(CMAKE_CXX_STANDARD 17) # set Variableset(CMAKE_CXX_STANDARD_REQUIRED ON cache) # set Cache Variablemessage(STATUS &quot;CMAKE_CXX_STANDARD: $&#123;CMAKE_CXX_STANDARD&#125;&quot;) # print messagemessage(WARNING &quot;$ENV&#123;USER&#125;&quot;) # print warning messagemessage(ERROR &quot;Error message&quot;) # print error message CMAKE ä¸­ï¼Œæ‰€æœ‰å˜é‡éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œè®¿é—®ä¸å­˜åœ¨çš„å˜é‡ä¼šè¿”å›ç©ºï¼ˆä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œå¦‚æœæ— æ³•æ­£å¸¸å¤„ç†ä¼šäº§ç”Ÿé—®é¢˜ã€‚å› æ­¤å¸¸ç”¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨ if åˆ¤æ–­å˜é‡æ˜¯å¦å­˜åœ¨ã€‚ if(DEFINED CMAKE_CXX_STANDARD) message(STATUS &quot;CMAKE_CXX_STANDARD: $&#123;CMAKE_CXX_STANDARD&#125;&quot;)else() message(WARNING &quot;CMAKE_CXX_STANDARD is not defined&quot;)endif() åœ¨æ¯”è¾ƒæ—¶ï¼Œåˆ™å¯ä»¥ç›´æ¥åŠ ä¸Šå¼•å·ï¼Œè¿™æ ·å³ä½¿å˜é‡ä¸å­˜åœ¨ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚ if(&quot;$&#123;CMAKE_CXX_STANDARD&#125;&quot; STREQUAL &quot;17&quot;) message(STATUS &quot;CMAKE_CXX_STANDARD is 17&quot;)else() message(WARNING &quot;CMAKE_CXX_STANDARD is not 17&quot;)endif() Control Flow åŒå¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒCMake ä¹Ÿæ”¯æŒæ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯æ§åˆ¶ã€‚ if if è¯­å¥æ”¯æŒ ANDã€ORã€NOT é€»è¾‘è¿ç®—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨ PARENT_SCOPE é€‰é¡¹å°†å˜é‡ä¼ é€’åˆ°çˆ¶ä½œç”¨åŸŸã€‚ 1234567if(CMAKE_CXX_STANDARD EQUAL 17 OR ENABLE_CXX17) message(STATUS &quot;CMAKE_CXX_STANDARD is 17&quot;)elseif(CMAKE_CXX_STANDARD EQUAL 14 AND CMAKE_CXX_STANDARD_REQUIRED) message(STATUS &quot;CMAKE_CXX_STANDARD is 14&quot;)else() message(WARNING &quot;CMAKE_CXX_STANDARD is not 17 or 14&quot;) endif() ä»»ä½•ç©ºå­—ç¬¦ä¸²ã€0ã€FALSEã€NOTFOUNDã€OFFã€NOã€Nã€IGNOREã€æ— å®šä¹‰çš„å˜é‡éƒ½ä¼šè¢«è§†ä¸ºå‡ï¼Œå…¶ä»–å€¼éƒ½ä¼šè¢«è§†ä¸ºçœŸã€‚ loop CMake æ”¯æŒ FOREACHã€WHILEã€WHILEã€UNTIL å¾ªç¯ï¼Œå…¶ä¸­ FOREACH å¾ªç¯æœ€ä¸ºå¸¸ç”¨ã€‚ set(SRC_FILES main.cpp lib.cpp a.cpp b.cpp)foreach(file $&#123;SRC_FILES&#125;) message(STATUS &quot;Source file: $&#123;file&#125;&quot;)endforeach() Subdir CMake æ”¯æŒå­ç›®å½•ï¼Œå¯ä»¥é€šè¿‡ add_subdirectory å‘½ä»¤æ·»åŠ å­ç›®å½•ï¼Œå­ç›®å½•ä¸­çš„ CMakeLists.txt æ–‡ä»¶ä¼šè¢«æ‰§è¡Œã€‚ egï¼šå‡è®¾é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ 123456.â”œâ”€â”€ 1â”‚ â””â”€â”€ CMakeLists.txtâ”œâ”€â”€ 2â”‚ â””â”€â”€ CMakeLists.txtâ””â”€â”€ CMakeLists.txt æ ¹ç›®å½•çš„ CMakeLists.txt æ–‡ä»¶å¦‚ä¸‹ 12345678project(foo)set(useless &quot;root&quot;)message(STATUS &quot;Root: $&#123;useless&#125;&quot;)add_subdirectory(1)message(STATUS &quot;Root: $&#123;useless&#125;&quot;)add_subdirectory(2)message(STATUS &quot;Root: $&#123;useless&#125;&quot;)message(STATUS &quot;Root: $&#123;useless2&#125;&quot;) 1/CMakeLists.txt æ–‡ä»¶å¦‚ä¸‹ message(STATUS &quot;Dir1: $&#123;useless&#125;&quot;)set(useless &quot;dir1&quot;)message(STATUS &quot;Dir1: $&#123;useless&#125;&quot;) 2/CMakeLists.txt æ–‡ä»¶å¦‚ä¸‹ set(useless &quot;dir2&quot; PARENT_SCOPE)set(useless2 &quot;dir2&quot;)message(STATUS &quot;Dir2: $&#123;useless2&#125;&quot;) è¿è¡Œcmake -Bbuild è¾“å‡ºå¦‚ä¸‹ 123456789// something-- Root: root-- Dir1: root-- Dir1: dir1-- Root: root-- Dir2: dir2-- Root: dir2-- Root:// something å¯ä»¥çœ‹åˆ°ï¼Œå­ç›®å½•ä¸­çš„å˜é‡ä¸ä¼šå½±å“åˆ°çˆ¶ç›®å½•ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ PARENT_SCOPE é€‰é¡¹å°†å˜é‡ä¼ é€’åˆ°çˆ¶ç›®å½•ã€‚å­ç›®å½•è°ƒç”¨å®Œæˆåï¼Œè¿”å›åˆ°çˆ¶ç›®å½•ï¼Œç»§ç»­æ‰§è¡Œã€‚ CMake æ”¯æŒ include å‘½ä»¤ï¼Œå¯ä»¥åŒ…å«å…¶ä»– CMakeLists.txt æ–‡ä»¶ã€‚include å‘½ä»¤ä¼šå°†è¢«åŒ…å«çš„æ–‡ä»¶çš„å†…å®¹ç›´æ¥æ’å…¥åˆ°å½“å‰æ–‡ä»¶ä¸­ï¼Œå› æ­¤è¢«åŒ…å«çš„æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ä¼šå½±å“åˆ°åŒ…å«çš„æ–‡ä»¶ã€‚å’Œ C/CPPçš„é¢„å¤„ç†#include ä½œç”¨ç›¸åŒã€‚ Executable/Lib CMake ä¸­æ”¯æŒä¸‰ç§ç±»å‹çš„æ„å»ºç›®æ ‡ï¼šå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆadd_executableï¼‰ã€é™æ€åº“ï¼ˆadd_library STATICï¼‰ã€åŠ¨æ€åº“ï¼ˆadd_library SHAREDï¼‰ã€‚ add_executable(hello_world main.cpp) # add executable targetadd_library(hello STATIC lib.cpp) # add static library targetadd_library(hello SHARED lib.cpp) # add shared library target include_directories include_directories å‘½ä»¤ç”¨äºæ·»åŠ å¤´æ–‡ä»¶æœç´¢è·¯å¾„ï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªè·¯å¾„ã€‚ä½¿ç”¨ BEFORE é€‰é¡¹å¯ä»¥å°†è·¯å¾„æ·»åŠ åˆ°å·²æœ‰è·¯å¾„çš„å‰é¢ï¼Œæ”¾ç½®è¢«å…¶ä»–è·¯å¾„è¦†ç›–ã€‚ include_directories(include/foo) # add include pathinclude_directories(BEFORE include/bar) # add include path before target_xxx target_xxx ç³»åˆ—å‘½ä»¤ç”¨äºè®¾ç½®ç›®æ ‡çš„å±æ€§ï¼Œå¦‚ç¼–è¯‘é€‰é¡¹ã€é“¾æ¥é€‰é¡¹ã€ä¾èµ–ç­‰ã€‚åˆ†ä¸ºä¸‰ç§å±æ€§ï¼šPRIVATE, PUBLIC, INTERFACEã€‚ PRIVATE å±æ€§åªå¯¹å½“å‰ç›®æ ‡æœ‰æ•ˆ, ä¸ä¼šä¼ é€’ç»™ä¾èµ–ç›®æ ‡ PUBLIC å±æ€§å¯¹å½“å‰ç›®æ ‡å’Œä¾èµ–ç›®æ ‡éƒ½æœ‰æ•ˆ INTERFACE å±æ€§åªå¯¹ä¾èµ–ç›®æ ‡æœ‰æ•ˆ,ä¸ä¼šå¯¹å½“å‰ç›®æ ‡æœ‰æ•ˆ target_include_directories(hello PUBLIC include) # add include path for target hello and any target that depends on hellotarget_compile_definitions(hello PRIVATE DEBUG) # add compile definition for target hellotarget_link_libraries(hello INTERFACE foo) # link library foo to targets who depends on hello å¸¸ç”¨çš„ target_xxx å‘½ä»¤æœ‰ï¼š target_include_directories æ·»åŠ å¤´æ–‡ä»¶æœç´¢è·¯å¾„ target_compile_definitions æ·»åŠ ç¼–è¯‘å®å®šä¹‰ target_compile_options æ·»åŠ ç¼–è¯‘é€‰é¡¹ target_link_libraries æ·»åŠ é“¾æ¥åº“ find_package find_package å‘½ä»¤ç”¨äºæŸ¥æ‰¾å¤–éƒ¨åº“ï¼Œæœ‰å¦‚ä¸‹å‡ ç§æ¨¡å¼ï¼š Module æ¨¡å¼ï¼šåœ¨æŒ‡å®šçš„è·¯å¾„ä¸‹æŸ¥æ‰¾ Find.cmake æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†æŸ¥æ‰¾åº“çš„è§„åˆ™ï¼Œå¦‚ä½•è®¾ç½®åº“çš„å¤´æ–‡ä»¶è·¯å¾„ã€åº“æ–‡ä»¶è·¯å¾„ã€é“¾æ¥åº“ç­‰ã€‚ Config æ¨¡å¼ï¼šåœ¨æŒ‡å®šçš„è·¯å¾„ä¸‹æŸ¥æ‰¾ Config.cmakeæˆ–-config.cmake æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†åº“çš„é…ç½®ä¿¡æ¯ï¼Œå¦‚å¤´æ–‡ä»¶è·¯å¾„ã€åº“æ–‡ä»¶è·¯å¾„ã€é“¾æ¥åº“ç­‰ã€‚ å…¶ä»–å¯é€‰é¡¹ REQUIRED: å¦‚æœæ‰¾ä¸åˆ°åº“ï¼ŒCMake ä¼šæŠ¥é”™å¹¶åœæ­¢æ„å»ºã€‚å¦‚æœ find_package æˆåŠŸï¼Œä¼šå®šä¹‰ä¸€ä¸ª &lt;package&gt;_FOUND å˜é‡ï¼Œè¡¨ç¤ºæ‰¾åˆ°åº“ã€‚ OPTIONAL: å¦‚æœæ‰¾ä¸åˆ°åº“ï¼ŒCMake ä¼šç»§ç»­æ„å»ºã€‚ QUIET: å¤±è´¥æ—¶ä¸è¾“å‡ºè­¦å‘Šã€‚ PATHS &amp; HINTS: æŒ‡å®šæŸ¥æ‰¾è·¯å¾„ï¼Œå…¶ä¸­ HINTS ä¼˜å…ˆçº§é«˜äº PATHSã€‚ &lt;package&gt;_ROOT å˜é‡æˆ–ç¯å¢ƒå˜é‡å¦‚æœè®¾ç½®ï¼Œä¼šä¼˜å…ˆä½¿ç”¨ã€‚ å…·ä½“æŸ¥æ‰¾é¡ºåºå‚è€ƒ CMake å®˜æ–¹æ–‡æ¡£ ğŸ’© 123456789find_package(Boost) # find boost libraryif(Boost_FOUND) message(STATUS &quot;Boost found&quot;)else() message(FATAL_ERROR &quot;Boost not found&quot;)endif()find_package(OpenCV CONFIG REQUIRED) # find opencv libraryfind_package(OpenGL REQUIRED HINTS /usr/lib) # find opengl library ctest ctest æ˜¯ CMake çš„æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥ç”¨äºè¿è¡Œæµ‹è¯•ã€‚å¯ä»¥é€šè¿‡ add_test æŒ‡ä»¤æ·»åŠ å¯¹åº”çš„æµ‹è¯•ã€‚ç­¾åå¦‚ä¸‹: add_test(NAME &lt;test_name&gt; COMMAND &lt;executable&gt; [arg1 [arg2 ...]]) enable_testing() # enable testingadd_executable(test test.cpp) # add test targetadd_test(NAME example-test COMMAND test config.yaml &gt; $&#123;CMAKE_BINARY_DIR&#125;/test.log) # add test å¸¸ç”¨å˜é‡ CMAKE_SOURCE_DIR: é¡¹ç›®æ ¹ç›®å½• CMAKE_BINARY_DIR: é¡¹ç›®æ„å»ºç›®å½• CMAKE_CURRENT_SOURCE_DIR: å½“å‰å¤„ç†çš„ CMakeLists.txt æ–‡ä»¶æ‰€åœ¨çš„ç›®å½• CMAKE_PREFIX_PATH: æŸ¥æ‰¾åº“çš„è·¯å¾„ CMAKE_MODULE_PATH: æŸ¥æ‰¾æ¨¡å—çš„è·¯å¾„ CMAKE_INCLUDE_PATH: æŸ¥æ‰¾å¤´æ–‡ä»¶çš„è·¯å¾„ CMAKE_LIBRARY_PATH: æŸ¥æ‰¾åº“æ–‡ä»¶çš„è·¯å¾„ CMAKE_INSTALL_PREFIX: å®‰è£…ç›®å½• CMAKE_BUILD_TYPE: æ„å»ºç±»å‹ï¼Œå¦‚ Debugã€Releaseã€RelWithDebInfoã€MinSizeRel CMAKE_C_COMPILER: C ç¼–è¯‘å™¨ CMAKE_CXX_COMPILER: C++ ç¼–è¯‘å™¨ CMAKE_C_FLAGS: C ç¼–è¯‘é€‰é¡¹ CMAKE_CXX_FLAGS: C++ ç¼–è¯‘é€‰é¡¹ CMAKE_EXE_LINKER_FLAGS: å¯æ‰§è¡Œæ–‡ä»¶é“¾æ¥é€‰é¡¹ CMAKE_LINKER_FLAGS: é“¾æ¥é€‰é¡¹ CMake Cli è™½ç„¶ CMake æœ‰æä¾› GUI å·¥å…·ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿˜æ˜¯ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ã€‚CMake çš„å‘½ä»¤è¡Œå·¥å…·æ˜¯ cmakeï¼Œå¯ä»¥é€šè¿‡ cmake --help æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ã€‚ å¸¸ç”¨å‘½ä»¤è¡Œå‚æ•°ï¼š cmake -B&lt;build-dir&gt;: æŒ‡å®šæ„å»ºç›®å½• cmake &lt;source-dir&gt;: æŒ‡å®šæºä»£ç ç›®å½• cmake --build &lt;build-dir&gt;: æ„å»ºé¡¹ç›® cmake -D&lt;variable&gt;=&lt;value&gt;: è®¾ç½®å˜é‡ ctest -C &lt;build-dir&gt;: åœ¨æŒ‡å®šçš„æ„å»ºç›®å½•ä¸‹è¿è¡Œæµ‹è¯• æ‹“å±• è®© CMake install æ”¯æŒ find_package vcpkg precompiled headers åºŸè¯ ç”±äº CMake è¯­æ³•è¿‡äºå¤æ‚ï¼Œå®é™…ä½¿ç”¨æ—¶åº”å¤šå»å®˜ç½‘æŸ¥æ‰¾ç”¨æ³•ã€‚ç½‘å€è´´åˆ°è¿™é‡Œï¼Œä¸è¿‡å®˜ç½‘çš„æ–‡æ¡£æŸ¥æ‰¾æ•ˆç‡ä½ä¸‹ï¼Œä¸ªäººä¸€èˆ¬éƒ½æ˜¯æ‰¾å¤§å‹ cmake é¡¹ç›®ç›´æ¥æŠ„ CMakeLists.txt ï¼ˆ","categories":[{"name":"Knowledge","slug":"Knowledge","permalink":"http://blog.vollate.top/categories/Knowledge/"}],"tags":[{"name":"CMake","slug":"CMake","permalink":"http://blog.vollate.top/tags/CMake/"}]},{"title":"é…ç½®è‡ªå·±çš„é‚®ä»¶æœåŠ¡å™¨","slug":"deploy-self-mail-server","date":"2024-09-26T04:57:57.000Z","updated":"2024-09-26T04:58:26.000Z","comments":true,"path":"2024/09/26/deploy-self-mail-server/","permalink":"http://blog.vollate.top/2024/09/26/deploy-self-mail-server/","excerpt":"","text":"æœ€è¿‘æœ‰äº‹éœ€è¦æ”¶å‘é‚®ä»¶ï¼Œä½†æ˜¯ä¸æƒ³ç”¨è‡ªå·±çš„ç§äººé‚®ç®±ã€‚æ­£å¥½æ‰‹ä¸Šæœ‰ä¸ªåŸŸåï¼Œå°±æƒ³ç€è‡ªå·±æ­å»ºä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨é—²å¾—æ…Œï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹æ­å»ºè¿‡ç¨‹ã€‚ é€‰ç”¨çš„é‚®ä»¶æœåŠ¡å™¨æ˜¯ docker-mailserverï¼Œå¯ä»¥æ–¹ä¾¿çš„åœ¨å®¹å™¨å†…éƒ¨ç½²ï¼Œé…ç½®ä¹Ÿç›¸å¯¹ç®€ä¾¿ï¼Œæ›´æ”¹ docker-compose.yml æ–‡ä»¶å³å¯ã€‚ å‡†å¤‡å·¥ä½œ æœåŠ¡å™¨ é¦–å…ˆéœ€è¦ä¸€å°æœåŠ¡å™¨ï¼Œç„¶åè£…å¥½ docker å’Œ docker-composeï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ Debian 12ï¼Œå®‰è£…è¿‡ç¨‹ä¸å†èµ˜è¿°ã€‚ åŸŸåè§£æ åœ¨ä½ çš„ DNS æœåŠ¡å•†å¤„æ·»åŠ  MX è®°å½•ï¼ŒæŒ‡å‘ä½ çš„æœåŠ¡å™¨åœ°å€ã€‚æˆ‘ä½¿ç”¨ Cloudflare æ‰˜ç®¡ï¼Œæ·»åŠ çš„ MX è®°å½•å¦‚ä¸‹ï¼š 123456Type: MXName: @ // ä»£è¡¨æ ¹åŸŸåContent: mail.example.com // ä½ çš„é‚®ä»¶æœåŠ¡å™¨åœ°å€ï¼Œè¿™é‡Œä½¿ç”¨ mail.example.com ä½œä¸ºç¤ºä¾‹ï¼Œä½ å¯ä»¥ä½¿ç”¨è‡ªå·±çš„äºŒçº§åŸŸåPriority: 10 // ä¼˜å…ˆçº§ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨ï¼Œå¯ä»¥éšæ„è®¾ç½®Proxied: DNS onlyTTL: Auto å®Œæˆåç”¨ dig å‘½ä»¤æ£€æŸ¥ MX è®°å½•æ˜¯å¦ç”Ÿæ•ˆï¼š dig MX example.com é…ç½® SSL è¯ä¹¦ docker-mailserver é»˜è®¤ä½¿ç”¨ Letâ€™s Encrypt è¯ä¹¦ï¼Œæ‰€ä»¥éœ€è¦é…ç½®å¥½åŸŸåè§£æï¼Œç¡®ä¿èƒ½å¤Ÿè®¿é—®åˆ°ä½ çš„æœåŠ¡å™¨ã€‚å¦‚æœä½ æ²¡æœ‰åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä»»ä½•ç½‘å€(80ç«¯å£æœªå ç”¨) Letâ€™s Encrypt ä¼šè‡ªåŠ¨éªŒè¯åŸŸåï¼Œç”Ÿæˆè¯ä¹¦ã€‚ åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ certbot å·¥å…·ç”Ÿæˆè¯ä¹¦ï¼Œä½ å¯ä»¥æŸ¥çœ‹è¿™ä¸ªç½‘ç«™æ¥è·å¾—åœ¨ä½  WebServer å’Œå‘è¡Œç‰ˆä¸Šçš„æœ€ä½³å®ç°ã€‚æˆ‘çš„æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯ Nginxã€‚ sudo apt install certbotsudo apt install sudo certbot certonly --standalone -d mail.example.com -d example.com éƒ¨ç½² docker-mailserver é¦–å…ˆåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç”¨äºå­˜æ”¾ docker-compose.yml æ–‡ä»¶å’Œå…¶ä»–é…ç½®æ–‡ä»¶ã€‚ mkdir mailservercd mailserver ç„¶åå°† docker-compose.yml æ–‡ä»¶ä¸‹è½½åˆ°å½“å‰ç›®å½•ã€‚ wget https://raw.githubusercontent.com/docker-mailserver/docker-mailserver/master/docker-compose.yml æ ¹æ®ä½ çš„éœ€æ±‚ä¿®æ”¹ docker-compose.yml æ–‡ä»¶ï¼Œæˆ‘ä¿®æ”¹åçš„æ–‡ä»¶å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940version: &#x27;3.8&#x27;services: mailserver: image: docker.io/mailserver/docker-mailserver:latest hostname: mail.example.com domainname: example.com container_name: mailserver ports: - &quot;25:25&quot; - &quot;143:143&quot; - &quot;465:465&quot; - &quot;587:587&quot; - &quot;993:993&quot; volumes: - ./docker-data/dms/mail-data/:/var/mail/ - ./docker-data/dms/mail-state/:/var/mail-state/ - ./docker-data/dms/mail-logs/:/var/log/mail/ - ./docker-data/dms/config/:/tmp/docker-mailserver/ - /etc/localtime:/etc/localtime:ro - /etc/letsencrypt:/etc/letsencrypt environment: - ENABLE_SPAMASSASSIN=1 - ENABLE_FAIL2BAN=1 - ENABLE_OPENDKIM=1 - ENABLE_OPENDMARC=1 - POSTFIX_MESSAGE_SIZE_LIMIT=102400000 - DMS_DEBUG=0 - SSL_TYPE=letsencrypt - SSL_DOMAIN=example.com - LETSENCRYPT_EMAIL=admin@example.com - SSL_LTS=1 cap_add: - NET_ADMIN restart: unless-stoppedvolumes: maildata: mailstate: maillogs: å®Œæˆåï¼Œè¿è¡Œ docker-compose up -d å¯åŠ¨å®¹å™¨ã€‚ç¬¬ä¸€æ¬¡å¯åŠ¨åï¼Œè¦åœ¨120ç§’å†…åˆ›å»ºç¬¬ä¸€ä¸ªç”¨æˆ·ï¼Œå¦åˆ™å®¹å™¨ä¼šè‡ªåŠ¨å…³é—­ã€‚ docker exec -it mailserver setup email add xxx@example.com password å¼€æ”¾ç«¯å£ åœ¨æœåŠ¡å™¨ä¸Šå¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š 25: SMTP 143: IMAP 465: SMTPS 587: Submission 993: IMAPS æˆ‘çš„æœåŠ¡å™¨ä½¿ç”¨ iptables é˜²ç«å¢™ï¼Œå¼€æ”¾ç«¯å£çš„å‘½ä»¤å¦‚ä¸‹ï¼š iptables -A INPUT -p tcp --dport 25 -j ACCEPTiptables -A INPUT -p tcp --dport 143 -j ACCEPTiptables -A INPUT -p tcp --dport 465 -j ACCEPTiptables -A INPUT -p tcp --dport 587 -j ACCEPTiptables -A INPUT -p tcp --dport 993 -j ACCEPT è¦æŒä¹…åŒ–è¿™äº›è§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨ netfilter-persistent å·¥å…·ï¼š apt install iptables-persistent æ‰§è¡Œ sudo netfilter-persistent save ä¿å­˜è§„åˆ™ã€‚ è¿›é˜¶é…ç½® åˆšåˆšé…å¥½çš„é‚®ä»¶æœåŠ¡å™¨ç»™ gmail å‘é‚®ä»¶æ—¶ï¼Œä¼šè¢«æ ‡è®°ä¸ºåƒåœ¾é‚®ä»¶ï¼Œè¿™æ˜¯å› ä¸ºç¼ºå°‘ SPFã€DKIM å’Œ DMARC è®°å½•ã€‚æˆ‘ä»¬éœ€è¦é…ç½®è¿™äº›è®°å½•ã€‚ SPF SPF æ˜¯ä¸€ç§ç”¨äºé˜²èŒƒä¼ªé€ é‚®ä»¶çš„æŠ€æœ¯ï¼Œé€šè¿‡åœ¨ DNS ä¸­æ·»åŠ  SPF è®°å½•ï¼Œå¯ä»¥æŒ‡å®šå“ªäº› IP åœ°å€å¯ä»¥å‘é€é‚®ä»¶ã€‚ç”±äºæˆ‘ä»¬çš„é‚®ä»¶æœåŠ¡å™¨åªæœ‰ä¸€å°ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æŒ‡å®šæœåŠ¡å™¨çš„ IP åœ°å€ã€‚åœ¨ Cloudflare ä¸­æ·»åŠ  TXT è®°å½•ï¼š Type: TXTName: @Content: v=spf1 mx -allTTL: Auto è§£é‡Šï¼š v=spf1ï¼šSPF ç‰ˆæœ¬ mxï¼šå…è®¸ MX è®°å½•æŒ‡å®šçš„æœåŠ¡å™¨å‘é€é‚®ä»¶ -allï¼šæ‹’ç»æ‰€æœ‰å…¶ä»–æœåŠ¡å™¨å‘é€é‚®ä»¶ DKIM DomainKeys Identified Mail (DKIM) æ˜¯ä¸€ç§ç”¨äºéªŒè¯é‚®ä»¶æ¥æºçš„æŠ€æœ¯ï¼Œé€šè¿‡åœ¨ DNS ä¸­æ·»åŠ  DKIM è®°å½•ï¼Œå¯ä»¥éªŒè¯é‚®ä»¶çš„çœŸå®æ€§ã€‚docker-mailserver å·²ç»ä¸ºæˆ‘ä»¬å†…ç½®å¹¶è‡ªåŠ¨å¼€å¯äº† OpenDKIMï¼Œæˆ‘ä»¬åªéœ€è¦ç”Ÿæˆ DKIM å¯†é’¥å¹¶æå–å…¬é’¥æ·»åŠ åˆ° DNS ä¸­ã€‚å®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¯¦ç»†çš„æ­¥éª¤ã€‚ ç”±äºæˆ‘ä»¬éœ€è¦æŒ‡å®šç‰¹å®šå­åŸŸåï¼Œæ‰€ä»¥éœ€è¦åœ¨ä¾ç…§æ–‡æ¡£ä¸­ You may need to specify mail domains explicitly éƒ¨åˆ†çš„æ­¥éª¤ä¸­æ·»åŠ  -d mail.example.com å‚æ•°ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š docker exec -it mailserver /bin/bashsetup config dkim domain &#x27;mail.example.com&#x27;setup config dkim domain mail.example.com ç„¶åï¼Œåœ¨åˆšåˆšæ‰“å¼€çš„ shell ä¸­æŸ¥çœ‹å…¬é’¥ï¼š cat /tmp/docker-mailserver/opendkim/keys/mail.example.com/mail.txt å°†è¾“å‡ºçš„å†…å®¹æ·»åŠ åˆ° DNS ä¸­ï¼Œå…·ä½“å‚è€ƒè¿™å—ï¼š Type: TXTName: mail._domainkeyContent: v=DKIM1; k=rsa; p=xxxxxxTTL: Auto DMARC Domain-based Message Authentication, Reporting and Conformance (DMARC) æ˜¯ä¸€ç§ç”¨äºéªŒè¯é‚®ä»¶æ¥æºçš„æŠ€æœ¯ï¼Œé€šè¿‡åœ¨ DNS ä¸­æ·»åŠ  DMARC è®°å½•ï¼Œå¯ä»¥æŒ‡å®šé‚®ä»¶çš„å¤„ç†æ–¹å¼ã€‚docker-mailserver å·²ç»ä¸ºæˆ‘ä»¬å†…ç½®å¹¶è‡ªåŠ¨å¼€å¯äº† OpenDMARCï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ  DMARC è®°å½•ã€‚åœ¨ Cloudflare ä¸­æ·»åŠ  TXT è®°å½•ï¼š Type: TXTName: _dmarcContent: v=DMARC1; p=none; rua=mailto:admin@example.comTTL: Auto è§£é‡Šï¼š v=DMARC1ï¼šDMARC ç‰ˆæœ¬ p=noneï¼šæŒ‡å®šé‚®ä»¶çš„å¤„ç†æ–¹å¼ï¼Œnone è¡¨ç¤ºä¸åšä»»ä½•å¤„ç† rua=mailto:ï¼šæŒ‡å®šæŠ¥å‘Šçš„æ¥æ”¶é‚®ç®± ruf=mailto:ï¼šæŒ‡å®šå¤±è´¥æŠ¥å‘Šçš„æ¥æ”¶é‚®ç®± sp=noneï¼šæŒ‡å®šå­åŸŸåçš„å¤„ç†æ–¹å¼ adkim=sï¼šæŒ‡å®š DKIM çš„éªŒè¯æ–¹å¼ aspf=rï¼šæŒ‡å®š SPF çš„éªŒè¯æ–¹å¼ pct=100ï¼šæŒ‡å®šæŠ¥å‘Šçš„ç™¾åˆ†æ¯” rf=afrfï¼šæŒ‡å®šæŠ¥å‘Šçš„æ ¼å¼ rDNS åå‘ DNS (rDNS) æ˜¯ä¸€ç§ç”¨äºéªŒè¯ IP åœ°å€çš„æŠ€æœ¯ï¼Œé€šè¿‡åœ¨ DNS ä¸­æ·»åŠ  PTR è®°å½•ï¼Œå¯ä»¥éªŒè¯ IP åœ°å€çš„çœŸå®æ€§ã€‚è¿™éœ€è¦è”ç³»æœåŠ¡å™¨æä¾›å•†æ¥é…ç½®ã€‚ éªŒè¯é‚®ä»¶æœåŠ¡å™¨æ­£å¸¸å·¥ä½œ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ dkimvalidator.com æ¥éªŒè¯ DKIM å’Œ DMARC è®°å½•æ˜¯å¦ç”Ÿæ•ˆï¼Œä½¿ç”¨ www.mail-tester.com æ¥éªŒè¯é‚®ä»¶æ˜¯å¦è¢«æ ‡è®°ä¸ºåƒåœ¾é‚®ä»¶ã€‚","categories":[{"name":"Journal","slug":"Journal","permalink":"http://blog.vollate.top/categories/Journal/"}],"tags":[{"name":"Server","slug":"Server","permalink":"http://blog.vollate.top/tags/Server/"},{"name":"Emali","slug":"Emali","permalink":"http://blog.vollate.top/tags/Emali/"}]},{"title":"ä½¿ç”¨ pass ç®¡ç†å¯†ç ","slug":"pass-sync","date":"2024-08-10T11:48:05.000Z","updated":"2024-08-12T02:15:07.000Z","comments":true,"path":"2024/08/10/pass-sync/","permalink":"http://blog.vollate.top/2024/08/10/pass-sync/","excerpt":"","text":"zx2c4 pass æ˜¯ä¸€ä¸ª unix ä¸‹çš„å¯†ç ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨ gpg åŠ å¯†å¯†ç ï¼Œé…åˆ git å¯ä»¥æ–¹ä¾¿çš„å®ç°å¯†ç åŒæ­¥ï¼Œæ¥å½»åº•æ‘†è„± browser å’Œå…¶ä»–å„å¼å„æ ·éè‡ªç”±å¯†ç ç®¡ç†å·¥å…·ã€‚ ä¸‹é¢ä»‹ç» pass çš„é…ç½®ï¼Œå¯†ç è¿ç§»ï¼Œä»¥åŠå„ä¸ªå®¢æˆ·ç«¯çš„ä½¿ç”¨æ–¹æ³•ã€‚ é…ç½® å®‰è£… pass UNIX like ç³»ç»Ÿç›´æ¥ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…å³å¯ï¼Œæˆ‘çš„ç³»ç»Ÿæ˜¯ Arch, ä½¿ç”¨ pacman å®‰è£…: # å·²æœ‰ gpg å’Œ git çš„å¿½ç•¥è¿™æ­¥sudo pacman -S gnupg git# pass æœ¬ä½“ä¸º cli å·¥å…·ï¼Œå¯ä»¥é…åˆ qtpass æ¥ä½¿ç”¨sudo pacman -S pass qtpass å¦‚æœæ˜¯windowsï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹å‡ ä¸ªå¹³æ›¿: prs: rust å®ç°çš„ passï¼Œä½†ä¸æ”¯æŒ extension pass-winmenu: å¯ä»¥å®ç° pass çš„åŸºæœ¬åŠŸèƒ½ï¼Œä½†ä¸º GUI åº”ç”¨ passpy: python å®ç°çš„ passï¼ŒåŠŸèƒ½è¡¥å…¨ä¸”å¹´ä¹…å¤±ä¿® pass4win: å¹´ä¹…å¤±ä¿®ä¸”å·²ç» archiving ï¼Œä¸å»ºè®®ä½¿ç”¨ åˆå§‹åŒ– pass åœ¨ä½¿ç”¨ pass ä¹‹å‰ï¼Œå…ˆç”Ÿæˆ gpg å¯†é’¥å¯¹ã€‚å·²æœ‰ gpg å¯†é’¥å¯¹å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ã€‚ 123456789101112gpg --full-generate-key # ç„¶åæ ¹æ®æç¤ºè¾“å…¥å¯¹åº”ä¿¡æ¯å’Œä½ è¦è®¾ç½®çš„å¯†ç gpg --list-secret-keys --keyid-format LONG # åˆ—å‡ºå¯†é’¥çš„ gpg-id, å¤§æ¦‚çš„è¾“å‡ºé•¿è¿™æ ·:# /home/foo/.gnupg/pubring.kbx# ----------------------------------# sec ed25519/xxx 20xx-xx-xx [SC] [expires: 20xx-xx-xx]# &lt;gpg-id&gt;# uid [ unknown] vollate &lt;uint44t@gmail.com&gt;# ssb cv25519/xxxxxxxxxxxxxxxx 20xx-xx-xx [E] [expires: 20xx-xx-xx]pass init &lt;gpg-id&gt; # ä½¿ç”¨ gpg-id åˆå§‹åŒ– pass ç»è¿‡åˆå§‹åŒ–ï¼Œä¼šç”Ÿæˆ ~/.password-store ç›®å½•ã€‚ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª .gpg-id æ–‡ä»¶ï¼Œå­˜æ”¾äº†ç”¨æ¥åŠ å¯†å¯†ç çš„ gpg key çš„ idã€‚ å¦‚æœä½ æƒ³è¦å¯¼å…¥æˆ–å¯¼å‡º gpg key,ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ # exportgpg --export-secret-keys -a &lt;gpg-id&gt; &gt; private.key# importgpg --import private.key æ³¨æ„ï¼Œä½¿ç”¨ --export-secret-keys å¯¼å‡ºç§é’¥ï¼Œå¦åˆ™è¡Œä¸ºä¸ºå¯¼å‡ºå…¬é’¥ã€‚ åŒæ­¥å¯†ç  ä½¿ç”¨ git æ¥åŒæ­¥å¯†ç ï¼Œè¿™é‡Œä½¿ç”¨ github ä½œä¸ºè¿œç¨‹ä»“åº“ã€‚æ¨èä½¿ç”¨ ssh-key è¿›è¡Œè®¤è¯ï¼Œå› ä¸ºgithubå¾ˆæ—©å°±åœæ­¢äº†ä½¿ç”¨å¯†ç è®¤è¯ã€‚ é¦–å…ˆåˆ›å»ºä½ çš„ private repoï¼Œä¸ç”¨æ·»åŠ  gitignore æˆ– readmeï¼Œç„¶ååˆå§‹åŒ–ä½ çš„ .password-store å¹¶ ref åˆ°è¿œç¨‹ä»“åº“ã€‚æˆ–è€…ä½ å¯ä»¥è·Ÿæˆ‘ä¸€æ ·å·æ‡’ clone ä¸‹æ¥ç„¶å æŠŠ .git æ‰”è¿› .password-store é‡Œã€‚ ä¹‹åå°±å¯ä»¥ä½¿ç”¨git æ¥ç®¡ç†å¯†ç äº†ã€‚ ä»æµè§ˆå™¨è¿ç§» firefox,chrome,edgeéƒ½æ”¯æŒå¯¼å‡ºå¯†ç ä¸º csv æ–‡ä»¶ï¼Œé¦–å…ˆå¯¼å‡ºå¯†ç åˆ° csv æ–‡ä»¶ï¼Œç„¶åå®‰è£… pass-importã€‚ ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯¼å…¥å¯†ç : pass import &lt;csv-file&gt; æ›´å¤šç”¨æ³•è§ useage å¯¼å‡ºå®Œåè®°å¾—æ¸…ç©ºæµè§ˆå™¨ä¿å­˜çš„å¯†ç ã€‚å¦‚æœå¼€å¯äº†äº‘åŒæ­¥ï¼Œéœ€è¦åœ¨ history ä¸­åˆ é™¤å¯†ç ååŒæ­¥åˆ°äº‘ç«¯ã€‚ Chome ç›´æ¥å†å²è®°å½•æ¸…é™¤å¯†ç åä¼šè‡ªåŠ¨åŒæ­¥ Edge éœ€è¦åœ¨å†å²è®°å½•ä¸­åˆ é™¤å¯†ç åæ‰‹åŠ¨å¼ºåˆ¶åŒæ­¥ firefox åœ¨ password manager å³ä¸Šè§’å¯ä»¥ç›´æ¥åˆ é™¤æ‰€æœ‰å¯†ç ã€‚ å®¢æˆ·ç«¯ ä¸‹é¢æ¨èå‡ ä¸ªä¸ªäººä½¿ç”¨çš„å®¢æˆ·ç«¯: qtpass: pass çš„ qt å®¢æˆ·ç«¯ï¼Œæ”¯æŒå›¾å½¢åŒ–æ“ä½œå’Œä¸€å®š extension passff: firefox æ’ä»¶ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ pass æ¥å¡«å……å¯†ç ï¼ŒåŸºæœ¬å¯ä»¥åšåˆ°å®Œå…¨æ›¿ä»£æµè§ˆå™¨è‡ªå¸¦çš„å¯†ç ç®¡ç†å™¨(ä½†æ˜¯ windows ä¸Šæ”¯æŒç¨€çƒ‚) Android-Password-Store: Android å®¢æˆ·ç«¯ï¼Œæ”¯æŒåŠ å¯†è§£å¯†å’Œ git åŒæ­¥ï¼Œä½†æ˜¯è‡ªåŠ¨å¡«å……ç¨€çƒ‚ ç›®å‰ windows ä¸Šçš„ passff æœ‰ä¸€äº›é—®é¢˜ï¼Œæš‚æ—¶æ²¡æ‰¾åˆ°å¥½çš„è§£å†³æ–¹æ¡ˆä¸ç”¨winå°±è¡Œäº† æ‰©å±• pass æ”¯æŒ extensionï¼Œå…·ä½“å‚è€ƒè¿™ä¸ªåˆé›†ï¼Œæ‰¾è‡ªå·±éœ€è¦çš„ç”¨ã€‚","categories":[{"name":"Journal","slug":"Journal","permalink":"http://blog.vollate.top/categories/Journal/"}],"tags":[{"name":"Password","slug":"Password","permalink":"http://blog.vollate.top/tags/Password/"}]},{"title":"Google GN CheatSheet","slug":"google-gn","date":"2024-07-14T06:44:21.000Z","updated":"2024-07-14T14:37:05.000Z","comments":true,"path":"2024/07/14/google-gn/","permalink":"http://blog.vollate.top/2024/07/14/google-gn/","excerpt":"","text":"åŸºç¡€è¯­æ³• ç›®æ ‡(Target) executableï¼šå®šä¹‰ä¸€ä¸ªå¯æ‰§è¡Œç›®æ ‡ executable(&quot;my_app&quot;) &#123; sources = [ &quot;main.cc&quot; ]&#125; shared_libraryï¼šå®šä¹‰ä¸€ä¸ªå…±äº«åº“ç›®æ ‡ shared_library(&quot;my_shared_lib&quot;) &#123; sources = [ &quot;shared_lib.cc&quot; ]&#125; static_libraryï¼šå®šä¹‰ä¸€ä¸ªé™æ€åº“ç›®æ ‡ static_library(&quot;my_static_lib&quot;) &#123; sources = [ &quot;static_lib.cc&quot; ]&#125; source_setï¼šå®šä¹‰ä¸€ç»„æºæ–‡ä»¶ï¼Œé€šå¸¸ç”¨äºä¸­é—´æ„å»º source_set(&quot;my_sources&quot;) &#123; sources = [ &quot;file1.cc&quot;, &quot;file2.cc&quot; ]&#125; å˜é‡ sourcesï¼šå®šä¹‰è¦åŒ…å«åœ¨ç›®æ ‡ä¸­çš„æºæ–‡ä»¶åˆ—è¡¨ sources = [ &quot;main.cc&quot;, &quot;util.cc&quot; ] depsï¼šå®šä¹‰ç›®æ ‡çš„ä¾èµ–é¡¹åˆ—è¡¨ deps = [ &quot;//:my_static_lib&quot; ] public_depsï¼šç±»ä¼¼äº depsï¼Œä½†ä¼šå°†ä¾èµ–é¡¹å…¬å¼€ç»™ä¾èµ–æ­¤ç›®æ ‡çš„å…¶ä»–ç›®æ ‡ public_deps = [ &quot;//:my_shared_lib&quot; ] å‡½æ•° importï¼šå¯¼å…¥å…¶ä»– GN æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œåªèƒ½åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ä½¿ç”¨ï¼Œç”¨äºé…ç½®å˜é‡å’Œé»˜è®¤å€¼ import(&quot;//build/config.gni&quot;) set_defaultsï¼šè®¾ç½®é»˜è®¤å€¼ï¼Œé€šå¸¸ç”¨äºè®¾ç½®å…¨å±€é…ç½® set_defaults(&quot;executable&quot;) &#123; output_name = &quot;default_executable&quot;&#125; templateï¼šå®šä¹‰æ¨¡æ¿ï¼Œä¾¿äºå¤ç”¨æ„å»ºè§„åˆ™(å°±æ˜¯æ¨¡æ¿å‡½æ•°) 12345678910111213# definitiontemplate(&quot;foo&quot;) &#123; assert(defined(invoker.var1), &quot;var1 must be defined&quot;) print(invoker.var1) print(invoker.var2) # something&#125;# useagefoo(&quot;useless&quot;)&#123; var1 = &quot;foo&quot; var2 = &quot;bar&quot;&#125; é…ç½® configï¼šå®šä¹‰ä¸€ç»„ç¼–è¯‘æˆ–é“¾æ¥é€‰é¡¹ï¼Œå¯ä»¥åœ¨å¤šä¸ªç›®æ ‡ä¸­å¤ç”¨ config(&quot;default_cflags&quot;) &#123; cflags = [ &quot;-Wall&quot;, &quot;-Werror&quot; ]&#125; å·¥å…·é“¾ toolchainï¼šå®šä¹‰ä¸€ä¸ªå·¥å…·é“¾ï¼Œç”¨äºæŒ‡å®šç¼–è¯‘å’Œé“¾æ¥çš„å·¥å…·åŠå…¶é€‰é¡¹ 1234567891011toolchain(&quot;my_toolchain&quot;) &#123; tool(&quot;cc&quot;) &#123; command = &quot;gcc&quot; &#125; tool(&quot;cxx&quot;) &#123; command = &quot;g++&quot; &#125; tool(&quot;link&quot;) &#123; command = &quot;g++&quot; &#125;&#125; è¿‡æ»¤å™¨(Filter) sources_assignment_filterï¼šç”¨äºè¿‡æ»¤ sources åˆ—è¡¨ä¸­çš„æ–‡ä»¶ sources_assignment_filter = [ &quot;*.cc&quot;, &quot;*.h&quot; ] åˆ†ç»„ groupï¼šå®šä¹‰ä¸€ä¸ªæ„å»ºç›®æ ‡çš„åˆ†ç»„ group(&quot;all&quot;) &#123; deps = [ &quot;:target1&quot;, &quot;:target2&quot; ]&#125; å¤–éƒ¨è„šæœ¬æ‰§è¡Œ exec_scriptï¼šè¿è¡Œå¤–éƒ¨è„šæœ¬ï¼Œå¹¶å°†ç»“æœå¯¼å…¥ GN é…ç½®ä¸­ result = exec_script(&quot;find_sources.py&quot;, [], &quot;string_list&quot;)sources = result æ§åˆ¶æµ(control flow) ifï¼šæ¡ä»¶è¯­å¥ï¼Œç”¨äºåœ¨ GN æ–‡ä»¶ä¸­è¿›è¡Œæ¡ä»¶æ„å»º 1234567if (is_win) &#123; # win config&#125; else if (is_linux)&#123; # linux config&#125; else &#123; # other config&#125; foreach:ç¼–è¯‘åˆ—è¡¨ 12345678var_list=[ &quot;a&quot;, &quot;b&quot;, &quot;c&quot;]foreach(var, var_list) &#123; rubbish += var&#125; ä½œç”¨åŸŸ set_defaultsï¼šè®¾ç½®é»˜è®¤å€¼ï¼Œé€šå¸¸ç”¨äºè®¾ç½®å…¨å±€é…ç½® set_defaults(&quot;executable&quot;) &#123; output_name = &quot;default_executable&quot;&#125; scopeï¼šå®šä¹‰ä¸€ä¸ªä½œç”¨åŸŸï¼Œå¯ä»¥åœ¨ GN æ–‡ä»¶ä¸­ç»„ç»‡å’Œç®¡ç†å˜é‡å’Œç›®æ ‡ scope(&quot;my_scope&quot;) &#123; sources = [ &quot;file1.cc&quot;, &quot;file2.cc&quot; ]&#125; ç”Ÿæˆè¿‡ç¨‹ å’Œ CMake ç±»ä¼¼ï¼ŒGNä»æ ¹ç›®å½•çš„ BUILD.gn å¼€å§‹è§£æï¼Œé€šè¿‡ dependence ç¡®å®šä¾èµ–å­ç›®å½•ï¼Œç„¶ååœ¨å„ä¸ªä¾èµ–çš„å­ç›®å½•ä¸­å¯»æ‰¾ BUILD.gn æ¥æ„å»ºä¾èµ–ã€‚è§£ææ–‡ä»¶çš„éƒ¨åˆ†ä¾èµ–è„šæœ¬è¯­è¨€è€Œä¸æ˜¯ CMake é‚£æ ·å¯ä»¥ç›´æ¥è°ƒç”¨å†…ç½®å‡½æ•°ï¼Œæœ‰æ›´é«˜çš„çµæ´»æ€§ï¼Œä½†æ˜¯ä¹Ÿæ›´å¤æ‚ã€‚ å¸¸ç”¨å‘½ä»¤/å‚æ•° gn gen out/Default --args='...': åœ¨ out/Default ç›®å½•ç”Ÿæˆ ninja æ„å»ºæ–‡ä»¶ gn desc out/Default //some_path:target --$&#123;additional&#125;: æ˜¾ç¤ºå½“å‰ç”Ÿæˆé¡¹ç›®ç›®å½•ä¸­æŸä¸ª target çš„è¯¦ç»†ä¿¡æ¯ --tree: æ˜¾ç¤ºç”Ÿæˆ target è¿‡ç¨‹æ‰€æœ‰ä¾èµ–è°ƒç”¨é¡ºåºå’Œå‚æ•° --blame: æ˜¾ç¤ºç”Ÿæˆ target è¿‡ç¨‹çš„ç¼–è¯‘å‚æ•°ä¸­æ¯ä¸ªå‚æ•°çš„æ¥æº gn check out/Default: æ£€æŸ¥å½“å‰é¡¹ç›®çš„é…ç½®æ˜¯å¦æ­£ç¡® gn format: æ ¼å¼åŒ–æ‰€æœ‰ BUILD.gn æ–‡ä»¶ gn gen --ide=$&#123;x&#125; out/Default ç”Ÿæˆ IDE é¡¹ç›®æ–‡ä»¶ --ide=json ç”Ÿæˆ JSON æ ¼å¼çš„ IDE é¡¹ç›®æ–‡ä»¶,ç”¨äº clangd ç­‰ --ide=vs ç”Ÿæˆ Visual Studio é¡¹ç›®æ–‡ä»¶(åªæ”¯æŒx64 win32 ä¸¤ç§target plateform) --ide=xcode ç”Ÿæˆ Xcode é¡¹ç›®æ–‡ä»¶","categories":[],"tags":[]},{"title":"LLDB åœ¨ Docker ä¸­åŠŸèƒ½å¼‚å¸¸","slug":"docker-lldb-error","date":"2024-06-26T16:36:35.000Z","updated":"2024-07-01T15:22:47.000Z","comments":true,"path":"2024/06/26/docker-lldb-error/","permalink":"http://blog.vollate.top/2024/06/26/docker-lldb-error/","excerpt":"","text":"è®°(å¯„)å½• å†™ 15445 çš„æ—¶å€™å‘ç° clang-14 ä»¥ä¸Šç¼–è¯‘ fmt ä¼šæŠ¥é”™ï¼ˆarch åŒ…å¤ªæ–°äº†å¯¼è‡´çš„ï¼‰ï¼Œå› æ­¤åœ¨ debian12 çš„ docker ä¸­æŒ‚è½½ host æ–‡ä»¶å¤¹å¼€å‘ã€‚ç”¨ lldb debug æ—¶åœ¨å‡ºç° exception æˆ– signalå lldb ä¼šæŠ¥é”™ A packet returned an error 8 å¹¶é€€å‡ºè¿›ç¨‹ï¼Œå¯¼è‡´æ— æ³• backtraceï¼Œä½†æ˜¯ gdb æ²¡äº‹ã€‚ åŸå› æ˜¯å› ä¸º lldb debug ç”¨çš„ syscall ptrace åœ¨ docker ä¸­è¢«é™åˆ¶äº†ï¼Œè§£å†³æ–¹æ³•æ˜¯åœ¨ docker run æ—¶åŠ ä¸Š --cap-add=SYS_PTRACE --security-opt seccomp=unconfined å‚æ•°ã€‚ Problem on stack overflow Docker å°çŸ¥è¯† Linux capabilities: Docker å…³äº Linux capabilities çš„ç« èŠ‚ã€‚è¿™ä¸ªæ˜¯ç”¨æ¥é™åˆ¶å®¹å™¨æƒé™çš„ï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤æƒ…å†µä¸‹ &quot;SYS_PTRACE Trace arbitrary processes using ptrace(2).&quot;æ˜¯è¢«ç¦ç”¨çš„ï¼Œç„¶å lldb å°±å¯„äº†ï¼ˆ Secure computing mode(Seccomp): è¿™æ˜¯ Linux å†…æ ¸çš„ä¸€ä¸ª feature,ç”¨äºæ§åˆ¶è®¡ç®—æ—¶çš„è¡Œä¸ºå®‰å…¨ã€‚Docker é»˜è®¤çš„ profile ç¦ç”¨äº†å¤§çº¦ 44 ä¸ª syscall, ptrace ä½åˆ—å…¶ä¸­ã€‚é€šè¿‡ --security-opt seccomp=unconfined æ¥å…³é—­è¿™ä¸ª profileï¼ˆå›¾çœäº‹çš„ä¸å®‰å…¨åšæ³•ï¼‰ï¼Œæ­£ç¡®çš„æ˜¯æ”¹é»˜è®¤ profile æ¥è‡ªå®šä¹‰ä¸€ä¸ªprofileã€‚ç„¶è€Œæˆ‘æ‡’ï¼Œå°±è¿™æ ·äº†ã€‚ ptrace æ€ä¹ˆä¸å®‰å…¨äº† Docker å®˜æ–¹æ–‡æ¡£: Blocked in Linux kernel versions before 4.8 to avoid seccomp bypass. Tracing/profiling arbitrary processes is already blocked by dropping CAP_SYS_PTRACE, because it could leak a lot of information on the host. ä¸Š NVD æœäº†ä¸€åœˆï¼Œå¥½å¤šæ–‡æ¡£éƒ½å†™çš„ç¦æ­¢ä½¿ç”¨ ptrace, debugger å’Œ straceï¼ˆused to trace syscal)ï¼Œä½†æ˜¯æ²¡è¯´ä¸ºå•¥ã€‚cgroup å’Œ namespace ä¸æ˜¯å·²ç»éš”ç¦»äº†å—ï¼Œç­‰å“ªå¤©æœ‰ç©ºæŸ¥åˆ°å†ç ”ç©¶ä¸‹ã€‚ ä¸ºä»€ä¹ˆ GDB æ²¡äº‹ TODO: æ‰¾äº†åŠå¤©èµ„æ–™æ²¡æ‰¾åˆ°ï¼Œgdb internals ååè¿™ä¸€ç« æ˜¯å’•å’•çš„ï¼Œå…ˆæ´—æ´—ç¡äº†ã€‚","categories":[{"name":"Journal","slug":"Journal","permalink":"http://blog.vollate.top/categories/Journal/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"http://blog.vollate.top/tags/Docker/"},{"name":"LLDB","slug":"LLDB","permalink":"http://blog.vollate.top/tags/LLDB/"}]},{"title":"gRPC & Protobuf å­¦ä¹ ","slug":"protobuf-and-grpc","date":"2024-05-10T10:42:59.000Z","updated":"2024-06-14T15:23:41.000Z","comments":true,"path":"2024/05/10/protobuf-and-grpc/","permalink":"http://blog.vollate.top/2024/05/10/protobuf-and-grpc/","excerpt":"","text":"é˜…è¯»é¡»çŸ¥ æœ¬æ–‡ä»…ä¾›å­¦ä¹ å‚è€ƒï¼Œç¬”è€…çš„ protobuf ç‰ˆæœ¬ä¸º 3.21.12.0ï¼Œä¸ä¿è¯å…¶ä»–ç‰ˆæœ¬çš„å…¼å®¹æ€§ã€‚ proto file .proto æ ¼å¼æ–‡ä»¶å¯ä»¥è¢« protobuf(protocol buffer) è§£æï¼Œç”¨äºå®šä¹‰æœåŠ¡å’Œæ¶ˆæ¯æ ¼å¼çš„è¯­è¨€ã€‚é€šè¿‡ protobuf çš„ protoc å¯ä»¥ç”Ÿæˆç¬¦åˆåŒä¸€é€šè®¯åè®®çš„å¯¹åº”çš„ä»£ç æ¡†æ¶ï¼Œä»¥æ­¤å®ç°è·¨è¯­è¨€ rpc é€šè®¯ã€‚ åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä¾‹å­ 123456789101112131415161718192021222324252627282930313233343536373839404142syntax = &quot;proto3&quot;;// proto file versionpackage package_name;// define the serviceservice ChatService &#123; rpc PublishRoom(PublishRoomRequest) returns (PublishRoomReply); rpc GetRoomPeers(GetRoomPeersRequest) returns (GetRoomPeersReply);&#125;// define the status code(enum)enum StatusCode&#123; OK = 0; ERROR = 1;&#125;// define the request and reply messagemessage PublishRoomRequest &#123; string name = 1; string password = 2; oneof contact &#123;// like union in c/c++ string email = 3; string phone = 4; int64 id = 5; &#125;&#125;message PublishRoomReply &#123; bool success = 1; string message = 2;&#125;message GetRoomPeersRequest&#123; string name = 1; string password = 2; string id = 3;&#125;message GetRoomPeersReply&#123; bool success = 1; repeated string peers = 2; string message = 3;&#125; å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¤§æ¦‚çŸ¥é“äº†å¦‚ä½•ç¼–å†™ä¸€ä¸ª .proto æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†è®²è§£ç»†èŠ‚ è¯­æ³• é¦–å…ˆé™„ä¸Šå®˜æ–¹æ–‡æ¡£ proto file çš„è¯­æ³•åˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬ï¼Œåˆ†åˆ«æ˜¯ proto2 å’Œ proto3ï¼Œä¸¤ä¸ªç‰ˆè¯­æ³•æœ¬éå¸¸ç›¸ä¼¼ï¼Œä½†proto3 å–æ¶ˆäº† require/optional fieldï¼Œå› æ­¤ä¸å»ºè®®ç»™è‡ªå·±æ‰¾äº‹è·¨ç‰ˆæœ¬é€šè®¯ã€‚æœ¬æ–‡ä»…ä»‹ç» proto3 çš„è¯­æ³•ã€‚ åœ¨ .proto æ–‡ä»¶çš„å¼€å¤´ï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜ä½¿ç”¨çš„ç‰ˆæœ¬ syntax = &quot;proto$&#123;x&#125;&quot;;ï¼Œ$&#123;x&#125; ä¸ºç‰ˆæœ¬å·ï¼Œä¸€å®šè¦åœ¨å¼€å¤´å£°æ˜ï¼Œå¦åˆ™é»˜è®¤ä¼šä½¿ç”¨ proto2 çš„è¯­æ³•ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å£°æ˜åŒ…å package package_name;ï¼ŒåŒ…åç”¨äºåŒºåˆ†ä¸åŒçš„æœåŠ¡ï¼Œé¿å…å‘½åå†²çªï¼Œå®é™…ç¼–ç ä¸­ä¼šè½¬æ¢æˆå„ä¸ªè¯­è¨€çš„åŒ…åæˆ–åç§°ç©ºé—´ï¼Œå¦‚ C++ ä¼šè½¬æ¢æˆ namespace package_name;ï¼Œ Rust ä¼šè½¬æ¢æˆ mod package_name; service ç”¨äºå®šä¹‰æœåŠ¡ï¼ŒæœåŠ¡ä¸­åŒ…å«å¤šä¸ª rpc æ–¹æ³•ï¼Œrpc æ–¹æ³•åŒ…å«è¯·æ±‚å’Œå“åº”æ¶ˆæ¯ï¼Œå…·ä½“ä¼šåœ¨åé¢è®²è§£ ä¹‹åæ˜¯å„ç±»å¤åˆç±»å‹å®šä¹‰ï¼Œå¦‚ enumã€message ç­‰ï¼Œè¯¥æ¨¡å—å’Œ service å®šä¹‰æ²¡æœ‰é¡ºåºè¦æ±‚ï¼Œåªè¦ service ä¸­ä½¿ç”¨çš„å¤åˆç±»å‹åœ¨æœ¬æ–‡ä»¶ä¸­å®šä¹‰å³å¯ Scalar Value Types gRPC ä¸­å…±ç”¨å¦‚ä¸‹å‡ ç§åŸºç¡€ç±»å‹ï¼Œåœ¨ç¼–è¯‘æ—¶ä¼šè½¬æ¢æˆå¯¹åº”è¯­è¨€çš„åŸºç¡€ç±»å‹: å˜é•¿ç¼–ç ï¼ˆVarintï¼‰ï¼š int32ï¼ˆæœ‰ç¬¦å·æ•´æ•°ï¼‰ int64ï¼ˆæœ‰ç¬¦å·æ•´æ•°ï¼‰ uint32ï¼ˆæ— ç¬¦å·æ•´æ•°ï¼‰ uint64ï¼ˆæ— ç¬¦å·æ•´æ•°ï¼‰ sint32ï¼ˆæœ‰ç¬¦å·æ•´æ•°ï¼Œä½¿ç”¨ ZigZag ç¼–ç ï¼‰ sint64ï¼ˆæœ‰ç¬¦å·æ•´æ•°ï¼Œä½¿ç”¨ ZigZag ç¼–ç ï¼‰ boolï¼ˆå¸ƒå°”å€¼ï¼Œå­˜å‚¨ä¸º 0 æˆ– 1ï¼‰ enumï¼ˆæšä¸¾ï¼Œé€šå¸¸ä½œä¸º Varint ç¼–ç çš„æ•´æ•°ï¼‰ å›ºå®šé•¿åº¦ç¼–ç ï¼š fixed32ï¼ˆ32 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå›ºå®š 4 å­—èŠ‚ï¼‰ fixed64ï¼ˆ64 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå›ºå®š 8 å­—èŠ‚ï¼‰ sfixed32ï¼ˆ32 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå›ºå®š 4 å­—èŠ‚ï¼‰ sfixed64ï¼ˆ64 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå›ºå®š 8 å­—èŠ‚ï¼‰ floatï¼ˆ32 ä½æµ®ç‚¹æ•°ï¼Œå›ºå®š 4 å­—èŠ‚ï¼‰ doubleï¼ˆ64 ä½æµ®ç‚¹æ•°ï¼Œå›ºå®š 8 å­—èŠ‚ï¼‰ é•¿åº¦å‰ç¼€ç¼–ç ï¼š stringï¼ˆå­—ç¬¦ä¸²ï¼‰ bytesï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰ messageï¼ˆåµŒå¥—æ¶ˆæ¯ï¼‰ è¿™ç§å¤šç§ç¼–ç æ–¹å¼å…è®¸ Protocol Buffers ä»¥é«˜æ•ˆå’Œç´§å‡‘çš„æ–¹å¼è¿›è¡Œåºåˆ—åŒ–ã€‚ å„è¯­è¨€å…·ä½“è½¬æ¢ï¼Œç‚¹æˆ‘å±•å¼€ .proto TypeNotesC++ TypeJava/Kotlin Type[1]Python Type[3]Go TypeRuby TypeC# TypePHP TypeDart Typedoubledoubledoublefloatfloat64Floatdoublefloatdoublefloatfloatfloatfloatfloat32Floatfloatfloatdoubleint32Uses variable-length encoding. Inefficient for encoding negative numbers â€“ if your field is likely to have negative values, use sint32 instead.int32intintint32Fixnum or Bignum (as required)intintegerintint64Uses variable-length encoding. Inefficient for encoding negative numbers â€“ if your field is likely to have negative values, use sint64 instead.int64longint/long[4]int64Bignumlonginteger/string[6]Int64uint32Uses variable-length encoding.uint32int[2]int/long[4]uint32Fixnum or Bignum (as required)uintintegerintuint64Uses variable-length encoding.uint64long[2]int/long[4]uint64Bignumulonginteger/string[6]Int64sint32Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int32s.int32intintint32Fixnum or Bignum (as required)intintegerintsint64Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int64s.int64longint/long[4]int64Bignumlonginteger/string[6]Int64fixed32Always four bytes. More efficient than uint32 if values are often greater than 228.uint32int[2]int/long[4]uint32Fixnum or Bignum (as required)uintintegerintfixed64Always eight bytes. More efficient than uint64 if values are often greater than 256.uint64long[2]int/long[4]uint64Bignumulonginteger/string[6]Int64sfixed32Always four bytes.int32intintint32Fixnum or Bignum (as required)intintegerintsfixed64Always eight bytes.int64longint/long[4]int64Bignumlonginteger/string[6]Int64boolboolbooleanboolboolTrueClass/FalseClassboolbooleanboolstringA string must always contain UTF-8 encoded or 7-bit ASCII text, and cannot be longer than 232.stringStringstr/unicode[5]stringString (UTF-8)stringstringStringbytesMay contain any arbitrary sequence of bytes no longer than 232.stringByteStringstr (Python 2)bytes (Python 3)[]byteString (ASCII-8BIT)ByteStringstringList è¿™æ˜¯å®˜ç½‘çš„è¡¨æ ¼ç…§æŠ„ç»“æœï¼Œè¯·ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºå‡†ä»¥é¿å…ä»»ä½•æ—¶æ•ˆæ€§é—®é¢˜ã€‚å®˜æ–¹æ–‡æ¡£é“¾æ¥ Enumerations Union(Variant) 123456789message PublishRoomRequest &#123; string name = 1; string password = 2; oneof contact &#123;// like union in c/c++ string email = 3; string phone = 4; int64 id = 5; &#125;&#125; Message å°±æ˜¯ Struct, ç”¨äºå®šä¹‰å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥åµŒå¥—å®šä¹‰ï¼Œå¯ä»¥åŒ…å« enumã€messageã€oneof ç­‰ å¯ä»¥ç”¨ repeated å…³é”®å­—å®šä¹‰æ•°ç»„ 123456789101112131415161718message Person &#123; string name = 1; int32 id = 2; string email = 3; enum PhoneType &#123; MOBILE = 0; HOME = 1; WORK = 2; &#125; message PhoneNumber &#123; string number = 1; PhoneType type = 2; &#125; repeated PhoneNumber phones = 4;&#125; Service å®šä¹‰ service ChatService &#123; rpc PublishRoom(PublishRoomRequest) returns (PublishRoomReply); rpc GetRoomPeers(GetRoomPeersRequest) returns (stream GetRoomPeersReply); rpc GetRoomsPeers(stream GetRoomPeersRequest) returns (stream GetRoomPeersReply);&#125; stream use to specify a stream message, which means the server or client can send or receive multiple messages in one rpc call. grpc ä¸€äº›æ•™ç¨‹ å®˜ç½‘æ‰¾è‡ªå·±è¦ç”¨çš„è¯­è¨€å»çœ‹ æ‰¾çš„æŸä¸ª blog æœ‰è¶£çš„ä¸œè¥¿ è¯­æ³•è¯´å®è¯æ²¡å•¥çœ‹çš„ï¼Œç”¨çš„æ—¶å€™å†æŸ¥ï¼Œä½†æ˜¯ç¼–ç æŒºå¥½ç©çš„ã€‚å®˜æ–¹ä»‹ç» å¯å˜é•¿åº¦ç¼–ç  å°†åŸæ•°æŒ‰å°ç«¯åºç¼–ç ï¼Œç„¶ååˆ†ä¸º 7 bits ä¸€ç»„ï¼Œæ¯ byte çš„ MSBï¼ˆæœ€é«˜ä½ï¼‰è¡¨ç¤ºæ˜¯å¦è¿˜æœ‰åç»­(0è¡¨ç¤ºæ— ï¼Œ1è¡¨ç¤ºæœ‰)ã€‚ç”±äºæŒ‰å°ç«¯åºè€Œä¸æ˜¯ä¼ ç»Ÿçš„å¤§ç«¯åºï¼ˆç½‘ç»œå­—èŠ‚åºï¼‰ï¼Œå¯ä»¥èŠ‚çœæ•°å­—è¾ƒå°æ—¶é«˜ä½çš„å­˜å‚¨ç©ºé—´ã€‚å½“ç„¶å¯¹äºå¤§æ•°éœ€è¦æœ€å¤š10 bytesæ¥ä¼ è¾“ï¼Œå› æ­¤åœ¨å·²çŸ¥æ•°æ®éƒ½è¾ƒå¤§æ—¶åº”ç›´æ¥ä½¿ç”¨å®šé•¿ç¼–ç ã€‚ ZigZag ç¼–ç  ä¸ºäº†è§£å†³è´Ÿæ•°è€Œç”Ÿã€‚å› ä¸ºè´Ÿæ•°çš„æ ‡å‡†è¡¨ç¤ºæ–¹å¼æ˜¯ MSB è®¾ 1 çš„ 2 è¡¥ç ï¼Œä¼šå¯¼è‡´å¤§è´Ÿæ•°çš„å¯å˜é•¿åº¦ç¼–ç è¿œè¿œé•¿äºåŒç»å¯¹å€¼çš„æ­£æ•°ã€‚å¦‚æœæ˜¯æœŸæœ›ä¸º 0 çš„é«˜æ–¯åˆ†å¸ƒï¼Œç”¨ä¸Šé¢çš„å˜é•¿ç¼–ç ä¼šäº§ç”Ÿå¾ˆå¤§çš„æ¶ˆè€—ã€‚ZigZag ç¼–ç å°†è´Ÿæ•°æ˜ å°„åˆ°æ­£æ•°ï¼Œä½¿å¾—ç»å¯¹å€¼è¾ƒå°çš„è´Ÿæ•°çš„ç¼–ç é•¿åº¦æ¥è¿‘äºæ­£æ•°ã€‚ ç¼–ç : n &lt;&lt; 1 ^ n &gt;&gt; len, å…¶ä¸­ len ä¸º n çš„ä½æ•° è§£ç : (n &gt;&gt; 1) ^ -(n &amp; 1) æœ¬è´¨: åªç”¨æ­£æ•°è¡¨ç¤ºç»å¯¹å€¼å¤§å°ï¼Œç¬¦å·ä½ä» MSB æ¢ä¸º LSB, è¿™æ ·è®©ä¸Šé¢çš„å˜é•¿ç¼–ç å…³äºç»å¯¹å€¼å¤§å°çš„ä¼˜åŠ¿å¾—ä»¥ä¿ç•™ã€‚","categories":[],"tags":[{"name":"Notes","slug":"Notes","permalink":"http://blog.vollate.top/tags/Notes/"},{"name":"RPC","slug":"RPC","permalink":"http://blog.vollate.top/tags/RPC/"}]},{"title":"Arch Linux ä¸‹ firefox æ— æ³•æ˜¾ç¤º emoji","slug":"missing-emoji","date":"2024-02-20T16:11:59.000Z","updated":"2024-05-10T18:01:09.000Z","comments":true,"path":"2024/02/20/missing-emoji/","permalink":"http://blog.vollate.top/2024/02/20/missing-emoji/","excerpt":"","text":"é—®é¢˜æè¿° firefox æ— æ³•æ˜¾ç¤ºä»»ä½• emojiï¼Œä½† chromeï¼Œedge å‡æ˜¾ç¤ºæ­£å¸¸ æŠ˜è…¾è¿‡ç¨‹ é¦–å…ˆæ€€ç–‘æ˜¯ firefox ä»€ä¹ˆåœ°æ–¹é…ç½®ç‚¸äº†ã€‚æœäº†å‡ ç¯‡æé—®ï¼Œè§£å†³æ–¹æ¡ˆéƒ½æ— æ•ˆï¼ŒåŒ…æ‹¬ Arch wiki ä¸Šçš„è¿™ä¸ªã€‚ ç„¶åæˆ‘å¼€äº†ä¸‹è‡ªå·±å¦ä¸€å°ç”µè„‘ä¸Šçš„ Arch å‘ç°æ˜¾ç¤ºæ­£å¸¸ï¼Œäºæ˜¯æ¨æ–­å¯èƒ½æ˜¯ç¼ºå­—ä½“ã€‚å…·ä½“æ˜¯ä»€ä¹ˆä¸æ¸…æ¥šï¼Œä½†æ˜¯åŒ…åä¸­å¤§æ¦‚å¸¦ â€œemojiâ€ã€‚æœäº†åŠå¤©æ²¡æ‰¾åˆ°ä¸ªèƒ½ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œnoto-font-emoji è£…äº†ä¹Ÿæ²¡ç”¨ã€‚æœ€åä¸æŠ±å¸Œæœ›æœäº†ä¸‹packageï¼ŒåŸä»¥ä¸ºä¼šå‡ºç°ä¸€å †å¸¦ emoji çš„ï¼Œç»“æœå°±åå‡ ä¸ªã€‚çœ‹äº†çœ‹ï¼Œè§‰å¾—ç¼ºå°‘ â€œunicode-emojiâ€ çš„å¯èƒ½æ€§æœ€é«˜ï¼Œè£…äº†ï¼Œå¥½äº†ã€‚ ç„¶åå‘ç° vim ä¸­çš„ warning å­—ä½“çªç„¶å˜æˆ unicode é‡Œé¢é‚£ä¸ªé»„è‰² warningï¼ˆä¸‘ï¼‰ï¼Œäºæ˜¯åˆæŠŠåŒ…å¸äº†ã€‚é‡å¯åå‘ç° firefox ä¸­ emoji æ­£å¸¸æ˜¾ç¤ºï¼Œå¤§æ¦‚æ˜¯æœ¬åœ°å“ªä¸ªé…ç½®æ–‡ä»¶ç‚¸äº†ä¸€å¼€å§‹æ‰æ˜¾ç¤ºä¸äº†ã€‚ æ€»ç»“ äººç”Ÿ -1h å¼ºè¿«ç—‡æ»¡è¶³++ æŠ˜è…¾ Linux ç»éªŒ++","categories":[{"name":"Journal","slug":"Journal","permalink":"http://blog.vollate.top/categories/Journal/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://blog.vollate.top/tags/Linux/"},{"name":"KDE Plasma","slug":"KDE-Plasma","permalink":"http://blog.vollate.top/tags/KDE-Plasma/"}]},{"title":"Linux ä¸‹ç³»ç»Ÿä»£ç†é…ç½®","slug":"linux-desktop-system-proxy","date":"2024-01-09T15:57:33.000Z","updated":"2024-05-10T18:01:09.000Z","comments":true,"path":"2024/01/09/linux-desktop-system-proxy/","permalink":"http://blog.vollate.top/2024/01/09/linux-desktop-system-proxy/","excerpt":"","text":"é…ç½® firefox ç³»ç»Ÿä»£ç†æ—¶å‡ºç°äº†ä¸€äº›é—®é¢˜ï¼Œç„¶åæŸ¥äº†ä¸‹ Linux æ¡Œé¢ç³»ç»Ÿä»£ç†çš„åŸç†ï¼Œè®°å½•ä¸€ä¸‹ ç³»ç»Ÿä¿¡æ¯: 12345678OS: Arch Linux x86_64 Kernel: 6.6.10-arch1-1 Packages: 1369 (pacman) Shell: zsh 5.9 DE: Plasma 5.27.10 WM: KWin Theme: [Plasma], Canta-dark [GTK2/3] Icons: Tela-circle-manjaro-dark [Plasma], Tela-circle-manjaro-dark [GTK2/3] ä½¿ç”¨ clash-verge è¿›è¡Œä»£ç†ï¼Œç„¶å system-proxy è®¾ç½®ä¸º manual å edge å’Œ chrome èƒ½æ­£å¸¸è¯†åˆ«ã€‚ä½†æ˜¯ firefox æ­»æ´»ä¸è¡Œï¼Œä¸Šç½‘æŸ¥äº†ä¸æ”¯æŒä»£ç†çš„é—®é¢˜æ˜¯11å¹´å‰çš„ã€‚ æ— å¥ˆå¼€å§‹æ€€ç–‘æ˜¯ firefox ä¸æ”¯æŒ KDE æ¡Œé¢ç¯å¢ƒçš„ç³»ç»Ÿä»£ç†è®¾ç½®ã€‚ KDE ç³»ç»Ÿä»£ç†é…ç½® å¦‚ä¸Šå›¾ï¼Œé…ç½®å¥½åï¼Œç³»ç»Ÿä»£ç†çš„ä¿¡æ¯å¯ä»¥åœ¨ ~/.config/kioslaverc ä¸­æ‰¾åˆ° GNOME ç³»ç»Ÿä»£ç†é…ç½® GNOME æ¡Œé¢åŒæ ·å¯ä»¥é€šè¿‡ GUI é…ç½®ç³»ç»Ÿä»£ç†ï¼Œå…·ä½“ä¸å±•ç¤ºäº†å› ä¸ºæ²¡ GNOME æ¡Œé¢(å…¨ç”¨Archå¯¼è‡´çš„ã€‚GNOME ä¸‹æ¡Œé¢åº”ç”¨å¯ä»¥é€šè¿‡ gsettings æ¥è·å–å¯¹åº”çš„ key å€¼ï¼Œå¦‚ gsettings get org.gnome.system.proxy mode å¯ä»¥è·å–ç°åœ¨çš„ç³»ç»Ÿä»£ç†æ¨¡å¼ã€‚ è§£å†³é—®é¢˜ å‘ç° clash-verge å†…ç½®çš„ç³»ç»Ÿä»£ç†é…ç½®çš„æ˜¯ gsettings çš„é€‰é¡¹ï¼Œè€Œä¸” firefox åªè®¤ GNOME çš„ç³»ç»Ÿä»£ç†é…ç½®(Mozilla å¿«æŠŠ firefox ç©æ­»äº†)ã€‚å› æ­¤ä¹‹å‰ä¸€ç›´æ²¡æœ‰æˆåŠŸã€‚Ubuntu ç”¨æˆ·å¤ªå¤šå¯¼è‡´è½¯ä»¶é€‚é…å€¾å‘äº GNOME æ¡Œé¢ï¼Œä½†æ˜¯çœŸçš„å¥½ä¸‘å•Š GNOMEã€‚ å°è´´å£«ï¼šä¸€èˆ¬æ¡Œé¢ app ä¸åƒ env variable è¿™ä¸€å¥—","categories":[{"name":"Journal","slug":"Journal","permalink":"http://blog.vollate.top/categories/Journal/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://blog.vollate.top/tags/Linux/"},{"name":"Proxy","slug":"Proxy","permalink":"http://blog.vollate.top/tags/Proxy/"}]},{"title":"VPS æµ‹è¯•è„šæœ¬æ•´ç†","slug":"vps-testscripts","date":"2023-12-13T07:44:50.000Z","updated":"2024-05-10T18:01:09.000Z","comments":true,"path":"2023/12/13/vps-testscripts/","permalink":"http://blog.vollate.top/2023/12/13/vps-testscripts/","excerpt":"","text":"æ•´ç†è‡ªçŸ¥ä¹ åŸºç¡€æµ‹è¯•(IO+ç½‘é€Ÿ) Bench wget -qO- bench.sh | bashcurl -Lso- bench.sh | bashwget -qO- 86.re/bench.sh | bashcurl -so- 86.re/bench.sh | bash SuperBench ä¼šå®‰è£…è¾ƒå¤šä¸œè¥¿ï¼Œæµ‹å¾—ä¹Ÿè¾ƒå…¨ï¼Œå¹¶ä¸”ç½‘ç»œæµ‹é€Ÿæ³¨é‡å›å›½é€Ÿåº¦ wget -qO- --no-check-certificate https://raw.githubusercontent.com/oooldking/script/master/superbench.sh | bashcurl -Lso- -no-check-certificate https://raw.githubusercontent.com/oooldking/script/master/superb Superseed æä¾›æµ‹è¯•å…¨å›½å„åœ°ä¸‰å¤§è¿è¥å•†é€Ÿåº¦ wget https://raw.githubusercontent.com/oooldking/script/master/superspeed.sh &amp;&amp; chmod +x superspeed.sh &amp;&amp; ./superspeed.sh UnixBench ä¸»è¦æµ‹è¯•é¡¹ç›®æœ‰ï¼šç³»ç»Ÿè°ƒç”¨ã€è¯»å†™ã€è¿›ç¨‹ã€å›¾å½¢åŒ–æµ‹è¯•ã€2Dã€3Dã€ç®¡é“ã€è¿ç®—ã€Cåº“ç­‰ç³»ç»ŸåŸºå‡†æ€§èƒ½æä¾›æµ‹è¯•æ•°æ®ï¼Œå‘å¸ƒé¡µ wget --no-check-certificate https://github.com/teddysun/across/raw/master/unixbench.shchmod +x unixbench.sh./unixbench.sh Memory Test 123456789101112#CentOS / RHELyum install wget -yyum groupinstall &quot;Development Tools&quot; -ywget https://raw.githubusercontent.com/FunctionClub/Memtester/master/memtester.cppgcc -l stdc++ memtester.cpp./a.out#Ubuntu / Debianapt-get updateapt-get install wget build-essential -ywget https://raw.githubusercontent.com/FunctionClub/Memtester/master/memtester.cppgcc -l stdc++ memtester.cpp./a.out","categories":[{"name":"Journal","slug":"Journal","permalink":"http://blog.vollate.top/categories/Journal/"}],"tags":[{"name":"Server","slug":"Server","permalink":"http://blog.vollate.top/tags/Server/"}]},{"title":"ç¼–è¯‘ä¹‹æ³•","slug":"compile-knowledge","date":"2023-12-08T07:34:57.000Z","updated":"2024-06-14T15:23:41.000Z","comments":true,"path":"2023/12/08/compile-knowledge/","permalink":"http://blog.vollate.top/2023/12/08/compile-knowledge/","excerpt":"","text":"ä»¥ C/C++ ä¸ºä¾‹ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹ Linux ä¸‹ç¼–è¯‘çš„ç›¸å…³çŸ¥è¯†ã€‚çœ‹å®Œåº”è¯¥èƒ½æŒæ¡åŸºç¡€çš„ç¼–è¯‘èƒ½åŠ›ï¼Œå¤„ç†æŠ¥é”™ä¸å†æŠ“çã€‚ éº»éº»å†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘é‡åˆ°é—®é¢˜åªèƒ½çé€› stackoverflow äº† è¯¥é€›è¿˜å¾—é€› åŸºç¡€çŸ¥è¯† ç¼–è¯‘å‹è¯­è¨€ä¸è§£é‡Šå‹è¯­è¨€ ç¼–è¯‘å‹è¯­è¨€æ˜¯å°†ä»£ç ç›´æ¥ç¼–è¯‘æˆæœºå™¨å¯ä»¥ç›´æ¥æ‰§è¡Œçš„æœºå™¨ç ï¼Œå¯ä»¥ç›´æ¥åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œã€‚ä»£è¡¨æ˜¯ Fortran, C, C++, RUST, Go ç­‰ã€‚ è§£é‡Šå‹è¯­è¨€æ˜¯é€šè¿‡è§£é‡Šå™¨é€è¡Œè§£é‡Šæ¯æ¡å‘½ä»¤æ¥æ‰§è¡Œå¯¹åº”çš„æ“ä½œï¼Œè¿è¡Œä¸éœ€è¦ç¼–è¯‘ï¼Œä½†æ˜¯éœ€è¦å¯¹åº”çš„è§£é‡Šå™¨è§£é‡Šæˆå¯¹åº”æ¶æ„çš„æŒ‡ä»¤ã€‚ä»£è¡¨æ˜¯ Python, ECMAScript, PHP ç­‰ç­‰ã€‚ ä¹Ÿè¿˜æœ‰ä¸€äº›ä¸¤è€…å…¼å…·çš„ï¼Œå¦‚ JAVAï¼Œç¼–è¯‘æˆå­—èŠ‚ç ï¼Œç„¶åç”± JVM è§£é‡Šæ‰§è¡Œã€‚ æ±‡ç¼–è¯­è¨€ æ±‡ç¼–è¯­è¨€æ˜¯æœ€æ¥è¿‘äºæœºå™¨ç çš„è¯­è¨€ï¼Œå’Œç›®æ ‡æœºå™¨çš„æŒ‡ä»¤é›†æ¶æ„ç´§å¯†ç›¸å…³ä¹Ÿç§°ä¸ºä½çº§è¯­è¨€ã€‚æŒ‡ä»¤é›†æ˜¯ä¸€ç§æŠ½è±¡ï¼Œå®ƒå°†è®¡ç®—æœºçš„ç‰©ç†å®ç°æŠ½è±¡æˆæŒ‡ä»¤é›†è§„å®šçš„ä¸€ç³»åˆ—æ“ä½œï¼Œä½¿å¾—åŒä¸€æ¶æ„çš„ä¸åŒå‹å·è®¡ç®—æœºèƒ½è¿ç®—åŒä¸€ä¸ªç¨‹åºï¼Œä¸”è§„å®šäº†ç¨‹åºå¦‚ä½•æ“ä½œç¡¬ä»¶å®Œæˆè®¡ç®—ã€‚æ±‡ç¼–ä¹‹æ‰€ä»¥æˆä¸ºæœ€æ¥è¿‘äºæœºå™¨ç çš„è¯­è¨€ï¼Œæ˜¯åœ¨äºå®ƒåªéœ€è¦è¿›è¡Œç®€å•çš„æ›¿æ¢å°±èƒ½ç”Ÿæˆå¯¹åº”çš„æœºå™¨ç ã€‚ ä¸¾ä¸ª MIPS32 æ¶æ„æ±‡ç¼–çš„ä¾‹å­ï¼š add $1,$2,$3 è¿™æ¡æŒ‡ä»¤å°†2å’Œ3å·å¯„å­˜å™¨çš„å€¼ç›¸åŠ å­˜å‚¨åˆ°1å·å¯„å­˜å™¨ä¸­ï¼Œæ ¹æ® MIPS32 çš„è½¬æ¢è§„åˆ™ï¼Œç”Ÿæˆçš„äºŒè¿›åˆ¶æœºå™¨ç å¦‚ä¸‹: opcode rs rt rd shamt func 000000 00010 00011 00001 00000 100000 æ“ä½œç ï¼ˆopcodeï¼‰ï¼šå¯¹äº add æ“ä½œï¼Œå®ƒçš„æ“ä½œç æ˜¯ 000000ã€‚ æºå¯„å­˜å™¨2ï¼ˆrsï¼‰ï¼š$2 å¯¹åº”çš„å¯„å­˜å™¨æ˜¯ 00010ã€‚ æºå¯„å­˜å™¨3ï¼ˆrtï¼‰ï¼š$3 å¯¹åº”çš„å¯„å­˜å™¨æ˜¯ 00011ã€‚ ç›®æ ‡å¯„å­˜å™¨ï¼ˆrdï¼‰ï¼š$1 å¯¹åº”çš„å¯„å­˜å™¨æ˜¯ 00001ã€‚ ç§»ä½é‡ï¼ˆshamtï¼‰ï¼šå¯¹äº add æ“ä½œè€Œè¨€ï¼Œä¸æ¶‰åŠç§»ä½ï¼Œå› æ­¤ä¸º 00000ã€‚ åŠŸèƒ½ç ï¼ˆfunctï¼‰ï¼šadd æ“ä½œçš„åŠŸèƒ½ç æ˜¯ 100000ã€‚ æ±‡ç¼–è¯­è¨€ç»è¿‡ç®€å•çš„å¤„ç†å°±å¯ä»¥ç›´æ¥è½¬æ¢ä¸ºæœºå™¨ç ï¼Œä½†æ˜¯æœ‰è®¸å¤šåå¤„: å¯è¯»æ€§å·®ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª clang ç”Ÿæˆçš„ç®€å•çš„ hello world ç¨‹åºçš„æ±‡ç¼–ä»£ç  12345678910111213141516171819202122232425262728293031323334353637 .text .file &quot;test.c&quot; .globl main # -- Begin function main .p2align 4, 0x90 .type main,@functionmain: # @main .cfi_startproc# %bb.0: pushq %rbp .cfi_def_cfa_offset 16 .cfi_offset %rbp, -16 movq %rsp, %rbp .cfi_def_cfa_register %rbp subq $16, %rsp movl $0, -4(%rbp) leaq .L.str(%rip), %rdi movb $0, %al callq printf@PLT xorl %eax, %eax addq $16, %rsp popq %rbp .cfi_def_cfa %rsp, 8 retq.Lfunc_end0: .size main, .Lfunc_end0-main .cfi_endproc # -- End function .type .L.str,@object # @.str .section .rodata.str1.1,&quot;aMS&quot;,@progbits,1.L.str: .asciz &quot;Hello, World!\\n&quot; .size .L.str, 15 .ident &quot;clang version 16.0.6&quot; .section &quot;.note.GNU-stack&quot;,&quot;&quot;,@progbits .addrsig .addrsig_sym printf æ±‡ç¼–ä¸­æ²¡æœ‰æˆ‘ä»¬å¸¸ç”¨çš„æ§åˆ¶æµï¼Œéœ€è¦æ‰‹å†™åˆ¤æ–­è·³è½¬çš„æ“ä½œ 2. å¯ç§»æ¤æ€§å·®ï¼Œåªä½¿ç”¨äºç‰¹å®šæ¶æ„çš„è®¡ç®—æœºã€‚å¦‚æœä½ æƒ³è¦ä½ çš„æ±‡ç¼–ç¨‹åºåŒæ—¶åœ¨ arm64 å’Œ x86_64 ä¸Šè¿è¡Œï¼Œä½ éœ€è¦å†™ä¸¤ä»½ä»£ç ã€‚ 3. å…¶ä»–å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†â€¦â€¦ å‡½æ•°å£°æ˜å’Œå®šä¹‰ åœ¨ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç”¨å‡½æ•°æ¥è¡¨ç¤ºä¸€ç§ç‰¹å®šçš„æ“ä½œï¼Œå®ƒèƒ½å¤Ÿå¤„ç†æˆ‘ä»¬çš„è¾“å…¥å¹¶ä¸”äº§ç”Ÿå¯¹åº”çš„è¾“å‡º(å‰¯ä½œç”¨)ã€‚æƒ³æ·±å…¥äº†è§£å¯ä»¥çœ‹çœ‹Î»æ¼”ç®—ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»äº†ã€‚å‡½æ•°èƒ½å¤Ÿç®€åŒ–æˆ‘ä»¬çš„ä»£ç ï¼Œå¯¹äºéœ€è¦åœ¨å¤šå¤„é‡å¤æ‰§è¡Œçš„æ“ä½œï¼Œæˆ‘ä»¬é€šè¿‡å°†ä»–åŒ…è£…æˆå‡½æ•°æ¥ç®€åŒ–æˆ‘ä»¬çš„ä»£ç ã€‚ å‡½æ•°çš„å£°æ˜å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨æˆ‘ä»¬æœ‰è¿™ä¹ˆä¸€ä¸ªå«xxxçš„å‡½æ•°ï¼Œå®ƒçš„è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯ä»€ä¹ˆç±»å‹ã€‚å®šä¹‰åˆ™æ˜¯å…·ä½“æè¿°äº†å‡½æ•°å¦‚ä½•å¤„ç†è¾“å…¥æœ€ç»ˆå¾—åˆ°è¾“å‡ºã€‚ åœ¨ç¼–ç¨‹ä¸­ï¼Œå‡½æ•°å¾€å¾€æ˜¯å£°æ˜å’Œå®šä¹‰åˆ†å¼€ï¼Œæ¥å°†é€»è¾‘å’Œå‡½æ•°è§£è€¦ã€‚åœ¨ C/C++ ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ #include é¢„å¤„ç†å‘½ä»¤æ¥å¼•ç”¨å¤´æ–‡ä»¶ï¼Œå¤´æ–‡ä»¶ä¸­åŒ…å«äº†å‡½æ•°å£°æ˜ã€‚é¢„å¤„ç†å™¨ä¼šç›´æ¥å°†è¢« include çš„æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°é¢„å¤„ç†åçš„æ–‡ä»¶å¯¹åº”ä½ç½®ä¸­ã€‚ ç¼–è¯‘è¿‡ç¨‹ ç¼–è¯‘å™¨æ˜¯ä¸€ç§è®¡ç®—æœºç¨‹åºï¼Œå®ƒä¼šå°†æŸç§ç¼–ç¨‹è¯­è¨€å†™æˆçš„æºä»£ç è½¬æ¢æˆå¦ä¸€ç§ç¼–ç¨‹è¯­è¨€ã€‚ä¸»è¦ç”¨é€”æ˜¯å°†ä¾¿äºäººç¼–å†™ã€é˜…è¯»ã€ç»´æŠ¤çš„é«˜çº§è®¡ç®—æœºè¯­è¨€æ‰€å†™ä½œçš„æºä»£ç ç¨‹åºï¼Œç¿»è¯‘ä¸ºç›®æ ‡æœºå™¨èƒ½è§£è¯»ã€è¿è¡Œçš„ä½é˜¶æœºå™¨è¯­è¨€çš„ç¨‹åºã€‚å°†é«˜çº§è¯­è¨€è½¬åŒ–ä¸ºä½çº§è¯­è¨€çš„è¿‡ç¨‹ç§°ä¸ºç¼–è¯‘ï¼Œåè¿‡æ¥æˆä¸ºåç¼–è¯‘ã€‚ ä¸€èˆ¬ç¼–è¯‘çš„è¿‡ç¨‹åˆ†ä¸ºå¦‚ä¸‹æ­¥éª¤: é¢„å¤„ç†: è¿›è¡Œæ–‡æœ¬æ›¿æ¢ç­‰å…¶ä»–æ“ä½œï¼Œå¦‚ C/C++ é‡Œ â€œ#xxxâ€ é¢„å¤„ç†å‘½ä»¤çš„å±•å¼€ä»¥åŠå®çš„æ›¿æ¢ ç¼–è¯‘ï¼šå°†æºä»£ç è½¬æ¢ä¸ºå¯¹åº”æ¶æ„çš„æ±‡ç¼–ä»£ç ï¼Œç”Ÿæˆ.sæ±‡ç¼–æ–‡ä»¶ æ±‡ç¼–ï¼šå°†ä¸Šä¸€æ­¥ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ç¿»è¯‘æˆäºŒè¿›åˆ¶æœºå™¨ç ï¼Œç”Ÿæˆ.o object æ–‡ä»¶ é“¾æ¥ï¼šå°†ä¸Šä¸€æ­¥ç”Ÿæˆçš„æ–‡ä»¶å’Œæ‰€éœ€è¦çš„é™æ€/åŠ¨æ€åº“é“¾æ¥ä¸ºä¸€ä¸ªæ–°çš„ object æ–‡ä»¶ æ³¨æ„ä¸æ˜¯æ‰€æœ‰è¯­è¨€çš„ç¼–è¯‘éƒ½æœ‰ä¸Šè¿°çš„å‡ ä¸ªéƒ¨åˆ†ï¼Œå¦‚ JAVA ã€‚ é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥ æˆ‘ä»¬å¯ä»¥é€šè¿‡å£°æ˜è®©åœ¨å¤šä¸ªåœ°æ–¹ä½¿ç”¨å‡½æ•°è€Œåªéœ€æä¾›ä¸€æ¬¡å®šä¹‰ï¼ŒåŒç†ï¼Œå¤šä¸ªæ–‡ä»¶å¯ä»¥å…±ç”¨åŒä¸€ä¸ªå‡½æ•°ï¼Œåªéœ€è¦é“¾æ¥åŒ…å«äº†å‡½æ•°å®šä¹‰çš„ library å³å¯ï¼Œæ— éœ€é‡å¤ç¼–è¯‘ã€‚é“¾æ¥æ–¹å¼æœ‰å¦‚ä¸‹ä¸¤ç§: é™æ€é“¾æ¥ï¼šå°†è¢«é“¾æ¥çš„åº“çš„æ‰€æœ‰ä»£ç åµŒå…¥åˆ°æ–°çš„å¯æ‰§è¡Œæ–‡ä»¶æˆ–ç›®æ ‡æ–‡ä»¶ä¸­ã€‚ ä¼˜ç‚¹ï¼šç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸éœ€è¦ä¾èµ–å¤–éƒ¨åº“ ç¼ºç‚¹ï¼š ç”Ÿæˆæ–‡ä»¶å˜å¤§ å¦‚æœè¢«é“¾æ¥çš„åº“æ›´æ–°ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘ æ— æ³•é‡å¤åˆ©ç”¨å…±äº«åº“ åŠ¨æ€é“¾æ¥ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶æˆ–è¿è¡Œå‰çš„è£…è½½é˜¶æ®µå°†å¤–éƒ¨åº“ä»£ç åŠ è½½åˆ°å†…å­˜ä¸­çš„è¿‡ç¨‹ã€‚å¯æ‰§è¡Œæ–‡ä»¶åªåŒ…å«å¯¹è¿™äº›åº“çš„å¼•ç”¨ï¼Œä¸åŒ…å«å®é™…çš„åº“ä»£ç  ä¼˜ç‚¹ï¼š å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥æ›´å° å¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥å¤ç”¨åŒä¸€ä¸ª lib å¦‚æœæ›´æ–°ä¸æ”¹å˜å‡½æ•°æ¥å£ï¼Œåˆ™æ— éœ€é‡æ–°ç¼–è¯‘ ç¼ºç‚¹ï¼š ä¼šä¾èµ–å¤–éƒ¨åº“ï¼Œå¦‚ linux çš„ glibcã€‚å¦‚æœç‰ˆæœ¬ä¸å…¼å®¹ï¼Œè¿è¡Œæ—¶ä¼šæŠ¥é”™ã€‚ å¯åŠ¨æ—¶ä¼šç•¥å¾®å¢åŠ æ—¶é—´ åŠ¨æ€é“¾æ¥åº“ .dll (Dynamic link library)æ˜¯ Windows ä¸‹çš„çš„ç§°å‘¼ï¼Œåœ¨ Unix/Linux ä¸‹ç§°ä¸º Shared Object .soï¼Œæœ¬æ–‡ä¼šç»Ÿä¸€å«åŠ¨æ€é“¾æ¥åº“(å«é¡ºå£äº†)ã€‚ Linux ä¸‹ï¼Œé™æ€é“¾æ¥åº“ä¸€èˆ¬ä»¥ .a ç»“å°¾ (archive) gcc/clang ä½¿ç”¨ æœ¬ç« ä¸»è¦ä»‹ç»åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ gcc/clang è¿›è¡Œç¼–è¯‘çš„çš„è¿‡ç¨‹å’Œæ³¨æ„äº‹é¡¹ï¼Œä»¥ä¸‹å‘½ä»¤ä¸­çš„ clang éƒ½å¯ä»¥æ¢æˆ gccã€‚ä½†æ˜¯æ³¨æ„ï¼Œä¸åŒç¼–è¯‘å™¨æ‰€æ”¯æŒçš„ç¼–è¯‘å‚æ•°å¹¶ä¸å®Œå…¨ç›¸åŒï¼Œå› æ­¤é¡¹ç›®ä¸­éœ€è¦å¯¹ä¸åŒçš„ç¼–è¯‘å™¨è¿›è¡Œä¸åŒå‚æ•°çš„é€‚é…ã€‚ è·å–å¸®åŠ© man clangï¼Œman æ˜¯ Linux ä¸‹çš„ä¸€ä¸ª reference é¡µé¢ï¼Œå®‰è£…çš„ç¨‹åºå¯ä»¥ä»¥ä¸€å®šæ ¼å¼æä¾› manual ä¾› man å‘½ä»¤è°ƒç”¨ã€‚man ä½¿ç”¨ vim çš„é”®ä½ï¼ŒæŒ‰ / å»ºå¼€å§‹æœç´¢ï¼Œn å»ºä¸‹ä¸€ä¸ªï¼ŒN é”®ä¸Šä¸€ä¸ªï¼ŒæŒ‰ q é”®é€€å‡ºã€‚ä½ å¯ä»¥ä½¿ç”¨ man man æ¥æŸ¥çœ‹ man çš„ manualï¼Œå¦‚æœä½ åªæƒ³è·å¾—ç®€å•çš„å¸®åŠ©ï¼Œè¯·ä½¿ç”¨ clang --help ç¼–è¯‘ä¸€ä¸ªæ–‡ä»¶ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ test.c clang test.c -o test æ³¨æ„ï¼Œåœ¨ clang/gcc é»˜è®¤ä½¿ç”¨ â€œmainâ€ ä½œä¸ºä¸»å‡½æ•°çš„å…¥ç‚¹ï¼Œå¦‚æœä½ çš„æ–‡ä»¶ä¸­æ²¡æœ‰ main å‡½æ•°ï¼Œç¼–è¯‘ä¼šæŠ¥é”™ï¼Œå› ä¸ºç¼–è¯‘å™¨æ²¡æœ‰æ‰¾åˆ°ä¸»å‡½æ•°å…¥å£ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ â€œ-oâ€ æŒ‡å®šè¾“å‡ºæ–‡ä»¶åç§°ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸º â€œa.outâ€ ç¼–è¯‘ä¸€ä¸ªåº“ mBool.c 123456789# static libclang -c mBool.c -o mBool.o # è¿™é‡Œä¸å†™é»˜è®¤ç”ŸæˆåŒååç¼€ä¸º.oçš„å¯¹åº”æ–‡ä»¶ar r mBool.a mBool.o # for GNU toolchainllvm-ar r libmBool.a mBool.o # for llvm toolchain# ar å°†æ‰€æœ‰(è¿™é‡Œåªæœ‰ä¸€ä¸ª) .o æ–‡ä»¶æ‰“åŒ…ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªç´¢å¼•è¡¨ä»¥ä¾›æŸ¥æ‰¾ã€‚æŸäº›æƒ…å†µï¼Œä¼šé€‰æ‹©æ€§å¯¹æ–‡ä»¶è¿›è¡Œå‹ç¼©# shared libclang -shared mBool.c -o libmBool.so -fPIC# ä¸Šè¿°åŠ¨æ€é“¾æ¥åº“çš„ç¼–è¯‘è¿‡ç¨‹ä¸­ä½¿ç”¨äº† `-fPIC` è¿™ä¸ªå‚æ•°ï¼Œæ„å‘³ç€ç”Ÿæˆ position independent codeï¼Œè¿™æ ·æˆ‘ä»¬çš„åŠ¨æ€é“¾æ¥åº“å°±å¯ä»¥åœ¨ä»»æ„åœ°å€è¢«è£…è½½ã€‚ é“¾æ¥ä¸€ä¸ªåº“ mBoolTest.c è¿™é‡Œæˆ‘æ‡’å¾—å†™å¤´æ–‡ä»¶äº†ï¼Œç›´æ¥å‰ç½®å£°æ˜äº† 123456789101112# link the static libclang -o mTest.out mBoolTest.c `pwd`/mBool.aclang -o mTest.out -static mBoolTest.c -L`pwd` -lmBool # if no shared lib, &quot;-static&quot; is uneeded# link the shared libclang -o mTest.out mBoolTest.c -L`pwd` -lmBool# ref:# -L$&#123;target_lib_path&#125;# -l$&#123;lib_name&#125; # compiler will try to find lib$&#123;lib_name&#125;.a/so# -l:$&#123;custom_lib_name&#125;# -static # use static link å¯¹äºé™æ€é“¾æ¥åº“ï¼Œæˆ‘ä»¬ç›´æ¥å°†å…¶ä½œä¸ºè¾“å…¥å³å¯é“¾æ¥ï¼Œå› ä¸ºå…¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªç¼–è¯‘åç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ .o å¯¹äºåŠ¨æ€é“¾æ¥åº“ï¼Œç¼–è¯‘å™¨ä¼šæœ‰ä¸€äº›ç³»ç»Ÿé»˜è®¤çš„åŠ¨æ€åº“ç›®å½•ï¼Œå®ƒä¼šè¿›å…¥ç›®å½•ä¸‹æŸ¥æ‰¾ã€‚æ˜¾ç„¶æˆ‘ä»¬å½“å‰çš„æ–‡ä»¶å¤¹å¹¶ä¸åœ¨æ­¤ä¹‹åˆ—ï¼Œå› æ­¤ä¸ºäº†è®©ç¼–è¯‘å™¨è¿›å…¥æˆ‘ä»¬å½“å‰çš„ç›®å½•ä¸‹æŸ¥æ‰¾é“¾æ¥åº“ï¼Œæˆ‘ä»¬ä½¿ç”¨ -L æ¥åŠ å…¥æˆ‘ä»¬åº“æ‰€åœ¨çš„ç›®å½•æ¥è®©ç¼–è¯‘å™¨æŸ¥æ‰¾ã€‚æˆ‘ä»¬ä¹‹å‰å°†ç¼–è¯‘å‡ºæ¥çš„åº“å‘½åä¸º â€œlibmBool.*â€ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨ -l æ¥é“¾æ¥æˆ‘ä»¬çš„åº“ã€‚å› ä¸ºæˆ‘ä»¬çš„ç›®å½•ä¸‹åŒæ—¶å­˜åœ¨é™æ€å’ŒåŠ¨æ€é“¾æ¥åº“ï¼Œå› æ­¤ç¼–è¯‘å™¨é»˜è®¤ä½¿ç”¨åŠ¨æ€é“¾æ¥ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ -static æ¥è®©ç¼–è¯‘å™¨ä½¿ç”¨é™æ€é“¾æ¥åº“ã€‚ ä½¿ç”¨ -rpath/-runpath ç°åœ¨æˆ‘ä»¬å°è¯•è¿è¡Œæˆ‘ä»¬åˆšåˆšé“¾æ¥å®ŒåŠ¨æ€é“¾æ¥åº“çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åå°±æŠ¥é”™äº† ./mTest.out: error while loading shared libraries: libmBool.so: cannot open shared object file: No such file or directory ç³»ç»Ÿæç¤ºæˆ‘ä»¬æ‰¾ä¸åˆ°åŠ¨æ€é“¾æ¥åº“ã€‚å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å­˜å‚¨åŠ¨æ€é“¾æ¥åº“çš„ä½ç½®ï¼ŒåŠ¨æ€é“¾æ¥å™¨(å¦‚ ld-linux.so)ä¸çŸ¥é“å»å“ªåŠ è½½æˆ‘ä»¬çš„åŠ¨æ€é“¾æ¥åº“æˆ‘ä»¬ä½¿ç”¨ -rpath æ¥å­˜å‚¨åŠ¨æ€é“¾æ¥åº“çš„ç›®å½•ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ï¼Œä¸€èˆ¬ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œè¿™æ ·ç¨‹åºåªè¦ä¿æŒæ–‡ä»¶å†…çš„ç»“æ„ä¸å˜å³å¯åœ¨å„å¤„æ‰§è¡Œã€‚æ³¨æ„ï¼Œè¿™ä¸ªå‚æ•°æ˜¯åŠ ç»™é“¾æ¥å™¨çš„ï¼Œclang å¯ä»¥ç›´æ¥ä¼ é€’ç»™é“¾æ¥å™¨ï¼Œä½†æ˜¯ gcc éœ€è¦ä½¿ç”¨ -Wl æ¥ä¼ é€’ç»™é“¾æ¥å™¨ã€‚runpath å’Œ rpath ç›¸æ¯”ï¼Œæ›´æ–°ï¼Œä¸€äº›è€æ—§çš„åŠ¨æ€é“¾æ¥å™¨å¯èƒ½ä¸æ”¯æŒï¼Œä½†æ˜¯æä¾›äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œå…·ä½“ä¸‹é¢ä¼šè®²åˆ°ã€‚ 1234567891011121314# use relative pathclang -o mTest.out mBoolTest.c -L`pwd` -lmBool -rpath . # clang could ignore the -Wl for rpath, but gcc can&#x27;tclang -o mTest.out mBoolTest.c -L`pwd` -lmBool -Wl,-rpath . # also worksgcc -o mTest.out mBoolTest.c -L`pwd` -lmBool -Wl,-rpath .# use absolute pathclang -o mTest.out mBoolTest.c -L`pwd` -lmBool -rpath `pwd`clang -o mTest.out mBoolTest.c -L`pwd` -lmBool -Wl,-rpath `pwd`# use runpathclang -o mTest.out mBoolTest.c -L`pwd` -lmBool -Wl,--enable-new-dtags -Wl,-rpath . # gcc paremeter is the same# force use rpath(disable runpath)clang -o mTest.out mBoolTest.c -L`pwd` -lmBool -Wl,-rpath . -Wl,--disable-new-dtags å¼•ç”¨å¤´æ–‡ä»¶ ç°åœ¨æˆ‘ä»¬ä¸å·æ‡’äº†ï¼Œå¼•å…¥ä¸€ä¸ªå¤´æ–‡ä»¶ head.hï¼Œåˆ›å»ºä¸€ä¸ª nMBoolTest.cï¼Œå‡è®¾å¤´æ–‡ä»¶å­˜å‚¨åœ¨ç›®å½• /tmp ä¸‹ï¼Œæˆ‘ä»¬è¦è®©ç¼–è¯‘å™¨çŸ¥é“æˆ‘ä»¬å¤´æ–‡ä»¶çš„ä½ç½®ï¼Œä½¿ç”¨ -I é€‰é¡¹ clang -o nTest.out nMBoolTest.c -L`pwd` -lmBool -rpath `pwd` -I/tmp ä½¿ç”¨ç¯å¢ƒå˜é‡ å‡è®¾æˆ‘ä»¬æ²¡æœ‰ makeï¼Œcmake è¿™æ ·çš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œæˆ–è€…æœ‰ä¸€ä¸ªå¤æ‚æ— æ¯”çš„ Makefile/CMakeLists.txtï¼Œæ— æ³•è½»æ˜“æ›´æ”¹ã€‚æˆ‘ä»¬éœ€è¦è®©ç¼–è¯‘å™¨çŸ¥é“æˆ‘ä»¬è‡ªå®šä¹‰çš„ header å’Œ lib çš„ä½ç½®ï¼Œè¿™æ—¶å€™å°±éœ€è¦æˆ‘ä»¬çš„ç¯å¢ƒå˜é‡ç™»åœºäº†ã€‚ä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ï¼Œæ›´å¤šçš„çœ‹å¯¹åº”ç¼–è¯‘å™¨çš„æ–‡æ¡£ï¼ŒGCC C_INCLUDE_PATHï¼šé˜…è¯»ç†è§£ï¼ˆ C_PATHï¼šsame as above CPLUS_INCLUDE_PATHï¼šé˜…è¯»ç†è§£ï¼ˆ LIBRARY_PATHï¼šå‘Šè¯‰é“¾æ¥å™¨åº“çš„ä½ç½®ï¼Œé“¾æ¥æ—¶ä¼šè¿›å…¥è¯¥ç›®å½•æœç´¢ LD_LIBRARY_PATH: å‘Šè¯‰åŠ¨æ€é“¾æ¥å™¨åº“çš„ä½ç½®ï¼Œè¿è¡Œæ—¶ä¼šè¿›å…¥è¯¥ç›®å½•æœç´¢ ä»¥ä¸Šå†™æ³•å†™æ³•åŒ PATHï¼Œç”¨ : åˆ†éš”æ¯ä¸ªè·¯å¾„ ld.so(åŠ¨æ€é“¾æ¥å™¨) æœç´¢é¡ºåº: ç¼–è¯‘æ—¶è®¾ç½®çš„ rpath è·¯å¾„ ç¯å¢ƒå˜é‡ LD_LIBRARY_PATH ç¼–è¯‘æ—¶è®¾ç½®çš„ runpath: runpath çš„æœç´¢ä¼˜å…ˆçº§ä½äº LD_LIBRARY_PATHï¼Œå› æ­¤å®ƒå¯ä»¥å…è®¸ç”¨æˆ·è®¾ç½® LD_LIBRARY_PATH æ¥è¦†ç›– runpath æŒ‡å®šçš„åº“ï¼Œæä¾›æ›´å¤šçš„çµæ´»æ€§ã€‚è€Œ rpath åˆ™ä¸è¡Œã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€æœ‰å¯èƒ½ä¼šæ— æ„é—´ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„åº“ï¼Œé€ æˆä¸€äº›é—®é¢˜ã€‚ ç¼“å­˜æ–‡ä»¶(å¦‚ /etc/ld.so.cache): åŒ…å«äº†å½“å‰ç¯å¢ƒä¸­å¯ç”¨åº“çš„ç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨ ldconfig æ¥æ›´æ–° é»˜è®¤è·¯å¾„ï¼Œå¦‚ â€œ/libâ€, â€œ/usr/libâ€ ç­‰ç­‰ å¸¸ç”¨ç¼–è¯‘é€‰é¡¹: -g: generate debug info -O0, -O1, -O3, -Ofast: è®¾ç½®ç¼–è¯‘å™¨ä¼˜åŒ–ç­‰çº§ï¼Œç­‰çº§è¶Šé«˜ä¼˜åŒ–è¶Šå¤šã€‚O0æ— ä¼˜åŒ–ï¼ŒOfast å¯ç”¨O3çš„åŒæ—¶ä½¿ç”¨ä¸€äº›ä¸ç¬¦åˆ ISO æ ‡å‡†çš„ä¼˜åŒ– -vï¼šè¾“å‡ºæ‰§è¡Œçš„å‘½ä»¤ -xï¼šæ˜¾ç¤ºæŒ‡å®šè¯­è¨€ç±»å‹ -std=ï¼šæŒ‡å®šè¯­è¨€æ ‡å‡† -Wallï¼šå°†æ‰€æœ‰ warning å½“ä½œ error -Wno-deprecatedï¼šå¦‚æœä½¿ç”¨äº†ç¼–è¯‘å™¨è¢«å¼ƒç”¨çš„åŠŸèƒ½ï¼Œä¸è¦äº§ç”Ÿ warning -Wno-deprecated-declarationsï¼šä¸è¦å¯¹ä½¿ç”¨ C++ ä¸­çš„ [[deprecated]] ä¿®é¥°çš„å¯¹è±¡äº§ç”Ÿ warning -mx32ï¼šç”Ÿæˆ32ä½x86ä»£ç  -stdlib=ï¼šæŒ‡å®šä½¿ç”¨çš„æ ‡å‡†åº“ -Eï¼šåªè¿›è¡Œé¢„å¤„ç† -Sï¼šç”Ÿæˆæ±‡ç¼–ä»£ç ååœæ­¢ -cï¼šç¼–è¯‘æˆ–æ±‡ç¼–å¯¹è±¡æ–‡ä»¶ï¼Œä½†ä¸é“¾æ¥ more: read the manual å¸¸è§é—®é¢˜è§£å†³ æŠ¥é”™äº†ï¼šå­¦ä¼šçœ‹æŠ¥é”™ï¼ŒæŠ¥é”™æ˜¯å¸®ä½ è§£å†³é—®é¢˜çš„ï¼Œçœ‹ä¸æ‡‚æŠŠæŠ¥é”™æ‰”æœç´¢å¼•æ“ä¸Šå¤šåŠèƒ½å‡ºæ¥(æ³¨æ„ä¸è¦å¤åˆ¶è¿‡å¤šæœ¬åœ°ç¯å¢ƒçš„æ— æ•ˆä¿¡æ¯) å¿ƒæ€å´©äº†ï¼šç¼“ä¸Šä¸ªåŠå¤©ç»§ç»­æ•´ å®Œ","categories":[{"name":"Knowledge","slug":"Knowledge","permalink":"http://blog.vollate.top/categories/Knowledge/"}],"tags":[{"name":"Compiler","slug":"Compiler","permalink":"http://blog.vollate.top/tags/Compiler/"}]},{"title":"æµ…è®°ç³»ç»Ÿè™šæ‹ŸåŒ–","slug":"virtualization","date":"2023-11-17T11:24:06.000Z","updated":"2024-05-10T18:01:09.000Z","comments":true,"path":"2023/11/17/virtualization/","permalink":"http://blog.vollate.top/2023/11/17/virtualization/","excerpt":"","text":"æœ€è¿‘ç”±äºé¡¹ç›®éœ€è¦å­¦ä¹ è™šæ‹ŸåŒ–çš„çŸ¥è¯†ï¼Œäºæ˜¯åœ¨å¸ˆå…„çš„å»ºè®®ä¸‹è¯»äº† sjtu å‡ºçš„æ–°ä¹¦ã€Šæ“ä½œç³»ç»ŸåŸç†ä¸å®è·µã€‹ä¸­çš„ç³»ç»Ÿè™šæ‹ŸåŒ–çš„éƒ¨åˆ†ï¼Œéšä¾¿è®°ç‚¹ç¬”è®°ã€‚ è™šæ‹ŸåŒ–å‘å±•å†å²: 1960så‡ºç°åˆ†æ—¶æ“ä½œç³»ç»Ÿæ¦‚å¿µã€‚åŒæ—¶æœŸIBMè¿›è¡Œäº†å¦ä¸€ä¸ªæ–¹å‘ä¹Ÿå°±æ˜¯è™šæ‹ŸåŒ–çš„æ¢ç´¢ï¼Œå¹¶åœ¨1968å¹´çš„system360ä¸Šå®ç°äº†ç¬¬ä¸€ä¸ªVMM(Virtual Machine Monitor) CP/CMS 1980sï¼Œå¼€å§‹å‡ºç°çº¯è½¯ä»¶å®ç°çš„è™šæ‹Ÿæœºç›‘è§†å™¨ 1990s, äº’è”ç½‘å…´èµ·ï¼ŒwebæœåŠ¡å™¨é€æ¸æ€§èƒ½è¿‡å‰© 1998å¹´ï¼ŒVMwareæˆç«‹ã€‚ äº‘è®¡ç®—å…´èµ·ï¼Œè™šæ‹ŸåŒ–è¶Šå‘é‡è¦ ä¼˜åŠ¿: å……åˆ†åˆ©ç”¨æœåŠ¡å™¨æ€§èƒ½ï¼Œæè¶…å”® è™šæ‹Ÿæœºç®¡ç†æ›´ä¸ºä¾¿æ·ï¼Œå¯ä»¥å¿«é€Ÿéƒ¨ç½²é”€æ¯ å¯ä»¥çƒ­è¿ç§» VMI (Virtual Machine Introspection è™šæ‹Ÿæœºè‡ªçœ)å¯ä»¥ä»å¤–éƒ¨æ£€æŸ¥è™šæ‹Ÿæœºæ˜¯å¦è¢«å…¥ä¾µ ç³»ç»Ÿè™šæ‹ŸåŒ–æ¦‚è¿° ç»„æˆéƒ¨åˆ† CPU è™šæ‹ŸåŒ–ï¼ˆvCPUï¼‰ï¼šè‹¥è™šæ‹ŸåŒ–çš„æŒ‡ä»¤é›†å’Œç‰©ç†æ¶æ„æŒ‡ä»¤é›†ç›¸åŒï¼Œé™¤äº†éƒ¨åˆ†ç‰¹æ®ŠæŒ‡ä»¤å…¶ä»–éƒ½å¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œæ•ˆç‡è¾ƒé«˜ï¼ˆKVMï¼‰ï¼›è‹¥æ¶æ„ä¸åŒï¼Œåˆ™éœ€è¦å…¨éƒ¨è½¬è¯‘æ‰§è¡Œã€‚ å†…å­˜è™šæ‹ŸåŒ–ï¼šå¼•å…¥è™šæ‹Ÿç‰©ç†åœ°å€ï¼Œå†…å­˜è®¿é—®éœ€è¦å¤šç»è¿‡ä¸€å±‚è™šæ‹Ÿç‰©ç†åœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„æ“ä½œã€‚ I/O è™šæ‹ŸåŒ–ï¼šVMM æä¾›è™šæ‹Ÿé©±åŠ¨ä¾›è™šæ‹Ÿæœºä½¿ç”¨ï¼Œå¹¶å°†æ“ä½œè½¬åŒ–ä¸ºå®é™…çš„ç‰©ç†è®¾å¤‡è®¿é—®æˆ–å…¶ä»–æ“ä½œã€‚ VMM ç±»å‹ åŠè™šæ‹ŸåŒ–: è¿è¡Œåœ¨æœ€é«˜æƒé™çº§åˆ«ï¼Œç›¸å½“äºä¸€ä¸ªä»¥OSä½œä¸ºè¿›ç¨‹çš„æ“ä½œç³»ç»Ÿï¼Œå¦‚ Xenã€‚ å®Œå…¨è™šæ‹ŸåŒ–ï¼šä½œä¸ºä¸€ä¸ªè¿›ç¨‹è¿è¡Œåœ¨ OS ä¸Šï¼Œå¤ç”¨å®¿ä¸»OSçš„çº¿ç¨‹è°ƒåº¦å’Œèµ„æºç®¡ç†ï¼Œå¦‚ QEMUã€‚ Trap-Emulateï¼ˆä¸‹é™·-æ¨¡æ‹Ÿï¼‰ Trapï¼šå°†ç³»ç»Ÿçº§ISAæ‹¦æˆªè½¬ç”± VMM è¿›è¡Œæ¨¡æ‹Ÿæ“ä½œã€‚å¦‚ç³»ç»Ÿè°ƒç”¨å…ˆè½¬åŒ–ä¸ºè™šæ‹Ÿæœºå†…æ ¸æ€ï¼Œç„¶åç”± VMM æ‹¦æˆªå¹¶å®Œæˆå¯¹åº”è°ƒç”¨çš„æ¨¡æ‹Ÿã€‚ Emulateï¼šç”¨è½¯ä»¶æ¨¡æ‹Ÿæ‰§è¡Œåçš„å‰¯ä½œç”¨ åŸºç¡€æ¦‚å¿µ: CPU ä¸Šä¸‹æ–‡ï¼šæŒ‡CPUåœ¨æ‰§è¡Œç‰¹å®šè¿›ç¨‹æˆ–ä»»åŠ¡æ—¶æ‰€éœ€çš„ä¿¡æ¯é›†åˆã€‚ä¸€èˆ¬åŒ…æ‹¬è¯¥CPUçš„æ‰€æœ‰å¯„å­˜å™¨ï¼ˆåŒ…æ‹¬PCï¼‰çš„å€¼å’Œå½“å‰ç³»ç»ŸçŠ¶æ€ï¼ˆå†…å­˜ä¿¡æ¯ï¼Œè°ƒåº¦ä¼˜å…ˆçº§ç­‰ï¼‰ã€‚ ä¸­æ–­å‘é‡è¡¨ï¼ˆInterrupt Vector Tableï¼‰ï¼šå­˜æ”¾ä¸­æ–­å¤„ç†å‡½æ•°ã€‚ ä¸­æ–­å¤„ç†è¿‡ç¨‹ï¼šè§¦å‘ä¸­æ–­æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ä¸­æ–­æ˜¯å¦å¼€å¯ã€‚è‹¥å¼€å¯ï¼ŒCPU æ¥æ”¶ä¸­æ–­ä¿¡å·å¹¶æš‚åœå½“å‰ç¨‹åºå¤„ç†ã€‚ç„¶åä¿å­˜å½“å‰ä¸Šä¸‹æ–‡ä»¥ä¾›æ¢å¤ã€‚ç„¶åç¡®å®šä¸­æ–­ç±»å‹å¹¶ä»ä¸­æ–­å‘é‡è¡¨ä¸­æŸ¥æ‰¾å¯¹åº”å¤„ç†å‡½æ•°çš„åœ°å€å¹¶è·³è½¬æ‰§è¡Œã€‚æ‰§è¡Œç»“æŸåï¼Œæ¢å¤ä¸­æ–­å‰çš„ä¸Šä¸‹æ–‡ã€‚ ç”¨æˆ·æ€ï¼šç”¨æˆ·æ€æ˜¯æ™®é€šåº”ç”¨ç¨‹åºè¿è¡Œçš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼ä¸‹ï¼Œç¨‹åºå¯¹ç¡¬ä»¶çš„è®¿é—®å—é™ï¼Œä¸€èˆ¬é€šè¿‡OSæä¾›ç³»ç»Ÿè°ƒç”¨åˆ‡æ¢åˆ°å†…æ ¸æ€æ¥æ‰§è¡Œå¯¹åº”å‡½æ•°è¿›è¡Œè®¿é—®ã€‚ å†…æ ¸æ€ï¼šOS ä¸€èˆ¬è¿è¡Œåœ¨è¯¥çŠ¶æ€ä¸‹ã€‚è¯¥çŠ¶æ€ä¸‹ï¼ŒOS èƒ½å¤Ÿå®Œå…¨è®¿é—®å¹¶æ“ä½œç¡¬ä»¶ï¼Œè®¿é—®æ‰€æœ‰å†…å­˜ã€‚ Trap-Emulate è™šæ‹ŸåŒ–å®ç° VMM éœ€æä¾›æ•°æ®ç»“æ„ï¼Œæ¥å­˜å‚¨åŸæœ¬å­˜å‚¨åœ¨ç‰©ç† CPU ä¸Šçš„æ‰€æœ‰è¿›ç¨‹ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»¥åŠå¯¹åº”çš„å…¶å®ƒä¿¡æ¯ï¼ˆå¦‚ä¸­æ–­å‘é‡è¡¨,è™šæ‹Ÿé¡µè¡¨ç­‰ï¼‰ã€‚ å¤„ç†ä¸­æ–­ï¼šå¯¹äºç¡¬ä»¶ä¸­æ–­ï¼Œå°†ä¼šè§¦å‘ VMM æŸ¥çœ‹è™šæ‹Ÿæœºæ˜¯å¦å¼€å¯å¯¹åº”ä¸­æ–­ã€‚å¦‚å¼€å¯ï¼Œè™šæ‹Ÿæœºä¿å­˜ä¸Šä¸‹æ–‡åä¸‹é™·åˆ° VMMï¼Œç„¶å VMM æ£€æŸ¥ä¸­æ–­å‘é‡è¡¨å¤„ç†ä¸­æ–­ã€‚ å¤„ç†ç³»ç»Ÿè°ƒç”¨ï¼šåŒä¸­æ–­å¤„ç†çš„æ¨¡å¼ï¼Œåªæ˜¯ VMM éœ€è¦éš”ç¦»ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„é¡µè¡¨æ˜ å°„ å¤„ç†çº¿ç¨‹åˆ‡æ¢ï¼šæœ¬è´¨è½¯ä»¶ä¸­æ–­åˆ°å†…æ ¸æ€ç„¶åè¿›è¡Œçº¿ç¨‹è°ƒåº¦ï¼Œåˆ‡æ¢è¿›ç¨‹ä¸Šä¸‹æ–‡å³å¯ã€‚ å¤š CPU æ¨¡æ‹Ÿï¼šåŠ ä¸ªæ•°æ®ç»“æ„å­˜è¿›ç¨‹ä¸Šä¸‹æ–‡å’Œ vCPU çš„å¯¹åº”å…³ç³»å°±è¡Œã€‚vCPU è°ƒåº¦å‚è€ƒ OS çš„è¿›ç¨‹è°ƒåº¦ï¼Œæˆ–è€…ç›´æ¥ç”¨çº¿ç¨‹ OS è¿›ç¨‹æ¥å®ç°ã€‚ CPUè™šæ‹ŸåŒ– ç‰¹æƒæŒ‡ä»¤ï¼šåœ¨ç”¨æˆ·æ€æ‰§è¡Œæ—¶ä¼šä¸‹é™·è¿›å…¥ç‰¹æƒçº§çš„æŒ‡ä»¤ æ•æ„ŸæŒ‡ä»¤ï¼šç®¡ç†ç‰©ç†ç¡¬ä»¶èµ„æºæˆ–æ›´æ”¹CPUçŠ¶æ€çš„æŒ‡ä»¤ egï¼š x86 ä¿®æ”¹ CR å¯„å­˜å™¨çš„å€¼ è¯»å†™æ•æ„Ÿå†…å­˜ I/O æŒ‡ä»¤ å¯è™šæ‹ŸåŒ–å’Œä¸å¯è™šæ‹ŸåŒ–æ¶æ„ æ‰€æœ‰æ»¡è¶³æ•æ„ŸæŒ‡ä»¤éƒ½æ˜¯ç‰¹æƒæŒ‡ä»¤çš„æ¶æ„ç§°ä¸ºå¯è™šæ‹ŸåŒ–æ¶æ„ï¼Œåä¹‹åˆ™ä¸ºä¸å¯è™šæ‹ŸåŒ–æ¶æ„ã€‚ eg: AArch32 æ—©æœŸ x86 å¼¥è¡¥ä¸å¯è™šæ‹ŸåŒ–æ¶æ„çš„æ–¹æ³• å…¨è™šæ‹ŸåŒ– é€‚ç”¨äºæ— éœ€ä¿®æ”¹å®¢æˆ·ç«¯æºç çš„æƒ…å†µ è§£é‡Šæ‰§è¡Œï¼šç”¨çº¯è½¯ä»¶æ¨¡æ‹Ÿcpuæ‰§è¡ŒæŒ‡ä»¤è¿‡ç¨‹ã€‚å…·ä½“æ“ä½œæ˜¯å¯¹äºæ¯æ¡æŒ‡ä»¤è°ƒç”¨å¯¹åº”çš„ç”¨äºæ¨¡æ‹Ÿçš„å‡½æ•°ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸äº§ç”Ÿä»»ä½•ä¸‹é™·ã€‚ä¼˜ç‚¹æ˜¯å¯ä»¥æ¨¡æ‹Ÿä»»ä½• ISA ç±»å‹çš„è™šæ‹Ÿæœºã€‚ç¼ºç‚¹æ˜¾è€Œæ˜“è§ï¼Œæ•ˆç‡ä½ä¸‹ã€‚ åŠ¨æ€äºŒè¿›åˆ¶ç¼–è¯‘ï¼šåœ¨è§£é‡Šæ‰§è¡Œçš„åŸºç¡€ä¸Šå°†ç¨‹åºåˆ’åˆ†ä¸ºåªæœ‰ä¸€ä¸ªå…¥å£å’Œä¸€ä¸ªå‡ºå£,ä¸­é—´æ— ä»»ä½•ä¿®æ”¹æ§åˆ¶æµæŒ‡ä»¤çš„ä»£ç å—(ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°)ã€‚ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯¥å—æ—¶è¿›è¡Œç¿»è¯‘å¹¶ç¼“å­˜ï¼Œä¹‹åå†æ‰§è¡Œæ—¶è°ƒç”¨ä¹‹å‰çš„ç¼“å­˜ã€‚ç¿»è¯‘æ›¿æ¢æ‰€æœ‰æ•æ„ŸæŒ‡ä»¤ï¼Œåœ¨å—çš„æœ«å°¾æ·»åŠ ä¸€æ¡è·³è½¬æŒ‡ä»¤æ¥é€šçŸ¥ VMM æ‰§è¡Œå®Œæ¯•ã€‚ æ‰«æ-ç¿»è¯‘ï¼šç”¨äºè™šæ‹Ÿæœºæ¶æ„å’Œå®¿ä¸»ç›¸åŒçš„æƒ…å†µï¼Œåœ¨ç¨‹åºæ‰§è¡Œå‰æ‰«æå¯èƒ½å­˜åœ¨æ•æ„ŸæŒ‡ä»¤çš„ä»£ç ï¼Œç¿»è¯‘å¹¶ç¼“å­˜ç¿»è¯‘åçš„ä»£ç ä»¥ä¾¿ä¸‹æ¬¡å¤ç”¨ã€‚å¤§å¤šæ•°æƒ…å†µæ•æ„ŸæŒ‡ä»¤åªå­˜åœ¨äº OS kernal ä¸­ï¼Œå¯ä»¥åªæ‰«æå†…æ ¸ä»£ç ã€‚ åŠè™šæ‹ŸåŒ– åœ¨å…è®¸ä¿®æ”¹è™šæ‹Ÿæœºå®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ åŸç†ï¼šé€šè¿‡ VMM æä¾›çš„ç±»ä¼¼ç³»ç»Ÿè°ƒç”¨çš„æœåŠ¡ä½¿å¾—è™šæ‹Ÿæœºå†…æ ¸ä¸å†éœ€è¦ä¸‹é™·æ¨¡æ‹Ÿï¼Œè€Œæ˜¯ç±»ä¼¼è¿›ç¨‹ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ä¸€æ ·è¿›è¡Œå¯¹åº”æ“ä½œï¼Œæ•ˆç‡æ›´é«˜ã€‚åŠè™šæ‹ŸåŒ–ä½¿å¾— VMM è·å¾—æŸ¥çœ‹å®¢æˆ·ç«¯å†…å­˜åˆ†å¸ƒçš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ›´åˆç†çš„åˆ†é…èµ„æºã€‚ ç¡¬ä»¶è™šæ‹ŸåŒ– é€šè¿‡ CPU ç¡¬ä»¶æ”¯æŒæ¥å®ç°æ›´é«˜æ•ˆçš„è™šæ‹ŸåŒ–ã€‚å…·ä½“æ¥è¯´å°±æ˜¯å¢åŠ ä¸€ä¸ªä¸“ä¸º VMM è¿è¡Œçš„ç‰¹æƒçº§ï¼Œè¯¥ç‰¹æƒçº§ä¸‹ VMM æ‹¥æœ‰å’Œå®¿ä¸» OS ç›¸åŒçš„ç¡¬ä»¶è®¿é—®æƒé™ï¼Œæ¥èŠ‚çœä¸‹é™·çš„å¼€é”€ã€‚ æ‹“å±•â€”â€”KVM (kernal-based virtual machine) æŠ€æœ¯: é€šè¿‡å°† VMM ä½œä¸ºå†…æ ¸æ¨¡å—åŠ è½½ä½¿å¾— VMM èƒ½å¤Ÿä½¿ç”¨ å®¿ä¸» OS å†…æ ¸çš„åŠŸèƒ½ï¼Œè¿™æ ·ä¸‹é™·æ—¶æŸäº›æ”¯æŒçš„æ¶æ„å¯ä»¥æ¶ˆé™¤ KVM åˆ° OS å†…æ ¸ç‰¹æƒçº§è½¬æ¢å¸¦æ¥çš„å¼€é”€ã€‚æŒ‡ä»¤æ— éœ€ç¿»è¯‘ï¼Œç›´æ¥åœ¨ç¡¬ä»¶ä¸Šæ‰§è¡Œï¼Œä½¿å¾—è™šæ‹ŸåŒ–æ•ˆç‡æ¥è¿‘ç›´æ¥è¿è¡Œã€‚ å†…å­˜è™šæ‹ŸåŒ– ç›®æ ‡ï¼šå®ç°è™šæ‹Ÿæœºä¹‹é—´ï¼Œè™šæ‹Ÿæœºå’Œç‰©ç†æœºä¹‹é—´çš„å†…å­˜éš”ç¦» æœ¯è¯­ï¼š GVA: Guest Virtual Address GPA: Guest Physical Address HPA: Host Physical Address å½±å­é¡µè¡¨(Shadow Page Table) å¤ä¹ è¿›ç¨‹é¡µè¡¨çš„é…ç½®&amp;ä½¿ç”¨ï¼š è°ƒç”¨å‰ OS ä¸ºè¿›ç¨‹é…ç½®ä¸€ä¸ªè™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ç‰©ç†åœ°å€çš„é™æ€é¡µè¡¨ï¼ˆç›¸å¯¹åœ°å€ï¼‰ OS å°†é¡µè¡¨åŸºåœ°å€å†™å…¥å¯¹åº”å¯„å­˜å™¨ä»¥è®© MMU èƒ½æ‰¾åˆ°é¡µè¡¨ MMU è§£æè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€ å†…å­˜è™šæ‹ŸåŒ–ä¸­ï¼ŒVMM éœ€è¦æ ¹æ®å­˜å‚¨çš„ GPA åˆ° HPA çš„æ˜ å°„ä¿¡æ¯å¹¶ç”Ÿæˆä¸€ä¸ª GVA åˆ° HPA çš„å½±å­é¡µè¡¨ã€‚åœ¨è™šæ‹Ÿæœºä¸‹é™·æ—¶,å°†é¡µè¡¨åŸºåœ°å€æ›¿æ¢ä¸ºå½±å­é¡µè¡¨åŸºåœ°å€ï¼Œä»è€Œè®© MMU ç›´æ¥è§£æ GVAã€‚ VMM éœ€è¦ç›‘è§†è™šæ‹Ÿæœºå¯¹é¡µè¡¨çš„æ›´æ”¹ï¼Œå¹¶å¯¹åº”åœ°ä¿®æ”¹å½±å­é¡µè¡¨ã€‚åŒæ—¶ä¸ºäº†åˆ†éš”ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Œéœ€è¦åˆ†ç¦»å¯¹åº”çš„é¡µè¡¨ï¼Œä½¿å¾—ç”¨æˆ·æ€é¡µè¡¨ä¸­ä¸åŒ…å«å†…æ ¸æ€çš„æ˜ å°„ ç¼ºé¡µå¤„ç†ï¼š è‹¥ä¸ºé¡µè¡¨é¡¹ä¸å­˜åœ¨æˆ–æ— æƒé™ï¼ŒVMM éœ€è§¦å‘å®¿ä¸» OS çš„ç¼ºé¡µä¸­æ–­è¿›è¡Œå¤„ç† è‹¥ä¸ºè®¿é—®æƒé™è¶³å¤Ÿï¼Œåˆ™éœ€è¦åŒæ­¥å½±å­é¡µè¡¨ä¸è™šæ‹Ÿæœºé¡µè¡¨ ç›´æ¥é¡µè¡¨æ˜ å°„ å®¢æˆ·ç«¯ä¸å®¿ä¸»å…±ç”¨é¡µè¡¨ã€‚è¯¥æƒ…å†µä¸‹å®¢æˆ·ç«¯çŸ¥é“è‡ªå·±å¤„åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ï¼ŒVMM ä¼šå‘ŠçŸ¥å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨çš„é¡µè¡¨èŒƒå›´ï¼Œæ–¹ä¾¿å®¢æˆ·ç«¯è§„åˆ’ã€‚å®¢æˆ·ç«¯çš„é¡µè¡¨é¡¹è¢«è®¾ä¸ºåªè¯»ï¼Œä¿®æ”¹é¡µè¡¨éœ€è¦ä½¿ç”¨ VMM æä¾›çš„è¶…çº§è°ƒç”¨ï¼Œè¯¥è°ƒç”¨ä¼šæ£€æŸ¥å¯¹é¡µè¡¨çš„ä¿®æ”¹æ˜¯å¦åˆæ³•ã€‚ ä¸¤é˜¶æ®µåœ°å€ç¿»è¯‘ ç¡¬ä»¶è™šæ‹ŸåŒ–çš„ä¸€éƒ¨åˆ†ï¼Œéœ€è¦ CPU æ”¯æŒä½¿ç”¨ç¬¬äºŒé¡µè¡¨å°† GPA è½¬æ¢åˆ° HPAï¼Œçœå» VMM æ‰‹åŠ¨ç»´æŠ¤å½±å­é¡µè¡¨çš„æ­¥éª¤ã€‚åŒæ—¶å¯ä»¥ä½¿ç”¨ TLB æ¥ä¼˜åŒ–è§£æé€Ÿåº¦ã€‚ ç¼ºé¡µä¸­æ–­å¤„ç†ï¼š å®¢æˆ·è™šæ‹Ÿæœºç¼ºé¡µï¼šæ— éœ€ä¸‹é™·ï¼Œç¡¬ä»¶ç›´æ¥è°ƒç”¨è™šæ‹Ÿæœºæ³¨å†Œçš„ä¸­æ–­å‡½æ•° ç¬¬äºŒé˜¶æ®µé¡µè¡¨ç¼ºé¡µï¼šä¸‹é™·ï¼Œç¡¬ä»¶ç›´æ¥è°ƒç”¨ VMM æ³¨å†Œçš„çš„å¯¹åº”ä¸­æ–­å‡½æ•° ä¼˜ç‚¹ï¼š ä¸ç”¨ç»´æŠ¤å½±å­é¡µè¡¨ ä¸ç”¨ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªé¡µè¡¨ ç¼ºé¡µå¤„ç†æ›´å¿« æ¢é¡µå’Œå†…å­˜æ°”çƒ ç›®çš„ï¼šè¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´è™šæ‹Ÿæœºå†…å­˜å¤§å°ï¼Œå†…å­˜è¶…å”® æ¢é¡µé€»è¾‘ï¼š ä¿å­˜å°†è¦äº¤æ¢çš„é¡µçš„ GVA å’Œ GPA äº¤æ¢é¡µå†…æ•°æ®åˆ°æŒä¹…åŒ–å­˜å‚¨è®¾å¤‡ï¼ˆç¡¬ç›˜ä»€ä¹ˆçš„ï¼‰ å°†å®¢æˆ·ç«¯é¡µè¡¨é¡¹è®¾ä¸º INVALID VMM é‡æ–°åˆ†é…è¯¥é¡µ å†…å­˜æ°”çƒ(Memory Ballooning)ï¼šåœ¨å®¢æˆ·ç«¯æ’å…¥ä¸€ä¸ªé©±åŠ¨(å†…é¬¼)ï¼Œè¯¥é©±åŠ¨æ ¹æ® VMM çš„è¦æ±‚ä½¿ç”¨è™šæ‹Ÿæœºçš„æ¥å£ç”³è¯·/é‡Šæ”¾å†…å­˜ï¼Œç„¶åå°†ç”³è¯·çš„å†…å­˜ç‰©ç†åœ°å€å‘Šè¯‰ VMM æ¥ä½¿ç”¨ã€‚ I/Oè™šæ‹ŸåŒ– é™åˆ¶è™šæ‹Ÿæœºå¯¹ç‰©ç†ç¡¬ä»¶çš„ç›´æ¥è®¿é—® æä¾›è™šæ‹Ÿè®¾å¤‡æ¥å£ å……åˆ†åˆ©ç”¨I/O è½¯ä»¶æ¨¡æ‹Ÿï¼ˆå…¨è™šæ‹ŸåŒ–ï¼‰ æ•è·å®¢æˆ·ç«¯å¯¹è™šæ‹Ÿç¡¬ä»¶çš„ MMIO, DMA, ä¸­æ–­ï¼Œä¸‹é™·åç”± VMM æ‰§è¡Œå¯¹åº”æ“ä½œ åŠè™šæ‹ŸåŒ– ç±»ä¼¼å…¨è™šæ‹ŸåŒ–ï¼Œå®¢æˆ·ç«¯ä¸å†ä½¿ç”¨åŸç”Ÿé©±åŠ¨è€Œæ˜¯å‰ç«¯é©±åŠ¨ï¼Œç”¨äºä¸ VMM åç«¯é©±åŠ¨äº¤äº’ã€‚ é€šè¿‡å†…å­˜å…±äº«ä¼ é€’æ•°æ®ï¼Œå¹¶ä½¿ç”¨æ‰¹å¤„ç†åŠ é€Ÿï¼Œç”±åç«¯é©±åŠ¨å®Œæˆå’Œç‰©ç†ç¡¬ä»¶çš„äº¤äº’ã€‚ è®¾å¤‡ç›´é€š è®©å®¢æˆ·ç«¯ç›´æ¥ç®¡ç†ç¡¬ä»¶è®¾å¤‡ï¼Œæ­¤æ—¶æ“ä½œå¯¹åº”ç¡¬ä»¶ä¸ä¼šäº§ç”Ÿä»»ä½•ä¸‹é™·ã€‚ä¸ºé˜²æ­¢ DMA æ”»å‡»ä½¿ç”¨ IOMMU è¿›è¡ŒäºŒé˜¶æ®µ GPA åˆ° HPA çš„æ˜ å°„å¹¶æ£€æŸ¥å¯¹åº”æƒé™ã€‚ SR-IOV(single root I/O virtualization):å®ç°ç¡¬ä»¶å±‚é¢ IO è™šæ‹ŸåŒ–ï¼Œé¿å…å•ä¸€è™šæ‹Ÿæœºç‹¬å ç¡¬ä»¶ã€‚é€šè¿‡åˆ›å»ºå¤šä¸ª VF ï¼ˆvirtual functionï¼‰ è®© VMM åˆ†é…ç»™è™šæ‹Ÿæœºä½¿ç”¨ ä¸­æ–­è™šæ‹ŸåŒ– ä¸¤ç§ä¸­æ–­ï¼š ç‰©ç†ä¸­æ–­ï¼šç”±ç¡¬ä»¶äº§ç”Ÿï¼Œåœ¨éç›´é€šæƒ…å†µä¸‹ç”± VMM å¤„ç† è™šæ‹Ÿä¸­æ–­ï¼šç”± VMM äº§ç”Ÿ è§£å†³å¼€å…³ä¸­æ–­ä¸‹é™·çš„é—®é¢˜ï¼šå¢åŠ å¯ä¾›è™šæ‹Ÿæœºä¿®æ”¹ä¸­æ–­è€Œæ— éœ€ä¸‹é™·çš„è™šæ‹Ÿå¯„å­˜å™¨ ç›´æ¥å‘è™šæ‹Ÿæœºå‘é€ä¸­æ–­ï¼šå¢åŠ ä¸€ä¸ªä¸­æ–­ç¿»è¯‘è¡¨ï¼Œç”¨äºå°†ç‰©ç†ä¸­æ–­ç¿»è¯‘ä¸ºè™šæ‹Ÿæœºå¯¹åº”çš„ä¸­æ–­ã€‚å› æ­¤æ— éœ€å†è¿›è¡Œä¸‹é™·ã€‚ QEMU/KVM ç•¥","categories":[{"name":"Knowledge","slug":"Knowledge","permalink":"http://blog.vollate.top/categories/Knowledge/"}],"tags":[{"name":"Notes","slug":"Notes","permalink":"http://blog.vollate.top/tags/Notes/"},{"name":"OS","slug":"OS","permalink":"http://blog.vollate.top/tags/OS/"}]},{"title":"æŠ˜è…¾ç½‘ç«™è®°å½•","slug":"build-site","date":"2023-11-13T09:22:25.000Z","updated":"2024-09-26T04:58:26.000Z","comments":true,"path":"2023/11/13/build-site/","permalink":"http://blog.vollate.top/2023/11/13/build-site/","excerpt":"","text":"åŸæ¥çš„ vps åˆ°æœŸäº†ï¼Œä¸æƒ³ç»­è´¹æ–°å¼€äº†ä¸€å°ï¼Œå¿˜äº†å…¨ç³»ç»Ÿå¤‡ä»½ã€‚ç´¢æ€§ blog æ‰”åˆ° github page,ç„¶ååˆæ˜¯ä¸€é¡¿æŠ˜è…¾ã€‚ Github Action æ ·ä¾‹ æ”¹äº†æ”¹ Hexo å®˜ç½‘çš„: 1234567891011121314151617181920212223242526272829name: Blogon: push: branches: - mainjobs: pages: runs-on: ubuntu-latest permissions: contents: write steps: - uses: actions/checkout@v3 with: token: $&#123;&#123; secrets.GITHUB_TOKEN &#125;&#125; submodules: true - name: Use Node.js 18.x uses: actions/setup-node@v2 with: node-version: &quot;18&quot; - name: Install Dependencies run: npm install - name: Build run: npm run build - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: $&#123;&#123; secrets.GITHUB_TOKEN &#125;&#125; publish_dir: ./public Github Action ç¦ç”¨ jekyll build å› ä¸ºè¦ç”¨ peaceiris/actions-gh-pages@v3 è¿›è¡Œéƒ¨ç½²ï¼Œä½†æ˜¯ç”¨çš„ Hexo ä¸”å·²ç»åœ¨å…ˆå‰çš„æ“ä½œç¼–è¯‘å®Œæˆï¼Œåªéœ€éƒ¨ç½²åˆ°å¯¹åº”åˆ†æ”¯å³å¯ã€‚ ä¸€å¼€å§‹ä¸çŸ¥é“ debug äº†åŠå¤© è§£å†³æ–¹æ³•åœ¨ä»“åº“é‡Œåˆ›å»ºä¸€ä¸ª.nojekyllæ–‡ä»¶å³å¯, è¿™ä¼šè‡ªåŠ¨ç¦ç”¨ jekyll build è€Œåªæ‰§è¡Œ deploy (éƒ¨ç½²ç¼–è¯‘å¥½çš„æ–‡ä»¶åˆ°å¯¹åº”åˆ†æ”¯) ä½¿ç”¨cfåæ— é™redirect åœ¨ namesilo ä¹°çš„åŸŸåï¼Œçªå‘å¥‡æƒ³è¯•è¯•ç”¨ Cloudflare å…è´¹è®¡åˆ’çš„åŸŸåè§£æï¼ˆä¸ºäº†CDNï¼‰ é…å®Œåç‚¸äº†ï¼Œhttp è¯·æ±‚è¿”å› 301 å¯¼è‡´æ— é™ redirectï¼ŒæŸ¥äº†ä¸‹åŸå› å¦‚ä¸‹ï¼š æœåŠ¡å™¨ç«¯ä½¿ç”¨äº†å¼ºåˆ¶HTTPSï¼ŒCloudFlare çš„Flexibleç­–ç•¥åŸç†æ˜¯ï¼šç”¨æˆ·è®¿é—®æ—¶ä½¿ç”¨HTTPSè®¿é—®åˆ°CFçš„èŠ‚ç‚¹ï¼Œç„¶åCFé€šè¿‡HTTPæ–¹å¼å›æºåˆ°ä½ çš„æœåŠ¡å™¨å»è¯»å–æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å¯¹äºä½ çš„æœåŠ¡å™¨æ¥è¯´ï¼ŒCFå°±æ˜¯è®¿å®¢ï¼Œæ‰€ä»¥æœåŠ¡å™¨è¿”å›çš„çŠ¶æ€éƒ½æ˜¯ 301ã€‚è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œå°† SSL ç­–ç•¥è®¾ä¸º Full æˆ–è€… Full(strict) å°±èƒ½è§£å†³ã€‚ Vanishvzone.me/897 ä¸è¦ç»™ç½‘ç›˜å¥— cf çš„ cdn cf çš„ cdn æœ‰å•æ–‡ä»¶100M å¤§å°é™åˆ¶ï¼Œä¸ºäº†ä¸è¢«æ»¥ç”¨ã€‚å†™ dns çš„æ—¶å€™è„‘å­æŠ½äº†ï¼Œç„¶åè™šç©º debug nginx é…ç½®æ–‡ä»¶ã€‚ ä¸Šå¤§å­¦ä¸Šçš„.jpg","categories":[{"name":"Journal","slug":"Journal","permalink":"http://blog.vollate.top/categories/Journal/"}],"tags":[{"name":"Blog","slug":"Blog","permalink":"http://blog.vollate.top/tags/Blog/"},{"name":"CI/CD","slug":"CI-CD","permalink":"http://blog.vollate.top/tags/CI-CD/"}]},{"title":"More Effecitve C++","slug":"more-effecitve-cpp","date":"2023-11-08T08:21:57.000Z","updated":"2024-05-10T18:01:09.000Z","comments":true,"path":"2023/11/08/more-effecitve-cpp/","permalink":"http://blog.vollate.top/2023/11/08/more-effecitve-cpp/","excerpt":"","text":"ä¸èƒ½ç›´æ¥å¾€æ•°ç»„ç±»å®¹å™¨å¡å¤šæ€ç±»ï¼Œä½¿ç”¨æŒ‡é’ˆï¼›ä¸€å®šè¦å¼•ç”¨çš„æƒ…å†µä¸‹ï¼ˆéœ€è¦operator()ï¼‰ç”¨std::reference ç›´æ¥åˆ›å»ºæ•°ç»„æˆ–ç”¨vector,arrayç­‰å®¹å™¨é¢„å…ˆåˆ†é…å¤§å°æ—¶è°ƒç”¨ç±»çš„æ— å‚(é»˜è®¤)æ„é€ å‡½æ•°ï¼Œå› æ­¤å¦‚æœç”¨äº†explictè®°å¾—å£°æ˜æ— å‚æ„é€ å‡½æ•° 1234567//æ²¡æœ‰æ— å‚æ„é€ å‡½æ•°è§£æ³•ï¼ˆåˆ«ç”¨ï¼‰class Ex;void* ptr=operator new[](10*sizeof(Ex));for(int i=0;i!=10;++i) new (&amp;ptr[i]) Ex(...);//call constructor//Free memoryoperator delete(ptr); custom i++&amp;++i for class class foo;int foo operator++();//++iconst int foo operator++(int);//i++ å°½å¯èƒ½ä¸é‡è½½ &amp;&amp;,|| and ,ï¼Œå› ä¸ºä¸æ»¡è¶³çŸ­è·¯é€»è¾‘ æœ‰å…³new, new[],delete,delete[] newæ—¶ï¼Œå…ˆè°ƒç”¨void* operator new(size_t size)åˆ†é…å†…å­˜,ç„¶ååˆå§‹åŒ–å¯¹è±¡å¹¶ä¸”å°†void*è½¬å‹ä¸ºå¯¹åº”ç±»å‹æŒ‡é’ˆ operator new çš„ä¸€ä¸ªé‡è½½:void* operator new(size_t size, void* loaction) å®šä½newå®ç° deleteæ—¶ï¼Œå…ˆè°ƒç”¨ææ„å‡½æ•°ç„¶åoperator delete é‡Šæ”¾å†…å­˜ å¯¹æ•°ç»„: new []è°ƒç”¨operator new[]()åˆ†é…å†…å­˜,ç„¶åä¸ºæ¯ä¸ªå¯¹è±¡è°ƒç”¨æ„é€ å‡½æ•° delete[]åŒç† æ„é€ å‡½æ•°å¼‚å¸¸å¤„ç†(æœªå®Œå…¨æ„é€ å‡½æ•°ä¸ä¼šæ ˆè§£é€€è‡ªåŠ¨ææ„): ä½¿ç”¨try catchè¿›è¡Œæ¸…ç† é˜²æ­¢æˆå‘˜åˆ—è¡¨åˆå§‹åŒ–const pointerå¼‚å¸¸å¯¼è‡´èµ„æºæ³„æ¼çš„æ–¹æ³•(æœªå®Œå…¨æ„é€ æŒ‡é’ˆæ— æ³•ä½¿ç”¨delete): è°ƒç”¨ä¸€ä¸ªbasic exception guaranteeçš„å‡½æ•° ä½¿ç”¨RAIIç±» å¼‚å¸¸ å¼‚å¸¸æ ˆè§£é€€æ—¶è°ƒç”¨ææ„å‡½æ•°å†æŠ›å‡ºå¼‚å¸¸å°†ä¼šå¯¼è‡´ç¨‹åºç›´æ¥ç»ˆæ­¢(call terminate directly kill program) å¼‚å¸¸æ‹·è´æ—¶æŒ‰ç…§é™æ€ç±»å‹æ‹·è´(æ´¾ç”Ÿç±»çš„åŸºç±»å¼•ç”¨æ‹·è´ä¸ºåŸºç±») å¼‚å¸¸æ•è·çš„æ”¯æŒéšå¼è½¬å‹(æŒ‰æŒ‡): ä»»ä½•æŒ‡é’ˆto void*(æå…¶ä¸å»ºè®®ç”¨æŒ‡é’ˆ) æ´¾ç”Ÿç±»è½¬åŸºç±» æ€»æ˜¯æŒ‰catchå…ˆåé¡ºåºæ•è· æŒ‰å¼•ç”¨æ•è·å¯ä»¥å®ç°å¤šæ€ Improve proformance: lazy evaluation: è¿”å›ä¸€ä¸ªç»“æœçš„ä»£ç†ç±»ï¼Œåªæœ‰åœ¨éœ€è¦æ—¶æ‰è¿›è¡Œè®¡ç®— lazy copyï¼š å†™æ—¶å¤åˆ¶ lazy fetchï¼šæ¶‰åŠåˆ°æ•°æ®åº“çš„éƒ¨åˆ† over-eager evaluationï¼šæå‰è®¡ç®—å¹¶å­˜å…¥ç¼“å­˜ï¼Œæˆ–constexprç¼–è¯‘æœŸè®¡ç®— ä¸´æ—¶å¯¹è±¡: ä»…åœ¨æŒ‰å€¼ä¼ é€’å¯¹è±¡æˆ–è€…ä¼ é€’å¸¸é‡å¼•ç”¨å‚æ•°æ—¶äº§ç”Ÿã€‚è¿”å›å¯¹è±¡æ—¶ï¼Œè‹¥ç›´æ¥è¿”å›åˆ™ä¼šæ‹·è´å±€éƒ¨å¯¹è±¡ è¿”å›å€¼ä¼˜åŒ–: è¿”å›æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œè¿™æ ·è¿”å›çš„å¯¹è±¡ä¼šåœ¨è¿”å›çš„ä½œç”¨åŸŸæ„é€ (ç¼–è¯‘å™¨ä¼˜åŒ–) åˆ¤æ–­ç±»æ˜¯å¦åœ¨å †ä¸­(ä¸ºäº†ç¡®å®šèƒ½å¦è°ƒç”¨delete this)ï¼šé‡è½½operator new,operator new[],è®°å½•è¿”å›çš„æŒ‡é’ˆåˆ°ä¸€ä¸ªå›¾ä¸­ï¼Œæ¯æ¬¡åˆ é™¤å‰è¿›è¡ŒæŸ¥æ‰¾æ˜¯å¦åœ¨å †ä¸Š é€‚å½“ä½¿ç”¨ä»£ç†å¯ä»¥ç®€åŒ–æµç¨‹ï¼Œä½†æ˜¯ä¼šåœ¨éšå¼è½¬å‹çš„åœ°æ–¹å‡ºé”™ ç±»å‹æ“¦é™¤:ä½¿ç”¨è™šåŸºç±»(æ¥å£) double dispatch:(é’ˆå¯¹ä¸åŒåŠ¨æ€ç±»å‹çš„å¤šä¸ªobjectäº§ç”Ÿä¸åŒå‰¯ä½œç”¨) è™šå‡½æ•° + RTTIï¼šæ— å°è£…ï¼Œå¯ç»´æŠ¤æ€§ä¸º0 å¤šé‡è™šå‡½æ•°è°ƒç”¨: ç±»ä¼¼æ¨¡æ¿é€’å½’å±•å¼€çš„æ‰‹åŠ¨å®ç°ï¼Œæ¯æ¬¡ç¡®å®šä¸€ä¸ªç±»å‹ï¼Œç„¶åè°ƒç”¨ä¸‹ä¸€ä¸ªè™šå‡½æ•° æ‰‹åŠ¨å®ç°è™šå‡½æ•°è¡¨","categories":[{"name":"Knowledge","slug":"Knowledge","permalink":"http://blog.vollate.top/categories/Knowledge/"}],"tags":[{"name":"Notes","slug":"Notes","permalink":"http://blog.vollate.top/tags/Notes/"},{"name":"C++","slug":"C","permalink":"http://blog.vollate.top/tags/C/"}]},{"title":"CPP éšç¬”","slug":"cpp-essay","date":"2023-11-03T03:20:31.000Z","updated":"2024-05-10T18:01:09.000Z","comments":true,"path":"2023/11/03/cpp-essay/","permalink":"http://blog.vollate.top/2023/11/03/cpp-essay/","excerpt":"","text":"è®°å½•cppç¼–ç¨‹è¿‡ç¨‹ä¸­çš„ä¸€äº›æ€»ç»“ clang + libstdc++ debug é—®é¢˜ ä¼—æ‰€å‘¨çŸ¥ LLVM çš„ libc++ å’Œ GNU çš„ libstdc++ æ˜¯ä¸¤ä¸ªä¸åŒçš„æ ‡å‡†åº“å®ç°ã€‚è™½ç„¶ä½¿ç”¨ clang + libstdc++ ç¼–è¯‘ä¹Ÿå¯ä»¥ä½¿ç”¨ LLDB å¯¹ç¨‹åºè¿›è¡Œ debugï¼Œä½†æ˜¯å­—ç¬¦ä¸²ä»¥åŠä¸€äº›æ•°æ®ç»“æ„å¦‚ unordered_map æ— æ³•æ­£ç¡®æ˜¾ç¤ºå€¼ã€‚è§£å†³æ–¹å¼: ä½¿ç”¨ç¼–è¯‘é€‰é¡¹ â€œ-fstandalone-debugâ€ åœ¨ç¼–è¯‘å’Œé“¾æ¥æ—¶æ¢ä¸º libc++, cmake ä¸­å¯ä»¥ä½¿ç”¨ set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -stdlib=libc++&quot;) æ¥è§£å†³ã€‚ cheatsheet: cmake ä¸­åˆ‡æ¢åˆ° llvm å…¨å¥— C++ å·¥å…·é“¾ if(&quot;$&#123;CMAKE_CXX_COMPILER_ID&#125;&quot; STREQUAL &quot;Clang&quot;) set(CMAKE_CXX_FLAGS &quot;-stdlib=libc++&quot;) set(CMAKE_EXE_LINKER_FLAGS &quot;-fuse-ld=lld&quot;)endif ()","categories":[{"name":"Knowledge","slug":"Knowledge","permalink":"http://blog.vollate.top/categories/Knowledge/"}],"tags":[{"name":"Notes","slug":"Notes","permalink":"http://blog.vollate.top/tags/Notes/"},{"name":"C++","slug":"C","permalink":"http://blog.vollate.top/tags/C/"}]},{"title":"Effective C++","slug":"effective-cpp","date":"2023-10-05T08:03:48.000Z","updated":"2024-05-10T18:01:09.000Z","comments":true,"path":"2023/10/05/effective-cpp/","permalink":"http://blog.vollate.top/2023/10/05/effective-cpp/","excerpt":"","text":"ä»vimwikiè¿ç§»è¿‡æ¥çš„å¤æ—©ç¬”è®°,ä»”ç»†çœ‹çœ‹å‘ç°å¥½å¤šå¿˜äº†( Items from 1 to 55 å°†cppçœ‹ä½œCï¼Œé¢å‘å¯¹è±¡çš„cppï¼Œæ¨¡æ¿å’ŒSTLå››ä¸ªéƒ¨åˆ†ï¼›æ ¹æ®å„ä¸ªéƒ¨åˆ†çš„ä¸åŒç‰¹æ€§é€‰æ‹©ä¸åŒçš„ç¼–ç¨‹æ–¹å¼ èƒ½ç”¨constï¼Œenumï¼Œinlineå°±åˆ«#define èƒ½ç”¨constå°±ç”¨const ç¡®ä¿ç±»åˆå§‹åŒ–åå†ä½¿ç”¨ å°½å¯èƒ½ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–(åŸå› :operator= first call classâ€™s default consturctor to allocate memory and get address, then do variable assigment) é¿å…åˆå§‹åŒ–é¡ºåºé—®é¢˜ï¼ˆæœ‰å…³staticåˆå§‹åŒ–çš„é—®é¢˜ï¼‰ çŸ¥é“é»˜è®¤æ„é€ ï¼Œææ„ï¼Œå¤åˆ¶æ„é€ å‡½æ•° ä¸€æ—¦åˆ›å»ºç§»åŠ¨æ„é€ ||ç§»åŠ¨èµ‹å€¼æ“ä½œç¬¦ï¼Œä¸ä¼šç”Ÿæˆé»˜è®¤å¤åˆ¶æ„é€ &amp;&amp;å¤åˆ¶è¿ç®—ç¬¦ï¼Œåä¹‹äº¦ç„¶ å°å¿ƒä½¿ç”¨é»˜è®¤ç”Ÿæˆçš„ç±»å‡½æ•° è‹¥è¦ä½¿ç”¨å¤šæ€ï¼Œåˆ™åº”å°†åŸºç±»ææ„å‡½æ•°å®šä¹‰ä¸ºvirtual ä¸è¦è®©å¼‚å¸¸ç¦»å¼€ææ„å‡½æ•° ä¸è¦åœ¨æ„é€ å’Œææ„å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•° ä¹Ÿä¸æ˜¯ä¸èƒ½ç”¨ï¼Œæ³¨æ„ç”¨çš„æ—¶å€™çš„ç±»å‹æ˜¯åŸºç±»è¿˜æ˜¯æ´¾ç”Ÿç±»ï¼ˆå®¹æ˜“å‡ºé—®é¢˜æ‰€ä»¥ä¸å»ºè®®ç”¨ï¼‰ é‡è½½è¿ç®—ç¬¦å»ºè®®è¿”å›*thisä»¥ä¾¿è¿ç­‰åŠå…¶å®ƒæ“ä½œ é‡è½½æ“ä½œç¬¦æ—¶è¦è€ƒè™‘è‡ªå·±å¯¹è‡ªå·±æ“ä½œçš„æƒ…å†µ å¤„ç†æ–¹æ³•ï¼š å…ˆåˆ¤æ–­åœ°å€ æ‹·è´åæ“ä½œæ‹·è´ æ‹·è´ï¼ˆå¤åˆ¶è¿ç®—ç¬¦ï¼‰è¦å®Œå…¨å¤åˆ¶ç±»çš„å†…å®¹ï¼ˆåŒ…æ‹¬åŸºç±»çš„ï¼‰ è¦å¤ç”¨ä»£ç ï¼Œä¸è¦ç›¸äº’è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°ï¼Œè€Œæ˜¯å…±åŒè°ƒç”¨ä¸€ä¸ªä¸‰æ–¹å‡½æ•° RAII: use class to manage resource(unique_ptr &amp; share_ptr) RAII object have specified copy function è®¿é—®RAII classæ•°æ®ï¼š éšå¼ï¼šæ›´æ–¹ä¾¿ æ˜¾ç¤ºï¼šæ›´å®‰å…¨ æˆå¯¹ä½¿ç”¨å¯¹åº”çš„ new([]) &amp; delete([]) å•ç‹¬åˆ›å»ºæ™ºèƒ½æŒ‡é’ˆ eg: A(std::unique_ptr&lt;B&gt;(new B), fuc()) æ™ºèƒ½æŒ‡é’ˆåˆ›å»ºéœ€è¦æ¥å— new è¿”å›çš„åœ°å€ï¼Œè€Œç±»æ„é€ å‡½æ•°æ‰§è¡Œé¡ºåºç”±ç¼–è¯‘å™¨å†³å®šï¼Œå¦‚æœfuc throw exception,ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ è®¾è®¡è‰¯å¥½çš„interface å°½å¯èƒ½ä¸è®©ç”¨æˆ·å†™å‡ºå‡ºé”™ä»£ç  å‡å°‘ç”¨æˆ·ç¢°åˆ°ç®¡ç†å†…å­˜çš„å‡ ç‡ shared_ptræ€»æ˜¯ä½¿ç”¨æŒ‡å‘ç±»çš„ææ„å‡½æ•°ï¼Œå¯ä»¥é˜²æ­¢cross-DLL(object creat in a dynamic link library but delete in a differet DLL) å®šä¹‰ç±»å°±æ˜¯å®šä¹‰ç±»å‹ï¼Œå…³æ³¨ä¸€äº›ç»†èŠ‚ å°½é‡ä¼ const&amp;,å¯¹åŸºç¡€ç±»å‹ç›´æ¥ä¼ å€¼(iteratorå®ç°æ˜¯æŒ‡é’ˆï¼Œä¹Ÿç®—) ä¸è¦è¿”å›æŒ‡å‘æœ¬åœ°ä¸´æ—¶å˜é‡çš„æŒ‡é’ˆ å¯¹ç”¨æˆ·éšè—æ•°æ®ï¼Œprotectedæ²¡æ¯”publicåŒ…è£…å¥½åˆ°å“ªå» ä¸ç”¨è®¿é—®dataçš„å°±åˆ«ææˆæˆå‘˜å‡½æ•° ç±»å‹è½¬æ¢éœ€è¦éæˆå‘˜å‡½æ•°(friend) åˆ›å»ºåˆé€‚çš„swapå‡½æ•°ï¼š é»˜è®¤çš„std::swapæ‰§è¡Œä¸‰æ¬¡æ‹·è´æ„é€ -&gt;è§£å†³æ–¹æ¡ˆï¼šæ„é€ wapperç±»ä½¿ç”¨æŒ‡é’ˆæ¥å­˜å‚¨æ•°æ®ï¼Œäº¤æ¢ä»…äº¤æ¢æŒ‡é’ˆï¼Œå¹¶ä¸”æä¾›publicçš„swapæˆå‘˜å‡½æ•° å¦‚æœè¯¥ç±»ä¸æ˜¯æ¨¡æ¿ç±»ï¼Œéœ€è¦å…·ä½“åŒ–std::swapç»™è¯¥ç±»;å¦‚æœè¯¥ç±»æ˜¯æ¨¡æ¿ç±»åˆ™åœ¨namespaceä¸­é‡å†™swapï¼ˆæ¨¡æ¿å‡½æ•°ï¼‰ è°ƒç”¨è§„åˆ™ï¼šusing + using std::swapï¼Œè°ƒç”¨ä¼˜å…ˆçº§ä¸º æ¨¡æ¿swap&gt;å…·ä½“åŒ–std::swap&gt;std::swap,å› æ­¤è®°å¾—using å’Œusing std::swap å°½å¯èƒ½å»¶ç¼“å˜é‡çš„å®šä¹‰ï¼ˆçœ‹æƒ…å†µè€Œå®šï¼‰å¥½å¤„ï¼š - é¿å…æ— ç”¨å˜é‡æ„é€ æ¶ˆè€—æ—¶é—´ï¼ˆthrowä¼šå¯¼è‡´æ— ç”¨ - ä¼˜åŒ–é»˜è®¤æ„é€ +å¤åˆ¶æ„é€ ä¸ºå¤åˆ¶æ„é€  å°½å¯èƒ½ä¸ç”¨castï¼Œå°¤å…¶dynamic_castï¼›å¿…é¡»è¦ç”¨ï¼Œå®šä¹‰å‡½æ•°æ¥éšè—castï¼ˆå°½é‡é¿å…ç”¨æˆ·è‡ªå·±castï¼‰ï¼›å°‘ç”¨cç±»å‹çš„è½¬å‹, c++å››ç§cast const_cast dynamic_cast reinterpret_cast static_cast static_castå­ç±»è½¬æˆçˆ¶ç±»æ—¶æ˜¯äº§ç”Ÿä¸€ä¸ªå­ç±»ä¸­çˆ¶ç±»çš„ä¸´æ—¶æ‹·è´ï¼Œä¿®æ”¹ä¸ä¼šæ˜ å°„åˆ°åŸå­˜å‚¨ castè¦å°å¿ƒï¼Œææ¸…æ¥šè‡ªå·±çš„ç›®çš„ å°½å¯èƒ½é¿å…è¿”å›å¥æŸ„[å¼•ç”¨å’ŒæŒ‡é’ˆ] æŒ‡å‘æ ˆä¸­ä¸´æ—¶å˜é‡ä¼šå¯„æ‰ exception safety: No resource leak No data structures become coorupted exception safety function: Basic guarantee: after throw, everything in program remain valid Strong guarantee: after exception, the program status remain as if the fuction is never called Nothrow guarantee: never throw exception(hard to guarantee out of C part in C++) Strong guarantee implement: make a copy and modify the copy, then swap them in noexception way(But this need more resource and time, though itâ€™s highly recommand, not always need to provide strong guarantee) ä¸€èˆ¬å‡½æ•°éœ€è¦æä¾›è‡³å°‘è¦æœ‰weak exception guarantee(at least no resource leak) inline function rules: limit inline function as small, frequently called functions. å†…è”åˆ«ç”¨æ¨¡æ¿ å…¶å®ƒä¸€äº›ä¸œè¥¿ï¼š ä¸€èˆ¬æ„é€ å’Œææ„å‡½æ•°ä¸æ˜¯å†…è” èƒ½ä¸èƒ½å†…è”ä¸»è¦çœ‹ç¼–è¯‘å™¨ æœ€å°åŒ–ç¼–è¯‘ä¾èµ–å…³ç³»ï¼ˆé€šè¿‡å£°æ˜ï¼‰å¯ä»¥ä½¿ç”¨ï¼š handle class interface class: increase memory cost for virtual function table ç¼–è¯‘æ—¶åªéœ€è¦é‡æ–°é“¾æ¥å‡½æ•°å°±è¡Œ public inheritance means â€œis aâ€(noted that only public do this) ç»§æ‰¿ä¼šéšè—çˆ¶ç±»ï¼ˆä½œç”¨åŸŸï¼‰çš„å˜é‡å’Œå‡½æ•°ï¼ˆå½“ç„¶åç§°ç©ºé—´ä¹Ÿä¼š{ä½¿ç”¨usingè§£é™¤éšè— pure virtual function; virtual function;non-virtual function; ä¸è¦æ‹…å¿ƒè™šå‡½æ•°å¸¦æ¥çš„æŸè€—ï¼ˆå¤§å¤šæ•°æƒ…å†µï¼‰ï¼Œä¹Ÿä¸è¦å…¨æ˜¯è™šå‡½æ•°ï¼ˆä¸€æ ·ï¼‰ pure virtual functionå¯ä»¥åœ¨ç±»å¤–æä¾›å®ç°ï¼Œå¦‚æ­¤å¯ä»¥å¼ºåˆ¶å­ç±»é‡å†™ï¼ˆç®—æ˜¯å¼ºåˆ¶æ³¨æ„å§ï¼‰å¹¶å‡å°‘ä»£ç é‡å¤ 80~20rule:80% running time spend on 20% code ä½¿ç”¨none virtual interface idiom åœ¨åŸºç±»ä»¥ç¡®ä¿å¤šæ€åœ¨ä½•æ—¶è°ƒç”¨å‡½æ•° ä½¿ç”¨å‡½æ•°æŒ‡é’ˆæˆå‘˜ä»£æ›¿è™šå‡½æ•°ï¼ˆå¥½å¤„ï¼šå¯ä»¥æ›´æ”¹è°ƒç”¨çš„å‡½æ•°(åå¤„ï¼šç¼ºå°‘å¯¹épublicå˜é‡çš„è®¿é—®æƒé™ ä½¿ç”¨std::functionæˆå‘˜ä»£æ›¿è™šå‡½æ•° é‡å®šä¹‰éè™šå‡½æ•°å¯èƒ½ä¼šä½¿å¾—å¤šæ€å‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜(ä»è®¾è®¡ä¸Šæ¥è¯´å°±ä¸åº”è¯¥é‡å®šä¹‰éè™šå‡½æ•°) é»˜è®¤å‚æ•°å€¼ä¸ºé™æ€ç»‘å®šï¼Œä¸åŒäºè™šå‡½æ•°çš„åŠ¨æ€ç»‘å®šï¼Œä¸è¦åœ¨ç»§æ‰¿ä¸­æ”¹å˜é»˜è®¤å€¼ has a &amp; implemented in terms of-- composition private inheritanceå½“ä»…å¿…è¦æ—¶ - both private inheritance and composition mean is-implemented-in-terms-of - composition is easy to understand - private inheritance can enable EBO - empty base optomize(EBO):å½“ä»…å•ç»§æ‰¿ä¸”çˆ¶ç±»æ˜¯ç©ºç±»æ—¶ï¼Œå­ç±»å¤§å°ç­‰äºæ•°æ®å¤§å°(ç¼–è¯‘å™¨ä¼˜åŒ– å¤šç»§æ‰¿å°½é‡åˆ«ç”¨ï¼Œç”¨è¦è€ƒè™‘virtual è™šæ‹Ÿç»§æ‰¿æœ‰æŸè€—ï¼ˆæ¯”èµ·å•ç»§æ‰¿ å¤šç»§æ‰¿ä¾‹å­ï¼špublic interface+private implementation ç±»å’Œæ¨¡æ¿éƒ½æ”¯æŒå¤šæ€ å¯¹äºç±»ï¼Œæ¥å£æ˜¯æ˜ç¡®çš„ï¼Œå¤šæ€å‡ºç°åœ¨è¿è¡Œæ—¶ å¯¹äºæ¨¡æ¿å‚æ•°ï¼Œæ¥å£æ˜¯æ˜ç¡®ä¸”åŸºäºåˆæ³•çš„è¡¨è¾¾å¼çš„ï¼Œå¤šæ€å‡ºç°åœ¨ç¼–è¯‘æ—¶ï¼ˆé€šè¿‡æ¨¡æ¿åˆå§‹åŒ–å’Œå‡½æ•°é‡è½½ï¼‰ typenameå’Œclasså¯ä»¥äº’æ¢ åœ¨ä¸æ¸…æ¥šçš„æƒ…å†µä¸‹ï¼ŒC++é»˜è®¤æŠŠtypename(class):ğŸ˜—**çœ‹æˆå˜é‡è€Œä¸æ˜¯ç±»å‹ï¼Œä½¿ç”¨ typename å‘Šè¯‰ä»–è¿™æ˜¯ä¸ªå˜é‡ç±»å‹ è®¿é—®æ¨¡æ¿åŸºç±»å‡½æ•°çš„ä¸‰ç§æ–¹æ³• ä½¿ç”¨ this æŒ‡é’ˆè°ƒç”¨ using æŒ‡ä»¤ base&lt;T&gt;::**ç›´æ¥ç”¨ æ¨¡æ¿éšå¼å…·ä½“åŒ–å‡ºçš„ä¸ä¾èµ–äºæ¨¡æ¿å‚æ•°çš„å‡½æ•°ä¼šå¯¼è‡´ç¨‹åºè†¨èƒ€ è‹¥ç”±éç±»å‹å‚æ•°å¯¼è‡´ï¼Œå°†æ¨¡æ¿å‚æ•°æ¢ä¸ºå‡½æ•°å‚æ•°æˆ–è€…ç±»æˆå‘˜å˜é‡ è‹¥ç”±ç±»å‹å‚æ•°å¯¼è‡´ï¼Œå¯ä»¥å°†æ•°æ®è½¬åŒ–ä¸º æ— ç±»å‹æŒ‡é’ˆ eg: static_cast&lt;void*&gt; ç„¶åç»Ÿä¸€è°ƒç”¨ åœ¨æ¨¡æ¿ç±»ä¸­ä½¿ç”¨æ¨¡æ¿æˆå‘˜å‡½æ•°æ¥æ¥å—æ‰€æœ‰åˆæ³•å‚æ•° eg: åŒæ¨¡æ¿ä¸åŒå…·ä½“åŒ–ç±»çš„å®ä¾‹åŒ–çš„å¤åˆ¶æ„é€ å‡½æ•°å’Œå¤åˆ¶è¿ç®—ç¬¦ æ³¨æ„ï¼šå³ä½¿å£°æ˜äº†æ¨¡æ¿å¤åˆ¶æ„é€ å‡½æ•°ï¼Œä¹Ÿè¦å£°æ˜ä¸€èˆ¬çš„å¤åˆ¶æ„é€ å‡½æ•° æˆ‘ä¸çŸ¥é“ä»–æƒ³è¯´æ˜å•¥ ç‰¹åŒ–æ¨¡æ¿ç±»ä½¿å…¶å¯¹ç‰¹å®šç±»å‹ä½¿ç”¨ç‰¹å®šå‡½æ•° é€šè¿‡ tyepid() æ£€æŸ¥â€”wrong, canâ€™t compile ç”±äºä¸åŒçš„ç±»å‹æ”¯æŒä¸åŒçš„å‡½æ•°ï¼Œä¸€äº›ä¸æ”¯æŒçš„å‡½æ•°æ— æ³•è¢«ç¼–è¯‘ï¼ˆå³ä½¿if elseæ°¸è¿œä¸ä¼šè¿›å…¥)ç¼–è¯‘è¿‡ç¨‹è¦æ±‚æ‰€æœ‰ä»£ç åˆæ³• é€šè¿‡å’Œå‡½æ•°é‡è½½(ç¼–è¯‘æ—¶) TMP(template metaprogramming) å°†ä¸€éƒ¨åˆ†è¿è¡Œæ—¶å·¥ä½œæ”¾åˆ°ç¼–è¯‘æ—¶è¿›è¡Œ é€šè¿‡ set_new_handler(*new_handler) è‡ªå®šä¹‰newçš„è¡Œä¸º typedef void (*new_handler)() declear in std, use as std::new_handler é€šè¿‡è¿é”è°ƒç”¨åœ¨å¤±è´¥åå°è¯•å…¶ä»– handler åˆ†é…å†…å­˜ï¼Œæœ€åå…¨éƒ¨å¤±è´¥å†throw bad_alloc è‡ªå®šä¹‰ç±»newçš„è¡Œä¸º: modify void* operator new(std::size)throw(std::bad_alloc) and set_new_handler C++93å‰newåˆ†é…å¤±è´¥ä¼šè¿”å›0ï¼Œä½¿ç”¨ new(std::nothrow) æ¥å¯ç”¨è¿™ä¸€è¡Œä¸ºï¼ˆåªä½œç”¨äºå†…å­˜åˆ†é…æ—¶ï¼Œåˆå§‹åŒ–ç›¸å…³å¯¹è±¡ä»å¯èƒ½throw é‡è½½new/deleteæ“ä½œç¬¦çš„å‡ ç§æƒ…å†µ ä¼˜åŒ–æ“ä½œé€Ÿåº¦ æ”¶é›†å†…å­˜ä½¿ç”¨ä¿¡æ¯ å‡å°‘å¼€å¤´å’Œæœ«å°¾çš„å†…å­˜å ç”¨ è‡ªå®šä¹‰å†…å­˜å¯¹é½ å°†ç±»é›†æŸæ‘†æ”¾ å…¶ä»–æœªåˆ—å‡ºnewè¡Œä¸º é‡è½½newå’Œdelete é‡è½½newéœ€è¦ä¸€ä¸ªæ— é™å¾ªç¯æ¥åˆ†é…å†…å­˜ï¼Œå¹¶åœ¨å¤±è´¥æ—¶è°ƒç”¨ set_new_handler æˆ–è€…åˆ†é…0ç©ºé—´å¹¶throw å¯¹äºç±»ç±»å‹ï¼Œåº”è¯¥åˆ†é…æ¯”é¢„æœŸæ›´å¤§ç©ºé—´ deleteå¯¹nullpträ»€ä¹ˆä¹Ÿä¸åšï¼Œå¯¹ç±»ç±»å‹åº”è¯¥åˆ é™¤æ¯”é¢„æœŸæ›´å¤§ç©ºé—´ é‡å†™newäº†è®°å¾—é‡å†™deleteï¼Œå¹¶ä¸”ä¸è¦æ— æ„é—´éšè—äº†é»˜è®¤çš„new&amp;delete æ³¨æ„ç¼–è¯‘è­¦å‘Šï¼Œä¹Ÿä¸è¦è¿‡åº¦ä¾èµ–ç¼–è¯‘å™¨ ç†Ÿæ‚‰æ ‡å‡†åº“ï¼ŒåŒ…æ‹¬ STL(standard template library) Iostream Internationlization(like wchar_t,wstring) numeric provessing(valarray, complex) exception hierarchy C89 standard library tr1(2005,Technical report 1), add smartPointers,function pointers(tr1::function,std::function now)å°±æ˜¯std::expermental::xxx Boost organization and Boost library This is just a begining, C++ learning will never end","categories":[{"name":"Knowledge","slug":"Knowledge","permalink":"http://blog.vollate.top/categories/Knowledge/"}],"tags":[{"name":"Notes","slug":"Notes","permalink":"http://blog.vollate.top/tags/Notes/"},{"name":"C++","slug":"C","permalink":"http://blog.vollate.top/tags/C/"}]},{"title":"Book List","slug":"book-list","date":"2023-08-30T07:33:26.000Z","updated":"2024-03-03T10:46:58.000Z","comments":true,"path":"2023/08/30/book-list/","permalink":"http://blog.vollate.top/2023/08/30/book-list/","excerpt":"","text":"Reading C++ Currency in Action Schedule Effective Modern C++ C++ Templates ed.2 Stash Deep learning Finished Name Finish date C++ Primer Plus 2021.12 Effective C++ 2022.7 1984 2022.6 æ²™ä¸˜ 2022.6 èµ„æœ¬è®º 2022.8.1 åœ°é“ç³»åˆ—(203[3,5]) 2022.9.25 More Effective C++ 2023.1.22 The Fast Guide towards Modern C++ 2023.7.15","categories":[],"tags":[{"name":"Books","slug":"Books","permalink":"http://blog.vollate.top/tags/Books/"}]},{"title":"Tool List","slug":"tool-list","date":"2023-03-27T00:17:41.000Z","updated":"2024-07-06T09:56:57.000Z","comments":true,"path":"2023/03/27/tool-list/","permalink":"http://blog.vollate.top/2023/03/27/tool-list/","excerpt":"","text":"æ”¶å½•äº†Linuxä¸‹ä½¿ç”¨çš„ä¸€äº›å·¥å…· Screen Shot/Recorder SimpleScreenRecorder OBS studio Flameshot Cloud Drive Onedrive OnedriveGUI: GUI for client above Rclone: better than above Proxy Clash Client cfw(closed-source) ä¸å»ºè®®ä½¿ç”¨ clash-verge(open-source) clash verge rev; å› ä¸ºæŸäº›çƒ‚äººçš„åŸå› ï¼Œè¢«é“æ‹³åˆ¶è£åé‡ç”Ÿçš„ç‰ˆæœ¬ æ³¨æ„ Clash å’Œ Clash.Meta æ˜¯å¼€æºè½¯ä»¶ï¼Œclash.Premium ä¸º Clash åŸä½œè€…åœ¨ Clash åŸºç¡€ä¸Šå¼€å‘çš„é—­æºè½¯ä»¶ï¼Œä»‹æ„è¯¯ç”¨ åªå‰© Meta äº†ä¸”æ”¹åäº†ã€‚åŸç¥ï¼Œå¯åŠ¨!!! V2ray Client v2rayA(open-source) Diagram drawio Office libreoffice onlyoffice xournal++ å…¨å¹³å°æ‰‹å†™æ¿å·¥å…·ï¼Œä½†æ˜¯å®‰å“ç«¯è¿˜å¾ˆçƒ‚ Resource Monitor btop or bpytop htop Diff Tools meld kdiff3 Mouse piper è§£å†³äº† LogitechG ç³»åˆ—é¼ æ ‡åœ¨ Linux ä¸‹æ— æ³•è®¾ç½® DPIï¼Œç¯å…‰ä¸äº®çš„é—®é¢˜ã€‚ç›¸å½“äºä¸€ä¸ªéå®˜æ–¹ Logitech G Hub","categories":[],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://blog.vollate.top/tags/Linux/"}]},{"title":"Article Archive","slug":"article-archives","date":"2022-11-10T20:10:57.000Z","updated":"2024-02-15T14:09:46.000Z","comments":true,"path":"2022/11/10/article-archives/","permalink":"http://blog.vollate.top/2022/11/10/article-archives/","excerpt":"","text":"OS å†…å­˜ç®¡ç† Program CMake export lib oneAPI|DPC++å½’æ¡£ CppCon Network GFW report","categories":[],"tags":[{"name":"Archive","slug":"Archive","permalink":"http://blog.vollate.top/tags/Archive/"}]},{"title":"Happy Runner (ä¹é“ä¸è·‘)","slug":"happy-runner","date":"2022-11-03T02:57:19.000Z","updated":"2024-05-10T18:01:09.000Z","comments":true,"path":"2022/11/03/happy-runner/","permalink":"http://blog.vollate.top/2022/11/03/happy-runner/","excerpt":"","text":"Requirement ä¸€éƒ¨rootäº†çš„å®‰å“æ‰‹æœº(è§£ä¸äº†blçš„å¯ä»¥è¯•è¯•å¤ªæ) å¦‚ä½•rootå»ºè®®google,æ®è¯´å°ç±³å¼€æ¨¡ç³Šå®šä½ä¸rootä¹Ÿè¡Œï¼Œä½†æ˜¯æ²¡è¯•è¿‡(æ²¡æœ‰æ²¡rootçš„æ‰‹æœº) Steps ä¸‹è½½fake locationï¼Œé“¾æ¥æŒ‚äº†å°±ä¸Š github æœ ä¹°é«˜çº§ç‰ˆ (èŠ±é’±) è®¾ç½®é‡Œé¢æŠŠåœ°å›¾æ¢æˆç™¾åº¦ è·¯çº¿æ¨¡æ‹Ÿé‡Œé¢ç”»è·¯çº¿ï¼Œå»ºè®®æŠŠæ¯ä¸ªå¯èƒ½çš„æ‰“å¡ç‚¹éƒ½è¿‡ä¸€é ç°åœ¨ä¸ç”¨æ‰“å¡äº†,å·®ä¸å¤šå°±è¡Œï¼Œæ³¨æ„åˆ«è¶…è¿‡å•æ¬¡æœ€å¤§è·¯ç¨‹ å¼€å¯è·¯çº¿æ¨¡æ‹Ÿå’Œä¹è·‘ï¼Œè®¾ç½®é€Ÿåº¦(æ³¨æ„åˆ«å¤ªå¿«äº†)ï¼Œå»ºè®®å¼€å¯æµ®åŠ¨é€Ÿåº¦å’Œæ¨¡æ‹Ÿæ­¥é¢‘ è®°å¾—åˆ°æ—¶é—´æ¥å…³ä¹è·‘å…å¾—è¶…æ—¶ é—®é¢˜æ’æŸ¥ å¼€äº†æ¨¡æ‹Ÿæ²¡ååº”: æ¢è¿è¡Œæ¨¡å¼(root/no root) ä¹è·‘é—ªé€€(rootäº†çš„æ‰‹æœº/æ¨¡æ‹Ÿå™¨): å¯¹ä¹è·‘éšè—root(Magisk/fake location å†…ç½®) ç›®å‰æœ€æ–°ç‰ˆä¹è·‘å¥½åƒä¸èƒ½åœ¨æ¨¡æ‹Ÿå™¨ä¸­è¿è¡Œï¼Œå¤§æ¦‚æ˜¯æ£€æµ‹æ¨¡æ‹Ÿå™¨ï¼Ÿ å…¶ä»–: çœ‹æ–‡æ¡£, googleï¼Œæˆ‘æœ‰ä¸€ä¸ªæœ‹å‹ æœ¬æ•™ç¨‹ä»…ä¾›å‚è€ƒï¼Œä½¿ç”¨æœ‰é£é™©ï¼Œå¯¹äºæŒ‰ç…§æœ¬æ•™ç¨‹æ“ä½œé€ æˆè¢«æ£€æµ‹ç­‰ç­‰é—®é¢˜æ¦‚ä¸è´Ÿè´£","categories":[{"name":"Trick","slug":"Trick","permalink":"http://blog.vollate.top/categories/Trick/"}],"tags":[]},{"title":"First Post","slug":"first-post","date":"2022-10-01T03:12:59.000Z","updated":"2023-12-08T07:34:57.000Z","comments":true,"path":"2022/10/01/first-post/","permalink":"http://blog.vollate.top/2022/10/01/first-post/","excerpt":"","text":"æ€»ç®—æ•´äº†ä¸ªèƒ½çœ‹çš„ blog ç•Œé¢ ä¹‹å‰æ­å›¾åºŠç„¶åç–¯ç‹‚æŠ¥é”™ æœ€åå‘ç°å‘ç°è®¾ç½® nginx çš„æ—¶å€™ location æ‹¼é”™äº† ä¸å¼€è¯­æ³•é«˜äº®çš„ä¸‹åœº æ€»ä¹‹æ£é¼“äº†å¿«ä¸€ä¸ªæœˆæƒ³èµ·æ¥å¼„ä¸€ä¸‹æ–­æ–­ç»­ç»­çš„ç»ˆäºé…å¥½äº†","categories":[],"tags":[]}],"categories":[{"name":"Knowledge","slug":"Knowledge","permalink":"http://blog.vollate.top/categories/Knowledge/"},{"name":"Journal","slug":"Journal","permalink":"http://blog.vollate.top/categories/Journal/"},{"name":"Trick","slug":"Trick","permalink":"http://blog.vollate.top/categories/Trick/"}],"tags":[{"name":"CMake","slug":"CMake","permalink":"http://blog.vollate.top/tags/CMake/"},{"name":"Server","slug":"Server","permalink":"http://blog.vollate.top/tags/Server/"},{"name":"Emali","slug":"Emali","permalink":"http://blog.vollate.top/tags/Emali/"},{"name":"Password","slug":"Password","permalink":"http://blog.vollate.top/tags/Password/"},{"name":"Docker","slug":"Docker","permalink":"http://blog.vollate.top/tags/Docker/"},{"name":"LLDB","slug":"LLDB","permalink":"http://blog.vollate.top/tags/LLDB/"},{"name":"Notes","slug":"Notes","permalink":"http://blog.vollate.top/tags/Notes/"},{"name":"RPC","slug":"RPC","permalink":"http://blog.vollate.top/tags/RPC/"},{"name":"Linux","slug":"Linux","permalink":"http://blog.vollate.top/tags/Linux/"},{"name":"KDE Plasma","slug":"KDE-Plasma","permalink":"http://blog.vollate.top/tags/KDE-Plasma/"},{"name":"Proxy","slug":"Proxy","permalink":"http://blog.vollate.top/tags/Proxy/"},{"name":"Compiler","slug":"Compiler","permalink":"http://blog.vollate.top/tags/Compiler/"},{"name":"OS","slug":"OS","permalink":"http://blog.vollate.top/tags/OS/"},{"name":"Blog","slug":"Blog","permalink":"http://blog.vollate.top/tags/Blog/"},{"name":"CI/CD","slug":"CI-CD","permalink":"http://blog.vollate.top/tags/CI-CD/"},{"name":"C++","slug":"C","permalink":"http://blog.vollate.top/tags/C/"},{"name":"Books","slug":"Books","permalink":"http://blog.vollate.top/tags/Books/"},{"name":"Archive","slug":"Archive","permalink":"http://blog.vollate.top/tags/Archive/"}]}