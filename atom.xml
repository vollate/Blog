<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Vollate&#39;s Blog</title>
  
  
  <link href="http://blog.vollate.top/atom.xml" rel="self"/>
  
  <link href="http://blog.vollate.top/"/>
  <updated>2024-12-02T12:46:31.000Z</updated>
  <id>http://blog.vollate.top/</id>
  
  <author>
    <name>Vollate</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Systemd network-online.target é—®é¢˜æ’æŸ¥è®°å½•</title>
    <link href="http://blog.vollate.top/2024/12/02/systemd-network-online-problem/"/>
    <id>http://blog.vollate.top/2024/12/02/systemd-network-online-problem/</id>
    <published>2024-12-02T12:46:13.000Z</published>
    <updated>2024-12-02T12:46:31.000Z</updated>
    
    <content type="html"><![CDATA[<p><s>clash verge rev</s> æŸä¸å­˜åœ¨çš„è½¯ä»¶æ›´æ–°åˆ° 2.0 åï¼Œå¯åŠ¨æ—¶ä¼šå®‰è£… systemd æœåŠ¡ç”¨äº TUN ç½‘ç»œä»£ç†ã€‚ä½†å‡çº§åæ¯æ¬¡éƒ½éœ€è¦é‡æ–°æ‰§è¡Œ <code>uninstall-service</code> å’Œ <code>install-service</code>, ä¸”å¿…å®šä¼šå¡æ­»ä¸€æ®µæ—¶é—´ã€‚è¿™é‡Œè®°å½•ä¸€ä¸‹æ’æŸ¥è¿‡ç¨‹ã€‚</p><h2 id="æ£€æŸ¥ä¸ºä½•è¦æ‰§è¡Œ-uninstall-service-å’Œ-install-service">æ£€æŸ¥ä¸ºä½•è¦æ‰§è¡Œ <code>uninstall-service</code> å’Œ <code>install-service</code></h2><p>æŸ¥çœ‹<a href="https://github.com/clash-verge-rev/clash-verge-rev/blob/ae5b2cfb79423c7e76a281725209b812774367fa/src-tauri/src/core/service.rs#L76">æºç </a>å¾—çŸ¥ï¼Œservice å®‰è£…ç”±è¿™ä¸ªå‡½æ•°æ‰§è¡Œï¼Œæ£€æŸ¥è°ƒç”¨ä»–çš„ <a href="https://github.com/clash-verge-rev/clash-verge-rev/blob/ae5b2cfb79423c7e76a281725209b812774367fa/src-tauri/src/core/service.rs#L163"><code>check_service</code></a> å‡½æ•°å‘ç°å¯¹ â€œSERVICE_URL/get_clashâ€ å‘ GET è¯·æ±‚æ¥æ£€æµ‹æœåŠ¡æ˜¯å¦è¿è¡Œã€‚ â€œSERVICE_URLâ€ æ˜¯ä¸€ä¸ªå¸¸é‡,ä¸º â€œ<a href="http://127.0.0.1:33211">http://127.0.0.1:33211</a>â€</p><p>lsof çœ‹çœ‹æ˜¯ä»€ä¹ˆè¿›ç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">â¯ sudo lsof -i :33211</span><br><span class="line">COMMAND   PID USER FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">clash-ver 738 root 9u  IPv4   5515      0t0  TCP localhost:33211 (LISTEN)</span><br><span class="line">â¯ sudo lsof -p 738</span><br><span class="line">lsof: WARNING: can&#x27;t stat() fuse.portal file system /run/user/1001/doc</span><br><span class="line">      Output information may be incomplete.</span><br><span class="line">COMMAND   PID USER  FD      TYPE             DEVICE SIZE/OFF    NODE NAME</span><br><span class="line">clash-ver 738 root cwd       DIR              259,6     4096       2 /</span><br><span class="line">clash-ver 738 root rtd       DIR              259,6     4096       2 /</span><br><span class="line">clash-ver 738 root txt       REG              259,6  1068272 4667021 /usr/bin/clash-verge-service</span><br><span class="line">clash-ver 738 root mem       REG              259,6  2014520 4590980 /usr/lib/libc.so.6</span><br><span class="line">clash-ver 738 root mem       REG              259,6    14280 4590996 /usr/lib/libdl.so.2</span><br><span class="line">clash-ver 738 root mem       REG              259,6   973144 4591006 /usr/lib/libm.so.6</span><br><span class="line">clash-ver 738 root mem       REG              259,6    14288 4591034 /usr/lib/libpthread.so.0</span><br><span class="line">clash-ver 738 root mem       REG              259,6    14352 4591039 /usr/lib/librt.so.1</span><br><span class="line">clash-ver 738 root mem       REG              259,6   915712 4591699 /usr/lib/libgcc_s.so.1</span><br><span class="line">clash-ver 738 root mem       REG              259,6   228376 4590929 /usr/lib/ld-linux-x86-64.so.2</span><br><span class="line">clash-ver 738 root   0r      CHR                1,3      0t0       4 /dev/null</span><br><span class="line">clash-ver 738 root   1u     unix 0x000000005430ea85      0t0   17938 type=STREAM (CONNECTED)</span><br><span class="line">clash-ver 738 root   2u     unix 0x000000005430ea85      0t0   17938 type=STREAM (CONNECTED)</span><br><span class="line">clash-ver 738 root   3u  a_inode               0,16        0    2087 [eventpoll:4,8,9]</span><br><span class="line">clash-ver 738 root   4u  a_inode               0,16        0    2087 [eventfd:0]</span><br><span class="line">clash-ver 738 root   5u  a_inode               0,16        0    2087 [eventpoll:4,8,9]</span><br><span class="line">clash-ver 738 root   6u     unix 0x00000000cb59cf7b      0t0    2387 type=STREAM (CONNECTED)</span><br><span class="line">clash-ver 738 root   7u     unix 0x00000000093de046      0t0    2388 type=STREAM (CONNECTED)</span><br><span class="line">clash-ver 738 root   8u     unix 0x00000000cb59cf7b      0t0    2387 type=STREAM (CONNECTED)</span><br><span class="line">clash-ver 738 root   9u     IPv4               5515      0t0     TCP localhost:33211 (LISTEN)</span><br></pre></td></tr></table></figure><h2 id="æ£€æŸ¥æœåŠ¡çŠ¶æ€">æ£€æŸ¥æœåŠ¡çŠ¶æ€</h2><p>çœ‹çœ‹è£…äº†å“ªäº›æœåŠ¡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â¯ systemctl list-units|grep clash</span><br><span class="line">  clash-verge-service.service</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>systemctl status clash-verge-service.service</code> æŸ¥çœ‹æœåŠ¡çŠ¶æ€å’Œæ–‡ä»¶ä½ç½®ï¼Œæ‰“å¼€åå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Clash Verge Service helps to launch Clash Core.</span><br><span class="line">After=network-online.target nftables.service iptables.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/bin/clash-verge-service</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=5</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>Systemd serive å®šä¹‰ä¸­ï¼Œ<code>After=network-online.target nftables.service iptables.service</code> è¡¨æ˜è‡³å°‘ä¸€ä¸ªæœåŠ¡å®Œæˆå¯åŠ¨åæ‰ä¼šå¯åŠ¨ clash-verge-serviceã€‚<br>æˆ‘çš„ç³»ç»Ÿä½¿ç”¨ <code>firewalld</code> ä½œä¸ºé˜²ç«å¢™,å®ƒä¼šä½œä¸ºä¸Šå±‚æœåŠ¡è‡ªåŠ¨å¯ç”¨ <code>nftables.service</code> å’Œ <code>iptables.service</code> ä½œä¸ºåº•å±‚æœåŠ¡ï¼Œæ‰€ä»¥ <code>nftables.service iptables.service</code> ä¸¤ä¸ªæœåŠ¡ä¸ä¼šå¯åŠ¨ï¼Œå› æ­¤åªéœ€è¦ç­‰å¾… <code>network-online.target</code> å¯åŠ¨å®Œæˆå³å¯ã€‚</p><h2 id="æµ‹è¯•-network-online-target">æµ‹è¯• network-online.target</h2><p>æ‰§è¡Œ <code>systemctl start network-online.target</code>ï¼Œå‘ç°ä¼šå¡æ­»å°†è¿‘ 2 minã€‚ä½¿ç”¨ <code>systemd-analyze critical-chain network-online.target</code> æ£€æŸ¥ä¾èµ–å’Œè€—æ—¶ï¼Œå‘ç°å®é™…æ‰§è¡Œ(CPU æ—¶é—´)æ­£å¸¸ï¼Œä½†æ˜¯å¯åŠ¨å‰ç»è¿‡äº†é•¿æ—¶é—´ç­‰å¾…ã€‚</p><p>æ¥ä¸‹æ¥æŸ¥äº†ä¸‹ <code>network-online.target</code> çš„ä¾èµ–å’Œè¢«ä¾èµ–ï¼Œæ²¡ä»€ä¹ˆé—®é¢˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">â¯ systemctl list-dependencies network-online.target --after</span><br><span class="line">network-online.target</span><br><span class="line">â—‹ â”œâ”€NetworkManager-wait-online.service</span><br><span class="line">â— â””â”€network.target</span><br><span class="line">â—   â”œâ”€dhcpcd.service</span><br><span class="line">â—   â”œâ”€NetworkManager.service</span><br><span class="line">â—   â”œâ”€systemd-networkd.service</span><br><span class="line">â—   â”œâ”€wpa_supplicant.service</span><br><span class="line">â—   â””â”€network-pre.target</span><br><span class="line">â—     â”œâ”€firewalld.service</span><br><span class="line">â—‹     â”œâ”€ip6tables.service</span><br><span class="line">â—‹     â”œâ”€iptables.service</span><br><span class="line">â—‹     â”œâ”€nftables.service</span><br><span class="line">â—     â””â”€systemd-network-generator.service</span><br><span class="line"></span><br><span class="line">â¯ systemctl list-dependencies network-online.target --before</span><br><span class="line">network-online.target</span><br><span class="line">â—‹ â”œâ”€archlinux-keyring-wkd-sync.service</span><br><span class="line">â— â”œâ”€clash-verge-service.service</span><br><span class="line">â—‹ â”œâ”€docker.service</span><br><span class="line">â—‹ â””â”€shutdown.target</span><br><span class="line">â—‹   â”œâ”€systemd-halt.service</span><br><span class="line">â—‹   â”œâ”€systemd-kexec.service</span><br><span class="line">â—‹   â”œâ”€systemd-poweroff.service</span><br><span class="line">â—‹   â”œâ”€systemd-reboot.service</span><br><span class="line">â—‹   â”œâ”€systemd-soft-reboot.service</span><br><span class="line">â—‹   â””â”€final.target</span><br><span class="line">â—‹     â”œâ”€systemd-halt.service</span><br><span class="line">â—‹     â”œâ”€systemd-kexec.service</span><br><span class="line">â—‹     â”œâ”€systemd-poweroff.service</span><br><span class="line">â—‹     â”œâ”€systemd-reboot.service</span><br><span class="line">â—‹     â””â”€systemd-soft-reboot.service</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œæ‰§è¡Œä»»ä½•ä¾èµ–äº <code>network-online.target</code> çš„æœåŠ¡éƒ½ä¼šå¡æ­»å°†è¿‘ 2 minï¼ˆæˆ‘å°±è¯´æˆ‘ docker.service ä¸ºä»€ä¹ˆå¯åŠ¨æ…¢ï¼‰</p><p>å‚è€ƒ <a href="https://systemd.io/NETWORK_ONLINE/">systemd.io</a>ï¼Œå¯ä»¥çŸ¥é“åœ¨ä½¿ç”¨ systemd çš„ç³»ç»Ÿä¸­ï¼Œ<code>network-online.target</code> ä¸€èˆ¬ä¼šåœ¨ç½‘ç»œè¿æ¥æˆåŠŸåå¯åŠ¨,ç”¨äºç¡®ä¿æœåŠ¡åœ¨ç½‘ç»œè¿æ¥æˆåŠŸåå¯åŠ¨æ¥ã€‚å¦‚éœ€è¦è¿›è¡Œè¿œç¨‹ç£ç›˜æŒ‚è½½ã€è¿œç¨‹æ•°æ®åº“è¿æ¥ç­‰æ“ä½œï¼Œå¯ä»¥å°†æœåŠ¡ä¾èµ–äº <code>network-online.target</code>ã€‚<br><code>network-online.target</code> ä¸»è¦é€šè¿‡ <code>NetworkManager-wait-online.service</code> æˆ– <code>systemd-networkd-wait-online.service</code> æ¥å¯åŠ¨ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯ NetworkManagerï¼Œæ‰€ä»¥åº”è¯¥æ˜¯ <code>NetworkManager-wait-online.service</code>ã€‚<br>åœ¨ â€œTo verify that the right service is enabled (usually only one should be):â€ ç« èŠ‚ä¸­æåˆ°äº†å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤éªŒè¯ service æ­£å¸¸é…ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">systemctl is-enabled NetworkManager-wait-online.service systemd-networkd-wait-online.service</span></span><br><span class="line">disabled</span><br><span class="line">enabled</span><br></pre></td></tr></table></figure><p>ç»æ’æŸ¥å‘ç°åŒæ—¶å¯ç”¨äº† <code>NetworkManager-wait-online.service</code> å’Œ <code>systemd-networkd-wait-online.service</code>ï¼Œå¯¼è‡´äº†é—®é¢˜ã€‚ç¦ç”¨ <code>systemd-networkd-wait-online.service</code> åï¼Œ<code>network-online.target</code> å¯åŠ¨æ­£å¸¸ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;s&gt;clash verge rev&lt;/s&gt; æŸä¸å­˜åœ¨çš„è½¯ä»¶æ›´æ–°åˆ° 2.0 åï¼Œå¯åŠ¨æ—¶ä¼šå®‰è£… systemd æœåŠ¡ç”¨äº TUN ç½‘ç»œä»£ç†ã€‚ä½†å‡çº§åæ¯æ¬¡éƒ½éœ€è¦é‡æ–°æ‰§è¡Œ &lt;code&gt;uninstall-service&lt;/code&gt; å’Œ &lt;code&gt;install-service</summary>
      
    
    
    
    <category term="Journal" scheme="http://blog.vollate.top/categories/Journal/"/>
    
    
    <category term="Linux" scheme="http://blog.vollate.top/tags/Linux/"/>
    
    <category term="Systemd" scheme="http://blog.vollate.top/tags/Systemd/"/>
    
  </entry>
  
  <entry>
    <title>CMake ä»å…¥é—¨åˆ°èƒ½ç”¨å°±è¡Œ</title>
    <link href="http://blog.vollate.top/2024/10/12/cmake-introduction/"/>
    <id>http://blog.vollate.top/2024/10/12/cmake-introduction/</id>
    <published>2024-10-12T17:49:55.000Z</published>
    <updated>2024-10-13T10:35:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ„å»ºç³»ç»Ÿå‘å±•å†å²">æ„å»ºç³»ç»Ÿå‘å±•å†å²</h2><ol><li>æ‰‹å·¥ç¼–è¯‘ (1950s - 1960s): ç¼–ç¨‹è¯­è¨€åˆšåˆšè¯ç”Ÿï¼Œç¨‹åºå‘˜éœ€è¦æ‰‹å·¥ç¼–è¯‘ç¨‹åºï¼Œå°†æºä»£ç è½¬æ¢ä¸ºæœºå™¨ç ã€‚</li><li>æ‰¹å¤„ç†è„šæœ¬ (1960s - 1970s)ï¼š ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬æˆ– shell è„šæœ¬è‡ªåŠ¨åŒ–ç¼–è¯‘å‘½ä»¤ï¼Œå‡å°‘äº†æ‰‹å·¥è¾“å…¥ã€‚</li><li>Make ç³»ç»Ÿ (1970s)ï¼š Make å¼•å…¥äº†å¢é‡ç¼–è¯‘çš„æ¦‚å¿µï¼Œåªé‡æ–°ç¼–è¯‘ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Œå¤§å¹…æå‡æ•ˆç‡ã€‚</li><li>é…ç½®å’Œç”Ÿæˆå·¥å…· (1980s - 1990s)ï¼š Autotools ç­‰å·¥å…·é€šè¿‡è‡ªåŠ¨ç”Ÿæˆè·¨å¹³å°çš„æ„å»ºè„šæœ¬ï¼Œæ”¯æŒå¤šå¹³å°å¼€å‘ï¼Œé¿å…äº†æ‰‹å†™ Makefile çš„æƒ…å†µã€‚</li><li>ç°ä»£æ„å»ºç³»ç»Ÿ (2000s - 2010s)ï¼š CMake å’Œ Meson ç­‰å·¥å…·é‡‡ç”¨å£°æ˜å¼è¯­æ³•ï¼Œç®€åŒ–äº†å¤æ‚é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ã€‚</li><li>ä¸“ç”¨æ„å»ºç³»ç»Ÿå’Œæ„å»ºå·¥å…·é“¾ (2010s - Present)ï¼šNinjaã€Gradleã€Bazelã€Buck ç­‰ä¸“æ³¨äºåŠ é€Ÿå¤§å‹é¡¹ç›®çš„æ„å»ºï¼Œæä¾›é«˜åº¦çš„è‡ªå®šä¹‰åŠŸèƒ½ã€‚</li><li>äº‘åŸç”Ÿå’Œåˆ†å¸ƒå¼æ„å»º (2010s - Now)ï¼š æ”¯æŒäº‘åŸç”Ÿå’Œåˆ†å¸ƒå¼å¼€å‘åœºæ™¯çš„æ„å»ºç³»ç»Ÿï¼Œé›†æˆäº†å®¹å™¨åŒ–å’Œ CI/CD å·¥å…·ã€‚</li></ol><br/><p><strong>å¢é‡ç¼–è¯‘</strong>æ˜¯æŒ‡æ¯æ¬¡åªç¼–è¯‘ä¿®æ”¹è¿‡çš„ç¼–è¯‘å•å…ƒï¼Œé¿å…äº†æ— æ•ˆç¼–è¯‘ã€‚<br>ä¾‹å¦‚ï¼Œåœ¨ C/C++ ä¸­ï¼Œæ¯ä¸ªæºæ–‡ä»¶å¯¹åº”ä¸€ä¸ªç¼–è¯‘å•å…ƒï¼Œåªæœ‰ä¿®æ”¹è¿‡çš„æºæ–‡ä»¶æ‰éœ€è¦é‡æ–°ç¼–è¯‘ã€‚åŒæ—¶ç”±äºé¢„å¤„ç†çš„åŸå› ï¼Œå¤´æ–‡ä»¶çš„å˜æ›´ä¼šé€’å½’å½±å“åˆ°æ‰€æœ‰ç›´æ¥æˆ–é—´æ¥å¼•ç”¨è¯¥å¤´æ–‡ä»¶çš„æºæ–‡ä»¶ã€‚</p><h2 id="GNU-Make">GNU Make</h2><p>Make æ˜¯ä¸€ä¸ªæ„å»ºå·¥å…·ï¼Œé€šè¿‡ Makefile æ–‡ä»¶å®šä¹‰é¡¹ç›®çš„æ„å»ºè§„åˆ™ã€‚Makefile æ–‡ä»¶åŒ…å«äº†ä¸€ç³»åˆ—è§„åˆ™ï¼Œæ¯ä¸ªè§„åˆ™ç”±ä¸€ä¸ªç›®æ ‡ã€ä¾èµ–å’Œå‘½ä»¤ç»„æˆã€‚</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Variable</span></span><br><span class="line">CC = clang</span><br><span class="line">CFLAGS = -Wall -Wextra -Werror</span><br><span class="line"></span><br><span class="line"><span class="comment"># Target</span></span><br><span class="line"><span class="section">all: program</span></span><br><span class="line"></span><br><span class="line"><span class="section">foo.o: foo.c</span></span><br><span class="line">  <span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -c foo.c -o <span class="variable">$@</span></span><br><span class="line"><span class="comment"># $@ refers to the target</span></span><br><span class="line"><span class="comment"># $&lt; refers to the first dependency</span></span><br><span class="line"><span class="comment"># $^ refers to all dependencies</span></span><br><span class="line"></span><br><span class="line"><span class="section">main.o: main.c</span></span><br><span class="line">  <span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -c main.c -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="section">program: main.o foo.o</span></span><br><span class="line">  <span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> main.o foo.o -o program</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> subdir/Makefile</span><br></pre></td></tr></table></figure><p>make æ˜¯ä¸€ä¸ªè¿‡ç¨‹åŒ–çš„æ„å»ºå·¥å…·ï¼Œéœ€è¦æ‰‹åŠ¨ä¹¦å†™æ„å»ºå‘½ä»¤ï¼Œçµæ´»åº¦é«˜ä½†å¯ç»´æŠ¤æ€§å·®ã€‚</p><h2 id="CMake">CMake</h2><p>CMake ä½œä¸ºå…ƒæ„å»ºç³»ç»Ÿï¼Œå¯ä»¥ç”Ÿæˆ Makeã€Ninjaã€Visual Studio ç­‰æ„å»ºç³»ç»Ÿæ‰€éœ€çš„é…ç½®æ–‡ä»¶ï¼Œæ–¹ä¾¿çš„å®ç°é¡¹ç›®çš„è·¨å¹³å°ã€‚CMake çš„é…ç½®æ–‡ä»¶æ˜¯ CMakeLists.txtï¼Œé€šè¿‡ç¼–å†™ CMakeLists.txt æ–‡ä»¶ï¼Œå¯ä»¥å®šä¹‰é¡¹ç›®çš„æ„å»ºè§„åˆ™ã€‚</p><h3 id="Version">Version</h3><p>cmake ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å‘½ä»¤å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œæ–°ç‰ˆå¯èƒ½ä¼šæ·»åŠ æ–°çš„å‘½ä»¤ï¼Œå¹¶ä¸”ä¼šåºŸå¼ƒä¸€äº›æ—§çš„å‘½ä»¤ï¼ˆä½†å¤§éƒ¨åˆ†æƒ…å†µä»ç„¶å¯ç”¨ï¼‰, æ‰€ä»¥åœ¨ç¼–å†™ CMakeLists.txt æ–‡ä»¶æ—¶ï¼Œéœ€è¦é™å®š CMake çš„æœ€ä½ç‰ˆæœ¬ã€‚</p><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>) <span class="comment"># minimum cmake version</span></span><br><span class="line"><span class="comment"># This is a line comment in cmake</span></span><br><span class="line"><span class="comment">#[[ This is a block comment in cmake ]]</span></span><br></pre></td></tr></table></figure><h3 id="Project">Project</h3><p>Project å‘½ä»¤ç”¨äºå®šä¹‰é¡¹ç›®çš„åç§°å’Œæ”¯æŒçš„è¯­è¨€ã€‚å¯¹äºæ”¯æŒçš„è¯­è¨€ï¼Œå¯ä»¥ä½¿ç”¨ Cã€CXXã€CUDAã€Fortranã€ASM ç­‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCMake ä¼šè‡ªåŠ¨æ£€æµ‹é¡¹ç›®ä¸­çš„æºæ–‡ä»¶ï¼Œå¹¶æ ¹æ®æ–‡ä»¶åç¼€åæ¨æ–­è¯­è¨€ç±»å‹ã€‚</p><p>Project æ”¯æŒè®¾ç½®é¡¹ç›®çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥é€šè¿‡ VERSION é€‰é¡¹æŒ‡å®šé¡¹ç›®çš„ç‰ˆæœ¬å·ã€‚</p><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">project</span>(hello_world) <span class="comment"># project name</span></span><br><span class="line"><span class="keyword">project</span>(hello_wrold VERSION <span class="number">5.14</span> LANGUAGES CXX CUDA) <span class="comment"># project name with languages</span></span><br></pre></td></tr></table></figure><h3 id="Variable">Variable</h3><p>CMake ä¸­çš„å˜é‡åˆ†ä¸ºå¦‚ä¸‹å‡ ç§ï¼šæ™®é€šå˜é‡ï¼Œç¼“å­˜å˜é‡ï¼Œç¯å¢ƒå˜é‡ã€‚<br>æ™®é€šå˜é‡ä»…åœ¨æœ¬æ¬¡è¿è¡ŒcmakeæœŸé—´æœ‰æ•ˆï¼›ç¼“å­˜å˜é‡ä¼šè¢«å­˜å‚¨åˆ°ç”Ÿæˆé¡¹ç›®ç›®å½•çš„ CMakeCache.txt æ–‡ä»¶ä¸­ï¼Œç”¨é€”ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>é¿å…ç”¨æˆ·å†æ¬¡è¿è¡Œ cmake é‡æ–°è®¾ç½®å˜é‡</li><li>å­˜å‚¨æŸäº›è¿è¡Œæ—¶ä¿¡æ¯ï¼Œå¯¹ç”¨æˆ·ä¸å¯è§ã€‚å¦‚ç³»ç»Ÿåº“çš„è·¯å¾„ã€ç¼–è¯‘å™¨çš„è·¯å¾„ç­‰ã€‚</li></ul><p>ç¯å¢ƒå˜é‡å–å†³äºè¿è¡Œ cmake çš„ç¯å¢ƒ</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(SRC_FILES main.cpp lib.cpp) <span class="comment"># set Variable</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>) <span class="comment"># set Variable</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">ON</span> cache) <span class="comment"># set Cache Variable</span></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;CMAKE_CXX_STANDARD: $&#123;CMAKE_CXX_STANDARD&#125;&quot;</span>) <span class="comment"># print message</span></span><br><span class="line"><span class="keyword">message</span>(WARNING <span class="string">&quot;$ENV&#123;USER&#125;&quot;</span>) <span class="comment"># print warning message</span></span><br><span class="line"><span class="keyword">message</span>(ERROR <span class="string">&quot;Error message&quot;</span>) <span class="comment"># print error message</span></span><br></pre></td></tr></table></figure><p>CMAKE ä¸­ï¼Œæ‰€æœ‰å˜é‡éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œè®¿é—®ä¸å­˜åœ¨çš„å˜é‡ä¼šè¿”å›ç©ºï¼ˆä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œå¦‚æœæ— æ³•æ­£å¸¸å¤„ç†ä¼šäº§ç”Ÿé—®é¢˜ã€‚å› æ­¤å¸¸ç”¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨ <code>if</code> åˆ¤æ–­å˜é‡æ˜¯å¦å­˜åœ¨ã€‚</p><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">DEFINED</span> CMAKE_CXX_STANDARD)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;CMAKE_CXX_STANDARD: $&#123;CMAKE_CXX_STANDARD&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">  <span class="keyword">message</span>(WARNING <span class="string">&quot;CMAKE_CXX_STANDARD is not defined&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure><p>åœ¨æ¯”è¾ƒæ—¶ï¼Œåˆ™å¯ä»¥ç›´æ¥åŠ ä¸Šå¼•å·ï¼Œè¿™æ ·å³ä½¿å˜é‡ä¸å­˜åœ¨ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚</p><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&quot;$&#123;CMAKE_CXX_STANDARD&#125;&quot;</span> <span class="keyword">STREQUAL</span> <span class="string">&quot;17&quot;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;CMAKE_CXX_STANDARD is 17&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">  <span class="keyword">message</span>(WARNING <span class="string">&quot;CMAKE_CXX_STANDARD is not 17&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure><h3 id="Control-Flow">Control Flow</h3><p>åŒå¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒCMake ä¹Ÿæ”¯æŒæ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯æ§åˆ¶ã€‚</p><h4 id="if">if</h4><p>if è¯­å¥æ”¯æŒ ANDã€ORã€NOT é€»è¾‘è¿ç®—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨ PARENT_SCOPE é€‰é¡¹å°†å˜é‡ä¼ é€’åˆ°çˆ¶ä½œç”¨åŸŸã€‚</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(CMAKE_CXX_STANDARD <span class="keyword">EQUAL</span> <span class="number">17</span> <span class="keyword">OR</span> ENABLE_CXX17)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;CMAKE_CXX_STANDARD is 17&quot;</span>)</span><br><span class="line"><span class="keyword">elseif</span>(CMAKE_CXX_STANDARD <span class="keyword">EQUAL</span> <span class="number">14</span> <span class="keyword">AND</span> CMAKE_CXX_STANDARD_REQUIRED)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;CMAKE_CXX_STANDARD is 14&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">  <span class="keyword">message</span>(WARNING <span class="string">&quot;CMAKE_CXX_STANDARD is not 17 or 14&quot;</span>) </span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure><p>ä»»ä½•ç©ºå­—ç¬¦ä¸²ã€0ã€FALSEã€NOTFOUNDã€OFFã€NOã€Nã€IGNOREã€æ— å®šä¹‰çš„å˜é‡éƒ½ä¼šè¢«è§†ä¸ºå‡ï¼Œå…¶ä»–å€¼éƒ½ä¼šè¢«è§†ä¸ºçœŸã€‚</p><h4 id="loop">loop</h4><p>CMake æ”¯æŒ FOREACHã€WHILEã€WHILEã€UNTIL å¾ªç¯ï¼Œå…¶ä¸­ FOREACH å¾ªç¯æœ€ä¸ºå¸¸ç”¨ã€‚</p><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(SRC_FILES main.cpp lib.cpp a.cpp b.cpp)</span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">file</span> <span class="variable">$&#123;SRC_FILES&#125;</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;Source file: $&#123;file&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure><h3 id="Subdir">Subdir</h3><p>CMake æ”¯æŒå­ç›®å½•ï¼Œå¯ä»¥é€šè¿‡ add_subdirectory å‘½ä»¤æ·»åŠ å­ç›®å½•ï¼Œå­ç›®å½•ä¸­çš„ CMakeLists.txt æ–‡ä»¶ä¼šè¢«æ‰§è¡Œã€‚</p><p>egï¼šå‡è®¾é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ 1</span><br><span class="line">â”‚Â Â  â””â”€â”€ CMakeLists.txt</span><br><span class="line">â”œâ”€â”€ 2</span><br><span class="line">â”‚Â Â  â””â”€â”€ CMakeLists.txt</span><br><span class="line">â””â”€â”€ CMakeLists.txt</span><br></pre></td></tr></table></figure><p>æ ¹ç›®å½•çš„ CMakeLists.txt æ–‡ä»¶å¦‚ä¸‹</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">project</span>(foo)</span><br><span class="line"><span class="keyword">set</span>(useless <span class="string">&quot;root&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;Root: $&#123;useless&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">add_subdirectory</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;Root: $&#123;useless&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">add_subdirectory</span>(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;Root: $&#123;useless&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;Root: $&#123;useless2&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><p>1/CMakeLists.txt æ–‡ä»¶å¦‚ä¸‹</p><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;Dir1: $&#123;useless&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(useless <span class="string">&quot;dir1&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;Dir1: $&#123;useless&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><p>2/CMakeLists.txt æ–‡ä»¶å¦‚ä¸‹</p><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(useless <span class="string">&quot;dir2&quot;</span> PARENT_SCOPE)</span><br><span class="line"><span class="keyword">set</span>(useless2 <span class="string">&quot;dir2&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;Dir2: $&#123;useless2&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿è¡Œ<code>cmake -Bbuild</code> è¾“å‡ºå¦‚ä¸‹</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// something</span><br><span class="line">-- Root: root</span><br><span class="line">-- Dir1: root</span><br><span class="line">-- Dir1: dir1</span><br><span class="line">-- Root: root</span><br><span class="line">-- Dir2: dir2</span><br><span class="line">-- Root: dir2</span><br><span class="line">-- Root:</span><br><span class="line">// something</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå­ç›®å½•ä¸­çš„å˜é‡ä¸ä¼šå½±å“åˆ°çˆ¶ç›®å½•ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ PARENT_SCOPE é€‰é¡¹å°†å˜é‡ä¼ é€’åˆ°çˆ¶ç›®å½•ã€‚å­ç›®å½•è°ƒç”¨å®Œæˆåï¼Œè¿”å›åˆ°çˆ¶ç›®å½•ï¼Œç»§ç»­æ‰§è¡Œã€‚</p><p>CMake æ”¯æŒ include å‘½ä»¤ï¼Œå¯ä»¥åŒ…å«å…¶ä»– CMakeLists.txt æ–‡ä»¶ã€‚include å‘½ä»¤ä¼šå°†è¢«åŒ…å«çš„æ–‡ä»¶çš„å†…å®¹ç›´æ¥æ’å…¥åˆ°å½“å‰æ–‡ä»¶ä¸­ï¼Œå› æ­¤è¢«åŒ…å«çš„æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ä¼šå½±å“åˆ°åŒ…å«çš„æ–‡ä»¶ã€‚å’Œ C/CPPçš„é¢„å¤„ç†#include ä½œç”¨ç›¸åŒã€‚</p><h3 id="Executable-Lib">Executable/Lib</h3><p>CMake ä¸­æ”¯æŒä¸‰ç§ç±»å‹çš„æ„å»ºç›®æ ‡ï¼šå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆadd_executableï¼‰ã€é™æ€åº“ï¼ˆadd_library STATICï¼‰ã€åŠ¨æ€åº“ï¼ˆadd_library SHAREDï¼‰ã€‚</p><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(hello_world main.cpp) <span class="comment"># add executable target</span></span><br><span class="line"><span class="keyword">add_library</span>(hello STATIC lib.cpp) <span class="comment"># add static library target</span></span><br><span class="line"><span class="keyword">add_library</span>(hello SHARED lib.cpp) <span class="comment"># add shared library target</span></span><br></pre></td></tr></table></figure><h3 id="include-directories">include_directories</h3><p>include_directories å‘½ä»¤ç”¨äºæ·»åŠ å¤´æ–‡ä»¶æœç´¢è·¯å¾„ï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªè·¯å¾„ã€‚ä½¿ç”¨ BEFORE é€‰é¡¹å¯ä»¥å°†è·¯å¾„æ·»åŠ åˆ°å·²æœ‰è·¯å¾„çš„å‰é¢ï¼Œæ”¾ç½®è¢«å…¶ä»–è·¯å¾„è¦†ç›–ã€‚</p><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include_directories</span>(<span class="keyword">include</span>/foo) <span class="comment"># add include path</span></span><br><span class="line"><span class="keyword">include_directories</span>(BEFORE <span class="keyword">include</span>/bar) <span class="comment"># add include path before</span></span><br></pre></td></tr></table></figure><h3 id="target-xxx">target_xxx</h3><p>target_xxx ç³»åˆ—å‘½ä»¤ç”¨äºè®¾ç½®ç›®æ ‡çš„å±æ€§ï¼Œå¦‚ç¼–è¯‘é€‰é¡¹ã€é“¾æ¥é€‰é¡¹ã€ä¾èµ–ç­‰ã€‚åˆ†ä¸ºä¸‰ç§å±æ€§ï¼šPRIVATE, PUBLIC, INTERFACEã€‚</p><ul><li>PRIVATE å±æ€§åªå¯¹å½“å‰ç›®æ ‡æœ‰æ•ˆ, ä¸ä¼šä¼ é€’ç»™ä¾èµ–ç›®æ ‡</li><li>PUBLIC å±æ€§å¯¹å½“å‰ç›®æ ‡å’Œä¾èµ–ç›®æ ‡éƒ½æœ‰æ•ˆ</li><li>INTERFACE å±æ€§åªå¯¹ä¾èµ–ç›®æ ‡æœ‰æ•ˆ,ä¸ä¼šå¯¹å½“å‰ç›®æ ‡æœ‰æ•ˆ</li></ul><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_include_directories</span>(hello PUBLIC <span class="keyword">include</span>) <span class="comment"># add include path for target hello and any target that depends on hello</span></span><br><span class="line"><span class="keyword">target_compile_definitions</span>(hello PRIVATE DEBUG) <span class="comment"># add compile definition for target hello</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(hello INTERFACE foo) <span class="comment"># link library foo to targets who depends on hello</span></span><br></pre></td></tr></table></figure><p>å¸¸ç”¨çš„ target_xxx å‘½ä»¤æœ‰ï¼š</p><ul><li>target_include_directories æ·»åŠ å¤´æ–‡ä»¶æœç´¢è·¯å¾„</li><li>target_compile_definitions æ·»åŠ ç¼–è¯‘å®å®šä¹‰</li><li>target_compile_options æ·»åŠ ç¼–è¯‘é€‰é¡¹</li><li>target_link_libraries æ·»åŠ é“¾æ¥åº“</li></ul><h3 id="find-package">find_package</h3><p>find_package å‘½ä»¤ç”¨äºæŸ¥æ‰¾å¤–éƒ¨åº“ï¼Œæœ‰å¦‚ä¸‹å‡ ç§æ¨¡å¼ï¼š</p><ul><li>Module æ¨¡å¼ï¼šåœ¨æŒ‡å®šçš„è·¯å¾„ä¸‹æŸ¥æ‰¾ <code>Find&lt;package&gt;.cmake</code> æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†æŸ¥æ‰¾åº“çš„è§„åˆ™ï¼Œå¦‚ä½•è®¾ç½®åº“çš„å¤´æ–‡ä»¶è·¯å¾„ã€åº“æ–‡ä»¶è·¯å¾„ã€é“¾æ¥åº“ç­‰ã€‚</li><li>Config æ¨¡å¼ï¼šåœ¨æŒ‡å®šçš„è·¯å¾„ä¸‹æŸ¥æ‰¾ <code>&lt;package&gt;Config.cmake</code> æˆ– <code>&lt;lower-case-package&gt;-config.cmake</code> æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†åº“çš„é…ç½®ä¿¡æ¯ï¼Œå¦‚å¤´æ–‡ä»¶è·¯å¾„ã€åº“æ–‡ä»¶è·¯å¾„ã€é“¾æ¥åº“ç­‰ã€‚</li></ul><p>å…¶ä»–å¯é€‰é¡¹</p><ul><li><code>REQUIRED</code>: å¦‚æœæ‰¾ä¸åˆ°åº“ï¼ŒCMake ä¼šæŠ¥é”™å¹¶åœæ­¢æ„å»ºã€‚å¦‚æœ <code>find_package</code> æˆåŠŸï¼Œä¼šå®šä¹‰ä¸€ä¸ª <code>&lt;package&gt;_FOUND</code> å˜é‡ï¼Œè¡¨ç¤ºæ‰¾åˆ°åº“ã€‚</li><li><code>OPTIONAL</code>: å¦‚æœæ‰¾ä¸åˆ°åº“ï¼ŒCMake ä¼šç»§ç»­æ„å»ºã€‚</li><li><code>QUIET</code>: å¤±è´¥æ—¶ä¸è¾“å‡ºè­¦å‘Šã€‚</li><li><code>PATHS</code> &amp; <code>HINTS</code>: æŒ‡å®šæŸ¥æ‰¾è·¯å¾„ï¼Œå…¶ä¸­ <code>HINTS</code> ä¼˜å…ˆçº§é«˜äº <code>PATHS</code>ã€‚</li><li><code>&lt;package&gt;_ROOT</code> å˜é‡æˆ–ç¯å¢ƒå˜é‡å¦‚æœè®¾ç½®ï¼Œä¼šä¼˜å…ˆä½¿ç”¨ã€‚</li></ul><blockquote><p>å…·ä½“æŸ¥æ‰¾é¡ºåºå‚è€ƒ <a href="https://cmake.org/cmake/help/latest/command/find_package.html#find-package">CMake å®˜æ–¹æ–‡æ¡£</a> ğŸ’©</p></blockquote><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(Boost) <span class="comment"># find boost library</span></span><br><span class="line"><span class="keyword">if</span>(Boost_FOUND)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;Boost found&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">  <span class="keyword">message</span>(FATAL_ERROR <span class="string">&quot;Boost not found&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_package</span>(OpenCV CONFIG REQUIRED) <span class="comment"># find opencv library</span></span><br><span class="line"><span class="keyword">find_package</span>(OpenGL REQUIRED HINTS /usr/lib) <span class="comment"># find opengl library</span></span><br></pre></td></tr></table></figure><h3 id="ctest">ctest</h3><p>ctest æ˜¯ CMake çš„æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥ç”¨äºè¿è¡Œæµ‹è¯•ã€‚å¯ä»¥é€šè¿‡ <code>add_test</code> æŒ‡ä»¤æ·»åŠ å¯¹åº”çš„æµ‹è¯•ã€‚ç­¾åå¦‚ä¸‹: <code>add_test(NAME &lt;test_name&gt; COMMAND &lt;executable&gt; [arg1 [arg2 ...]])</code></p><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enable_testing</span>() <span class="comment"># enable testing</span></span><br><span class="line"><span class="keyword">add_executable</span>(<span class="keyword">test</span> <span class="keyword">test</span>.cpp) <span class="comment"># add test target</span></span><br><span class="line"><span class="keyword">add_test</span>(NAME example-<span class="keyword">test</span> <span class="keyword">COMMAND</span> <span class="keyword">test</span> config.yaml &gt; <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/<span class="keyword">test</span>.log) <span class="comment"># add test</span></span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨å˜é‡">å¸¸ç”¨å˜é‡</h3><ul><li>CMAKE_SOURCE_DIR: é¡¹ç›®æ ¹ç›®å½•</li><li>CMAKE_BINARY_DIR: é¡¹ç›®æ„å»ºç›®å½•</li><li>CMAKE_CURRENT_SOURCE_DIR: å½“å‰å¤„ç†çš„ CMakeLists.txt æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</li><li>CMAKE_PREFIX_PATH: æŸ¥æ‰¾åº“çš„è·¯å¾„</li><li>CMAKE_MODULE_PATH: æŸ¥æ‰¾æ¨¡å—çš„è·¯å¾„</li><li>CMAKE_INCLUDE_PATH: æŸ¥æ‰¾å¤´æ–‡ä»¶çš„è·¯å¾„</li><li>CMAKE_LIBRARY_PATH: æŸ¥æ‰¾åº“æ–‡ä»¶çš„è·¯å¾„</li><li>CMAKE_INSTALL_PREFIX: å®‰è£…ç›®å½•</li><li>CMAKE_BUILD_TYPE: æ„å»ºç±»å‹ï¼Œå¦‚ Debugã€Releaseã€RelWithDebInfoã€MinSizeRel</li><li>CMAKE_C_COMPILER: C ç¼–è¯‘å™¨</li><li>CMAKE_CXX_COMPILER: C++ ç¼–è¯‘å™¨</li><li>CMAKE_C_FLAGS: C ç¼–è¯‘é€‰é¡¹</li><li>CMAKE_CXX_FLAGS: C++ ç¼–è¯‘é€‰é¡¹</li><li>CMAKE_EXE_LINKER_FLAGS: å¯æ‰§è¡Œæ–‡ä»¶é“¾æ¥é€‰é¡¹</li><li>CMAKE_LINKER_FLAGS: é“¾æ¥é€‰é¡¹</li></ul><h3 id="CMake-Cli">CMake Cli</h3><p>è™½ç„¶ CMake æœ‰æä¾› GUI å·¥å…·ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿˜æ˜¯ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ã€‚CMake çš„å‘½ä»¤è¡Œå·¥å…·æ˜¯ cmakeï¼Œå¯ä»¥é€šè¿‡ cmake --help æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ã€‚</p><p>å¸¸ç”¨å‘½ä»¤è¡Œå‚æ•°ï¼š</p><ul><li><code>cmake -B&lt;build-dir&gt;</code>: æŒ‡å®šæ„å»ºç›®å½•</li><li><code>cmake &lt;source-dir&gt;</code>: æŒ‡å®šæºä»£ç ç›®å½•</li><li><code>cmake --build &lt;build-dir&gt;</code>: æ„å»ºé¡¹ç›®</li><li><code>cmake -D&lt;variable&gt;=&lt;value&gt;</code>: è®¾ç½®å˜é‡</li><li><code>ctest -C &lt;build-dir&gt;</code>: åœ¨æŒ‡å®šçš„æ„å»ºç›®å½•ä¸‹è¿è¡Œæµ‹è¯•</li></ul><h2 id="æ‹“å±•">æ‹“å±•</h2><ul><li><a href="https://www.foonathan.net/2016/03/cmake-install/">è®© CMake install æ”¯æŒ find_package</a></li><li><a href="https://github.com/microsoft/vcpkg">vcpkg</a></li><li><a href="https://cmake.org/cmake/help/latest/command/target_precompile_headers.html">precompiled headers</a></li></ul><h2 id="åºŸè¯">åºŸè¯</h2><p>ç”±äº CMake è¯­æ³•è¿‡äºå¤æ‚ï¼Œå®é™…ä½¿ç”¨æ—¶åº”å¤šå»å®˜ç½‘æŸ¥æ‰¾ç”¨æ³•ã€‚ç½‘å€è´´åˆ°<a href="https://cmake.org/documentation/">è¿™é‡Œ</a>ï¼Œä¸è¿‡å®˜ç½‘çš„æ–‡æ¡£æŸ¥æ‰¾æ•ˆç‡ä½ä¸‹ï¼Œä¸ªäººä¸€èˆ¬éƒ½æ˜¯æ‰¾å¤§å‹ cmake é¡¹ç›®ç›´æ¥æŠ„ CMakeLists.txt ï¼ˆ</p><p><img src="Image_1728729096791.jpg" alt="ğŸ˜†"></p><!--CMake è¯­æ³•æ˜¯ä¾æ‰˜ï¼Œå†å²é—ç•™å¤ªå¤š(æ”¯æŒ JAVA æ²¡çœ‹æ‡‚)ã€‚ä½†æ˜¯ç”±äºå…¶å­˜åœ¨å·²ä¹…ï¼Œå¤§é‡çš„å¼€æºåº“éƒ½ä½¿ç”¨ CMake ä½œä¸ºæ„å»ºå·¥å…·,åŠ ä¸Šç›®å‰æ¯”è¾ƒå¥½ç”¨çš„ C/C++ åŒ…ç®¡ç†åŒº `vcpkg` ä¹Ÿä½¿ç”¨ CMake ä½œä¸ºæ„å»ºå·¥å…·ï¼Œæ‰€ä»¥å­¦ä¹  CMake æ˜¯å¿…è¦çš„ã€‚-->]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ„å»ºç³»ç»Ÿå‘å±•å†å²&quot;&gt;æ„å»ºç³»ç»Ÿå‘å±•å†å²&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æ‰‹å·¥ç¼–è¯‘ (1950s - 1960s): ç¼–ç¨‹è¯­è¨€åˆšåˆšè¯ç”Ÿï¼Œç¨‹åºå‘˜éœ€è¦æ‰‹å·¥ç¼–è¯‘ç¨‹åºï¼Œå°†æºä»£ç è½¬æ¢ä¸ºæœºå™¨ç ã€‚&lt;/li&gt;
&lt;li&gt;æ‰¹å¤„ç†è„šæœ¬ (1960s - 1970s)ï¼š ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬æˆ– she</summary>
      
    
    
    
    <category term="Knowledge" scheme="http://blog.vollate.top/categories/Knowledge/"/>
    
    
    <category term="CMake" scheme="http://blog.vollate.top/tags/CMake/"/>
    
  </entry>
  
  <entry>
    <title>é…ç½®è‡ªå·±çš„é‚®ä»¶æœåŠ¡å™¨</title>
    <link href="http://blog.vollate.top/2024/09/26/deploy-self-mail-server/"/>
    <id>http://blog.vollate.top/2024/09/26/deploy-self-mail-server/</id>
    <published>2024-09-26T04:57:57.000Z</published>
    <updated>2024-09-26T04:58:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰äº‹éœ€è¦æ”¶å‘é‚®ä»¶ï¼Œä½†æ˜¯ä¸æƒ³ç”¨è‡ªå·±çš„ç§äººé‚®ç®±ã€‚æ­£å¥½<s>æ‰‹ä¸Šæœ‰ä¸ªåŸŸåï¼Œå°±æƒ³ç€è‡ªå·±æ­å»ºä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨</s>é—²å¾—æ…Œï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹æ­å»ºè¿‡ç¨‹ã€‚</p><p>é€‰ç”¨çš„é‚®ä»¶æœåŠ¡å™¨æ˜¯ <a href="https://docker-mailserver.github.io/docker-mailserver/latest/">docker-mailserver</a>ï¼Œå¯ä»¥æ–¹ä¾¿çš„åœ¨å®¹å™¨å†…éƒ¨ç½²ï¼Œé…ç½®ä¹Ÿç›¸å¯¹ç®€ä¾¿ï¼Œæ›´æ”¹ <code>docker-compose.yml</code> æ–‡ä»¶å³å¯ã€‚</p><h2 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h2><h3 id="æœåŠ¡å™¨">æœåŠ¡å™¨</h3><p>é¦–å…ˆéœ€è¦ä¸€å°æœåŠ¡å™¨ï¼Œç„¶åè£…å¥½ docker å’Œ docker-composeï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ Debian 12ï¼Œå®‰è£…è¿‡ç¨‹ä¸å†èµ˜è¿°ã€‚</p><h3 id="åŸŸåè§£æ">åŸŸåè§£æ</h3><p>åœ¨ä½ çš„ DNS æœåŠ¡å•†å¤„æ·»åŠ  MX è®°å½•ï¼ŒæŒ‡å‘ä½ çš„æœåŠ¡å™¨åœ°å€ã€‚æˆ‘ä½¿ç”¨ Cloudflare æ‰˜ç®¡ï¼Œæ·»åŠ çš„ MX è®°å½•å¦‚ä¸‹ï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Type: MX</span><br><span class="line">Name: @ // ä»£è¡¨æ ¹åŸŸå</span><br><span class="line">Content: mail.example.com // ä½ çš„é‚®ä»¶æœåŠ¡å™¨åœ°å€ï¼Œè¿™é‡Œä½¿ç”¨ mail.example.com ä½œä¸ºç¤ºä¾‹ï¼Œä½ å¯ä»¥ä½¿ç”¨è‡ªå·±çš„äºŒçº§åŸŸå</span><br><span class="line">Priority: 10 // ä¼˜å…ˆçº§ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨ï¼Œå¯ä»¥éšæ„è®¾ç½®</span><br><span class="line">Proxied: DNS only</span><br><span class="line">TTL: Auto</span><br></pre></td></tr></table></figure><p>å®Œæˆåç”¨ <code>dig</code> å‘½ä»¤æ£€æŸ¥ MX è®°å½•æ˜¯å¦ç”Ÿæ•ˆï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dig MX example.com</span><br></pre></td></tr></table></figure><h3 id="é…ç½®-SSL-è¯ä¹¦">é…ç½® SSL è¯ä¹¦</h3><p>docker-mailserver é»˜è®¤ä½¿ç”¨ Letâ€™s Encrypt è¯ä¹¦ï¼Œæ‰€ä»¥éœ€è¦é…ç½®å¥½åŸŸåè§£æï¼Œç¡®ä¿èƒ½å¤Ÿè®¿é—®åˆ°ä½ çš„æœåŠ¡å™¨ã€‚å¦‚æœä½ æ²¡æœ‰åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä»»ä½•ç½‘å€(80ç«¯å£æœªå ç”¨) Letâ€™s Encrypt ä¼šè‡ªåŠ¨éªŒè¯åŸŸåï¼Œç”Ÿæˆè¯ä¹¦ã€‚</p><p>åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ <code>certbot</code> å·¥å…·ç”Ÿæˆè¯ä¹¦ï¼Œä½ å¯ä»¥æŸ¥çœ‹<a href="https://certbot.eff.org/instructions">è¿™ä¸ªç½‘ç«™</a>æ¥è·å¾—åœ¨ä½  WebServer å’Œå‘è¡Œç‰ˆä¸Šçš„æœ€ä½³å®ç°ã€‚æˆ‘çš„æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯ Nginxã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install certbot</span><br><span class="line"><span class="built_in">sudo</span> apt install </span><br><span class="line"><span class="built_in">sudo</span> certbot certonly --standalone -d mail.example.com -d example.com</span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²-docker-mailserver">éƒ¨ç½² docker-mailserver</h3><ul><li>é¦–å…ˆåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç”¨äºå­˜æ”¾ docker-compose.yml æ–‡ä»¶å’Œå…¶ä»–é…ç½®æ–‡ä»¶ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> mailserver</span><br><span class="line"><span class="built_in">cd</span> mailserver</span><br></pre></td></tr></table></figure><ul><li>ç„¶åå°† docker-compose.yml æ–‡ä»¶ä¸‹è½½åˆ°å½“å‰ç›®å½•ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/docker-mailserver/docker-mailserver/master/docker-compose.yml</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä½ çš„éœ€æ±‚ä¿®æ”¹ <code>docker-compose.yml</code> æ–‡ä»¶ï¼Œæˆ‘ä¿®æ”¹åçš„æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mailserver:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.io/mailserver/docker-mailserver:latest</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">mail.example.com</span></span><br><span class="line">    <span class="attr">domainname:</span> <span class="string">example.com</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mailserver</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;25:25&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;143:143&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;465:465&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;587:587&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;993:993&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./docker-data/dms/mail-data/:/var/mail/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./docker-data/dms/mail-state/:/var/mail-state/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./docker-data/dms/mail-logs/:/var/log/mail/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./docker-data/dms/config/:/tmp/docker-mailserver/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/letsencrypt:/etc/letsencrypt</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ENABLE_SPAMASSASSIN=1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ENABLE_FAIL2BAN=1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ENABLE_OPENDKIM=1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ENABLE_OPENDMARC=1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">POSTFIX_MESSAGE_SIZE_LIMIT=102400000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DMS_DEBUG=0</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SSL_TYPE=letsencrypt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SSL_DOMAIN=example.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">LETSENCRYPT_EMAIL=admin@example.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SSL_LTS=1</span>                     </span><br><span class="line">    <span class="attr">cap_add:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NET_ADMIN</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">maildata:</span></span><br><span class="line">  <span class="attr">mailstate:</span></span><br><span class="line">  <span class="attr">maillogs:</span></span><br></pre></td></tr></table></figure><p>å®Œæˆåï¼Œè¿è¡Œ <code>docker-compose up -d</code> å¯åŠ¨å®¹å™¨ã€‚ç¬¬ä¸€æ¬¡å¯åŠ¨åï¼Œè¦åœ¨120ç§’å†…åˆ›å»ºç¬¬ä¸€ä¸ªç”¨æˆ·ï¼Œå¦åˆ™å®¹å™¨ä¼šè‡ªåŠ¨å…³é—­ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mailserver setup email add xxx@example.com password</span><br></pre></td></tr></table></figure><h3 id="å¼€æ”¾ç«¯å£">å¼€æ”¾ç«¯å£</h3><p>åœ¨æœåŠ¡å™¨ä¸Šå¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š</p><ul><li>25: SMTP</li><li>143: IMAP</li><li>465: SMTPS</li><li>587: Submission</li><li>993: IMAPS</li></ul><p>æˆ‘çš„æœåŠ¡å™¨ä½¿ç”¨ iptables é˜²ç«å¢™ï¼Œå¼€æ”¾ç«¯å£çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 25 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 143 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 465 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 587 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 993 -j ACCEPT</span><br></pre></td></tr></table></figure><p>è¦æŒä¹…åŒ–è¿™äº›è§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨ <code>netfilter-persistent</code> å·¥å…·ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install iptables-persistent</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ <code>sudo netfilter-persistent save</code> ä¿å­˜è§„åˆ™ã€‚</p><h2 id="è¿›é˜¶é…ç½®">è¿›é˜¶é…ç½®</h2><p>åˆšåˆšé…å¥½çš„é‚®ä»¶æœåŠ¡å™¨ç»™ gmail å‘é‚®ä»¶æ—¶ï¼Œä¼šè¢«æ ‡è®°ä¸ºåƒåœ¾é‚®ä»¶ï¼Œè¿™æ˜¯å› ä¸ºç¼ºå°‘ SPFã€DKIM å’Œ DMARC è®°å½•ã€‚æˆ‘ä»¬éœ€è¦é…ç½®è¿™äº›è®°å½•ã€‚</p><h3 id="SPF">SPF</h3><p>SPF æ˜¯ä¸€ç§ç”¨äºé˜²èŒƒä¼ªé€ é‚®ä»¶çš„æŠ€æœ¯ï¼Œé€šè¿‡åœ¨ DNS ä¸­æ·»åŠ  SPF è®°å½•ï¼Œå¯ä»¥æŒ‡å®šå“ªäº› IP åœ°å€å¯ä»¥å‘é€é‚®ä»¶ã€‚ç”±äºæˆ‘ä»¬çš„é‚®ä»¶æœåŠ¡å™¨åªæœ‰ä¸€å°ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æŒ‡å®šæœåŠ¡å™¨çš„ IP åœ°å€ã€‚åœ¨ Cloudflare ä¸­æ·»åŠ  TXT è®°å½•ï¼š</p><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Type: TXT</span><br><span class="line">Name: @</span><br><span class="line">Content: v=spf1 mx -all</span><br><span class="line">TTL: Auto</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><ul><li><code>v=spf1</code>ï¼šSPF ç‰ˆæœ¬</li><li><code>mx</code>ï¼šå…è®¸ MX è®°å½•æŒ‡å®šçš„æœåŠ¡å™¨å‘é€é‚®ä»¶</li><li><code>-all</code>ï¼šæ‹’ç»æ‰€æœ‰å…¶ä»–æœåŠ¡å™¨å‘é€é‚®ä»¶</li></ul><h3 id="DKIM">DKIM</h3><p>DomainKeys Identified Mail (DKIM) æ˜¯ä¸€ç§ç”¨äºéªŒè¯é‚®ä»¶æ¥æºçš„æŠ€æœ¯ï¼Œé€šè¿‡åœ¨ DNS ä¸­æ·»åŠ  DKIM è®°å½•ï¼Œå¯ä»¥éªŒè¯é‚®ä»¶çš„çœŸå®æ€§ã€‚docker-mailserver å·²ç»ä¸ºæˆ‘ä»¬å†…ç½®å¹¶è‡ªåŠ¨å¼€å¯äº† OpenDKIMï¼Œæˆ‘ä»¬åªéœ€è¦ç”Ÿæˆ DKIM å¯†é’¥å¹¶æå–å…¬é’¥æ·»åŠ åˆ° DNS ä¸­ã€‚<a href="https://docker-mailserver.github.io/docker-mailserver/latest/config/best-practices/dkim_dmarc_spf/#dkim">å®˜æ–¹æ–‡æ¡£</a>ä¸­æœ‰è¯¦ç»†çš„æ­¥éª¤ã€‚</p><p>ç”±äºæˆ‘ä»¬éœ€è¦æŒ‡å®šç‰¹å®šå­åŸŸåï¼Œæ‰€ä»¥éœ€è¦åœ¨ä¾ç…§æ–‡æ¡£ä¸­ <code>You may need to specify mail domains explicitly</code> éƒ¨åˆ†çš„æ­¥éª¤ä¸­æ·»åŠ  <code>-d mail.example.com</code> å‚æ•°ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mailserver /bin/bash</span><br><span class="line">setup config dkim domain <span class="string">&#x27;mail.example.com&#x27;</span></span><br><span class="line">setup config dkim domain mail.example.com</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåœ¨åˆšåˆšæ‰“å¼€çš„ shell ä¸­æŸ¥çœ‹å…¬é’¥ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /tmp/docker-mailserver/opendkim/keys/mail.example.com/mail.txt</span><br></pre></td></tr></table></figure><p>å°†è¾“å‡ºçš„å†…å®¹æ·»åŠ åˆ° DNS ä¸­ï¼Œå…·ä½“å‚è€ƒ<a href="https://docker-mailserver.github.io/docker-mailserver/latest/config/best-practices/dkim_dmarc_spf/#dkim-dns">è¿™å—</a>ï¼š</p><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Type: TXT</span><br><span class="line">Name: mail._domainkey</span><br><span class="line">Content: v=DKIM1; k=rsa; p=xxxxxx</span><br><span class="line">TTL: Auto</span><br></pre></td></tr></table></figure><h3 id="DMARC">DMARC</h3><p>Domain-based Message Authentication, Reporting and Conformance (DMARC) æ˜¯ä¸€ç§ç”¨äºéªŒè¯é‚®ä»¶æ¥æºçš„æŠ€æœ¯ï¼Œé€šè¿‡åœ¨ DNS ä¸­æ·»åŠ  DMARC è®°å½•ï¼Œå¯ä»¥æŒ‡å®šé‚®ä»¶çš„å¤„ç†æ–¹å¼ã€‚docker-mailserver å·²ç»ä¸ºæˆ‘ä»¬å†…ç½®å¹¶è‡ªåŠ¨å¼€å¯äº† OpenDMARCï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ  DMARC è®°å½•ã€‚åœ¨ Cloudflare ä¸­æ·»åŠ  TXT è®°å½•ï¼š</p><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Type: TXT</span><br><span class="line">Name: _dmarc</span><br><span class="line">Content: v=DMARC1; p=none; rua=mailto:admin@example.com</span><br><span class="line">TTL: Auto</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><ul><li><code>v=DMARC1</code>ï¼šDMARC ç‰ˆæœ¬</li><li><code>p=none</code>ï¼šæŒ‡å®šé‚®ä»¶çš„å¤„ç†æ–¹å¼ï¼Œ<code>none</code> è¡¨ç¤ºä¸åšä»»ä½•å¤„ç†</li><li><code>rua=mailto:</code>ï¼šæŒ‡å®šæŠ¥å‘Šçš„æ¥æ”¶é‚®ç®±</li><li><code>ruf=mailto:</code>ï¼šæŒ‡å®šå¤±è´¥æŠ¥å‘Šçš„æ¥æ”¶é‚®ç®±</li><li><code>sp=none</code>ï¼šæŒ‡å®šå­åŸŸåçš„å¤„ç†æ–¹å¼</li><li><code>adkim=s</code>ï¼šæŒ‡å®š DKIM çš„éªŒè¯æ–¹å¼</li><li><code>aspf=r</code>ï¼šæŒ‡å®š SPF çš„éªŒè¯æ–¹å¼</li><li><code>pct=100</code>ï¼šæŒ‡å®šæŠ¥å‘Šçš„ç™¾åˆ†æ¯”</li><li><code>rf=afrf</code>ï¼šæŒ‡å®šæŠ¥å‘Šçš„æ ¼å¼</li></ul><h3 id="rDNS">rDNS</h3><p>åå‘ DNS (rDNS) æ˜¯ä¸€ç§ç”¨äºéªŒè¯ IP åœ°å€çš„æŠ€æœ¯ï¼Œé€šè¿‡åœ¨ DNS ä¸­æ·»åŠ  PTR è®°å½•ï¼Œå¯ä»¥éªŒè¯ IP åœ°å€çš„çœŸå®æ€§ã€‚è¿™éœ€è¦è”ç³»æœåŠ¡å™¨æä¾›å•†æ¥é…ç½®ã€‚</p><h2 id="éªŒè¯é‚®ä»¶æœåŠ¡å™¨æ­£å¸¸å·¥ä½œ">éªŒè¯é‚®ä»¶æœåŠ¡å™¨æ­£å¸¸å·¥ä½œ</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://dkimvalidator.com/">dkimvalidator.com</a> æ¥éªŒè¯ DKIM å’Œ DMARC è®°å½•æ˜¯å¦ç”Ÿæ•ˆï¼Œä½¿ç”¨ <a href="https://www.mail-tester.com/">www.mail-tester.com</a> æ¥éªŒè¯é‚®ä»¶æ˜¯å¦è¢«æ ‡è®°ä¸ºåƒåœ¾é‚®ä»¶ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ€è¿‘æœ‰äº‹éœ€è¦æ”¶å‘é‚®ä»¶ï¼Œä½†æ˜¯ä¸æƒ³ç”¨è‡ªå·±çš„ç§äººé‚®ç®±ã€‚æ­£å¥½&lt;s&gt;æ‰‹ä¸Šæœ‰ä¸ªåŸŸåï¼Œå°±æƒ³ç€è‡ªå·±æ­å»ºä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨&lt;/s&gt;é—²å¾—æ…Œï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹æ­å»ºè¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;é€‰ç”¨çš„é‚®ä»¶æœåŠ¡å™¨æ˜¯ &lt;a href=&quot;https://docker-mailserver.github.io/docke</summary>
      
    
    
    
    <category term="Journal" scheme="http://blog.vollate.top/categories/Journal/"/>
    
    
    <category term="Server" scheme="http://blog.vollate.top/tags/Server/"/>
    
    <category term="Emali" scheme="http://blog.vollate.top/tags/Emali/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ pass ç®¡ç†å¯†ç </title>
    <link href="http://blog.vollate.top/2024/08/10/pass-sync/"/>
    <id>http://blog.vollate.top/2024/08/10/pass-sync/</id>
    <published>2024-08-10T11:48:05.000Z</published>
    <updated>2024-08-12T02:15:07.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.passwordstore.org/">zx2c4 pass</a> æ˜¯ä¸€ä¸ª unix ä¸‹çš„å¯†ç ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨ gpg åŠ å¯†å¯†ç ï¼Œé…åˆ git å¯ä»¥æ–¹ä¾¿çš„å®ç°å¯†ç åŒæ­¥ï¼Œæ¥å½»åº•æ‘†è„± browser å’Œå…¶ä»–å„å¼å„æ ·éè‡ªç”±å¯†ç ç®¡ç†å·¥å…·ã€‚<br>ä¸‹é¢ä»‹ç» pass çš„é…ç½®ï¼Œå¯†ç è¿ç§»ï¼Œä»¥åŠå„ä¸ªå®¢æˆ·ç«¯çš„ä½¿ç”¨æ–¹æ³•ã€‚</p><h2 id="é…ç½®">é…ç½®</h2><h3 id="å®‰è£…-pass">å®‰è£… pass</h3><p>UNIX like ç³»ç»Ÿç›´æ¥ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…å³å¯ï¼Œæˆ‘çš„ç³»ç»Ÿæ˜¯ Arch, ä½¿ç”¨ pacman å®‰è£…:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å·²æœ‰ gpg å’Œ git çš„å¿½ç•¥è¿™æ­¥</span></span><br><span class="line"><span class="built_in">sudo</span> pacman -S gnupg git</span><br><span class="line"></span><br><span class="line"><span class="comment"># pass æœ¬ä½“ä¸º cli å·¥å…·ï¼Œå¯ä»¥é…åˆ qtpass æ¥ä½¿ç”¨</span></span><br><span class="line"><span class="built_in">sudo</span> pacman -S pass qtpass</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯windowsï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹å‡ ä¸ªå¹³æ›¿:</p><ul><li><a href="https://github.com/timvisee/prs">prs</a>: rust å®ç°çš„ passï¼Œä½†ä¸æ”¯æŒ extension</li><li><a href="https://github.com/geluk/pass-winmenu">pass-winmenu</a>: å¯ä»¥å®ç° pass çš„åŸºæœ¬åŠŸèƒ½ï¼Œä½†ä¸º GUI åº”ç”¨</li><li><a href="https://github.com/bfrascher/passpy">passpy</a>: python å®ç°çš„ passï¼ŒåŠŸèƒ½è¡¥å…¨ä¸”å¹´ä¹…å¤±ä¿®</li><li><a href="https://github.com/mbos/Pass4Win">pass4win</a>: å¹´ä¹…å¤±ä¿®ä¸”å·²ç» archiving ï¼Œä¸å»ºè®®ä½¿ç”¨</li></ul><h3 id="åˆå§‹åŒ–-pass">åˆå§‹åŒ– pass</h3><p>åœ¨ä½¿ç”¨ pass ä¹‹å‰ï¼Œå…ˆç”Ÿæˆ gpg å¯†é’¥å¯¹ã€‚å·²æœ‰ gpg å¯†é’¥å¯¹å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gpg --full-generate-key <span class="comment"># ç„¶åæ ¹æ®æç¤ºè¾“å…¥å¯¹åº”ä¿¡æ¯å’Œä½ è¦è®¾ç½®çš„å¯†ç </span></span><br><span class="line"></span><br><span class="line">gpg --list-secret-keys --keyid-format LONG </span><br><span class="line"><span class="comment"># åˆ—å‡ºå¯†é’¥çš„ gpg-id, å¤§æ¦‚çš„è¾“å‡ºé•¿è¿™æ ·:</span></span><br><span class="line"><span class="comment"># /home/foo/.gnupg/pubring.kbx</span></span><br><span class="line"><span class="comment"># ----------------------------------</span></span><br><span class="line"><span class="comment"># sec   ed25519/xxx 20xx-xx-xx [SC] [expires: 20xx-xx-xx]</span></span><br><span class="line"><span class="comment">#       &lt;gpg-id&gt;</span></span><br><span class="line"><span class="comment"># uid                 [ unknown] vollate &lt;uint44t@gmail.com&gt;</span></span><br><span class="line"><span class="comment"># ssb   cv25519/xxxxxxxxxxxxxxxx 20xx-xx-xx [E] [expires: 20xx-xx-xx]</span></span><br><span class="line"></span><br><span class="line">pass init &lt;gpg-id&gt; <span class="comment"># ä½¿ç”¨ gpg-id åˆå§‹åŒ– pass</span></span><br></pre></td></tr></table></figure><p>ç»è¿‡åˆå§‹åŒ–ï¼Œä¼šç”Ÿæˆ <code>~/.password-store</code> ç›®å½•ã€‚ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª <code>.gpg-id</code> æ–‡ä»¶ï¼Œå­˜æ”¾äº†ç”¨æ¥åŠ å¯†å¯†ç çš„ gpg key çš„ idã€‚</p><p>å¦‚æœä½ æƒ³è¦å¯¼å…¥æˆ–å¯¼å‡º gpg key,ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># export</span></span><br><span class="line">gpg --export-secret-keys -a &lt;gpg-id&gt; &gt; private.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># import</span></span><br><span class="line">gpg --import private.key</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä½¿ç”¨ <code>--export-secret-keys</code> å¯¼å‡ºç§é’¥ï¼Œå¦åˆ™è¡Œä¸ºä¸ºå¯¼å‡ºå…¬é’¥ã€‚</p><h3 id="åŒæ­¥å¯†ç ">åŒæ­¥å¯†ç </h3><p>ä½¿ç”¨ git æ¥åŒæ­¥å¯†ç ï¼Œè¿™é‡Œä½¿ç”¨ github ä½œä¸ºè¿œç¨‹ä»“åº“ã€‚æ¨èä½¿ç”¨ ssh-key è¿›è¡Œè®¤è¯ï¼Œå› ä¸ºgithubå¾ˆæ—©å°±åœæ­¢äº†ä½¿ç”¨å¯†ç è®¤è¯ã€‚</p><p>é¦–å…ˆåˆ›å»ºä½ çš„ private repoï¼Œä¸ç”¨æ·»åŠ  gitignore æˆ– readmeï¼Œç„¶ååˆå§‹åŒ–ä½ çš„ .password-store å¹¶ ref åˆ°è¿œç¨‹ä»“åº“ã€‚<s>æˆ–è€…ä½ å¯ä»¥è·Ÿæˆ‘ä¸€æ ·å·æ‡’ clone ä¸‹æ¥ç„¶å æŠŠ .git æ‰”è¿› .password-store é‡Œã€‚</s> ä¹‹åå°±å¯ä»¥ä½¿ç”¨git æ¥ç®¡ç†å¯†ç äº†ã€‚</p><h2 id="ä»æµè§ˆå™¨è¿ç§»">ä»æµè§ˆå™¨è¿ç§»</h2><p>firefox,chrome,edgeéƒ½æ”¯æŒå¯¼å‡ºå¯†ç ä¸º csv æ–‡ä»¶ï¼Œé¦–å…ˆå¯¼å‡ºå¯†ç åˆ° csv æ–‡ä»¶ï¼Œç„¶åå®‰è£… <a href="https://github.com/roddhjav/pass-import">pass-import</a>ã€‚ ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯¼å…¥å¯†ç :</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pass import &lt;csv-file&gt;</span><br></pre></td></tr></table></figure><p>æ›´å¤šç”¨æ³•è§ <a href="https://github.com/roddhjav/pass-import?tab=readme-ov-file#usage">useage</a></p><p>å¯¼å‡ºå®Œåè®°å¾—æ¸…ç©ºæµè§ˆå™¨ä¿å­˜çš„å¯†ç ã€‚å¦‚æœå¼€å¯äº†äº‘åŒæ­¥ï¼Œéœ€è¦åœ¨ history ä¸­åˆ é™¤å¯†ç ååŒæ­¥åˆ°äº‘ç«¯ã€‚</p><ul><li>Chome ç›´æ¥å†å²è®°å½•æ¸…é™¤å¯†ç åä¼šè‡ªåŠ¨åŒæ­¥</li><li>Edge éœ€è¦åœ¨å†å²è®°å½•ä¸­åˆ é™¤å¯†ç åæ‰‹åŠ¨å¼ºåˆ¶åŒæ­¥<img src="fucking-mc.png" alt="fucking microsoft"></li><li>firefox åœ¨ password manager å³ä¸Šè§’å¯ä»¥ç›´æ¥åˆ é™¤æ‰€æœ‰å¯†ç ã€‚</li></ul><h2 id="å®¢æˆ·ç«¯">å®¢æˆ·ç«¯</h2><p>ä¸‹é¢æ¨èå‡ ä¸ªä¸ªäººä½¿ç”¨çš„å®¢æˆ·ç«¯:</p><ul><li><a href="https://qtpass.org/">qtpass</a>: pass çš„ qt å®¢æˆ·ç«¯ï¼Œæ”¯æŒå›¾å½¢åŒ–æ“ä½œå’Œä¸€å®š extension</li><li><a href="https://codeberg.org/PassFF/passff">passff</a>: firefox æ’ä»¶ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ pass æ¥å¡«å……å¯†ç ï¼ŒåŸºæœ¬å¯ä»¥åšåˆ°å®Œå…¨æ›¿ä»£æµè§ˆå™¨è‡ªå¸¦çš„å¯†ç ç®¡ç†å™¨(ä½†æ˜¯ windows ä¸Šæ”¯æŒç¨€çƒ‚)</li><li><a href="https://github.com/android-password-store/Android-Password-Store">Android-Password-Store</a>: Android å®¢æˆ·ç«¯ï¼Œæ”¯æŒåŠ å¯†è§£å¯†å’Œ git åŒæ­¥ï¼Œä½†æ˜¯è‡ªåŠ¨å¡«å……ç¨€çƒ‚</li></ul><blockquote><p>ç›®å‰ windows ä¸Šçš„ passff æœ‰ä¸€äº›é—®é¢˜ï¼Œæš‚æ—¶æ²¡æ‰¾åˆ°å¥½çš„è§£å†³æ–¹æ¡ˆ<s>ä¸ç”¨winå°±è¡Œäº†</s></p></blockquote><h2 id="æ‰©å±•">æ‰©å±•</h2><p>pass æ”¯æŒ extensionï¼Œå…·ä½“å‚è€ƒ<a href="https://github.com/tijn/awesome-password-store">è¿™ä¸ªåˆé›†</a>ï¼Œæ‰¾è‡ªå·±éœ€è¦çš„ç”¨ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://www.passwordstore.org/&quot;&gt;zx2c4 pass&lt;/a&gt; æ˜¯ä¸€ä¸ª unix ä¸‹çš„å¯†ç ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨ gpg åŠ å¯†å¯†ç ï¼Œé…åˆ git å¯ä»¥æ–¹ä¾¿çš„å®ç°å¯†ç åŒæ­¥ï¼Œæ¥å½»åº•æ‘†è„± browser å’Œå…¶ä»–å„å¼å„æ ·éè‡ªç”±å¯†ç ç®¡ç†å·¥å…·ã€‚&lt;</summary>
      
    
    
    
    <category term="Journal" scheme="http://blog.vollate.top/categories/Journal/"/>
    
    
    <category term="Password" scheme="http://blog.vollate.top/tags/Password/"/>
    
  </entry>
  
  <entry>
    <title>Google GN CheatSheet</title>
    <link href="http://blog.vollate.top/2024/07/14/google-gn/"/>
    <id>http://blog.vollate.top/2024/07/14/google-gn/</id>
    <published>2024-07-14T06:44:21.000Z</published>
    <updated>2024-07-14T14:37:05.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŸºç¡€è¯­æ³•">åŸºç¡€è¯­æ³•</h2><ol><li><p>ç›®æ ‡(Target)</p><ul><li>executableï¼šå®šä¹‰ä¸€ä¸ªå¯æ‰§è¡Œç›®æ ‡</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">executable(&quot;my_app&quot;) &#123;</span><br><span class="line">    sources = [ &quot;main.cc&quot;  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>shared_libraryï¼šå®šä¹‰ä¸€ä¸ªå…±äº«åº“ç›®æ ‡</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">shared_library(&quot;my_shared_lib&quot;) &#123;</span><br><span class="line">    sources = [ &quot;shared_lib.cc&quot;  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>static_libraryï¼šå®šä¹‰ä¸€ä¸ªé™æ€åº“ç›®æ ‡</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">static_library(&quot;my_static_lib&quot;) &#123;</span><br><span class="line">    sources = [ &quot;static_lib.cc&quot;  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>source_setï¼šå®šä¹‰ä¸€ç»„æºæ–‡ä»¶ï¼Œé€šå¸¸ç”¨äºä¸­é—´æ„å»º</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">source_set(&quot;my_sources&quot;) &#123;</span><br><span class="line">    sources = [ &quot;file1.cc&quot;, &quot;file2.cc&quot;  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å˜é‡</p><ul><li>sourcesï¼šå®šä¹‰è¦åŒ…å«åœ¨ç›®æ ‡ä¸­çš„æºæ–‡ä»¶åˆ—è¡¨</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sources = [ &quot;main.cc&quot;, &quot;util.cc&quot;  ]</span><br></pre></td></tr></table></figure><ul><li>depsï¼šå®šä¹‰ç›®æ ‡çš„ä¾èµ–é¡¹åˆ—è¡¨</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deps = [ &quot;//:my_static_lib&quot;  ]</span><br></pre></td></tr></table></figure><ul><li>public_depsï¼šç±»ä¼¼äº depsï¼Œä½†ä¼šå°†ä¾èµ–é¡¹å…¬å¼€ç»™ä¾èµ–æ­¤ç›®æ ‡çš„å…¶ä»–ç›®æ ‡</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public_deps = [ &quot;//:my_shared_lib&quot;  ]</span><br></pre></td></tr></table></figure></li><li><p>å‡½æ•°</p><ul><li>importï¼šå¯¼å…¥å…¶ä»– GN æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œåªèƒ½åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ä½¿ç”¨ï¼Œç”¨äºé…ç½®å˜é‡å’Œé»˜è®¤å€¼</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import(&quot;//build/config.gni&quot;)</span><br></pre></td></tr></table></figure><ul><li>set_defaultsï¼šè®¾ç½®é»˜è®¤å€¼ï¼Œé€šå¸¸ç”¨äºè®¾ç½®å…¨å±€é…ç½®</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set_defaults(&quot;executable&quot;) &#123;</span><br><span class="line">  output_name = &quot;default_executable&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>templateï¼šå®šä¹‰æ¨¡æ¿ï¼Œä¾¿äºå¤ç”¨æ„å»ºè§„åˆ™(å°±æ˜¯æ¨¡æ¿å‡½æ•°)</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># definition</span><br><span class="line">template(&quot;foo&quot;) &#123;</span><br><span class="line">    assert(defined(invoker.var1), &quot;var1 must be defined&quot;)</span><br><span class="line">    print(invoker.var1)</span><br><span class="line">    print(invoker.var2)</span><br><span class="line">    # something</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># useage</span><br><span class="line">foo(&quot;useless&quot;)&#123;</span><br><span class="line">    var1 = &quot;foo&quot;</span><br><span class="line">    var2 = &quot;bar&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é…ç½®</p><ul><li>configï¼šå®šä¹‰ä¸€ç»„ç¼–è¯‘æˆ–é“¾æ¥é€‰é¡¹ï¼Œå¯ä»¥åœ¨å¤šä¸ªç›®æ ‡ä¸­å¤ç”¨</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">config(&quot;default_cflags&quot;) &#123;</span><br><span class="line">    cflags = [ &quot;-Wall&quot;, &quot;-Werror&quot; ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å·¥å…·é“¾</p><ul><li>toolchainï¼šå®šä¹‰ä¸€ä¸ªå·¥å…·é“¾ï¼Œç”¨äºæŒ‡å®šç¼–è¯‘å’Œé“¾æ¥çš„å·¥å…·åŠå…¶é€‰é¡¹</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">toolchain(&quot;my_toolchain&quot;) &#123;</span><br><span class="line">    tool(&quot;cc&quot;) &#123;</span><br><span class="line">        command = &quot;gcc&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    tool(&quot;cxx&quot;) &#123;</span><br><span class="line">        command = &quot;g++&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    tool(&quot;link&quot;) &#123;</span><br><span class="line">        command = &quot;g++&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è¿‡æ»¤å™¨(Filter)</p><ul><li>sources_assignment_filterï¼šç”¨äºè¿‡æ»¤ sources åˆ—è¡¨ä¸­çš„æ–‡ä»¶</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sources_assignment_filter = [ &quot;*.cc&quot;, &quot;*.h&quot;  ]</span><br></pre></td></tr></table></figure></li><li><p>åˆ†ç»„</p><ul><li>groupï¼šå®šä¹‰ä¸€ä¸ªæ„å»ºç›®æ ‡çš„åˆ†ç»„</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">group(&quot;all&quot;) &#123;</span><br><span class="line">      deps = [ &quot;:target1&quot;, &quot;:target2&quot;  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¤–éƒ¨è„šæœ¬æ‰§è¡Œ</p><ul><li>exec_scriptï¼šè¿è¡Œå¤–éƒ¨è„šæœ¬ï¼Œå¹¶å°†ç»“æœå¯¼å…¥ GN é…ç½®ä¸­</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">result = exec_script(&quot;find_sources.py&quot;, [], &quot;string_list&quot;)</span><br><span class="line">sources = result</span><br></pre></td></tr></table></figure></li><li><p>æ§åˆ¶æµ(control flow)</p><ul><li>ifï¼šæ¡ä»¶è¯­å¥ï¼Œç”¨äºåœ¨ GN æ–‡ä»¶ä¸­è¿›è¡Œæ¡ä»¶æ„å»º</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if (is_win) &#123;</span><br><span class="line">    # win config</span><br><span class="line">&#125; else if (is_linux)&#123;</span><br><span class="line">    # linux config</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    # other config</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>foreach:ç¼–è¯‘åˆ—è¡¨</li></ul> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var_list=[</span><br><span class="line">    &quot;a&quot;,</span><br><span class="line">    &quot;b&quot;,</span><br><span class="line">    &quot;c&quot;</span><br><span class="line">]</span><br><span class="line">foreach(var, var_list) &#123;</span><br><span class="line">    rubbish += var</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½œç”¨åŸŸ</p><ul><li>set_defaultsï¼šè®¾ç½®é»˜è®¤å€¼ï¼Œé€šå¸¸ç”¨äºè®¾ç½®å…¨å±€é…ç½®</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set_defaults(&quot;executable&quot;) &#123;</span><br><span class="line">    output_name = &quot;default_executable&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>scopeï¼šå®šä¹‰ä¸€ä¸ªä½œç”¨åŸŸï¼Œå¯ä»¥åœ¨ GN æ–‡ä»¶ä¸­ç»„ç»‡å’Œç®¡ç†å˜é‡å’Œç›®æ ‡</li></ul> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">scope(&quot;my_scope&quot;) &#123;</span><br><span class="line">    sources = [ &quot;file1.cc&quot;, &quot;file2.cc&quot;  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="ç”Ÿæˆè¿‡ç¨‹">ç”Ÿæˆè¿‡ç¨‹</h2><p>å’Œ CMake ç±»ä¼¼ï¼ŒGNä»æ ¹ç›®å½•çš„ <code>BUILD.gn</code> å¼€å§‹è§£æï¼Œé€šè¿‡ dependence ç¡®å®šä¾èµ–å­ç›®å½•ï¼Œç„¶ååœ¨å„ä¸ªä¾èµ–çš„å­ç›®å½•ä¸­å¯»æ‰¾ <code>BUILD.gn</code> æ¥æ„å»ºä¾èµ–ã€‚è§£ææ–‡ä»¶çš„éƒ¨åˆ†ä¾èµ–è„šæœ¬è¯­è¨€è€Œä¸æ˜¯ CMake é‚£æ ·å¯ä»¥ç›´æ¥è°ƒç”¨å†…ç½®å‡½æ•°ï¼Œæœ‰æ›´é«˜çš„çµæ´»æ€§ï¼Œä½†æ˜¯ä¹Ÿæ›´å¤æ‚ã€‚</p><h2 id="å¸¸ç”¨å‘½ä»¤-å‚æ•°">å¸¸ç”¨å‘½ä»¤/å‚æ•°</h2><ul><li><code>gn gen out/Default --args='...'</code>: åœ¨ out/Default ç›®å½•ç”Ÿæˆ ninja æ„å»ºæ–‡ä»¶</li><li><code>gn desc out/Default //some_path:target --$&#123;additional&#125;</code>: æ˜¾ç¤ºå½“å‰ç”Ÿæˆé¡¹ç›®ç›®å½•ä¸­æŸä¸ª target çš„è¯¦ç»†ä¿¡æ¯<ul><li><code>--tree</code>: æ˜¾ç¤ºç”Ÿæˆ target è¿‡ç¨‹æ‰€æœ‰ä¾èµ–è°ƒç”¨é¡ºåºå’Œå‚æ•°</li><li><code>--blame</code>: æ˜¾ç¤ºç”Ÿæˆ target è¿‡ç¨‹çš„ç¼–è¯‘å‚æ•°ä¸­æ¯ä¸ªå‚æ•°çš„æ¥æº</li></ul></li><li><code>gn check out/Default</code>: æ£€æŸ¥å½“å‰é¡¹ç›®çš„é…ç½®æ˜¯å¦æ­£ç¡®</li><li><code>gn format</code>: æ ¼å¼åŒ–æ‰€æœ‰ <a href="http://BUILD.gn">BUILD.gn</a> æ–‡ä»¶</li><li><code>gn gen --ide=$&#123;x&#125; out/Default</code> ç”Ÿæˆ IDE é¡¹ç›®æ–‡ä»¶<ul><li><code>--ide=json</code> ç”Ÿæˆ JSON æ ¼å¼çš„ IDE é¡¹ç›®æ–‡ä»¶,ç”¨äº clangd ç­‰</li><li><code>--ide=vs</code> ç”Ÿæˆ Visual Studio é¡¹ç›®æ–‡ä»¶(åªæ”¯æŒx64 win32 ä¸¤ç§target plateform)</li><li><code>--ide=xcode</code> ç”Ÿæˆ Xcode é¡¹ç›®æ–‡ä»¶</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;åŸºç¡€è¯­æ³•&quot;&gt;åŸºç¡€è¯­æ³•&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç›®æ ‡(Target)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;executableï¼šå®šä¹‰ä¸€ä¸ªå¯æ‰§è¡Œç›®æ ‡&lt;/li&gt;
&lt;/ul&gt;
 &lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>LLDB åœ¨ Docker ä¸­åŠŸèƒ½å¼‚å¸¸</title>
    <link href="http://blog.vollate.top/2024/06/26/docker-lldb-error/"/>
    <id>http://blog.vollate.top/2024/06/26/docker-lldb-error/</id>
    <published>2024-06-26T16:36:35.000Z</published>
    <updated>2024-07-01T15:22:47.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è®°-å¯„-å½•">è®°(å¯„)å½•</h2><p>å†™ 15445 çš„æ—¶å€™å‘ç° clang-14 ä»¥ä¸Šç¼–è¯‘ fmt ä¼šæŠ¥é”™ï¼ˆarch åŒ…å¤ªæ–°äº†å¯¼è‡´çš„ï¼‰ï¼Œå› æ­¤åœ¨ debian12 çš„ docker ä¸­æŒ‚è½½ host æ–‡ä»¶å¤¹å¼€å‘ã€‚ç”¨ lldb debug æ—¶åœ¨å‡ºç° exception æˆ– signalå lldb ä¼šæŠ¥é”™ <code>A packet returned an error 8</code> å¹¶é€€å‡ºè¿›ç¨‹ï¼Œå¯¼è‡´æ— æ³• backtraceï¼Œä½†æ˜¯ gdb æ²¡äº‹ã€‚<br>åŸå› æ˜¯å› ä¸º lldb debug ç”¨çš„ syscall ptrace åœ¨ docker ä¸­è¢«é™åˆ¶äº†ï¼Œè§£å†³æ–¹æ³•æ˜¯åœ¨ <code>docker run</code> æ—¶åŠ ä¸Š <code>--cap-add=SYS_PTRACE --security-opt seccomp=unconfined</code> å‚æ•°ã€‚<br><a href="https://stackoverflow.com/questions/69291157/lldb-producing-a-packet-returned-error-8-when-i-run-my-program">Problem on stack overflow</a></p><h2 id="Docker-å°çŸ¥è¯†">Docker å°çŸ¥è¯†</h2><ul><li>Linux capabilities: Docker å…³äº Linux capabilities çš„<a href="https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities">ç« èŠ‚</a>ã€‚è¿™ä¸ªæ˜¯ç”¨æ¥é™åˆ¶å®¹å™¨æƒé™çš„ï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤æƒ…å†µä¸‹ &quot;SYS_PTRACE Trace arbitrary processes using ptrace(2).&quot;æ˜¯è¢«ç¦ç”¨çš„ï¼Œç„¶å lldb å°±å¯„äº†ï¼ˆ</li><li>Secure computing mode(Seccomp): è¿™æ˜¯ Linux å†…æ ¸çš„ä¸€ä¸ª feature,ç”¨äºæ§åˆ¶è®¡ç®—æ—¶çš„è¡Œä¸ºå®‰å…¨ã€‚Docker é»˜è®¤çš„ profile ç¦ç”¨äº†å¤§çº¦ 44 ä¸ª syscall, ptrace ä½åˆ—å…¶ä¸­ã€‚é€šè¿‡ <code>--security-opt seccomp=unconfined</code> æ¥å…³é—­è¿™ä¸ª profileï¼ˆå›¾çœäº‹çš„ä¸å®‰å…¨åšæ³•ï¼‰ï¼Œæ­£ç¡®çš„æ˜¯æ”¹é»˜è®¤ profile æ¥è‡ªå®šä¹‰ä¸€ä¸ªprofileã€‚ç„¶è€Œæˆ‘æ‡’ï¼Œå°±è¿™æ ·äº†ã€‚</li></ul><h2 id="ptrace-æ€ä¹ˆä¸å®‰å…¨äº†">ptrace æ€ä¹ˆä¸å®‰å…¨äº†</h2><p><strong>Docker å®˜æ–¹æ–‡æ¡£</strong>:</p><ul><li>Blocked in Linux kernel versions before 4.8 to avoid seccomp bypass.</li><li>Tracing/profiling arbitrary processes is already blocked by dropping CAP_SYS_PTRACE, because it could leak a lot of information on the host.</li></ul><p>ä¸Š NVD æœäº†ä¸€åœˆï¼Œå¥½å¤šæ–‡æ¡£éƒ½å†™çš„ç¦æ­¢ä½¿ç”¨ ptrace, debugger å’Œ straceï¼ˆused to trace syscal)ï¼Œä½†æ˜¯æ²¡è¯´ä¸ºå•¥ã€‚cgroup å’Œ namespace ä¸æ˜¯å·²ç»éš”ç¦»äº†å—ï¼Œç­‰å“ªå¤©æœ‰ç©ºæŸ¥åˆ°å†ç ”ç©¶ä¸‹ã€‚</p><!--TODO--><h2 id="ä¸ºä»€ä¹ˆ-GDB-æ²¡äº‹">ä¸ºä»€ä¹ˆ GDB æ²¡äº‹</h2><p>TODO: æ‰¾äº†åŠå¤©èµ„æ–™æ²¡æ‰¾åˆ°ï¼Œgdb internals ååè¿™ä¸€ç« æ˜¯å’•å’•çš„ï¼Œå…ˆæ´—æ´—ç¡äº†ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;è®°-å¯„-å½•&quot;&gt;è®°(å¯„)å½•&lt;/h2&gt;
&lt;p&gt;å†™ 15445 çš„æ—¶å€™å‘ç° clang-14 ä»¥ä¸Šç¼–è¯‘ fmt ä¼šæŠ¥é”™ï¼ˆarch åŒ…å¤ªæ–°äº†å¯¼è‡´çš„ï¼‰ï¼Œå› æ­¤åœ¨ debian12 çš„ docker ä¸­æŒ‚è½½ host æ–‡ä»¶å¤¹å¼€å‘ã€‚ç”¨ lldb debug æ—¶åœ¨å‡ºç° except</summary>
      
    
    
    
    <category term="Journal" scheme="http://blog.vollate.top/categories/Journal/"/>
    
    
    <category term="Docker" scheme="http://blog.vollate.top/tags/Docker/"/>
    
    <category term="LLDB" scheme="http://blog.vollate.top/tags/LLDB/"/>
    
  </entry>
  
  <entry>
    <title>gRPC &amp; Protobuf å­¦ä¹ </title>
    <link href="http://blog.vollate.top/2024/05/10/protobuf-and-grpc/"/>
    <id>http://blog.vollate.top/2024/05/10/protobuf-and-grpc/</id>
    <published>2024-05-10T10:42:59.000Z</published>
    <updated>2024-06-14T15:23:41.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é˜…è¯»é¡»çŸ¥">é˜…è¯»é¡»çŸ¥</h2><p>æœ¬æ–‡ä»…ä¾›å­¦ä¹ å‚è€ƒï¼Œç¬”è€…çš„ protobuf ç‰ˆæœ¬ä¸º 3.21.12.0ï¼Œä¸ä¿è¯å…¶ä»–ç‰ˆæœ¬çš„å…¼å®¹æ€§ã€‚</p><h2 id="proto-file">proto file</h2><p><code>.proto</code> æ ¼å¼æ–‡ä»¶å¯ä»¥è¢« <a href="https://github.com/protocolbuffers/protobuf">protobuf(protocol buffer)</a> è§£æï¼Œç”¨äºå®šä¹‰æœåŠ¡å’Œæ¶ˆæ¯æ ¼å¼çš„è¯­è¨€ã€‚é€šè¿‡ <code>protobuf</code> çš„ <code>protoc</code> å¯ä»¥ç”Ÿæˆç¬¦åˆåŒä¸€é€šè®¯åè®®çš„å¯¹åº”çš„ä»£ç æ¡†æ¶ï¼Œä»¥æ­¤å®ç°è·¨è¯­è¨€ rpc é€šè®¯ã€‚</p><p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä¾‹å­</p><figure class="highlight proto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;<span class="comment">// proto file version</span></span><br><span class="line"><span class="keyword">package</span> package_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">// define the service</span></span><br><span class="line"><span class="keyword">service </span><span class="title class_">ChatService</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> PublishRoom(PublishRoomRequest) <span class="keyword">returns</span> (PublishRoomReply)</span>;</span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> GetRoomPeers(GetRoomPeersRequest) <span class="keyword">returns</span> (GetRoomPeersReply)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// define the status code(enum)</span></span><br><span class="line"><span class="keyword">enum </span><span class="title class_">StatusCode</span>&#123;</span><br><span class="line">    OK = <span class="number">0</span>;</span><br><span class="line">    ERROR = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// define the request and reply message</span></span><br><span class="line"><span class="keyword">message </span><span class="title class_">PublishRoomRequest</span> &#123;</span><br><span class="line">    <span class="type">string</span> name = <span class="number">1</span>;</span><br><span class="line">    <span class="type">string</span> password = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">oneof</span> contact &#123;<span class="comment">// like union in c/c++</span></span><br><span class="line">        <span class="type">string</span> email = <span class="number">3</span>;</span><br><span class="line">        <span class="type">string</span> phone = <span class="number">4</span>;</span><br><span class="line">        <span class="type">int64</span> id = <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">PublishRoomReply</span> &#123;</span><br><span class="line">    <span class="type">bool</span> success = <span class="number">1</span>;</span><br><span class="line">    <span class="type">string</span> message = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">GetRoomPeersRequest</span>&#123;</span><br><span class="line">    <span class="type">string</span> name = <span class="number">1</span>;</span><br><span class="line">    <span class="type">string</span> password = <span class="number">2</span>;</span><br><span class="line">    <span class="type">string</span> id   = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">GetRoomPeersReply</span>&#123;</span><br><span class="line">    <span class="type">bool</span> success = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">repeated</span> <span class="type">string</span> peers = <span class="number">2</span>;</span><br><span class="line">    <span class="type">string</span> message = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¤§æ¦‚çŸ¥é“äº†å¦‚ä½•ç¼–å†™ä¸€ä¸ª <code>.proto</code> æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†è®²è§£ç»†èŠ‚</p><h3 id="è¯­æ³•">è¯­æ³•</h3><p>é¦–å…ˆé™„ä¸Š<a href="https://protobuf.dev/programming-guides/"><strong>å®˜æ–¹æ–‡æ¡£</strong></a></p><p>proto file çš„è¯­æ³•åˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬ï¼Œåˆ†åˆ«æ˜¯ <code>proto2</code> å’Œ <code>proto3</code>ï¼Œä¸¤ä¸ªç‰ˆè¯­æ³•æœ¬éå¸¸ç›¸ä¼¼ï¼Œä½†<code>proto3</code> å–æ¶ˆäº† <code>require/optional</code> fieldï¼Œå› æ­¤ä¸å»ºè®®ç»™è‡ªå·±æ‰¾äº‹è·¨ç‰ˆæœ¬é€šè®¯ã€‚æœ¬æ–‡ä»…ä»‹ç» <code>proto3</code> çš„è¯­æ³•ã€‚</p><ul><li>åœ¨ <code>.proto</code> æ–‡ä»¶çš„å¼€å¤´ï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜ä½¿ç”¨çš„ç‰ˆæœ¬ <code>syntax = &quot;proto$&#123;x&#125;&quot;;</code>ï¼Œ<code>$&#123;x&#125;</code> ä¸ºç‰ˆæœ¬å·ï¼Œä¸€å®šè¦åœ¨å¼€å¤´å£°æ˜ï¼Œå¦åˆ™é»˜è®¤ä¼šä½¿ç”¨ <code>proto2</code> çš„è¯­æ³•ã€‚</li><li>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å£°æ˜åŒ…å <code>package package_name;</code>ï¼ŒåŒ…åç”¨äºåŒºåˆ†ä¸åŒçš„æœåŠ¡ï¼Œé¿å…å‘½åå†²çªï¼Œå®é™…ç¼–ç ä¸­ä¼šè½¬æ¢æˆå„ä¸ªè¯­è¨€çš„åŒ…åæˆ–åç§°ç©ºé—´ï¼Œå¦‚ C++ ä¼šè½¬æ¢æˆ <code>namespace package_name;</code>ï¼Œ Rust ä¼šè½¬æ¢æˆ <code>mod package_name;</code></li><li><code>service</code> ç”¨äºå®šä¹‰æœåŠ¡ï¼ŒæœåŠ¡ä¸­åŒ…å«å¤šä¸ª <code>rpc</code> æ–¹æ³•ï¼Œ<code>rpc</code> æ–¹æ³•åŒ…å«è¯·æ±‚å’Œå“åº”æ¶ˆæ¯ï¼Œå…·ä½“ä¼šåœ¨åé¢è®²è§£</li><li>ä¹‹åæ˜¯å„ç±»å¤åˆç±»å‹å®šä¹‰ï¼Œå¦‚ <code>enum</code>ã€<code>message</code> ç­‰ï¼Œè¯¥æ¨¡å—å’Œ service å®šä¹‰æ²¡æœ‰é¡ºåºè¦æ±‚ï¼Œåªè¦ <code>service</code> ä¸­ä½¿ç”¨çš„å¤åˆç±»å‹åœ¨æœ¬æ–‡ä»¶ä¸­å®šä¹‰å³å¯</li></ul><h4 id="Scalar-Value-Types">Scalar Value Types</h4><p>gRPC ä¸­å…±ç”¨å¦‚ä¸‹å‡ ç§åŸºç¡€ç±»å‹ï¼Œåœ¨ç¼–è¯‘æ—¶ä¼šè½¬æ¢æˆå¯¹åº”è¯­è¨€çš„åŸºç¡€ç±»å‹:</p><ul><li><p>å˜é•¿ç¼–ç ï¼ˆVarintï¼‰ï¼š</p><ul><li>int32ï¼ˆæœ‰ç¬¦å·æ•´æ•°ï¼‰</li><li>int64ï¼ˆæœ‰ç¬¦å·æ•´æ•°ï¼‰</li><li>uint32ï¼ˆæ— ç¬¦å·æ•´æ•°ï¼‰</li><li>uint64ï¼ˆæ— ç¬¦å·æ•´æ•°ï¼‰</li><li>sint32ï¼ˆæœ‰ç¬¦å·æ•´æ•°ï¼Œä½¿ç”¨ ZigZag ç¼–ç ï¼‰</li><li>sint64ï¼ˆæœ‰ç¬¦å·æ•´æ•°ï¼Œä½¿ç”¨ ZigZag ç¼–ç ï¼‰</li><li>boolï¼ˆå¸ƒå°”å€¼ï¼Œå­˜å‚¨ä¸º 0 æˆ– 1ï¼‰</li><li>enumï¼ˆæšä¸¾ï¼Œé€šå¸¸ä½œä¸º Varint ç¼–ç çš„æ•´æ•°ï¼‰</li></ul></li><li><p>å›ºå®šé•¿åº¦ç¼–ç ï¼š</p><ul><li>fixed32ï¼ˆ32 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå›ºå®š 4 å­—èŠ‚ï¼‰</li><li>fixed64ï¼ˆ64 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå›ºå®š 8 å­—èŠ‚ï¼‰</li><li>sfixed32ï¼ˆ32 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå›ºå®š 4 å­—èŠ‚ï¼‰</li><li>sfixed64ï¼ˆ64 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå›ºå®š 8 å­—èŠ‚ï¼‰</li><li>floatï¼ˆ32 ä½æµ®ç‚¹æ•°ï¼Œå›ºå®š 4 å­—èŠ‚ï¼‰</li><li>doubleï¼ˆ64 ä½æµ®ç‚¹æ•°ï¼Œå›ºå®š 8 å­—èŠ‚ï¼‰</li></ul></li><li><p>é•¿åº¦å‰ç¼€ç¼–ç ï¼š</p><ul><li>stringï¼ˆå­—ç¬¦ä¸²ï¼‰</li><li>bytesï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰</li><li>messageï¼ˆåµŒå¥—æ¶ˆæ¯ï¼‰</li></ul></li></ul><p>è¿™ç§å¤šç§ç¼–ç æ–¹å¼å…è®¸ Protocol Buffers ä»¥é«˜æ•ˆå’Œç´§å‡‘çš„æ–¹å¼è¿›è¡Œåºåˆ—åŒ–ã€‚</p><details>  <summary>å„è¯­è¨€å…·ä½“è½¬æ¢ï¼Œç‚¹æˆ‘å±•å¼€</summary>  <table style="width:100%"><tbody><tr><th>.proto Type</th><th>Notes</th><th>C++ Type</th><th>Java/Kotlin Type<sup>[1]</sup></th><th>Python Type<sup>[3]</sup></th><th>Go Type</th><th>Ruby Type</th><th>C# Type</th><th>PHP Type</th><th>Dart Type</th></tr><tr><td>double</td><td></td><td>double</td><td>double</td><td>float</td><td>float64</td><td>Float</td><td>double</td><td>float</td><td>double</td></tr><tr><td>float</td><td></td><td>float</td><td>float</td><td>float</td><td>float32</td><td>Float</td><td>float</td><td>float</td><td>double</td></tr><tr><td>int32</td><td>Uses variable-length encoding. Inefficient for encoding negativenumbers â€“ if your field is likely to have negative values, use sint32instead.</td><td>int32</td><td>int</td><td>int</td><td>int32</td><td>Fixnum or Bignum (as required)</td><td>int</td><td>integer</td><td>int</td></tr><tr><td>int64</td><td>Uses variable-length encoding. Inefficient for encoding negativenumbers â€“ if your field is likely to have negative values, use sint64instead.</td><td>int64</td><td>long</td><td>int/long<sup>[4]</sup></td><td>int64</td><td>Bignum</td><td>long</td><td>integer/string<sup>[6]</sup></td><td>Int64</td></tr><tr><td>uint32</td><td>Uses variable-length encoding.</td><td>uint32</td><td>int<sup>[2]</sup></td><td>int/long<sup>[4]</sup></td><td>uint32</td><td>Fixnum or Bignum (as required)</td><td>uint</td><td>integer</td><td>int</td></tr><tr><td>uint64</td><td>Uses variable-length encoding.</td><td>uint64</td><td>long<sup>[2]</sup></td><td>int/long<sup>[4]</sup></td><td>uint64</td><td>Bignum</td><td>ulong</td><td>integer/string<sup>[6]</sup></td><td>Int64</td></tr><tr><td>sint32</td><td>Uses variable-length encoding. Signed int value. These moreefficiently encode negative numbers than regular int32s.</td><td>int32</td><td>int</td><td>int</td><td>int32</td><td>Fixnum or Bignum (as required)</td><td>int</td><td>integer</td><td>int</td></tr><tr><td>sint64</td><td>Uses variable-length encoding. Signed int value. These moreefficiently encode negative numbers than regular int64s.</td><td>int64</td><td>long</td><td>int/long<sup>[4]</sup></td><td>int64</td><td>Bignum</td><td>long</td><td>integer/string<sup>[6]</sup></td><td>Int64</td></tr><tr><td>fixed32</td><td>Always four bytes. More efficient than uint32 if values are oftengreater than 2<sup>28</sup>.</td><td>uint32</td><td>int<sup>[2]</sup></td><td>int/long<sup>[4]</sup></td><td>uint32</td><td>Fixnum or Bignum (as required)</td><td>uint</td><td>integer</td><td>int</td></tr><tr><td>fixed64</td><td>Always eight bytes. More efficient than uint64 if values are oftengreater than 2<sup>56</sup>.</td><td>uint64</td><td>long<sup>[2]</sup></td><td>int/long<sup>[4]</sup></td><td>uint64</td><td>Bignum</td><td>ulong</td><td>integer/string<sup>[6]</sup></td><td>Int64</td></tr><tr><td>sfixed32</td><td>Always four bytes.</td><td>int32</td><td>int</td><td>int</td><td>int32</td><td>Fixnum or Bignum (as required)</td><td>int</td><td>integer</td><td>int</td></tr><tr><td>sfixed64</td><td>Always eight bytes.</td><td>int64</td><td>long</td><td>int/long<sup>[4]</sup></td><td>int64</td><td>Bignum</td><td>long</td><td>integer/string<sup>[6]</sup></td><td>Int64</td></tr><tr><td>bool</td><td></td><td>bool</td><td>boolean</td><td>bool</td><td>bool</td><td>TrueClass/FalseClass</td><td>bool</td><td>boolean</td><td>bool</td></tr><tr><td>string</td><td>A string must always contain UTF-8 encoded or 7-bit ASCII text, and cannotbe longer than 2<sup>32</sup>.</td><td>string</td><td>String</td><td>str/unicode<sup>[5]</sup></td><td>string</td><td>String (UTF-8)</td><td>string</td><td>string</td><td>String</td></tr><tr><td>bytes</td><td>May contain any arbitrary sequence of bytes no longer than 2<sup>32</sup>.</td><td>string</td><td>ByteString</td><td>str (Python 2)<br>bytes (Python 3)</td><td>[]byte</td><td>String (ASCII-8BIT)</td><td>ByteString</td><td>string</td><td>List<int></int></td></tr></tbody></table></details><p>è¿™æ˜¯å®˜ç½‘çš„è¡¨æ ¼ç…§æŠ„ç»“æœï¼Œè¯·ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºå‡†ä»¥é¿å…ä»»ä½•æ—¶æ•ˆæ€§é—®é¢˜ã€‚<a href="https://protobuf.dev/programming-guides/proto3/#scalar">å®˜æ–¹æ–‡æ¡£é“¾æ¥</a></p><h4 id="Enumerations">Enumerations</h4><h4 id="Union-Variant">Union(Variant)</h4><figure class="highlight proto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message </span><span class="title class_">PublishRoomRequest</span> &#123;</span><br><span class="line">    <span class="type">string</span> name = <span class="number">1</span>;</span><br><span class="line">    <span class="type">string</span> password = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">oneof</span> contact &#123;<span class="comment">// like union in c/c++</span></span><br><span class="line">        <span class="type">string</span> email = <span class="number">3</span>;</span><br><span class="line">        <span class="type">string</span> phone = <span class="number">4</span>;</span><br><span class="line">        <span class="type">int64</span> id = <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Message">Message</h4><p>å°±æ˜¯ Struct, ç”¨äºå®šä¹‰å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥åµŒå¥—å®šä¹‰ï¼Œå¯ä»¥åŒ…å« <code>enum</code>ã€<code>message</code>ã€<code>oneof</code> ç­‰<br>å¯ä»¥ç”¨ <code>repeated</code> å…³é”®å­—å®šä¹‰æ•°ç»„</p><figure class="highlight proto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message </span><span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="type">string</span> name = <span class="number">1</span>;</span><br><span class="line">  <span class="type">int32</span> id = <span class="number">2</span>;</span><br><span class="line">  <span class="type">string</span> email = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">enum </span><span class="title class_">PhoneType</span> &#123;</span><br><span class="line">    MOBILE = <span class="number">0</span>;</span><br><span class="line">    HOME = <span class="number">1</span>;</span><br><span class="line">    WORK = <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">message </span><span class="title class_">PhoneNumber</span> &#123;</span><br><span class="line">    <span class="type">string</span> number = <span class="number">1</span>;</span><br><span class="line">    PhoneType type = <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">repeated</span> PhoneNumber phones = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Service-å®šä¹‰">Service å®šä¹‰</h4><figure class="highlight proto"><table><tr><td class="code"><pre><span class="line"><span class="keyword">service </span><span class="title class_">ChatService</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> PublishRoom(PublishRoomRequest) <span class="keyword">returns</span> (PublishRoomReply)</span>;</span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> GetRoomPeers(GetRoomPeersRequest) <span class="keyword">returns</span> (stream GetRoomPeersReply)</span>;</span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> GetRoomsPeers(stream GetRoomPeersRequest) <span class="keyword">returns</span> (stream GetRoomPeersReply)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>stream</code> use to specify a stream message, which means the server or client can send or receive multiple messages in one rpc call.</p><h2 id="grpc-ä¸€äº›æ•™ç¨‹">grpc ä¸€äº›æ•™ç¨‹</h2><ul><li><a href="https://grpc.io/">å®˜ç½‘</a>æ‰¾è‡ªå·±è¦ç”¨çš„è¯­è¨€å»çœ‹</li><li><a href="https://github.com/mengbin92/protobuf/blob/master/docs/%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97(proto3).md">æ‰¾çš„æŸä¸ª blog</a></li></ul><h2 id="æœ‰è¶£çš„ä¸œè¥¿">æœ‰è¶£çš„ä¸œè¥¿</h2><p>è¯­æ³•è¯´å®è¯æ²¡å•¥çœ‹çš„ï¼Œç”¨çš„æ—¶å€™å†æŸ¥ï¼Œä½†æ˜¯ç¼–ç æŒºå¥½ç©çš„ã€‚<a href="https://protobuf.dev/programming-guides/encoding/">å®˜æ–¹ä»‹ç»</a></p><h3 id="å¯å˜é•¿åº¦ç¼–ç ">å¯å˜é•¿åº¦ç¼–ç </h3><p>å°†åŸæ•°æŒ‰å°ç«¯åºç¼–ç ï¼Œç„¶ååˆ†ä¸º 7 bits ä¸€ç»„ï¼Œæ¯ byte çš„ MSBï¼ˆæœ€é«˜ä½ï¼‰è¡¨ç¤ºæ˜¯å¦è¿˜æœ‰åç»­(0è¡¨ç¤ºæ— ï¼Œ1è¡¨ç¤ºæœ‰)ã€‚ç”±äºæŒ‰å°ç«¯åºè€Œä¸æ˜¯ä¼ ç»Ÿçš„å¤§ç«¯åºï¼ˆç½‘ç»œå­—èŠ‚åºï¼‰ï¼Œå¯ä»¥èŠ‚çœæ•°å­—è¾ƒå°æ—¶é«˜ä½çš„å­˜å‚¨ç©ºé—´ã€‚å½“ç„¶å¯¹äºå¤§æ•°éœ€è¦æœ€å¤š10 bytesæ¥ä¼ è¾“ï¼Œå› æ­¤åœ¨å·²çŸ¥æ•°æ®éƒ½è¾ƒå¤§æ—¶åº”ç›´æ¥ä½¿ç”¨å®šé•¿ç¼–ç ã€‚</p><h3 id="ZigZag-ç¼–ç ">ZigZag ç¼–ç </h3><p>ä¸ºäº†è§£å†³è´Ÿæ•°è€Œç”Ÿã€‚å› ä¸ºè´Ÿæ•°çš„æ ‡å‡†è¡¨ç¤ºæ–¹å¼æ˜¯ MSB è®¾ 1 çš„ 2 è¡¥ç ï¼Œä¼šå¯¼è‡´å¤§è´Ÿæ•°çš„å¯å˜é•¿åº¦ç¼–ç è¿œè¿œé•¿äºåŒç»å¯¹å€¼çš„æ­£æ•°ã€‚å¦‚æœæ˜¯æœŸæœ›ä¸º 0 çš„é«˜æ–¯åˆ†å¸ƒï¼Œç”¨ä¸Šé¢çš„å˜é•¿ç¼–ç ä¼šäº§ç”Ÿå¾ˆå¤§çš„æ¶ˆè€—ã€‚ZigZag ç¼–ç å°†è´Ÿæ•°æ˜ å°„åˆ°æ­£æ•°ï¼Œä½¿å¾—ç»å¯¹å€¼è¾ƒå°çš„è´Ÿæ•°çš„ç¼–ç é•¿åº¦æ¥è¿‘äºæ­£æ•°ã€‚</p><ul><li>ç¼–ç : <code>n &lt;&lt; 1 ^ n &gt;&gt; len</code>, å…¶ä¸­ <code>len</code> ä¸º n çš„ä½æ•°</li><li>è§£ç : <code>(n &gt;&gt; 1) ^ -(n &amp; 1)</code></li></ul><blockquote><p>æœ¬è´¨: åªç”¨æ­£æ•°è¡¨ç¤ºç»å¯¹å€¼å¤§å°ï¼Œç¬¦å·ä½ä» MSB æ¢ä¸º LSB, è¿™æ ·è®©ä¸Šé¢çš„å˜é•¿ç¼–ç å…³äºç»å¯¹å€¼å¤§å°çš„ä¼˜åŠ¿å¾—ä»¥ä¿ç•™ã€‚</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;é˜…è¯»é¡»çŸ¥&quot;&gt;é˜…è¯»é¡»çŸ¥&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä»…ä¾›å­¦ä¹ å‚è€ƒï¼Œç¬”è€…çš„ protobuf ç‰ˆæœ¬ä¸º 3.21.12.0ï¼Œä¸ä¿è¯å…¶ä»–ç‰ˆæœ¬çš„å…¼å®¹æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&quot;proto-file&quot;&gt;proto file&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;.proto&lt;/code&gt; æ ¼</summary>
      
    
    
    
    
    <category term="Notes" scheme="http://blog.vollate.top/tags/Notes/"/>
    
    <category term="RPC" scheme="http://blog.vollate.top/tags/RPC/"/>
    
  </entry>
  
  <entry>
    <title>Arch Linux ä¸‹ Firefox æ— æ³•æ­£ç¡®æ˜¾ç¤º emoji</title>
    <link href="http://blog.vollate.top/2024/02/20/missing-emoji/"/>
    <id>http://blog.vollate.top/2024/02/20/missing-emoji/</id>
    <published>2024-02-20T16:11:59.000Z</published>
    <updated>2024-12-02T12:46:31.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2><p>firefox æ— æ³•æ˜¾ç¤ºä»»ä½• emojiï¼Œä½† chromeï¼Œedge å‡æ˜¾ç¤ºæ­£å¸¸</p><h2 id="æŠ˜è…¾è¿‡ç¨‹">æŠ˜è…¾è¿‡ç¨‹</h2><p>é¦–å…ˆæ€€ç–‘æ˜¯ firefox ä»€ä¹ˆåœ°æ–¹é…ç½®ç‚¸äº†ã€‚æœäº†å‡ ç¯‡æé—®ï¼Œè§£å†³æ–¹æ¡ˆéƒ½æ— æ•ˆï¼ŒåŒ…æ‹¬ Arch wiki ä¸Šçš„<a href="https://wiki.archlinuxcn.org/wiki/Firefox#%E5%AD%97%E4%BD%93%E9%97%AE%E9%A2%98">è¿™ä¸ª</a>ã€‚<br>ç„¶åæˆ‘å¼€äº†ä¸‹è‡ªå·±å¦ä¸€å°ç”µè„‘ä¸Šçš„ Arch å‘ç°æ˜¾ç¤ºæ­£å¸¸ï¼Œäºæ˜¯æ¨æ–­å¯èƒ½æ˜¯ç¼ºå­—ä½“ã€‚å…·ä½“æ˜¯ä»€ä¹ˆä¸æ¸…æ¥šï¼Œä½†æ˜¯åŒ…åä¸­å¤§æ¦‚å¸¦ â€œemojiâ€ã€‚æœäº†åŠå¤©æ²¡æ‰¾åˆ°ä¸ªèƒ½ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œnoto-font-emoji è£…äº†ä¹Ÿæ²¡ç”¨ã€‚æœ€åä¸æŠ±å¸Œæœ›æœäº†ä¸‹<a href="https://archlinux.org/packages/">package</a>ï¼ŒåŸä»¥ä¸ºä¼šå‡ºç°ä¸€å †å¸¦ emoji çš„ï¼Œç»“æœå°±åå‡ ä¸ªã€‚çœ‹äº†çœ‹ï¼Œè§‰å¾—ç¼ºå°‘ â€œunicode-emojiâ€ çš„å¯èƒ½æ€§æœ€é«˜ï¼Œè£…äº†ï¼Œå¥½äº†ã€‚<br>ç„¶åå‘ç° vim ä¸­çš„ warning å­—ä½“çªç„¶å˜æˆ unicode é‡Œé¢é‚£ä¸ªé»„è‰² warningï¼ˆä¸‘ï¼‰ï¼Œäºæ˜¯åˆæŠŠåŒ…å¸äº†ã€‚é‡å¯åå‘ç° firefox ä¸­ emoji æ­£å¸¸æ˜¾ç¤ºï¼Œå¤§æ¦‚æ˜¯æœ¬åœ°å“ªä¸ªé…ç½®æ–‡ä»¶ç‚¸äº†ä¸€å¼€å§‹æ‰æ˜¾ç¤ºä¸äº†ã€‚</p><h2 id="æ€»ç»“">æ€»ç»“</h2><p>äººç”Ÿ -1h<br>å¼ºè¿«ç—‡æ»¡è¶³++<br>æŠ˜è…¾ Linux ç»éªŒ++</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;é—®é¢˜æè¿°&lt;/h2&gt;
&lt;p&gt;firefox æ— æ³•æ˜¾ç¤ºä»»ä½• emojiï¼Œä½† chromeï¼Œedge å‡æ˜¾ç¤ºæ­£å¸¸&lt;/p&gt;
&lt;h2 id=&quot;æŠ˜è…¾è¿‡ç¨‹&quot;&gt;æŠ˜è…¾è¿‡ç¨‹&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆæ€€ç–‘æ˜¯ firefox ä»€ä¹ˆåœ°æ–¹é…ç½®ç‚¸äº†ã€‚æœäº†å‡ ç¯‡æé—®ï¼Œè§£å†³æ–¹æ¡ˆéƒ½æ— æ•ˆï¼ŒåŒ…æ‹¬ </summary>
      
    
    
    
    <category term="Journal" scheme="http://blog.vollate.top/categories/Journal/"/>
    
    
    <category term="Linux" scheme="http://blog.vollate.top/tags/Linux/"/>
    
    <category term="KDE Plasma" scheme="http://blog.vollate.top/tags/KDE-Plasma/"/>
    
  </entry>
  
  <entry>
    <title>Linux ä¸‹ç³»ç»Ÿä»£ç†é…ç½®</title>
    <link href="http://blog.vollate.top/2024/01/09/linux-desktop-system-proxy/"/>
    <id>http://blog.vollate.top/2024/01/09/linux-desktop-system-proxy/</id>
    <published>2024-01-09T15:57:33.000Z</published>
    <updated>2024-05-10T18:01:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>é…ç½® firefox ç³»ç»Ÿä»£ç†æ—¶å‡ºç°äº†ä¸€äº›é—®é¢˜ï¼Œç„¶åæŸ¥äº†ä¸‹ Linux æ¡Œé¢ç³»ç»Ÿä»£ç†çš„åŸç†ï¼Œè®°å½•ä¸€ä¸‹</p><p>ç³»ç»Ÿä¿¡æ¯:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">OS: Arch Linux x86_64 </span><br><span class="line">Kernel: 6.6.10-arch1-1 </span><br><span class="line">Packages: 1369 (pacman) </span><br><span class="line">Shell: zsh 5.9 </span><br><span class="line">DE: Plasma 5.27.10 </span><br><span class="line">WM: KWin </span><br><span class="line">Theme: [Plasma], Canta-dark [GTK2/3] </span><br><span class="line">Icons: Tela-circle-manjaro-dark [Plasma], Tela-circle-manjaro-dark [GTK2/3] </span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>clash-verge</code> è¿›è¡Œä»£ç†ï¼Œç„¶å system-proxy è®¾ç½®ä¸º manual å edge å’Œ chrome èƒ½æ­£å¸¸è¯†åˆ«ã€‚ä½†æ˜¯ firefox æ­»æ´»ä¸è¡Œï¼Œä¸Šç½‘æŸ¥äº†ä¸æ”¯æŒä»£ç†çš„é—®é¢˜æ˜¯11å¹´å‰çš„ã€‚ æ— å¥ˆå¼€å§‹æ€€ç–‘æ˜¯ firefox ä¸æ”¯æŒ KDE æ¡Œé¢ç¯å¢ƒçš„ç³»ç»Ÿä»£ç†è®¾ç½®ã€‚</p><p><img src="2024-01-10_01-00.png" alt="setting"></p><h2 id="KDE-ç³»ç»Ÿä»£ç†é…ç½®">KDE ç³»ç»Ÿä»£ç†é…ç½®</h2><p>å¦‚ä¸Šå›¾ï¼Œé…ç½®å¥½åï¼Œç³»ç»Ÿä»£ç†çš„ä¿¡æ¯å¯ä»¥åœ¨ <code>~/.config/kioslaverc</code> ä¸­æ‰¾åˆ°<br><img src="2024-01-10_01-04.png" alt="rc file"></p><h2 id="GNOME-ç³»ç»Ÿä»£ç†é…ç½®">GNOME ç³»ç»Ÿä»£ç†é…ç½®</h2><p>GNOME æ¡Œé¢åŒæ ·å¯ä»¥é€šè¿‡ GUI é…ç½®ç³»ç»Ÿä»£ç†ï¼Œå…·ä½“ä¸å±•ç¤ºäº†å› ä¸ºæ²¡ GNOME æ¡Œé¢(<s>å…¨ç”¨Archå¯¼è‡´çš„</s>ã€‚GNOME ä¸‹æ¡Œé¢åº”ç”¨å¯ä»¥é€šè¿‡ <code>gsettings</code> æ¥è·å–å¯¹åº”çš„ key å€¼ï¼Œå¦‚ <code>gsettings get org.gnome.system.proxy mode</code> å¯ä»¥è·å–ç°åœ¨çš„ç³»ç»Ÿä»£ç†æ¨¡å¼ã€‚</p><h2 id="è§£å†³é—®é¢˜">è§£å†³é—®é¢˜</h2><p>å‘ç° <code>clash-verge</code> å†…ç½®çš„ç³»ç»Ÿä»£ç†é…ç½®çš„æ˜¯ <code>gsettings</code> çš„é€‰é¡¹ï¼Œè€Œä¸” firefox åªè®¤ GNOME çš„ç³»ç»Ÿä»£ç†é…ç½®(Mozilla å¿«æŠŠ firefox ç©æ­»äº†)ã€‚å› æ­¤ä¹‹å‰ä¸€ç›´æ²¡æœ‰æˆåŠŸã€‚Ubuntu ç”¨æˆ·å¤ªå¤šå¯¼è‡´è½¯ä»¶é€‚é…å€¾å‘äº GNOME æ¡Œé¢ï¼Œ<s>ä½†æ˜¯çœŸçš„å¥½ä¸‘å•Š GNOME</s>ã€‚</p><blockquote><p>å°è´´å£«ï¼šä¸€èˆ¬æ¡Œé¢ app ä¸åƒ env variable è¿™ä¸€å¥—</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;é…ç½® firefox ç³»ç»Ÿä»£ç†æ—¶å‡ºç°äº†ä¸€äº›é—®é¢˜ï¼Œç„¶åæŸ¥äº†ä¸‹ Linux æ¡Œé¢ç³»ç»Ÿä»£ç†çš„åŸç†ï¼Œè®°å½•ä¸€ä¸‹&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿä¿¡æ¯:&lt;/p&gt;
&lt;figure class=&quot;highlight text&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;sp</summary>
      
    
    
    
    <category term="Journal" scheme="http://blog.vollate.top/categories/Journal/"/>
    
    
    <category term="Linux" scheme="http://blog.vollate.top/tags/Linux/"/>
    
    <category term="Proxy" scheme="http://blog.vollate.top/tags/Proxy/"/>
    
  </entry>
  
  <entry>
    <title>VPS æµ‹è¯•è„šæœ¬æ•´ç†</title>
    <link href="http://blog.vollate.top/2023/12/13/vps-testscripts/"/>
    <id>http://blog.vollate.top/2023/12/13/vps-testscripts/</id>
    <published>2023-12-13T07:44:50.000Z</published>
    <updated>2024-05-10T18:01:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ•´ç†è‡ª<a href="https://zhuanlan.zhihu.com/p/117547388">çŸ¥ä¹</a></p><h2 id="åŸºç¡€æµ‹è¯•-IO-ç½‘é€Ÿ">åŸºç¡€æµ‹è¯•(IO+ç½‘é€Ÿ)</h2><h3 id="Bench">Bench</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget -qO- bench.sh | bash</span><br><span class="line">curl -Lso- bench.sh | bash</span><br><span class="line">wget -qO- 86.re/bench.sh | bash</span><br><span class="line">curl -so- 86.re/bench.sh | bash</span><br></pre></td></tr></table></figure><h3 id="SuperBench">SuperBench</h3><p>ä¼šå®‰è£…è¾ƒå¤šä¸œè¥¿ï¼Œæµ‹å¾—ä¹Ÿè¾ƒå…¨ï¼Œå¹¶ä¸”ç½‘ç»œæµ‹é€Ÿæ³¨é‡å›å›½é€Ÿåº¦</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget -qO- --no-check-certificate https://raw.githubusercontent.com/oooldking/script/master/superbench.sh | bash</span><br><span class="line">curl -Lso- -no-check-certificate https://raw.githubusercontent.com/oooldking/script/master/superb</span><br></pre></td></tr></table></figure><h3 id="Superseed">Superseed</h3><p>æä¾›æµ‹è¯•å…¨å›½å„åœ°ä¸‰å¤§è¿è¥å•†é€Ÿåº¦</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/oooldking/script/master/superspeed.sh &amp;&amp; chmod +x superspeed.sh &amp;&amp; ./superspeed.sh</span><br></pre></td></tr></table></figure><h3 id="UnixBench">UnixBench</h3><p>ä¸»è¦æµ‹è¯•é¡¹ç›®æœ‰ï¼šç³»ç»Ÿè°ƒç”¨ã€è¯»å†™ã€è¿›ç¨‹ã€å›¾å½¢åŒ–æµ‹è¯•ã€2Dã€3Dã€ç®¡é“ã€è¿ç®—ã€Cåº“ç­‰ç³»ç»ŸåŸºå‡†æ€§èƒ½æä¾›æµ‹è¯•æ•°æ®ï¼Œ<a href="https://github.com/teddysun/across?tab=readme-ov-file">å‘å¸ƒé¡µ</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget --no-check-certificate https://github.com/teddysun/across/raw/master/unixbench.sh</span><br><span class="line">chmod +x unixbench.sh</span><br><span class="line">./unixbench.sh</span><br></pre></td></tr></table></figure><h3 id="Memory-Test">Memory Test</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">CentOS / RHEL</span></span><br><span class="line">yum install wget -y</span><br><span class="line">yum groupinstall &quot;Development Tools&quot; -y</span><br><span class="line">wget https://raw.githubusercontent.com/FunctionClub/Memtester/master/memtester.cpp</span><br><span class="line">gcc -l stdc++ memtester.cpp</span><br><span class="line">./a.out</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Ubuntu / Debian</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get install wget build-essential -y</span><br><span class="line">wget https://raw.githubusercontent.com/FunctionClub/Memtester/master/memtester.cpp</span><br><span class="line">gcc -l stdc++ memtester.cpp</span><br><span class="line">./a.out</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æ•´ç†è‡ª&lt;a href=&quot;https://zhuanlan.zhihu.com/p/117547388&quot;&gt;çŸ¥ä¹&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;åŸºç¡€æµ‹è¯•-IO-ç½‘é€Ÿ&quot;&gt;åŸºç¡€æµ‹è¯•(IO+ç½‘é€Ÿ)&lt;/h2&gt;
&lt;h3 id=&quot;Bench&quot;&gt;Bench&lt;/h3&gt;
&lt;figure cla</summary>
      
    
    
    
    <category term="Journal" scheme="http://blog.vollate.top/categories/Journal/"/>
    
    
    <category term="Server" scheme="http://blog.vollate.top/tags/Server/"/>
    
  </entry>
  
  <entry>
    <title>ç¼–è¯‘ä¹‹æ³•</title>
    <link href="http://blog.vollate.top/2023/12/08/compile-knowledge/"/>
    <id>http://blog.vollate.top/2023/12/08/compile-knowledge/</id>
    <published>2023-12-08T07:34:57.000Z</published>
    <updated>2024-10-13T10:35:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥ C/C++ ä¸ºä¾‹ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹ Linux ä¸‹ç¼–è¯‘çš„ç›¸å…³çŸ¥è¯†ã€‚çœ‹å®Œåº”è¯¥èƒ½æŒæ¡åŸºç¡€çš„ç¼–è¯‘èƒ½åŠ›ï¼Œå¤„ç†æŠ¥é”™ä¸å†æŠ“çã€‚ <s>éº»éº»å†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘é‡åˆ°é—®é¢˜åªèƒ½çé€› stackoverflow äº†</s> è¯¥é€›è¿˜å¾—é€›</p><h2 id="åŸºç¡€çŸ¥è¯†">åŸºç¡€çŸ¥è¯†</h2><h3 id="ç¼–è¯‘å‹è¯­è¨€ä¸è§£é‡Šå‹è¯­è¨€">ç¼–è¯‘å‹è¯­è¨€ä¸è§£é‡Šå‹è¯­è¨€</h3><ul><li>ç¼–è¯‘å‹è¯­è¨€æ˜¯å°†ä»£ç ç›´æ¥ç¼–è¯‘æˆæœºå™¨å¯ä»¥ç›´æ¥æ‰§è¡Œçš„æœºå™¨ç ï¼Œå¯ä»¥ç›´æ¥åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œã€‚ä»£è¡¨æ˜¯ Fortran, C, C++, RUST, Go ç­‰ã€‚</li><li>è§£é‡Šå‹è¯­è¨€æ˜¯é€šè¿‡è§£é‡Šå™¨é€è¡Œè§£é‡Šæ¯æ¡å‘½ä»¤æ¥æ‰§è¡Œå¯¹åº”çš„æ“ä½œï¼Œè¿è¡Œä¸éœ€è¦ç¼–è¯‘ï¼Œä½†æ˜¯éœ€è¦å¯¹åº”çš„è§£é‡Šå™¨è§£é‡Šæˆå¯¹åº”æ¶æ„çš„æŒ‡ä»¤ã€‚ä»£è¡¨æ˜¯ Python, ECMAScript, PHP ç­‰ç­‰ã€‚</li><li>ä¹Ÿè¿˜æœ‰ä¸€äº›ä¸¤è€…å…¼å…·çš„ï¼Œå¦‚ JAVAï¼Œç¼–è¯‘æˆå­—èŠ‚ç ï¼Œç„¶åç”± JVM è§£é‡Šæ‰§è¡Œã€‚</li></ul><h3 id="æ±‡ç¼–è¯­è¨€">æ±‡ç¼–è¯­è¨€</h3><p>æ±‡ç¼–è¯­è¨€æ˜¯æœ€æ¥è¿‘äºæœºå™¨ç çš„è¯­è¨€ï¼Œå’Œç›®æ ‡æœºå™¨çš„æŒ‡ä»¤é›†æ¶æ„ç´§å¯†ç›¸å…³ä¹Ÿç§°ä¸ºä½çº§è¯­è¨€ã€‚æŒ‡ä»¤é›†æ˜¯ä¸€ç§æŠ½è±¡ï¼Œå®ƒå°†è®¡ç®—æœºçš„ç‰©ç†å®ç°æŠ½è±¡æˆæŒ‡ä»¤é›†è§„å®šçš„ä¸€ç³»åˆ—æ“ä½œï¼Œä½¿å¾—åŒä¸€æ¶æ„çš„ä¸åŒå‹å·è®¡ç®—æœºèƒ½è¿ç®—åŒä¸€ä¸ªç¨‹åºï¼Œä¸”è§„å®šäº†ç¨‹åºå¦‚ä½•æ“ä½œç¡¬ä»¶å®Œæˆè®¡ç®—ã€‚æ±‡ç¼–ä¹‹æ‰€ä»¥æˆä¸ºæœ€æ¥è¿‘äºæœºå™¨ç çš„è¯­è¨€ï¼Œæ˜¯åœ¨äºå®ƒåªéœ€è¦è¿›è¡Œç®€å•çš„æ›¿æ¢å°±èƒ½ç”Ÿæˆå¯¹åº”çš„æœºå™¨ç ã€‚</p><p>ä¸¾ä¸ª MIPS32 æ¶æ„æ±‡ç¼–çš„ä¾‹å­ï¼š</p><figure class="highlight mips"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add </span>$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span></span><br></pre></td></tr></table></figure><p>è¿™æ¡æŒ‡ä»¤å°†2å’Œ3å·å¯„å­˜å™¨çš„å€¼ç›¸åŠ å­˜å‚¨åˆ°1å·å¯„å­˜å™¨ä¸­ï¼Œæ ¹æ® MIPS32 çš„è½¬æ¢è§„åˆ™ï¼Œç”Ÿæˆçš„äºŒè¿›åˆ¶æœºå™¨ç å¦‚ä¸‹:</p><table><thead><tr><th>opcode</th><th>rs</th><th>rt</th><th>rd</th><th>shamt</th><th>func</th></tr></thead><tbody><tr><td>000000</td><td>00010</td><td>00011</td><td>00001</td><td>00000</td><td>100000</td></tr></tbody></table><ul><li>æ“ä½œç ï¼ˆopcodeï¼‰ï¼šå¯¹äº add æ“ä½œï¼Œå®ƒçš„æ“ä½œç æ˜¯ 000000ã€‚</li><li>æºå¯„å­˜å™¨2ï¼ˆrsï¼‰ï¼š$2 å¯¹åº”çš„å¯„å­˜å™¨æ˜¯ 00010ã€‚</li><li>æºå¯„å­˜å™¨3ï¼ˆrtï¼‰ï¼š$3 å¯¹åº”çš„å¯„å­˜å™¨æ˜¯ 00011ã€‚</li><li>ç›®æ ‡å¯„å­˜å™¨ï¼ˆrdï¼‰ï¼š$1 å¯¹åº”çš„å¯„å­˜å™¨æ˜¯ 00001ã€‚</li><li>ç§»ä½é‡ï¼ˆshamtï¼‰ï¼šå¯¹äº add æ“ä½œè€Œè¨€ï¼Œä¸æ¶‰åŠç§»ä½ï¼Œå› æ­¤ä¸º 00000ã€‚</li><li>åŠŸèƒ½ç ï¼ˆfunctï¼‰ï¼šadd æ“ä½œçš„åŠŸèƒ½ç æ˜¯ 100000ã€‚</li></ul><p>æ±‡ç¼–è¯­è¨€ç»è¿‡ç®€å•çš„å¤„ç†å°±å¯ä»¥ç›´æ¥è½¬æ¢ä¸ºæœºå™¨ç ï¼Œä½†æ˜¯æœ‰è®¸å¤šåå¤„:</p><ol><li>å¯è¯»æ€§å·®ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª clang ç”Ÿæˆçš„ç®€å•çš„ hello world ç¨‹åºçš„æ±‡ç¼–ä»£ç </li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">    .text</span><br><span class="line">    .file   &quot;test.c&quot;</span><br><span class="line">    .globl  main                            # -- Begin function main</span><br><span class="line">    .p2align    4, 0x90</span><br><span class="line">    .type   main,@function</span><br><span class="line">main:                                   # @main</span><br><span class="line">    .cfi_startproc</span><br><span class="line"># %bb.0:</span><br><span class="line">    pushq   %rbp</span><br><span class="line">    .cfi_def_cfa_offset 16</span><br><span class="line">    .cfi_offset %rbp, -16</span><br><span class="line">    movq    %rsp, %rbp</span><br><span class="line">    .cfi_def_cfa_register %rbp</span><br><span class="line">    subq    $16, %rsp</span><br><span class="line">    movl    $0, -4(%rbp)</span><br><span class="line">    leaq    .L.str(%rip), %rdi</span><br><span class="line">    movb    $0, %al</span><br><span class="line">    callq   printf@PLT</span><br><span class="line">    xorl    %eax, %eax</span><br><span class="line">    addq    $16, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    .cfi_def_cfa %rsp, 8</span><br><span class="line">    retq</span><br><span class="line">.Lfunc_end0:</span><br><span class="line">    .size   main, .Lfunc_end0-main</span><br><span class="line">    .cfi_endproc</span><br><span class="line">                                        # -- End function</span><br><span class="line">    .type   .L.str,@object                  # @.str</span><br><span class="line">    .section    .rodata.str1.1,&quot;aMS&quot;,@progbits,1</span><br><span class="line">.L.str:</span><br><span class="line">    .asciz  &quot;Hello, World!\n&quot;</span><br><span class="line">    .size   .L.str, 15</span><br><span class="line"></span><br><span class="line">    .ident  &quot;clang version 16.0.6&quot;</span><br><span class="line">    .section    &quot;.note.GNU-stack&quot;,&quot;&quot;,@progbits</span><br><span class="line">    .addrsig</span><br><span class="line">    .addrsig_sym printf</span><br></pre></td></tr></table></figure><p>æ±‡ç¼–ä¸­æ²¡æœ‰æˆ‘ä»¬å¸¸ç”¨çš„æ§åˆ¶æµï¼Œéœ€è¦æ‰‹å†™åˆ¤æ–­è·³è½¬çš„æ“ä½œ<br>2. å¯ç§»æ¤æ€§å·®ï¼Œåªä½¿ç”¨äºç‰¹å®šæ¶æ„çš„è®¡ç®—æœºã€‚å¦‚æœä½ æƒ³è¦ä½ çš„æ±‡ç¼–ç¨‹åºåŒæ—¶åœ¨ arm64 å’Œ x86_64 ä¸Šè¿è¡Œï¼Œä½ éœ€è¦å†™ä¸¤ä»½ä»£ç ã€‚<br>3. å…¶ä»–å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†â€¦â€¦</p><h3 id="å‡½æ•°å£°æ˜å’Œå®šä¹‰">å‡½æ•°å£°æ˜å’Œå®šä¹‰</h3><p>åœ¨ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç”¨å‡½æ•°æ¥è¡¨ç¤ºä¸€ç§ç‰¹å®šçš„æ“ä½œï¼Œå®ƒèƒ½å¤Ÿå¤„ç†æˆ‘ä»¬çš„è¾“å…¥å¹¶ä¸”äº§ç”Ÿå¯¹åº”çš„è¾“å‡º(å‰¯ä½œç”¨)ã€‚æƒ³æ·±å…¥äº†è§£å¯ä»¥çœ‹çœ‹<a href="https://zh.wikipedia.org/wiki/%CE%9B%E6%BC%94%E7%AE%97">Î»æ¼”ç®—</a>ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šä»‹ç»äº†ã€‚å‡½æ•°èƒ½å¤Ÿç®€åŒ–æˆ‘ä»¬çš„ä»£ç ï¼Œå¯¹äºéœ€è¦åœ¨å¤šå¤„é‡å¤æ‰§è¡Œçš„æ“ä½œï¼Œæˆ‘ä»¬é€šè¿‡å°†ä»–åŒ…è£…æˆå‡½æ•°æ¥ç®€åŒ–æˆ‘ä»¬çš„ä»£ç ã€‚<br>å‡½æ•°çš„å£°æ˜å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨æˆ‘ä»¬æœ‰è¿™ä¹ˆä¸€ä¸ªå«xxxçš„å‡½æ•°ï¼Œå®ƒçš„è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯ä»€ä¹ˆç±»å‹ã€‚å®šä¹‰åˆ™æ˜¯å…·ä½“æè¿°äº†å‡½æ•°å¦‚ä½•å¤„ç†è¾“å…¥æœ€ç»ˆå¾—åˆ°è¾“å‡ºã€‚</p><p>åœ¨ç¼–ç¨‹ä¸­ï¼Œå‡½æ•°å¾€å¾€æ˜¯å£°æ˜å’Œå®šä¹‰åˆ†å¼€ï¼Œæ¥å°†é€»è¾‘å’Œå‡½æ•°è§£è€¦ã€‚åœ¨ C/C++ ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ <code>#include</code> é¢„å¤„ç†å‘½ä»¤æ¥å¼•ç”¨å¤´æ–‡ä»¶ï¼Œå¤´æ–‡ä»¶ä¸­åŒ…å«äº†å‡½æ•°å£°æ˜ã€‚é¢„å¤„ç†å™¨ä¼šç›´æ¥å°†è¢« include çš„æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°é¢„å¤„ç†åçš„æ–‡ä»¶å¯¹åº”ä½ç½®ä¸­ã€‚</p><h3 id="ç¼–è¯‘è¿‡ç¨‹">ç¼–è¯‘è¿‡ç¨‹</h3><p>ç¼–è¯‘å™¨æ˜¯ä¸€ç§è®¡ç®—æœºç¨‹åºï¼Œå®ƒä¼šå°†æŸç§ç¼–ç¨‹è¯­è¨€å†™æˆçš„æºä»£ç è½¬æ¢æˆå¦ä¸€ç§ç¼–ç¨‹è¯­è¨€ã€‚ä¸»è¦ç”¨é€”æ˜¯å°†ä¾¿äºäººç¼–å†™ã€é˜…è¯»ã€ç»´æŠ¤çš„é«˜çº§è®¡ç®—æœºè¯­è¨€æ‰€å†™ä½œçš„æºä»£ç ç¨‹åºï¼Œç¿»è¯‘ä¸ºç›®æ ‡æœºå™¨èƒ½è§£è¯»ã€è¿è¡Œçš„ä½é˜¶æœºå™¨è¯­è¨€çš„ç¨‹åºã€‚å°†é«˜çº§è¯­è¨€è½¬åŒ–ä¸ºä½çº§è¯­è¨€çš„è¿‡ç¨‹ç§°ä¸ºç¼–è¯‘ï¼Œåè¿‡æ¥æˆä¸ºåç¼–è¯‘ã€‚</p><p>ä¸€èˆ¬ç¼–è¯‘çš„è¿‡ç¨‹åˆ†ä¸ºå¦‚ä¸‹æ­¥éª¤:</p><ul><li>é¢„å¤„ç†: è¿›è¡Œæ–‡æœ¬æ›¿æ¢ç­‰å…¶ä»–æ“ä½œï¼Œå¦‚ C/C++ é‡Œ â€œ#xxxâ€ é¢„å¤„ç†å‘½ä»¤çš„å±•å¼€ä»¥åŠå®çš„æ›¿æ¢</li><li>ç¼–è¯‘ï¼šå°†æºä»£ç è½¬æ¢ä¸ºå¯¹åº”æ¶æ„çš„æ±‡ç¼–ä»£ç ï¼Œç”Ÿæˆ<code>.s</code>æ±‡ç¼–æ–‡ä»¶</li><li>æ±‡ç¼–ï¼šå°†ä¸Šä¸€æ­¥ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ç¿»è¯‘æˆäºŒè¿›åˆ¶æœºå™¨ç ï¼Œç”Ÿæˆ<code>.o</code> object æ–‡ä»¶</li><li>é“¾æ¥ï¼šå°†ä¸Šä¸€æ­¥ç”Ÿæˆçš„æ–‡ä»¶å’Œæ‰€éœ€è¦çš„é™æ€/åŠ¨æ€åº“é“¾æ¥ä¸ºä¸€ä¸ªæ–°çš„ object æ–‡ä»¶</li></ul><p>æ³¨æ„ä¸æ˜¯æ‰€æœ‰è¯­è¨€çš„ç¼–è¯‘éƒ½æœ‰ä¸Šè¿°çš„å‡ ä¸ªéƒ¨åˆ†ï¼Œå¦‚ JAVA ã€‚</p><h3 id="é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥">é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å£°æ˜è®©åœ¨å¤šä¸ªåœ°æ–¹ä½¿ç”¨å‡½æ•°è€Œåªéœ€æä¾›ä¸€æ¬¡å®šä¹‰ï¼ŒåŒç†ï¼Œå¤šä¸ªæ–‡ä»¶å¯ä»¥å…±ç”¨åŒä¸€ä¸ªå‡½æ•°ï¼Œåªéœ€è¦é“¾æ¥åŒ…å«äº†å‡½æ•°å®šä¹‰çš„ library å³å¯ï¼Œæ— éœ€é‡å¤ç¼–è¯‘ã€‚é“¾æ¥æ–¹å¼æœ‰å¦‚ä¸‹ä¸¤ç§:</p><ul><li>é™æ€é“¾æ¥ï¼šå°†è¢«é“¾æ¥çš„åº“çš„æ‰€æœ‰ä»£ç åµŒå…¥åˆ°æ–°çš„å¯æ‰§è¡Œæ–‡ä»¶æˆ–ç›®æ ‡æ–‡ä»¶ä¸­ã€‚<ul><li>ä¼˜ç‚¹ï¼šç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸éœ€è¦ä¾èµ–å¤–éƒ¨åº“</li><li>ç¼ºç‚¹ï¼š<ol><li>ç”Ÿæˆæ–‡ä»¶å˜å¤§</li><li>å¦‚æœè¢«é“¾æ¥çš„åº“æ›´æ–°ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘</li><li>æ— æ³•é‡å¤åˆ©ç”¨å…±äº«åº“</li></ol></li></ul></li><li>åŠ¨æ€é“¾æ¥ï¼šåœ¨ç¨‹åºè¿è¡Œæ—¶æˆ–è¿è¡Œå‰çš„è£…è½½é˜¶æ®µå°†å¤–éƒ¨åº“ä»£ç åŠ è½½åˆ°å†…å­˜ä¸­çš„è¿‡ç¨‹ã€‚å¯æ‰§è¡Œæ–‡ä»¶åªåŒ…å«å¯¹è¿™äº›åº“çš„å¼•ç”¨ï¼Œä¸åŒ…å«å®é™…çš„åº“ä»£ç <ul><li>ä¼˜ç‚¹ï¼š<ol><li>å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥æ›´å°</li><li>å¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥å¤ç”¨åŒä¸€ä¸ª lib</li><li>å¦‚æœæ›´æ–°ä¸æ”¹å˜å‡½æ•°æ¥å£ï¼Œåˆ™æ— éœ€é‡æ–°ç¼–è¯‘</li></ol></li><li>ç¼ºç‚¹ï¼š<ol><li>ä¼šä¾èµ–å¤–éƒ¨åº“ï¼Œå¦‚ linux çš„ glibcã€‚å¦‚æœç‰ˆæœ¬ä¸å…¼å®¹ï¼Œè¿è¡Œæ—¶ä¼šæŠ¥é”™ã€‚</li><li>å¯åŠ¨æ—¶ä¼šç•¥å¾®å¢åŠ æ—¶é—´</li></ol></li></ul></li></ul><p>åŠ¨æ€é“¾æ¥åº“ <code>.dll</code> (Dynamic link library)æ˜¯ Windows ä¸‹çš„çš„ç§°å‘¼ï¼Œåœ¨ Unix/Linux ä¸‹ç§°ä¸º Shared Object <code>.so</code>ï¼Œæœ¬æ–‡ä¼šç»Ÿä¸€å«åŠ¨æ€é“¾æ¥åº“(å«é¡ºå£äº†)ã€‚</p><p>Linux ä¸‹ï¼Œé™æ€é“¾æ¥åº“ä¸€èˆ¬ä»¥ <code>.a</code> ç»“å°¾ (archive)</p><hr><h2 id="gcc-clang-ä½¿ç”¨">gcc/clang ä½¿ç”¨</h2><p>æœ¬ç« ä¸»è¦ä»‹ç»åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ gcc/clang è¿›è¡Œç¼–è¯‘çš„çš„è¿‡ç¨‹å’Œæ³¨æ„äº‹é¡¹ï¼Œä»¥ä¸‹å‘½ä»¤ä¸­çš„ clang éƒ½å¯ä»¥æ¢æˆ gccã€‚ä½†æ˜¯æ³¨æ„ï¼Œä¸åŒç¼–è¯‘å™¨æ‰€æ”¯æŒçš„ç¼–è¯‘å‚æ•°å¹¶ä¸å®Œå…¨ç›¸åŒï¼Œå› æ­¤é¡¹ç›®ä¸­éœ€è¦å¯¹ä¸åŒçš„ç¼–è¯‘å™¨è¿›è¡Œä¸åŒå‚æ•°çš„é€‚é…ã€‚</p><ul><li>è·å–å¸®åŠ© <code>man clang</code>ï¼Œman æ˜¯ Linux ä¸‹çš„ä¸€ä¸ª reference é¡µé¢ï¼Œå®‰è£…çš„ç¨‹åºå¯ä»¥ä»¥ä¸€å®šæ ¼å¼æä¾› manual ä¾› man å‘½ä»¤è°ƒç”¨ã€‚man ä½¿ç”¨ vim çš„é”®ä½ï¼ŒæŒ‰ / å»ºå¼€å§‹æœç´¢ï¼Œn å»ºä¸‹ä¸€ä¸ªï¼ŒN é”®ä¸Šä¸€ä¸ªï¼ŒæŒ‰ q é”®é€€å‡ºã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>man man</code> æ¥æŸ¥çœ‹ man çš„ manualï¼Œå¦‚æœä½ åªæƒ³è·å¾—ç®€å•çš„å¸®åŠ©ï¼Œè¯·ä½¿ç”¨ <code>clang --help</code></li><li>ç¼–è¯‘ä¸€ä¸ªæ–‡ä»¶ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶<br><a href="test.c">test.c</a></li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">clang test.c -o test</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œåœ¨ clang/gcc é»˜è®¤ä½¿ç”¨ â€œmainâ€ ä½œä¸ºä¸»å‡½æ•°çš„å…¥ç‚¹ï¼Œå¦‚æœä½ çš„æ–‡ä»¶ä¸­æ²¡æœ‰ main å‡½æ•°ï¼Œç¼–è¯‘ä¼šæŠ¥é”™ï¼Œå› ä¸ºç¼–è¯‘å™¨æ²¡æœ‰æ‰¾åˆ°ä¸»å‡½æ•°å…¥å£ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ â€œ-oâ€ æŒ‡å®šè¾“å‡ºæ–‡ä»¶åç§°ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸º â€œa.outâ€</p><ul><li>ç¼–è¯‘ä¸€ä¸ªåº“<br><a href="mBool.c">mBool.c</a></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">static lib</span></span><br><span class="line">clang -c mBool.c -o mBool.o # è¿™é‡Œä¸å†™é»˜è®¤ç”ŸæˆåŒååç¼€ä¸º.oçš„å¯¹åº”æ–‡ä»¶</span><br><span class="line">ar r mBool.a mBool.o        # for GNU toolchain</span><br><span class="line">llvm-ar r libmBool.a mBool.o   # for llvm toolchain</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ar å°†æ‰€æœ‰(è¿™é‡Œåªæœ‰ä¸€ä¸ª) .o æ–‡ä»¶æ‰“åŒ…ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªç´¢å¼•è¡¨ä»¥ä¾›æŸ¥æ‰¾ã€‚æŸäº›æƒ…å†µï¼Œä¼šé€‰æ‹©æ€§å¯¹æ–‡ä»¶è¿›è¡Œå‹ç¼©</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shared lib</span></span><br><span class="line">clang -shared mBool.c -o libmBool.so -fPIC</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸Šè¿°åŠ¨æ€é“¾æ¥åº“çš„ç¼–è¯‘è¿‡ç¨‹ä¸­ä½¿ç”¨äº† `-fPIC` è¿™ä¸ªå‚æ•°ï¼Œæ„å‘³ç€ç”Ÿæˆ position independent codeï¼Œè¿™æ ·æˆ‘ä»¬çš„åŠ¨æ€é“¾æ¥åº“å°±å¯ä»¥åœ¨ä»»æ„åœ°å€è¢«è£…è½½ã€‚</span></span><br></pre></td></tr></table></figure><ul><li>é“¾æ¥ä¸€ä¸ªåº“<br><a href="mBoolTest.c">mBoolTest.c</a>  è¿™é‡Œæˆ‘æ‡’å¾—å†™å¤´æ–‡ä»¶äº†ï¼Œç›´æ¥å‰ç½®å£°æ˜äº†</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">link</span> the static lib</span></span><br><span class="line">clang -o mTest.out mBoolTest.c `pwd`/mBool.a</span><br><span class="line">clang -o mTest.out -static mBoolTest.c -L`pwd` -lmBool      # if no shared lib, &quot;-static&quot; is uneeded</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">link</span> the shared lib</span></span><br><span class="line">clang -o mTest.out mBoolTest.c -L`pwd` -lmBool</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ref:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> -L<span class="variable">$&#123;target_lib_path&#125;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> -l<span class="variable">$&#123;lib_name&#125;</span>            <span class="comment"># compiler will try to find lib$&#123;lib_name&#125;.a/so</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> -l:<span class="variable">$&#123;custom_lib_name&#125;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> -static                  <span class="comment"># use static link</span></span></span><br></pre></td></tr></table></figure><p>å¯¹äºé™æ€é“¾æ¥åº“ï¼Œæˆ‘ä»¬ç›´æ¥å°†å…¶ä½œä¸ºè¾“å…¥å³å¯é“¾æ¥ï¼Œå› ä¸ºå…¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªç¼–è¯‘åç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ <code>.o</code></p><p>å¯¹äºåŠ¨æ€é“¾æ¥åº“ï¼Œç¼–è¯‘å™¨ä¼šæœ‰ä¸€äº›ç³»ç»Ÿé»˜è®¤çš„åŠ¨æ€åº“ç›®å½•ï¼Œå®ƒä¼šè¿›å…¥ç›®å½•ä¸‹æŸ¥æ‰¾ã€‚æ˜¾ç„¶æˆ‘ä»¬å½“å‰çš„æ–‡ä»¶å¤¹å¹¶ä¸åœ¨æ­¤ä¹‹åˆ—ï¼Œå› æ­¤ä¸ºäº†è®©ç¼–è¯‘å™¨è¿›å…¥æˆ‘ä»¬å½“å‰çš„ç›®å½•ä¸‹æŸ¥æ‰¾é“¾æ¥åº“ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>-L</code> æ¥åŠ å…¥æˆ‘ä»¬åº“æ‰€åœ¨çš„ç›®å½•æ¥è®©ç¼–è¯‘å™¨æŸ¥æ‰¾ã€‚æˆ‘ä»¬ä¹‹å‰å°†ç¼–è¯‘å‡ºæ¥çš„åº“å‘½åä¸º â€œlibmBool.*â€ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>-l</code> æ¥é“¾æ¥æˆ‘ä»¬çš„åº“ã€‚å› ä¸ºæˆ‘ä»¬çš„ç›®å½•ä¸‹åŒæ—¶å­˜åœ¨é™æ€å’ŒåŠ¨æ€é“¾æ¥åº“ï¼Œå› æ­¤ç¼–è¯‘å™¨é»˜è®¤ä½¿ç”¨åŠ¨æ€é“¾æ¥ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>-static</code> æ¥è®©ç¼–è¯‘å™¨ä½¿ç”¨é™æ€é“¾æ¥åº“ã€‚</p><ul><li>ä½¿ç”¨ -rpath/-runpath<br>ç°åœ¨æˆ‘ä»¬å°è¯•è¿è¡Œæˆ‘ä»¬åˆšåˆšé“¾æ¥å®ŒåŠ¨æ€é“¾æ¥åº“çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åå°±æŠ¥é”™äº†</li></ul><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">./mTest.out: error while loading shared libraries: libmBool.so: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure><p>ç³»ç»Ÿæç¤ºæˆ‘ä»¬æ‰¾ä¸åˆ°åŠ¨æ€é“¾æ¥åº“ã€‚å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å­˜å‚¨åŠ¨æ€é“¾æ¥åº“çš„ä½ç½®ï¼ŒåŠ¨æ€é“¾æ¥å™¨(å¦‚ ld-linux.so)ä¸çŸ¥é“å»å“ªåŠ è½½æˆ‘ä»¬çš„åŠ¨æ€é“¾æ¥åº“æˆ‘ä»¬ä½¿ç”¨ <code>-rpath</code> æ¥å­˜å‚¨åŠ¨æ€é“¾æ¥åº“çš„ç›®å½•ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ï¼Œä¸€èˆ¬ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œè¿™æ ·ç¨‹åºåªè¦ä¿æŒæ–‡ä»¶å†…çš„ç»“æ„ä¸å˜å³å¯åœ¨å„å¤„æ‰§è¡Œã€‚æ³¨æ„ï¼Œè¿™ä¸ªå‚æ•°æ˜¯åŠ ç»™é“¾æ¥å™¨çš„ï¼Œclang å¯ä»¥ç›´æ¥ä¼ é€’ç»™é“¾æ¥å™¨ï¼Œä½†æ˜¯ gcc éœ€è¦ä½¿ç”¨ <code>-Wl</code> æ¥ä¼ é€’ç»™é“¾æ¥å™¨ã€‚<code>runpath</code> å’Œ <code>rpath</code> ç›¸æ¯”ï¼Œæ›´æ–°ï¼Œä¸€äº›è€æ—§çš„åŠ¨æ€é“¾æ¥å™¨å¯èƒ½ä¸æ”¯æŒï¼Œä½†æ˜¯æä¾›äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œå…·ä½“ä¸‹é¢ä¼šè®²åˆ°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">use relative path</span></span><br><span class="line">clang -o mTest.out  mBoolTest.c -L`pwd` -lmBool -rpath . # clang could ignore the -Wl for rpath, but gcc can&#x27;t</span><br><span class="line">clang -o mTest.out  mBoolTest.c -L`pwd` -lmBool -Wl,-rpath . # also works</span><br><span class="line">gcc -o mTest.out  mBoolTest.c -L`pwd` -lmBool -Wl,-rpath .</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">use absolute path</span></span><br><span class="line">clang -o mTest.out  mBoolTest.c -L`pwd` -lmBool -rpath `pwd`</span><br><span class="line">clang -o mTest.out  mBoolTest.c -L`pwd` -lmBool -Wl,-rpath `pwd`</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">use runpath</span></span><br><span class="line">clang -o mTest.out  mBoolTest.c -L`pwd` -lmBool -Wl,--enable-new-dtags -Wl,-rpath . # gcc paremeter is the same</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">force use rpath(<span class="built_in">disable</span> runpath)</span></span><br><span class="line">clang -o mTest.out  mBoolTest.c -L`pwd` -lmBool -Wl,-rpath . -Wl,--disable-new-dtags</span><br></pre></td></tr></table></figure><ul><li>å¼•ç”¨å¤´æ–‡ä»¶<br>ç°åœ¨æˆ‘ä»¬ä¸å·æ‡’äº†ï¼Œå¼•å…¥ä¸€ä¸ªå¤´æ–‡ä»¶ <a href="head.h">head.h</a>ï¼Œåˆ›å»ºä¸€ä¸ª <a href="nMBoolTest.c">nMBoolTest.c</a>ï¼Œå‡è®¾å¤´æ–‡ä»¶å­˜å‚¨åœ¨ç›®å½• <code>/tmp</code> ä¸‹ï¼Œæˆ‘ä»¬è¦è®©ç¼–è¯‘å™¨çŸ¥é“æˆ‘ä»¬å¤´æ–‡ä»¶çš„ä½ç½®ï¼Œä½¿ç”¨ <code>-I</code> é€‰é¡¹</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">clang -o nTest.out nMBoolTest.c -L`pwd` -lmBool -rpath `pwd` -I/tmp</span><br></pre></td></tr></table></figure><ul><li><p>ä½¿ç”¨ç¯å¢ƒå˜é‡<br>å‡è®¾æˆ‘ä»¬æ²¡æœ‰ makeï¼Œcmake è¿™æ ·çš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œæˆ–è€…æœ‰ä¸€ä¸ªå¤æ‚æ— æ¯”çš„ Makefile/CMakeLists.txtï¼Œæ— æ³•è½»æ˜“æ›´æ”¹ã€‚æˆ‘ä»¬éœ€è¦è®©ç¼–è¯‘å™¨çŸ¥é“æˆ‘ä»¬è‡ªå®šä¹‰çš„ header å’Œ lib çš„ä½ç½®ï¼Œè¿™æ—¶å€™å°±éœ€è¦æˆ‘ä»¬çš„ç¯å¢ƒå˜é‡ç™»åœºäº†ã€‚ä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ï¼Œæ›´å¤šçš„çœ‹å¯¹åº”ç¼–è¯‘å™¨çš„æ–‡æ¡£ï¼Œ<a href="https://gcc.gnu.org/onlinedocs/gcc/Environment-Variables.html">GCC</a></p></li><li><p>C_INCLUDE_PATHï¼šé˜…è¯»ç†è§£ï¼ˆ</p></li><li><p>C_PATHï¼šsame as above</p></li><li><p>CPLUS_INCLUDE_PATHï¼šé˜…è¯»ç†è§£ï¼ˆ</p></li><li><p>LIBRARY_PATHï¼šå‘Šè¯‰é“¾æ¥å™¨åº“çš„ä½ç½®ï¼Œé“¾æ¥æ—¶ä¼šè¿›å…¥è¯¥ç›®å½•æœç´¢</p></li><li><p>LD_LIBRARY_PATH: å‘Šè¯‰åŠ¨æ€é“¾æ¥å™¨åº“çš„ä½ç½®ï¼Œè¿è¡Œæ—¶ä¼šè¿›å…¥è¯¥ç›®å½•æœç´¢</p></li></ul><p>ä»¥ä¸Šå†™æ³•å†™æ³•åŒ <code>PATH</code>ï¼Œç”¨ <code>:</code> åˆ†éš”æ¯ä¸ªè·¯å¾„</p><p><a href="http://ld.so">ld.so</a>(åŠ¨æ€é“¾æ¥å™¨) æœç´¢é¡ºåº:</p><ol><li>ç¼–è¯‘æ—¶è®¾ç½®çš„ rpath è·¯å¾„</li><li>ç¯å¢ƒå˜é‡ LD_LIBRARY_PATH</li><li>ç¼–è¯‘æ—¶è®¾ç½®çš„ runpath: runpath çš„æœç´¢ä¼˜å…ˆçº§ä½äº LD_LIBRARY_PATHï¼Œå› æ­¤å®ƒå¯ä»¥å…è®¸ç”¨æˆ·è®¾ç½® LD_LIBRARY_PATH æ¥è¦†ç›– runpath æŒ‡å®šçš„åº“ï¼Œæä¾›æ›´å¤šçš„çµæ´»æ€§ã€‚è€Œ rpath åˆ™ä¸è¡Œã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€æœ‰å¯èƒ½ä¼šæ— æ„é—´ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„åº“ï¼Œé€ æˆä¸€äº›é—®é¢˜ã€‚</li><li>ç¼“å­˜æ–‡ä»¶(å¦‚ /etc/ld.so.cache): åŒ…å«äº†å½“å‰ç¯å¢ƒä¸­å¯ç”¨åº“çš„ç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨ <code>ldconfig</code> æ¥æ›´æ–°</li><li>é»˜è®¤è·¯å¾„ï¼Œå¦‚ â€œ/libâ€, â€œ/usr/libâ€ ç­‰ç­‰</li></ol><ul><li>å¸¸ç”¨ç¼–è¯‘é€‰é¡¹:<ul><li><code>-g</code>: generate debug info</li><li><code>-O0, -O1, -O3, -Ofast</code>: è®¾ç½®ç¼–è¯‘å™¨ä¼˜åŒ–ç­‰çº§ï¼Œç­‰çº§è¶Šé«˜ä¼˜åŒ–è¶Šå¤šã€‚O0æ— ä¼˜åŒ–ï¼ŒOfast å¯ç”¨O3çš„åŒæ—¶ä½¿ç”¨ä¸€äº›ä¸ç¬¦åˆ ISO æ ‡å‡†çš„ä¼˜åŒ–</li><li><code>-v</code>ï¼šè¾“å‡ºæ‰§è¡Œçš„å‘½ä»¤</li><li><code>-x</code>ï¼šæ˜¾ç¤ºæŒ‡å®šè¯­è¨€ç±»å‹</li><li><code>-std=</code>ï¼šæŒ‡å®šè¯­è¨€æ ‡å‡†</li><li><code>-Wall</code>ï¼šå¯ç”¨å‡ ä¹æ‰€æœ‰ warning</li><li><code>-Werror</code>: å°†æ‰€æœ‰ warning å½“ä½œ error</li><li><code>-Wno-deprecated</code>ï¼šå¦‚æœä½¿ç”¨äº†ç¼–è¯‘å™¨è¢«å¼ƒç”¨çš„åŠŸèƒ½ï¼Œä¸è¦äº§ç”Ÿ warning</li><li><code>-Wno-deprecated-declarations</code>ï¼šä¸è¦å¯¹ä½¿ç”¨ C++ ä¸­çš„ [[deprecated]] ä¿®é¥°çš„å¯¹è±¡äº§ç”Ÿ warning</li><li><code>-mx32</code>ï¼šç”Ÿæˆ32ä½x86ä»£ç </li><li><code>-stdlib=</code>ï¼šæŒ‡å®šä½¿ç”¨çš„æ ‡å‡†åº“</li><li><code>-E</code>ï¼šåªè¿›è¡Œé¢„å¤„ç†</li><li><code>-S</code>ï¼šç”Ÿæˆæ±‡ç¼–ä»£ç ååœæ­¢</li><li><code>-c</code>ï¼šç¼–è¯‘æˆ–æ±‡ç¼–å¯¹è±¡æ–‡ä»¶ï¼Œä½†ä¸é“¾æ¥</li><li>more: read the manual</li></ul></li></ul><h2 id="å¸¸è§é—®é¢˜è§£å†³">å¸¸è§é—®é¢˜è§£å†³</h2><ul><li>æŠ¥é”™äº†ï¼šå­¦ä¼šçœ‹æŠ¥é”™ï¼ŒæŠ¥é”™æ˜¯å¸®ä½ è§£å†³é—®é¢˜çš„ï¼Œçœ‹ä¸æ‡‚æŠŠæŠ¥é”™æ‰”æœç´¢å¼•æ“ä¸Šå¤šåŠèƒ½å‡ºæ¥(æ³¨æ„ä¸è¦å¤åˆ¶è¿‡å¤šæœ¬åœ°ç¯å¢ƒçš„æ— æ•ˆä¿¡æ¯)</li><li>å¿ƒæ€å´©äº†ï¼šç¼“ä¸Šä¸ªåŠå¤©ç»§ç»­æ•´</li></ul><p><img src="fix_all.jpg" alt="fix_all"></p><h2 id="å®Œ">å®Œ</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»¥ C/C++ ä¸ºä¾‹ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹ Linux ä¸‹ç¼–è¯‘çš„ç›¸å…³çŸ¥è¯†ã€‚çœ‹å®Œåº”è¯¥èƒ½æŒæ¡åŸºç¡€çš„ç¼–è¯‘èƒ½åŠ›ï¼Œå¤„ç†æŠ¥é”™ä¸å†æŠ“çã€‚ &lt;s&gt;éº»éº»å†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘é‡åˆ°é—®é¢˜åªèƒ½çé€› stackoverflow äº†&lt;/s&gt; è¯¥é€›è¿˜å¾—é€›&lt;/p&gt;
&lt;h2 id=&quot;åŸºç¡€çŸ¥è¯†&quot;&gt;åŸºç¡€çŸ¥è¯†&lt;/h2&gt;
&lt;h3 </summary>
      
    
    
    
    <category term="Knowledge" scheme="http://blog.vollate.top/categories/Knowledge/"/>
    
    
    <category term="Compiler" scheme="http://blog.vollate.top/tags/Compiler/"/>
    
  </entry>
  
  <entry>
    <title>æµ…è®°ç³»ç»Ÿè™šæ‹ŸåŒ–</title>
    <link href="http://blog.vollate.top/2023/11/17/virtualization/"/>
    <id>http://blog.vollate.top/2023/11/17/virtualization/</id>
    <published>2023-11-17T11:24:06.000Z</published>
    <updated>2024-05-10T18:01:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ç”±äºé¡¹ç›®éœ€è¦å­¦ä¹ è™šæ‹ŸåŒ–çš„çŸ¥è¯†ï¼Œäºæ˜¯åœ¨å¸ˆå…„çš„å»ºè®®ä¸‹è¯»äº† sjtu å‡ºçš„æ–°ä¹¦<a href="https://ipads.se.sjtu.edu.cn/ospi/">ã€Šæ“ä½œç³»ç»ŸåŸç†ä¸å®è·µã€‹</a>ä¸­çš„ç³»ç»Ÿè™šæ‹ŸåŒ–çš„éƒ¨åˆ†ï¼Œéšä¾¿è®°ç‚¹ç¬”è®°ã€‚</p><p><strong>è™šæ‹ŸåŒ–å‘å±•å†å²:</strong></p><ul><li>1960så‡ºç°åˆ†æ—¶æ“ä½œç³»ç»Ÿæ¦‚å¿µã€‚åŒæ—¶æœŸIBMè¿›è¡Œäº†å¦ä¸€ä¸ªæ–¹å‘ä¹Ÿå°±æ˜¯è™šæ‹ŸåŒ–çš„æ¢ç´¢ï¼Œå¹¶åœ¨1968å¹´çš„system360ä¸Šå®ç°äº†ç¬¬ä¸€ä¸ªVMM(Virtual Machine Monitor) <em>CP/CMS</em></li><li>1980sï¼Œå¼€å§‹å‡ºç°çº¯è½¯ä»¶å®ç°çš„è™šæ‹Ÿæœºç›‘è§†å™¨</li><li>1990s, äº’è”ç½‘å…´èµ·ï¼ŒwebæœåŠ¡å™¨é€æ¸æ€§èƒ½è¿‡å‰©</li><li>1998å¹´ï¼ŒVMwareæˆç«‹ã€‚</li><li>äº‘è®¡ç®—å…´èµ·ï¼Œè™šæ‹ŸåŒ–è¶Šå‘é‡è¦</li></ul><p><strong>ä¼˜åŠ¿:</strong></p><ul><li>å……åˆ†åˆ©ç”¨æœåŠ¡å™¨æ€§èƒ½ï¼Œ<s>æè¶…å”®</s></li><li>è™šæ‹Ÿæœºç®¡ç†æ›´ä¸ºä¾¿æ·ï¼Œå¯ä»¥å¿«é€Ÿéƒ¨ç½²é”€æ¯</li><li>å¯ä»¥çƒ­è¿ç§»</li><li>VMI (Virtual Machine Introspection è™šæ‹Ÿæœºè‡ªçœ)å¯ä»¥ä»å¤–éƒ¨æ£€æŸ¥è™šæ‹Ÿæœºæ˜¯å¦è¢«å…¥ä¾µ</li></ul><h2 id="ç³»ç»Ÿè™šæ‹ŸåŒ–æ¦‚è¿°">ç³»ç»Ÿè™šæ‹ŸåŒ–æ¦‚è¿°</h2><h3 id="ç»„æˆéƒ¨åˆ†">ç»„æˆéƒ¨åˆ†</h3><ul><li>CPU è™šæ‹ŸåŒ–ï¼ˆvCPUï¼‰ï¼šè‹¥è™šæ‹ŸåŒ–çš„æŒ‡ä»¤é›†å’Œç‰©ç†æ¶æ„æŒ‡ä»¤é›†ç›¸åŒï¼Œé™¤äº†éƒ¨åˆ†ç‰¹æ®ŠæŒ‡ä»¤å…¶ä»–éƒ½å¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œæ•ˆç‡è¾ƒé«˜ï¼ˆKVMï¼‰ï¼›è‹¥æ¶æ„ä¸åŒï¼Œåˆ™éœ€è¦å…¨éƒ¨è½¬è¯‘æ‰§è¡Œã€‚</li><li>å†…å­˜è™šæ‹ŸåŒ–ï¼šå¼•å…¥è™šæ‹Ÿç‰©ç†åœ°å€ï¼Œå†…å­˜è®¿é—®éœ€è¦å¤šç»è¿‡ä¸€å±‚è™šæ‹Ÿç‰©ç†åœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„æ“ä½œã€‚</li><li>I/O è™šæ‹ŸåŒ–ï¼šVMM æä¾›è™šæ‹Ÿé©±åŠ¨ä¾›è™šæ‹Ÿæœºä½¿ç”¨ï¼Œå¹¶å°†æ“ä½œè½¬åŒ–ä¸ºå®é™…çš„ç‰©ç†è®¾å¤‡è®¿é—®æˆ–å…¶ä»–æ“ä½œã€‚</li></ul><h3 id="VMM-ç±»å‹">VMM ç±»å‹</h3><ul><li>åŠè™šæ‹ŸåŒ–: è¿è¡Œåœ¨æœ€é«˜æƒé™çº§åˆ«ï¼Œç›¸å½“äºä¸€ä¸ªä»¥OSä½œä¸ºè¿›ç¨‹çš„æ“ä½œç³»ç»Ÿï¼Œå¦‚ Xenã€‚</li><li>å®Œå…¨è™šæ‹ŸåŒ–ï¼šä½œä¸ºä¸€ä¸ªè¿›ç¨‹è¿è¡Œåœ¨ OS ä¸Šï¼Œå¤ç”¨å®¿ä¸»OSçš„çº¿ç¨‹è°ƒåº¦å’Œèµ„æºç®¡ç†ï¼Œå¦‚ QEMUã€‚</li></ul><h2 id="Trap-Emulateï¼ˆä¸‹é™·-æ¨¡æ‹Ÿï¼‰">Trap-Emulateï¼ˆä¸‹é™·-æ¨¡æ‹Ÿï¼‰</h2><p>Trapï¼šå°†ç³»ç»Ÿçº§ISAæ‹¦æˆªè½¬ç”± VMM è¿›è¡Œæ¨¡æ‹Ÿæ“ä½œã€‚å¦‚ç³»ç»Ÿè°ƒç”¨å…ˆè½¬åŒ–ä¸ºè™šæ‹Ÿæœºå†…æ ¸æ€ï¼Œç„¶åç”± VMM æ‹¦æˆªå¹¶å®Œæˆå¯¹åº”è°ƒç”¨çš„æ¨¡æ‹Ÿã€‚</p><p>Emulateï¼šç”¨è½¯ä»¶æ¨¡æ‹Ÿæ‰§è¡Œåçš„å‰¯ä½œç”¨</p><p><strong>åŸºç¡€æ¦‚å¿µ:</strong></p><ul><li>CPU ä¸Šä¸‹æ–‡ï¼šæŒ‡CPUåœ¨æ‰§è¡Œç‰¹å®šè¿›ç¨‹æˆ–ä»»åŠ¡æ—¶æ‰€éœ€çš„ä¿¡æ¯é›†åˆã€‚ä¸€èˆ¬åŒ…æ‹¬è¯¥CPUçš„æ‰€æœ‰å¯„å­˜å™¨ï¼ˆåŒ…æ‹¬PCï¼‰çš„å€¼å’Œå½“å‰ç³»ç»ŸçŠ¶æ€ï¼ˆå†…å­˜ä¿¡æ¯ï¼Œè°ƒåº¦ä¼˜å…ˆçº§ç­‰ï¼‰ã€‚</li><li>ä¸­æ–­å‘é‡è¡¨ï¼ˆInterrupt Vector Tableï¼‰ï¼šå­˜æ”¾ä¸­æ–­å¤„ç†å‡½æ•°ã€‚</li><li>ä¸­æ–­å¤„ç†è¿‡ç¨‹ï¼šè§¦å‘ä¸­æ–­æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ä¸­æ–­æ˜¯å¦å¼€å¯ã€‚è‹¥å¼€å¯ï¼ŒCPU æ¥æ”¶ä¸­æ–­ä¿¡å·å¹¶æš‚åœå½“å‰ç¨‹åºå¤„ç†ã€‚ç„¶åä¿å­˜å½“å‰ä¸Šä¸‹æ–‡ä»¥ä¾›æ¢å¤ã€‚ç„¶åç¡®å®šä¸­æ–­ç±»å‹å¹¶ä»ä¸­æ–­å‘é‡è¡¨ä¸­æŸ¥æ‰¾å¯¹åº”å¤„ç†å‡½æ•°çš„åœ°å€å¹¶è·³è½¬æ‰§è¡Œã€‚æ‰§è¡Œç»“æŸåï¼Œæ¢å¤ä¸­æ–­å‰çš„ä¸Šä¸‹æ–‡ã€‚</li><li>ç”¨æˆ·æ€ï¼šç”¨æˆ·æ€æ˜¯æ™®é€šåº”ç”¨ç¨‹åºè¿è¡Œçš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼ä¸‹ï¼Œç¨‹åºå¯¹ç¡¬ä»¶çš„è®¿é—®å—é™ï¼Œä¸€èˆ¬é€šè¿‡OSæä¾›ç³»ç»Ÿè°ƒç”¨åˆ‡æ¢åˆ°å†…æ ¸æ€æ¥æ‰§è¡Œå¯¹åº”å‡½æ•°è¿›è¡Œè®¿é—®ã€‚</li><li>å†…æ ¸æ€ï¼šOS ä¸€èˆ¬è¿è¡Œåœ¨è¯¥çŠ¶æ€ä¸‹ã€‚è¯¥çŠ¶æ€ä¸‹ï¼ŒOS èƒ½å¤Ÿå®Œå…¨è®¿é—®å¹¶æ“ä½œç¡¬ä»¶ï¼Œè®¿é—®æ‰€æœ‰å†…å­˜ã€‚</li></ul><h3 id="Trap-Emulate-è™šæ‹ŸåŒ–å®ç°">Trap-Emulate è™šæ‹ŸåŒ–å®ç°</h3><p>VMM éœ€æä¾›æ•°æ®ç»“æ„ï¼Œæ¥å­˜å‚¨åŸæœ¬å­˜å‚¨åœ¨ç‰©ç† CPU ä¸Šçš„æ‰€æœ‰è¿›ç¨‹ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»¥åŠå¯¹åº”çš„å…¶å®ƒä¿¡æ¯ï¼ˆå¦‚ä¸­æ–­å‘é‡è¡¨,è™šæ‹Ÿé¡µè¡¨ç­‰ï¼‰ã€‚</p><ul><li>å¤„ç†ä¸­æ–­ï¼šå¯¹äºç¡¬ä»¶ä¸­æ–­ï¼Œå°†ä¼šè§¦å‘ VMM æŸ¥çœ‹è™šæ‹Ÿæœºæ˜¯å¦å¼€å¯å¯¹åº”ä¸­æ–­ã€‚å¦‚å¼€å¯ï¼Œè™šæ‹Ÿæœºä¿å­˜ä¸Šä¸‹æ–‡åä¸‹é™·åˆ° VMMï¼Œç„¶å VMM æ£€æŸ¥ä¸­æ–­å‘é‡è¡¨å¤„ç†ä¸­æ–­ã€‚</li><li>å¤„ç†ç³»ç»Ÿè°ƒç”¨ï¼šåŒä¸­æ–­å¤„ç†çš„æ¨¡å¼ï¼Œåªæ˜¯ VMM éœ€è¦éš”ç¦»ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„é¡µè¡¨æ˜ å°„</li><li>å¤„ç†çº¿ç¨‹åˆ‡æ¢ï¼šæœ¬è´¨è½¯ä»¶ä¸­æ–­åˆ°å†…æ ¸æ€ç„¶åè¿›è¡Œçº¿ç¨‹è°ƒåº¦ï¼Œåˆ‡æ¢è¿›ç¨‹ä¸Šä¸‹æ–‡å³å¯ã€‚</li><li>å¤š CPU æ¨¡æ‹Ÿï¼šåŠ ä¸ªæ•°æ®ç»“æ„å­˜è¿›ç¨‹ä¸Šä¸‹æ–‡å’Œ vCPU çš„å¯¹åº”å…³ç³»å°±è¡Œã€‚vCPU è°ƒåº¦å‚è€ƒ OS çš„è¿›ç¨‹è°ƒåº¦ï¼Œæˆ–è€…ç›´æ¥ç”¨çº¿ç¨‹ OS è¿›ç¨‹æ¥å®ç°ã€‚</li></ul><h2 id="CPUè™šæ‹ŸåŒ–">CPUè™šæ‹ŸåŒ–</h2><p>ç‰¹æƒæŒ‡ä»¤ï¼šåœ¨ç”¨æˆ·æ€æ‰§è¡Œæ—¶ä¼šä¸‹é™·è¿›å…¥ç‰¹æƒçº§çš„æŒ‡ä»¤</p><p>æ•æ„ŸæŒ‡ä»¤ï¼šç®¡ç†ç‰©ç†ç¡¬ä»¶èµ„æºæˆ–æ›´æ”¹CPUçŠ¶æ€çš„æŒ‡ä»¤</p><p>egï¼š</p><ul><li>x86 ä¿®æ”¹ CR å¯„å­˜å™¨çš„å€¼</li><li>è¯»å†™æ•æ„Ÿå†…å­˜</li><li>I/O æŒ‡ä»¤</li></ul><h3 id="å¯è™šæ‹ŸåŒ–å’Œä¸å¯è™šæ‹ŸåŒ–æ¶æ„">å¯è™šæ‹ŸåŒ–å’Œä¸å¯è™šæ‹ŸåŒ–æ¶æ„</h3><p>æ‰€æœ‰æ»¡è¶³æ•æ„ŸæŒ‡ä»¤éƒ½æ˜¯ç‰¹æƒæŒ‡ä»¤çš„æ¶æ„ç§°ä¸ºå¯è™šæ‹ŸåŒ–æ¶æ„ï¼Œåä¹‹åˆ™ä¸ºä¸å¯è™šæ‹ŸåŒ–æ¶æ„ã€‚</p><p>eg:</p><ul><li>AArch32</li><li>æ—©æœŸ x86</li></ul><h3 id="å¼¥è¡¥ä¸å¯è™šæ‹ŸåŒ–æ¶æ„çš„æ–¹æ³•">å¼¥è¡¥ä¸å¯è™šæ‹ŸåŒ–æ¶æ„çš„æ–¹æ³•</h3><h4 id="å…¨è™šæ‹ŸåŒ–">å…¨è™šæ‹ŸåŒ–</h4><p><em>é€‚ç”¨äºæ— éœ€ä¿®æ”¹å®¢æˆ·ç«¯æºç çš„æƒ…å†µ</em></p><ul><li>è§£é‡Šæ‰§è¡Œï¼šç”¨çº¯è½¯ä»¶æ¨¡æ‹Ÿcpuæ‰§è¡ŒæŒ‡ä»¤è¿‡ç¨‹ã€‚å…·ä½“æ“ä½œæ˜¯å¯¹äºæ¯æ¡æŒ‡ä»¤è°ƒç”¨å¯¹åº”çš„ç”¨äºæ¨¡æ‹Ÿçš„å‡½æ•°ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸äº§ç”Ÿä»»ä½•ä¸‹é™·ã€‚ä¼˜ç‚¹æ˜¯å¯ä»¥æ¨¡æ‹Ÿä»»ä½• ISA ç±»å‹çš„è™šæ‹Ÿæœºã€‚ç¼ºç‚¹æ˜¾è€Œæ˜“è§ï¼Œæ•ˆç‡ä½ä¸‹ã€‚</li><li>åŠ¨æ€äºŒè¿›åˆ¶ç¼–è¯‘ï¼šåœ¨è§£é‡Šæ‰§è¡Œçš„åŸºç¡€ä¸Šå°†ç¨‹åºåˆ’åˆ†ä¸ºåªæœ‰ä¸€ä¸ªå…¥å£å’Œä¸€ä¸ªå‡ºå£,ä¸­é—´æ— ä»»ä½•ä¿®æ”¹æ§åˆ¶æµæŒ‡ä»¤çš„ä»£ç å—(ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°)ã€‚ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯¥å—æ—¶è¿›è¡Œç¿»è¯‘å¹¶ç¼“å­˜ï¼Œä¹‹åå†æ‰§è¡Œæ—¶è°ƒç”¨ä¹‹å‰çš„ç¼“å­˜ã€‚ç¿»è¯‘æ›¿æ¢æ‰€æœ‰æ•æ„ŸæŒ‡ä»¤ï¼Œåœ¨å—çš„æœ«å°¾æ·»åŠ ä¸€æ¡è·³è½¬æŒ‡ä»¤æ¥é€šçŸ¥ VMM æ‰§è¡Œå®Œæ¯•ã€‚</li><li>æ‰«æ-ç¿»è¯‘ï¼šç”¨äºè™šæ‹Ÿæœºæ¶æ„å’Œå®¿ä¸»ç›¸åŒçš„æƒ…å†µï¼Œåœ¨ç¨‹åºæ‰§è¡Œå‰æ‰«æå¯èƒ½å­˜åœ¨æ•æ„ŸæŒ‡ä»¤çš„ä»£ç ï¼Œç¿»è¯‘å¹¶ç¼“å­˜ç¿»è¯‘åçš„ä»£ç ä»¥ä¾¿ä¸‹æ¬¡å¤ç”¨ã€‚å¤§å¤šæ•°æƒ…å†µæ•æ„ŸæŒ‡ä»¤åªå­˜åœ¨äº OS kernal ä¸­ï¼Œå¯ä»¥åªæ‰«æå†…æ ¸ä»£ç ã€‚</li></ul><h4 id="åŠè™šæ‹ŸåŒ–">åŠè™šæ‹ŸåŒ–</h4><blockquote><p>åœ¨å…è®¸ä¿®æ”¹è™šæ‹Ÿæœºå®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨</p></blockquote><p>åŸç†ï¼šé€šè¿‡ VMM æä¾›çš„ç±»ä¼¼ç³»ç»Ÿè°ƒç”¨çš„æœåŠ¡ä½¿å¾—è™šæ‹Ÿæœºå†…æ ¸ä¸å†éœ€è¦ä¸‹é™·æ¨¡æ‹Ÿï¼Œè€Œæ˜¯ç±»ä¼¼è¿›ç¨‹ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ä¸€æ ·è¿›è¡Œå¯¹åº”æ“ä½œï¼Œæ•ˆç‡æ›´é«˜ã€‚åŠè™šæ‹ŸåŒ–ä½¿å¾— VMM è·å¾—æŸ¥çœ‹å®¢æˆ·ç«¯å†…å­˜åˆ†å¸ƒçš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ›´åˆç†çš„åˆ†é…èµ„æºã€‚</p><h4 id="ç¡¬ä»¶è™šæ‹ŸåŒ–">ç¡¬ä»¶è™šæ‹ŸåŒ–</h4><p>é€šè¿‡ CPU ç¡¬ä»¶æ”¯æŒæ¥å®ç°æ›´é«˜æ•ˆçš„è™šæ‹ŸåŒ–ã€‚å…·ä½“æ¥è¯´å°±æ˜¯å¢åŠ ä¸€ä¸ªä¸“ä¸º VMM è¿è¡Œçš„ç‰¹æƒçº§ï¼Œè¯¥ç‰¹æƒçº§ä¸‹ VMM æ‹¥æœ‰å’Œå®¿ä¸» OS ç›¸åŒçš„ç¡¬ä»¶è®¿é—®æƒé™ï¼Œæ¥èŠ‚çœä¸‹é™·çš„å¼€é”€ã€‚</p><p>æ‹“å±•â€”â€”KVM (kernal-based virtual machine) æŠ€æœ¯: é€šè¿‡å°† VMM ä½œä¸ºå†…æ ¸æ¨¡å—åŠ è½½ä½¿å¾— VMM èƒ½å¤Ÿä½¿ç”¨ å®¿ä¸» OS å†…æ ¸çš„åŠŸèƒ½ï¼Œè¿™æ ·ä¸‹é™·æ—¶æŸäº›æ”¯æŒçš„æ¶æ„å¯ä»¥æ¶ˆé™¤ KVM åˆ° OS å†…æ ¸ç‰¹æƒçº§è½¬æ¢å¸¦æ¥çš„å¼€é”€ã€‚æŒ‡ä»¤æ— éœ€ç¿»è¯‘ï¼Œç›´æ¥åœ¨ç¡¬ä»¶ä¸Šæ‰§è¡Œï¼Œä½¿å¾—è™šæ‹ŸåŒ–æ•ˆç‡æ¥è¿‘ç›´æ¥è¿è¡Œã€‚</p><h2 id="å†…å­˜è™šæ‹ŸåŒ–">å†…å­˜è™šæ‹ŸåŒ–</h2><p>ç›®æ ‡ï¼šå®ç°è™šæ‹Ÿæœºä¹‹é—´ï¼Œè™šæ‹Ÿæœºå’Œç‰©ç†æœºä¹‹é—´çš„å†…å­˜éš”ç¦»<br>æœ¯è¯­ï¼š</p><ul><li>GVA: Guest Virtual Address</li><li>GPA: Guest Physical Address</li><li>HPA: Host Physical Address</li></ul><h3 id="å½±å­é¡µè¡¨-Shadow-Page-Table">å½±å­é¡µè¡¨(Shadow Page Table)</h3><p>å¤ä¹ è¿›ç¨‹é¡µè¡¨çš„é…ç½®&amp;ä½¿ç”¨ï¼š</p><ol><li>è°ƒç”¨å‰ OS ä¸ºè¿›ç¨‹é…ç½®ä¸€ä¸ªè™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ç‰©ç†åœ°å€çš„é™æ€é¡µè¡¨ï¼ˆç›¸å¯¹åœ°å€ï¼‰</li><li>OS å°†é¡µè¡¨åŸºåœ°å€å†™å…¥å¯¹åº”å¯„å­˜å™¨ä»¥è®© MMU èƒ½æ‰¾åˆ°é¡µè¡¨</li><li>MMU è§£æè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€</li></ol><p>å†…å­˜è™šæ‹ŸåŒ–ä¸­ï¼ŒVMM éœ€è¦æ ¹æ®å­˜å‚¨çš„ GPA åˆ° HPA çš„æ˜ å°„ä¿¡æ¯å¹¶ç”Ÿæˆä¸€ä¸ª GVA åˆ° HPA çš„å½±å­é¡µè¡¨ã€‚åœ¨è™šæ‹Ÿæœºä¸‹é™·æ—¶,å°†é¡µè¡¨åŸºåœ°å€æ›¿æ¢ä¸ºå½±å­é¡µè¡¨åŸºåœ°å€ï¼Œä»è€Œè®© MMU ç›´æ¥è§£æ GVAã€‚</p><p>VMM éœ€è¦ç›‘è§†è™šæ‹Ÿæœºå¯¹é¡µè¡¨çš„æ›´æ”¹ï¼Œå¹¶å¯¹åº”åœ°ä¿®æ”¹å½±å­é¡µè¡¨ã€‚åŒæ—¶ä¸ºäº†åˆ†éš”ç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Œéœ€è¦åˆ†ç¦»å¯¹åº”çš„é¡µè¡¨ï¼Œä½¿å¾—ç”¨æˆ·æ€é¡µè¡¨ä¸­ä¸åŒ…å«å†…æ ¸æ€çš„æ˜ å°„</p><p>ç¼ºé¡µå¤„ç†ï¼š</p><ul><li>è‹¥ä¸ºé¡µè¡¨é¡¹ä¸å­˜åœ¨æˆ–æ— æƒé™ï¼ŒVMM éœ€è§¦å‘å®¿ä¸» OS çš„ç¼ºé¡µä¸­æ–­è¿›è¡Œå¤„ç†</li><li>è‹¥ä¸ºè®¿é—®æƒé™è¶³å¤Ÿï¼Œåˆ™éœ€è¦åŒæ­¥å½±å­é¡µè¡¨ä¸è™šæ‹Ÿæœºé¡µè¡¨</li></ul><h3 id="ç›´æ¥é¡µè¡¨æ˜ å°„">ç›´æ¥é¡µè¡¨æ˜ å°„</h3><p>å®¢æˆ·ç«¯ä¸å®¿ä¸»å…±ç”¨é¡µè¡¨ã€‚è¯¥æƒ…å†µä¸‹å®¢æˆ·ç«¯çŸ¥é“è‡ªå·±å¤„åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ï¼ŒVMM ä¼šå‘ŠçŸ¥å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨çš„é¡µè¡¨èŒƒå›´ï¼Œæ–¹ä¾¿å®¢æˆ·ç«¯è§„åˆ’ã€‚å®¢æˆ·ç«¯çš„é¡µè¡¨é¡¹è¢«è®¾ä¸ºåªè¯»ï¼Œä¿®æ”¹é¡µè¡¨éœ€è¦ä½¿ç”¨ VMM æä¾›çš„è¶…çº§è°ƒç”¨ï¼Œè¯¥è°ƒç”¨ä¼šæ£€æŸ¥å¯¹é¡µè¡¨çš„ä¿®æ”¹æ˜¯å¦åˆæ³•ã€‚</p><h3 id="ä¸¤é˜¶æ®µåœ°å€ç¿»è¯‘">ä¸¤é˜¶æ®µåœ°å€ç¿»è¯‘</h3><p>ç¡¬ä»¶è™šæ‹ŸåŒ–çš„ä¸€éƒ¨åˆ†ï¼Œéœ€è¦ CPU æ”¯æŒä½¿ç”¨ç¬¬äºŒé¡µè¡¨å°† GPA è½¬æ¢åˆ° HPAï¼Œçœå» VMM æ‰‹åŠ¨ç»´æŠ¤å½±å­é¡µè¡¨çš„æ­¥éª¤ã€‚åŒæ—¶å¯ä»¥ä½¿ç”¨ TLB æ¥ä¼˜åŒ–è§£æé€Ÿåº¦ã€‚</p><p>ç¼ºé¡µä¸­æ–­å¤„ç†ï¼š</p><ul><li>å®¢æˆ·è™šæ‹Ÿæœºç¼ºé¡µï¼šæ— éœ€ä¸‹é™·ï¼Œç¡¬ä»¶ç›´æ¥è°ƒç”¨è™šæ‹Ÿæœºæ³¨å†Œçš„ä¸­æ–­å‡½æ•°</li><li>ç¬¬äºŒé˜¶æ®µé¡µè¡¨ç¼ºé¡µï¼šä¸‹é™·ï¼Œç¡¬ä»¶ç›´æ¥è°ƒç”¨ VMM æ³¨å†Œçš„çš„å¯¹åº”ä¸­æ–­å‡½æ•°</li></ul><p>ä¼˜ç‚¹ï¼š</p><ul><li>ä¸ç”¨ç»´æŠ¤å½±å­é¡µè¡¨</li><li>ä¸ç”¨ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªé¡µè¡¨</li><li>ç¼ºé¡µå¤„ç†æ›´å¿«</li></ul><h3 id="æ¢é¡µå’Œå†…å­˜æ°”çƒ">æ¢é¡µå’Œå†…å­˜æ°”çƒ</h3><p>ç›®çš„ï¼šè¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´è™šæ‹Ÿæœºå†…å­˜å¤§å°ï¼Œ<s>å†…å­˜è¶…å”®</s></p><p><strong>æ¢é¡µé€»è¾‘</strong>ï¼š</p><ul><li>ä¿å­˜å°†è¦äº¤æ¢çš„é¡µçš„ GVA å’Œ GPA</li><li>äº¤æ¢é¡µå†…æ•°æ®åˆ°æŒä¹…åŒ–å­˜å‚¨è®¾å¤‡ï¼ˆç¡¬ç›˜ä»€ä¹ˆçš„ï¼‰</li><li>å°†å®¢æˆ·ç«¯é¡µè¡¨é¡¹è®¾ä¸º INVALID</li><li>VMM é‡æ–°åˆ†é…è¯¥é¡µ</li></ul><p><strong>å†…å­˜æ°”çƒ(Memory Ballooning)</strong>ï¼šåœ¨å®¢æˆ·ç«¯æ’å…¥ä¸€ä¸ªé©±åŠ¨(<s>å†…é¬¼</s>)ï¼Œè¯¥é©±åŠ¨æ ¹æ® VMM çš„è¦æ±‚ä½¿ç”¨è™šæ‹Ÿæœºçš„æ¥å£ç”³è¯·/é‡Šæ”¾å†…å­˜ï¼Œç„¶åå°†ç”³è¯·çš„å†…å­˜ç‰©ç†åœ°å€å‘Šè¯‰ VMM æ¥ä½¿ç”¨ã€‚</p><h2 id="I-Oè™šæ‹ŸåŒ–">I/Oè™šæ‹ŸåŒ–</h2><ul><li>é™åˆ¶è™šæ‹Ÿæœºå¯¹ç‰©ç†ç¡¬ä»¶çš„ç›´æ¥è®¿é—®</li><li>æä¾›è™šæ‹Ÿè®¾å¤‡æ¥å£</li><li>å……åˆ†åˆ©ç”¨I/O</li></ul><h3 id="è½¯ä»¶æ¨¡æ‹Ÿï¼ˆå…¨è™šæ‹ŸåŒ–ï¼‰">è½¯ä»¶æ¨¡æ‹Ÿï¼ˆå…¨è™šæ‹ŸåŒ–ï¼‰</h3><p>æ•è·å®¢æˆ·ç«¯å¯¹è™šæ‹Ÿç¡¬ä»¶çš„ MMIO, DMA, ä¸­æ–­ï¼Œä¸‹é™·åç”± VMM æ‰§è¡Œå¯¹åº”æ“ä½œ</p><h3 id="åŠè™šæ‹ŸåŒ–-2">åŠè™šæ‹ŸåŒ–</h3><p>ç±»ä¼¼å…¨è™šæ‹ŸåŒ–ï¼Œå®¢æˆ·ç«¯ä¸å†ä½¿ç”¨åŸç”Ÿé©±åŠ¨è€Œæ˜¯å‰ç«¯é©±åŠ¨ï¼Œç”¨äºä¸ VMM åç«¯é©±åŠ¨äº¤äº’ã€‚ é€šè¿‡å†…å­˜å…±äº«ä¼ é€’æ•°æ®ï¼Œå¹¶ä½¿ç”¨æ‰¹å¤„ç†åŠ é€Ÿï¼Œç”±åç«¯é©±åŠ¨å®Œæˆå’Œç‰©ç†ç¡¬ä»¶çš„äº¤äº’ã€‚</p><h3 id="è®¾å¤‡ç›´é€š">è®¾å¤‡ç›´é€š</h3><p>è®©å®¢æˆ·ç«¯ç›´æ¥ç®¡ç†ç¡¬ä»¶è®¾å¤‡ï¼Œæ­¤æ—¶æ“ä½œå¯¹åº”ç¡¬ä»¶ä¸ä¼šäº§ç”Ÿä»»ä½•ä¸‹é™·ã€‚ä¸ºé˜²æ­¢ DMA æ”»å‡»ä½¿ç”¨ IOMMU è¿›è¡ŒäºŒé˜¶æ®µ GPA åˆ° HPA çš„æ˜ å°„å¹¶æ£€æŸ¥å¯¹åº”æƒé™ã€‚</p><p>SR-IOV(single root I/O virtualization):å®ç°ç¡¬ä»¶å±‚é¢ IO è™šæ‹ŸåŒ–ï¼Œé¿å…å•ä¸€è™šæ‹Ÿæœºç‹¬å ç¡¬ä»¶ã€‚é€šè¿‡åˆ›å»ºå¤šä¸ª VF ï¼ˆvirtual functionï¼‰ è®© VMM åˆ†é…ç»™è™šæ‹Ÿæœºä½¿ç”¨</p><h2 id="ä¸­æ–­è™šæ‹ŸåŒ–">ä¸­æ–­è™šæ‹ŸåŒ–</h2><p>ä¸¤ç§ä¸­æ–­ï¼š</p><ul><li>ç‰©ç†ä¸­æ–­ï¼šç”±ç¡¬ä»¶äº§ç”Ÿï¼Œåœ¨éç›´é€šæƒ…å†µä¸‹ç”± VMM å¤„ç†</li><li>è™šæ‹Ÿä¸­æ–­ï¼šç”± VMM äº§ç”Ÿ</li></ul><p>è§£å†³å¼€å…³ä¸­æ–­ä¸‹é™·çš„é—®é¢˜ï¼šå¢åŠ å¯ä¾›è™šæ‹Ÿæœºä¿®æ”¹ä¸­æ–­è€Œæ— éœ€ä¸‹é™·çš„è™šæ‹Ÿå¯„å­˜å™¨</p><p>ç›´æ¥å‘è™šæ‹Ÿæœºå‘é€ä¸­æ–­ï¼šå¢åŠ ä¸€ä¸ªä¸­æ–­ç¿»è¯‘è¡¨ï¼Œç”¨äºå°†ç‰©ç†ä¸­æ–­ç¿»è¯‘ä¸ºè™šæ‹Ÿæœºå¯¹åº”çš„ä¸­æ–­ã€‚å› æ­¤æ— éœ€å†è¿›è¡Œä¸‹é™·ã€‚</p><h2 id="QEMU-KVM">QEMU/KVM</h2><p>ç•¥</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ€è¿‘ç”±äºé¡¹ç›®éœ€è¦å­¦ä¹ è™šæ‹ŸåŒ–çš„çŸ¥è¯†ï¼Œäºæ˜¯åœ¨å¸ˆå…„çš„å»ºè®®ä¸‹è¯»äº† sjtu å‡ºçš„æ–°ä¹¦&lt;a href=&quot;https://ipads.se.sjtu.edu.cn/ospi/&quot;&gt;ã€Šæ“ä½œç³»ç»ŸåŸç†ä¸å®è·µã€‹&lt;/a&gt;ä¸­çš„ç³»ç»Ÿè™šæ‹ŸåŒ–çš„éƒ¨åˆ†ï¼Œéšä¾¿è®°ç‚¹ç¬”è®°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è™šæ‹ŸåŒ–å‘å±•</summary>
      
    
    
    
    <category term="Knowledge" scheme="http://blog.vollate.top/categories/Knowledge/"/>
    
    
    <category term="Notes" scheme="http://blog.vollate.top/tags/Notes/"/>
    
    <category term="OS" scheme="http://blog.vollate.top/tags/OS/"/>
    
  </entry>
  
  <entry>
    <title>æŠ˜è…¾ç½‘ç«™è®°å½•</title>
    <link href="http://blog.vollate.top/2023/11/13/build-site/"/>
    <id>http://blog.vollate.top/2023/11/13/build-site/</id>
    <published>2023-11-13T09:22:25.000Z</published>
    <updated>2024-09-26T04:58:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>åŸæ¥çš„ vps åˆ°æœŸäº†ï¼Œä¸æƒ³ç»­è´¹æ–°å¼€äº†ä¸€å°ï¼Œå¿˜äº†å…¨ç³»ç»Ÿå¤‡ä»½ã€‚ç´¢æ€§ blog æ‰”åˆ° github page,ç„¶ååˆæ˜¯ä¸€é¡¿æŠ˜è…¾ã€‚</p><h2 id="Github-Action-æ ·ä¾‹">Github Action æ ·ä¾‹</h2><p>æ”¹äº†æ”¹ Hexo å®˜ç½‘çš„:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Blog</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">main</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">pages:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">permissions:</span></span><br><span class="line">      <span class="attr">contents:</span> <span class="string">write</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">submodules:</span> <span class="literal">true</span>   </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="number">18.</span><span class="string">x</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">&quot;18&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Dependencies</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">peaceiris/actions-gh-pages@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">github_token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">publish_dir:</span> <span class="string">./public</span></span><br></pre></td></tr></table></figure><h2 id="Github-Action-ç¦ç”¨-jekyll-build">Github Action ç¦ç”¨ jekyll build</h2><p>å› ä¸ºè¦ç”¨ <code>peaceiris/actions-gh-pages@v3</code> è¿›è¡Œéƒ¨ç½²ï¼Œä½†æ˜¯ç”¨çš„ Hexo ä¸”å·²ç»åœ¨å…ˆå‰çš„æ“ä½œç¼–è¯‘å®Œæˆï¼Œåªéœ€éƒ¨ç½²åˆ°å¯¹åº”åˆ†æ”¯å³å¯ã€‚</p><p><s>ä¸€å¼€å§‹ä¸çŸ¥é“ debug äº†åŠå¤©</s> è§£å†³æ–¹æ³•åœ¨ä»“åº“é‡Œåˆ›å»ºä¸€ä¸ª<code>.nojekyll</code>æ–‡ä»¶å³å¯, è¿™ä¼šè‡ªåŠ¨ç¦ç”¨ jekyll build è€Œåªæ‰§è¡Œ deploy (éƒ¨ç½²ç¼–è¯‘å¥½çš„æ–‡ä»¶åˆ°å¯¹åº”åˆ†æ”¯)</p><h2 id="ä½¿ç”¨cfåæ— é™redirect">ä½¿ç”¨cfåæ— é™redirect</h2><p>åœ¨ namesilo ä¹°çš„åŸŸåï¼Œçªå‘å¥‡æƒ³è¯•è¯•ç”¨ Cloudflare å…è´¹è®¡åˆ’çš„åŸŸåè§£æï¼ˆ<s>ä¸ºäº†CDN</s>ï¼‰</p><p>é…å®Œåç‚¸äº†ï¼Œhttp è¯·æ±‚è¿”å› 301 å¯¼è‡´æ— é™ redirectï¼ŒæŸ¥äº†ä¸‹åŸå› å¦‚ä¸‹ï¼š</p><blockquote><p>æœåŠ¡å™¨ç«¯ä½¿ç”¨äº†å¼ºåˆ¶HTTPSï¼ŒCloudFlare çš„Flexibleç­–ç•¥åŸç†æ˜¯ï¼šç”¨æˆ·è®¿é—®æ—¶ä½¿ç”¨HTTPSè®¿é—®åˆ°CFçš„èŠ‚ç‚¹ï¼Œç„¶åCFé€šè¿‡HTTPæ–¹å¼å›æºåˆ°ä½ çš„æœåŠ¡å™¨å»è¯»å–æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å¯¹äºä½ çš„æœåŠ¡å™¨æ¥è¯´ï¼ŒCFå°±æ˜¯è®¿å®¢ï¼Œæ‰€ä»¥æœåŠ¡å™¨è¿”å›çš„çŠ¶æ€éƒ½æ˜¯ 301ã€‚è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œå°† SSL ç­–ç•¥è®¾ä¸º Full æˆ–è€… Full(strict) å°±èƒ½è§£å†³ã€‚</p><footer><strong>Vanish</strong><cite><a href="https://vzone.me/897/">vzone.me/897</a></cite></footer></blockquote><h2 id="ä¸è¦ç»™ç½‘ç›˜å¥—-cf-çš„-cdn">ä¸è¦ç»™ç½‘ç›˜å¥— cf çš„ cdn</h2><p>cf çš„ cdn æœ‰å•æ–‡ä»¶100M å¤§å°é™åˆ¶ï¼Œä¸ºäº†ä¸è¢«æ»¥ç”¨ã€‚å†™ dns çš„æ—¶å€™è„‘å­æŠ½äº†ï¼Œç„¶åè™šç©º debug nginx é…ç½®æ–‡ä»¶ã€‚</p><hr><h2 id="ä¸Šå¤§å­¦ä¸Šçš„-jpg"><s><strong>ä¸Šå¤§å­¦ä¸Šçš„.jpg</strong></s></h2><p><img src="fiddle-with-ddl.jpg" alt="ddl fuck you"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åŸæ¥çš„ vps åˆ°æœŸäº†ï¼Œä¸æƒ³ç»­è´¹æ–°å¼€äº†ä¸€å°ï¼Œå¿˜äº†å…¨ç³»ç»Ÿå¤‡ä»½ã€‚ç´¢æ€§ blog æ‰”åˆ° github page,ç„¶ååˆæ˜¯ä¸€é¡¿æŠ˜è…¾ã€‚&lt;/p&gt;
&lt;h2 id=&quot;Github-Action-æ ·ä¾‹&quot;&gt;Github Action æ ·ä¾‹&lt;/h2&gt;
&lt;p&gt;æ”¹äº†æ”¹ Hexo å®˜ç½‘çš„:&lt;/p&gt;
&lt;</summary>
      
    
    
    
    <category term="Journal" scheme="http://blog.vollate.top/categories/Journal/"/>
    
    
    <category term="Blog" scheme="http://blog.vollate.top/tags/Blog/"/>
    
    <category term="CI/CD" scheme="http://blog.vollate.top/tags/CI-CD/"/>
    
  </entry>
  
  <entry>
    <title>More Effecitve C++</title>
    <link href="http://blog.vollate.top/2023/11/08/more-effecitve-cpp/"/>
    <id>http://blog.vollate.top/2023/11/08/more-effecitve-cpp/</id>
    <published>2023-11-08T08:21:57.000Z</published>
    <updated>2024-05-10T18:01:09.000Z</updated>
    
    <content type="html"><![CDATA[<ul><li>ä¸èƒ½ç›´æ¥å¾€æ•°ç»„ç±»å®¹å™¨å¡å¤šæ€ç±»ï¼Œä½¿ç”¨æŒ‡é’ˆï¼›ä¸€å®šè¦å¼•ç”¨çš„æƒ…å†µä¸‹ï¼ˆéœ€è¦<code>operator()</code>ï¼‰ç”¨std::reference</li><li>ç›´æ¥åˆ›å»ºæ•°ç»„æˆ–ç”¨vector,arrayç­‰å®¹å™¨é¢„å…ˆåˆ†é…å¤§å°æ—¶è°ƒç”¨ç±»çš„æ— å‚(é»˜è®¤)æ„é€ å‡½æ•°ï¼Œå› æ­¤å¦‚æœç”¨äº†explictè®°å¾—å£°æ˜æ— å‚æ„é€ å‡½æ•°</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ²¡æœ‰æ— å‚æ„é€ å‡½æ•°è§£æ³•ï¼ˆåˆ«ç”¨ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ex</span>;</span><br><span class="line"><span class="type">void</span>* ptr=<span class="keyword">operator</span> <span class="keyword">new</span>[](<span class="number">10</span>*<span class="built_in">sizeof</span>(Ex));</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i!=<span class="number">10</span>;++i)</span><br><span class="line">    <span class="keyword">new</span> (&amp;ptr[i]) <span class="built_in">Ex</span>(...);<span class="comment">//call constructor</span></span><br><span class="line"><span class="comment">//Free memory</span></span><br><span class="line"><span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(ptr)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>custom <code>i++&amp;++i</code> for class</li></ul><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">foo</span>;</span><br><span class="line"><span class="type">int</span> foo <span class="keyword">operator</span>++();<span class="comment">//++i</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> foo <span class="keyword">operator</span>++(<span class="type">int</span>);<span class="comment">//i++</span></span><br></pre></td></tr></table></figure><ul><li>å°½å¯èƒ½ä¸é‡è½½ <code>&amp;&amp;</code>,<code>||</code> and <code>,</code>ï¼Œå› ä¸ºä¸æ»¡è¶³çŸ­è·¯é€»è¾‘</li><li>æœ‰å…³<code>new</code>, <code>new[]</code>,<code>delete</code>,<code>delete[]</code><ul><li>newæ—¶ï¼Œå…ˆè°ƒç”¨<code>void* operator new(size_t size)</code>åˆ†é…å†…å­˜,ç„¶ååˆå§‹åŒ–å¯¹è±¡å¹¶ä¸”å°†<code>void*</code>è½¬å‹ä¸ºå¯¹åº”ç±»å‹æŒ‡é’ˆ</li><li>operator new çš„ä¸€ä¸ªé‡è½½:<code>void* operator new(size_t size, void* loaction)</code> å®šä½newå®ç°</li><li>deleteæ—¶ï¼Œå…ˆè°ƒç”¨ææ„å‡½æ•°ç„¶å<code>operator delete</code> é‡Šæ”¾å†…å­˜</li><li>å¯¹æ•°ç»„:<ul><li>new []è°ƒç”¨<code>operator new[]()</code>åˆ†é…å†…å­˜,ç„¶åä¸ºæ¯ä¸ªå¯¹è±¡è°ƒç”¨æ„é€ å‡½æ•°</li><li>delete[]åŒç†</li></ul></li></ul></li><li>æ„é€ å‡½æ•°å¼‚å¸¸å¤„ç†(æœªå®Œå…¨æ„é€ å‡½æ•°ä¸ä¼šæ ˆè§£é€€è‡ªåŠ¨ææ„):<ul><li>ä½¿ç”¨try catchè¿›è¡Œæ¸…ç†</li><li>é˜²æ­¢æˆå‘˜åˆ—è¡¨åˆå§‹åŒ–const pointerå¼‚å¸¸å¯¼è‡´èµ„æºæ³„æ¼çš„æ–¹æ³•(æœªå®Œå…¨æ„é€ æŒ‡é’ˆæ— æ³•ä½¿ç”¨delete):<ul><li>è°ƒç”¨ä¸€ä¸ªbasic exception guaranteeçš„å‡½æ•°</li><li>ä½¿ç”¨RAIIç±»</li></ul></li></ul></li><li>å¼‚å¸¸<ul><li>å¼‚å¸¸æ ˆè§£é€€æ—¶è°ƒç”¨ææ„å‡½æ•°å†æŠ›å‡ºå¼‚å¸¸å°†ä¼šå¯¼è‡´ç¨‹åºç›´æ¥ç»ˆæ­¢(call terminate directly kill program)</li><li>å¼‚å¸¸æ‹·è´æ—¶æŒ‰ç…§é™æ€ç±»å‹æ‹·è´(æ´¾ç”Ÿç±»çš„åŸºç±»å¼•ç”¨æ‹·è´ä¸ºåŸºç±»)</li><li>å¼‚å¸¸æ•è·çš„æ”¯æŒéšå¼è½¬å‹(æŒ‰æŒ‡):<ul><li>ä»»ä½•æŒ‡é’ˆto <code>void*</code>(æå…¶ä¸å»ºè®®ç”¨æŒ‡é’ˆ)</li><li>æ´¾ç”Ÿç±»è½¬åŸºç±»</li></ul></li><li>æ€»æ˜¯æŒ‰catchå…ˆåé¡ºåºæ•è·</li><li>æŒ‰å¼•ç”¨æ•è·å¯ä»¥å®ç°å¤šæ€</li></ul></li><li>Improve proformance:<ul><li>lazy evaluation: è¿”å›ä¸€ä¸ªç»“æœçš„ä»£ç†ç±»ï¼Œåªæœ‰åœ¨éœ€è¦æ—¶æ‰è¿›è¡Œè®¡ç®—</li><li>lazy copyï¼š å†™æ—¶å¤åˆ¶</li><li>lazy fetchï¼šæ¶‰åŠåˆ°æ•°æ®åº“çš„éƒ¨åˆ†</li><li>over-eager evaluationï¼šæå‰è®¡ç®—å¹¶å­˜å…¥ç¼“å­˜ï¼Œæˆ–constexprç¼–è¯‘æœŸè®¡ç®—</li></ul></li><li>ä¸´æ—¶å¯¹è±¡: ä»…åœ¨æŒ‰å€¼ä¼ é€’å¯¹è±¡æˆ–è€…ä¼ é€’å¸¸é‡å¼•ç”¨å‚æ•°æ—¶äº§ç”Ÿã€‚è¿”å›å¯¹è±¡æ—¶ï¼Œè‹¥ç›´æ¥è¿”å›åˆ™ä¼šæ‹·è´å±€éƒ¨å¯¹è±¡</li><li>è¿”å›å€¼ä¼˜åŒ–: è¿”å›æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œè¿™æ ·è¿”å›çš„å¯¹è±¡ä¼šåœ¨è¿”å›çš„ä½œç”¨åŸŸæ„é€ (ç¼–è¯‘å™¨ä¼˜åŒ–)</li><li>åˆ¤æ–­ç±»æ˜¯å¦åœ¨å †ä¸­(ä¸ºäº†ç¡®å®šèƒ½å¦è°ƒç”¨<code>delete this</code>)ï¼šé‡è½½<code>operator new,operator new[]</code>,è®°å½•è¿”å›çš„æŒ‡é’ˆåˆ°ä¸€ä¸ªå›¾ä¸­ï¼Œæ¯æ¬¡åˆ é™¤å‰è¿›è¡ŒæŸ¥æ‰¾æ˜¯å¦åœ¨å †ä¸Š</li><li>é€‚å½“ä½¿ç”¨ä»£ç†å¯ä»¥ç®€åŒ–æµç¨‹ï¼Œä½†æ˜¯ä¼šåœ¨éšå¼è½¬å‹çš„åœ°æ–¹å‡ºé”™</li><li>ç±»å‹æ“¦é™¤:ä½¿ç”¨è™šåŸºç±»(æ¥å£)</li><li>double dispatch:(é’ˆå¯¹ä¸åŒåŠ¨æ€ç±»å‹çš„å¤šä¸ªobjectäº§ç”Ÿä¸åŒå‰¯ä½œç”¨)<ul><li>è™šå‡½æ•° + RTTIï¼šæ— å°è£…ï¼Œå¯ç»´æŠ¤æ€§ä¸º0</li><li>å¤šé‡è™šå‡½æ•°è°ƒç”¨: ç±»ä¼¼æ¨¡æ¿é€’å½’å±•å¼€çš„æ‰‹åŠ¨å®ç°ï¼Œæ¯æ¬¡ç¡®å®šä¸€ä¸ªç±»å‹ï¼Œç„¶åè°ƒç”¨ä¸‹ä¸€ä¸ªè™šå‡½æ•°</li><li>æ‰‹åŠ¨å®ç°è™šå‡½æ•°è¡¨</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;ä¸èƒ½ç›´æ¥å¾€æ•°ç»„ç±»å®¹å™¨å¡å¤šæ€ç±»ï¼Œä½¿ç”¨æŒ‡é’ˆï¼›ä¸€å®šè¦å¼•ç”¨çš„æƒ…å†µä¸‹ï¼ˆéœ€è¦&lt;code&gt;operator()&lt;/code&gt;ï¼‰ç”¨std::reference&lt;/li&gt;
&lt;li&gt;ç›´æ¥åˆ›å»ºæ•°ç»„æˆ–ç”¨vector,arrayç­‰å®¹å™¨é¢„å…ˆåˆ†é…å¤§å°æ—¶è°ƒç”¨ç±»çš„æ— å‚(é»˜è®¤)æ„é€ å‡½æ•°ï¼Œå› æ­¤å¦‚æœç”¨</summary>
      
    
    
    
    <category term="Knowledge" scheme="http://blog.vollate.top/categories/Knowledge/"/>
    
    
    <category term="Notes" scheme="http://blog.vollate.top/tags/Notes/"/>
    
    <category term="C++" scheme="http://blog.vollate.top/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>CPP éšç¬”</title>
    <link href="http://blog.vollate.top/2023/11/03/cpp-essay/"/>
    <id>http://blog.vollate.top/2023/11/03/cpp-essay/</id>
    <published>2023-11-03T03:20:31.000Z</published>
    <updated>2024-05-10T18:01:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•cppç¼–ç¨‹è¿‡ç¨‹ä¸­çš„ä¸€äº›æ€»ç»“</p><h2 id="clang-libstdc-debug-é—®é¢˜">clang + libstdc++ debug é—®é¢˜</h2><p>ä¼—æ‰€å‘¨çŸ¥ LLVM çš„ <code>libc++</code> å’Œ GNU çš„ <code>libstdc++</code> æ˜¯ä¸¤ä¸ªä¸åŒçš„æ ‡å‡†åº“å®ç°ã€‚è™½ç„¶ä½¿ç”¨ clang + libstdc++ ç¼–è¯‘ä¹Ÿå¯ä»¥ä½¿ç”¨ LLDB å¯¹ç¨‹åºè¿›è¡Œ debugï¼Œä½†æ˜¯å­—ç¬¦ä¸²ä»¥åŠä¸€äº›æ•°æ®ç»“æ„å¦‚ <code>unordered_map</code> æ— æ³•æ­£ç¡®æ˜¾ç¤ºå€¼ã€‚è§£å†³æ–¹å¼:</p><ol><li>ä½¿ç”¨ç¼–è¯‘é€‰é¡¹ â€œ-fstandalone-debugâ€</li><li>åœ¨ç¼–è¯‘å’Œé“¾æ¥æ—¶æ¢ä¸º <code>libc++</code>, cmake ä¸­å¯ä»¥ä½¿ç”¨ <code>set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -stdlib=libc++&quot;)</code> æ¥è§£å†³ã€‚</li></ol><p>cheatsheet: cmake ä¸­åˆ‡æ¢åˆ° llvm å…¨å¥— C++ å·¥å…·é“¾</p><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&quot;$&#123;CMAKE_CXX_COMPILER_ID&#125;&quot;</span> <span class="keyword">STREQUAL</span> <span class="string">&quot;Clang&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;-stdlib=libc++&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_EXE_LINKER_FLAGS <span class="string">&quot;-fuse-ld=lld&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span> ()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è®°å½•cppç¼–ç¨‹è¿‡ç¨‹ä¸­çš„ä¸€äº›æ€»ç»“&lt;/p&gt;
&lt;h2 id=&quot;clang-libstdc-debug-é—®é¢˜&quot;&gt;clang + libstdc++ debug é—®é¢˜&lt;/h2&gt;
&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥ LLVM çš„ &lt;code&gt;libc++&lt;/code&gt; å’Œ GNU çš„ &lt;code&gt;libs</summary>
      
    
    
    
    <category term="Knowledge" scheme="http://blog.vollate.top/categories/Knowledge/"/>
    
    
    <category term="Notes" scheme="http://blog.vollate.top/tags/Notes/"/>
    
    <category term="C++" scheme="http://blog.vollate.top/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>Effective C++</title>
    <link href="http://blog.vollate.top/2023/10/05/effective-cpp/"/>
    <id>http://blog.vollate.top/2023/10/05/effective-cpp/</id>
    <published>2023-10-05T08:03:48.000Z</published>
    <updated>2024-05-10T18:01:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»vimwikiè¿ç§»è¿‡æ¥çš„å¤æ—©ç¬”è®°,ä»”ç»†çœ‹çœ‹å‘ç°å¥½å¤šå¿˜äº†(</p><pre><code>Items from 1 to 55</code></pre><hr><ol><li><p>å°†cppçœ‹ä½œCï¼Œé¢å‘å¯¹è±¡çš„cppï¼Œæ¨¡æ¿å’ŒSTLå››ä¸ªéƒ¨åˆ†ï¼›æ ¹æ®å„ä¸ªéƒ¨åˆ†çš„ä¸åŒç‰¹æ€§é€‰æ‹©ä¸åŒçš„ç¼–ç¨‹æ–¹å¼</p></li><li><p>èƒ½ç”¨constï¼Œenumï¼Œinlineå°±åˆ«#define</p></li><li><p>èƒ½ç”¨constå°±ç”¨const</p></li><li><p>ç¡®ä¿ç±»åˆå§‹åŒ–åå†ä½¿ç”¨</p><ul><li>å°½å¯èƒ½ä½¿ç”¨åˆ—è¡¨åˆå§‹åŒ–(åŸå› :operator= first call classâ€™s default consturctor to allocate memory and get address, then do variable assigment)</li><li>é¿å…åˆå§‹åŒ–é¡ºåºé—®é¢˜ï¼ˆæœ‰å…³staticåˆå§‹åŒ–çš„é—®é¢˜ï¼‰</li></ul></li><li><p>çŸ¥é“é»˜è®¤æ„é€ ï¼Œææ„ï¼Œå¤åˆ¶æ„é€ å‡½æ•°</p><ul><li>ä¸€æ—¦åˆ›å»ºç§»åŠ¨æ„é€ ||ç§»åŠ¨èµ‹å€¼æ“ä½œç¬¦ï¼Œä¸ä¼šç”Ÿæˆé»˜è®¤å¤åˆ¶æ„é€ &amp;&amp;å¤åˆ¶è¿ç®—ç¬¦ï¼Œåä¹‹äº¦ç„¶</li></ul></li><li><p>å°å¿ƒä½¿ç”¨é»˜è®¤ç”Ÿæˆçš„ç±»å‡½æ•°</p></li><li><p>è‹¥è¦ä½¿ç”¨å¤šæ€ï¼Œåˆ™åº”å°†åŸºç±»ææ„å‡½æ•°å®šä¹‰ä¸ºvirtual</p></li><li><p>ä¸è¦è®©å¼‚å¸¸ç¦»å¼€ææ„å‡½æ•°</p></li><li><p>ä¸è¦åœ¨æ„é€ å’Œææ„å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°</p><ul><li>ä¹Ÿä¸æ˜¯ä¸èƒ½ç”¨ï¼Œæ³¨æ„ç”¨çš„æ—¶å€™çš„ç±»å‹æ˜¯åŸºç±»è¿˜æ˜¯æ´¾ç”Ÿç±»ï¼ˆå®¹æ˜“å‡ºé—®é¢˜æ‰€ä»¥ä¸å»ºè®®ç”¨ï¼‰</li></ul></li><li><p>é‡è½½è¿ç®—ç¬¦å»ºè®®è¿”å›*thisä»¥ä¾¿è¿ç­‰åŠå…¶å®ƒæ“ä½œ</p></li><li><p>é‡è½½æ“ä½œç¬¦æ—¶è¦è€ƒè™‘è‡ªå·±å¯¹è‡ªå·±æ“ä½œçš„æƒ…å†µ</p><ul><li>å¤„ç†æ–¹æ³•ï¼š<ol><li>å…ˆåˆ¤æ–­åœ°å€</li><li>æ‹·è´åæ“ä½œæ‹·è´</li></ol></li></ul></li><li><p>æ‹·è´ï¼ˆå¤åˆ¶è¿ç®—ç¬¦ï¼‰è¦å®Œå…¨å¤åˆ¶ç±»çš„å†…å®¹ï¼ˆåŒ…æ‹¬åŸºç±»çš„ï¼‰</p><ul><li>è¦å¤ç”¨ä»£ç ï¼Œä¸è¦ç›¸äº’è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°ï¼Œè€Œæ˜¯å…±åŒè°ƒç”¨ä¸€ä¸ªä¸‰æ–¹å‡½æ•°</li></ul></li><li><p>RAII: use class to manage resource(<code>unique_ptr &amp; share_ptr</code>)</p></li><li><p>RAII object have specified copy function</p></li><li><p>è®¿é—®RAII classæ•°æ®ï¼š</p><ul><li>éšå¼ï¼šæ›´æ–¹ä¾¿</li><li>æ˜¾ç¤ºï¼šæ›´å®‰å…¨</li></ul></li><li><p>æˆå¯¹ä½¿ç”¨å¯¹åº”çš„ <code>new([])</code> &amp; <code>delete([])</code></p></li><li><p>å•ç‹¬åˆ›å»ºæ™ºèƒ½æŒ‡é’ˆ<br><code>eg: A(std::unique_ptr&lt;B&gt;(new B), fuc())</code></p><ul><li>æ™ºèƒ½æŒ‡é’ˆåˆ›å»ºéœ€è¦æ¥å— <code>new</code> è¿”å›çš„åœ°å€ï¼Œè€Œç±»æ„é€ å‡½æ•°æ‰§è¡Œé¡ºåºç”±ç¼–è¯‘å™¨å†³å®šï¼Œå¦‚æœ<code>fuc</code> throw exception,ä¼šå¯¼è‡´å†…å­˜æ³„æ¼</li></ul></li><li><p>è®¾è®¡è‰¯å¥½çš„interface</p><ul><li>å°½å¯èƒ½ä¸è®©ç”¨æˆ·å†™å‡ºå‡ºé”™ä»£ç </li><li>å‡å°‘ç”¨æˆ·ç¢°åˆ°ç®¡ç†å†…å­˜çš„å‡ ç‡</li><li>shared_ptræ€»æ˜¯ä½¿ç”¨æŒ‡å‘ç±»çš„ææ„å‡½æ•°ï¼Œå¯ä»¥é˜²æ­¢cross-DLL(object creat in a dynamic link library but delete in a differet DLL)</li></ul></li><li><p>å®šä¹‰ç±»å°±æ˜¯å®šä¹‰ç±»å‹ï¼Œå…³æ³¨ä¸€äº›ç»†èŠ‚</p></li><li><p>å°½é‡ä¼ const&amp;,å¯¹åŸºç¡€ç±»å‹ç›´æ¥ä¼ å€¼(iteratorå®ç°æ˜¯æŒ‡é’ˆï¼Œä¹Ÿç®—)</p></li><li><p>ä¸è¦è¿”å›æŒ‡å‘æœ¬åœ°ä¸´æ—¶å˜é‡çš„æŒ‡é’ˆ</p></li><li><p>å¯¹ç”¨æˆ·éšè—æ•°æ®ï¼Œprotectedæ²¡æ¯”publicåŒ…è£…å¥½åˆ°å“ªå»</p></li><li><p>ä¸ç”¨è®¿é—®dataçš„å°±åˆ«ææˆæˆå‘˜å‡½æ•°</p></li><li><p>ç±»å‹è½¬æ¢éœ€è¦éæˆå‘˜å‡½æ•°(<code>friend</code>)</p></li><li><p>åˆ›å»ºåˆé€‚çš„swapå‡½æ•°ï¼š</p><ul><li>é»˜è®¤çš„std::swapæ‰§è¡Œä¸‰æ¬¡æ‹·è´æ„é€ -&gt;è§£å†³æ–¹æ¡ˆï¼šæ„é€ wapperç±»ä½¿ç”¨æŒ‡é’ˆæ¥å­˜å‚¨æ•°æ®ï¼Œäº¤æ¢ä»…äº¤æ¢æŒ‡é’ˆï¼Œå¹¶ä¸”æä¾›publicçš„swapæˆå‘˜å‡½æ•°</li><li>å¦‚æœè¯¥ç±»ä¸æ˜¯æ¨¡æ¿ç±»ï¼Œéœ€è¦å…·ä½“åŒ–std::swapç»™è¯¥ç±»;å¦‚æœè¯¥ç±»æ˜¯æ¨¡æ¿ç±»åˆ™åœ¨namespaceä¸­é‡å†™swapï¼ˆæ¨¡æ¿å‡½æ•°ï¼‰</li><li>è°ƒç”¨è§„åˆ™ï¼šusing <em>+ using std::swapï¼Œè°ƒç”¨ä¼˜å…ˆçº§ä¸º æ¨¡æ¿swap&gt;å…·ä½“åŒ–std::swap&gt;std::swap,å› æ­¤è®°å¾—using</em> å’Œusing std::swap</li></ul></li><li><p>å°½å¯èƒ½å»¶ç¼“å˜é‡çš„å®šä¹‰ï¼ˆçœ‹æƒ…å†µè€Œå®šï¼‰å¥½å¤„ï¼š<br>- é¿å…æ— ç”¨å˜é‡æ„é€ æ¶ˆè€—æ—¶é—´ï¼ˆthrowä¼šå¯¼è‡´æ— ç”¨<br>- ä¼˜åŒ–é»˜è®¤æ„é€ +å¤åˆ¶æ„é€ ä¸ºå¤åˆ¶æ„é€ </p></li><li><p>å°½å¯èƒ½ä¸ç”¨castï¼Œå°¤å…¶dynamic_castï¼›å¿…é¡»è¦ç”¨ï¼Œå®šä¹‰å‡½æ•°æ¥éšè—castï¼ˆå°½é‡é¿å…ç”¨æˆ·è‡ªå·±castï¼‰ï¼›å°‘ç”¨cç±»å‹çš„è½¬å‹, c++å››ç§cast</p><ul><li>const_cast</li><li>dynamic_cast</li><li>reinterpret_cast</li><li>static_cast<ul><li>static_castå­ç±»è½¬æˆçˆ¶ç±»æ—¶æ˜¯äº§ç”Ÿä¸€ä¸ªå­ç±»ä¸­çˆ¶ç±»çš„ä¸´æ—¶æ‹·è´ï¼Œä¿®æ”¹ä¸ä¼šæ˜ å°„åˆ°åŸå­˜å‚¨</li></ul></li></ul><blockquote><p>castè¦å°å¿ƒï¼Œææ¸…æ¥šè‡ªå·±çš„ç›®çš„</p></blockquote></li><li><p>å°½å¯èƒ½é¿å…è¿”å›å¥æŸ„[å¼•ç”¨å’ŒæŒ‡é’ˆ]</p><ul><li>æŒ‡å‘æ ˆä¸­ä¸´æ—¶å˜é‡ä¼šå¯„æ‰</li></ul></li><li><p>exception safety:</p><ul><li>No resource leak</li><li>No data structures become coorupted</li></ul><p>exception safety function:</p><ol><li>Basic guarantee: after throw, everything in program remain valid</li><li>Strong guarantee: after exception, the program status remain as if the fuction is never called</li><li>Nothrow guarantee: never throw exception(hard to guarantee out of C part in C++)</li></ol><ul><li>Strong guarantee implement: make a copy and modify the copy, then swap them in noexception way(But this need more resource and time, though itâ€™s highly recommand, not always need to provide strong guarantee)</li><li>ä¸€èˆ¬å‡½æ•°éœ€è¦æä¾›è‡³å°‘è¦æœ‰weak exception guarantee(at least no resource leak)</li></ul></li><li><p>inline function rules:</p><ul><li>limit inline function as small, frequently called functions.</li><li>å†…è”åˆ«ç”¨æ¨¡æ¿<br>å…¶å®ƒä¸€äº›ä¸œè¥¿ï¼š<ul><li>ä¸€èˆ¬æ„é€ å’Œææ„å‡½æ•°ä¸æ˜¯å†…è”</li><li>èƒ½ä¸èƒ½å†…è”ä¸»è¦çœ‹ç¼–è¯‘å™¨</li></ul></li></ul></li><li><p>æœ€å°åŒ–ç¼–è¯‘ä¾èµ–å…³ç³»ï¼ˆé€šè¿‡å£°æ˜ï¼‰å¯ä»¥ä½¿ç”¨ï¼š</p><ol><li>handle class</li><li>interface class: increase memory cost for virtual function table<br>ç¼–è¯‘æ—¶åªéœ€è¦é‡æ–°é“¾æ¥å‡½æ•°å°±è¡Œ</li></ol></li><li><p>public inheritance means â€œis aâ€(noted that only public do this)</p></li><li><p>ç»§æ‰¿ä¼šéšè—çˆ¶ç±»ï¼ˆä½œç”¨åŸŸï¼‰çš„å˜é‡å’Œå‡½æ•°ï¼ˆå½“ç„¶åç§°ç©ºé—´ä¹Ÿä¼š{ä½¿ç”¨usingè§£é™¤éšè—</p></li><li><p>pure virtual function; virtual function;non-virtual function; ä¸è¦æ‹…å¿ƒè™šå‡½æ•°å¸¦æ¥çš„æŸè€—ï¼ˆå¤§å¤šæ•°æƒ…å†µï¼‰ï¼Œä¹Ÿä¸è¦å…¨æ˜¯è™šå‡½æ•°ï¼ˆä¸€æ ·ï¼‰</p><ul><li>pure virtual functionå¯ä»¥åœ¨ç±»å¤–æä¾›å®ç°ï¼Œå¦‚æ­¤å¯ä»¥å¼ºåˆ¶å­ç±»é‡å†™ï¼ˆç®—æ˜¯å¼ºåˆ¶æ³¨æ„å§ï¼‰å¹¶å‡å°‘ä»£ç é‡å¤</li><li>80~20rule:80% running time spend on 20% code</li></ul></li><li><p>ä½¿ç”¨none virtual interface idiom åœ¨åŸºç±»ä»¥ç¡®ä¿å¤šæ€åœ¨ä½•æ—¶è°ƒç”¨å‡½æ•°</p><ul><li>ä½¿ç”¨å‡½æ•°æŒ‡é’ˆæˆå‘˜ä»£æ›¿è™šå‡½æ•°ï¼ˆå¥½å¤„ï¼šå¯ä»¥æ›´æ”¹è°ƒç”¨çš„å‡½æ•°(åå¤„ï¼šç¼ºå°‘å¯¹épublicå˜é‡çš„è®¿é—®æƒé™</li><li>ä½¿ç”¨std::functionæˆå‘˜ä»£æ›¿è™šå‡½æ•°</li></ul></li><li><p>é‡å®šä¹‰éè™šå‡½æ•°å¯èƒ½ä¼šä½¿å¾—å¤šæ€å‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜(ä»è®¾è®¡ä¸Šæ¥è¯´å°±ä¸åº”è¯¥é‡å®šä¹‰éè™šå‡½æ•°)</p></li><li><p>é»˜è®¤å‚æ•°å€¼ä¸ºé™æ€ç»‘å®šï¼Œä¸åŒäºè™šå‡½æ•°çš„åŠ¨æ€ç»‘å®šï¼Œä¸è¦åœ¨ç»§æ‰¿ä¸­æ”¹å˜é»˜è®¤å€¼</p></li><li><p>has a &amp; implemented in terms of-- composition</p></li><li><p>private inheritanceå½“ä»…å¿…è¦æ—¶<br>- both private inheritance and composition mean is-implemented-in-terms-of<br>- composition is easy to understand<br>- private inheritance can enable EBO<br>- empty base optomize(EBO):å½“ä»…å•ç»§æ‰¿ä¸”çˆ¶ç±»æ˜¯ç©ºç±»æ—¶ï¼Œå­ç±»å¤§å°ç­‰äºæ•°æ®å¤§å°(ç¼–è¯‘å™¨ä¼˜åŒ–</p></li><li><p>å¤šç»§æ‰¿å°½é‡åˆ«ç”¨ï¼Œç”¨è¦è€ƒè™‘virtual</p><ul><li>è™šæ‹Ÿç»§æ‰¿æœ‰æŸè€—ï¼ˆæ¯”èµ·å•ç»§æ‰¿</li><li>å¤šç»§æ‰¿ä¾‹å­ï¼špublic interface+private implementation</li></ul></li><li><p>ç±»å’Œæ¨¡æ¿éƒ½æ”¯æŒå¤šæ€</p><ul><li>å¯¹äºç±»ï¼Œæ¥å£æ˜¯æ˜ç¡®çš„ï¼Œå¤šæ€å‡ºç°åœ¨è¿è¡Œæ—¶</li><li>å¯¹äºæ¨¡æ¿å‚æ•°ï¼Œæ¥å£æ˜¯æ˜ç¡®ä¸”åŸºäºåˆæ³•çš„è¡¨è¾¾å¼çš„ï¼Œå¤šæ€å‡ºç°åœ¨ç¼–è¯‘æ—¶ï¼ˆé€šè¿‡æ¨¡æ¿åˆå§‹åŒ–å’Œå‡½æ•°é‡è½½ï¼‰</li></ul></li><li><p>typenameå’Œclasså¯ä»¥äº’æ¢</p><ul><li>åœ¨ä¸æ¸…æ¥šçš„æƒ…å†µä¸‹ï¼ŒC++é»˜è®¤æŠŠtypename(class):ğŸ˜—**çœ‹æˆå˜é‡è€Œä¸æ˜¯ç±»å‹ï¼Œä½¿ç”¨ <code>typename</code> å‘Šè¯‰ä»–è¿™æ˜¯ä¸ªå˜é‡ç±»å‹</li></ul></li><li><p>è®¿é—®æ¨¡æ¿åŸºç±»å‡½æ•°çš„ä¸‰ç§æ–¹æ³•</p><ol><li>ä½¿ç”¨ <code>this</code> æŒ‡é’ˆè°ƒç”¨</li><li><code>using</code> æŒ‡ä»¤</li><li><code>base&lt;T&gt;::**</code>ç›´æ¥ç”¨</li></ol></li><li><p>æ¨¡æ¿éšå¼å…·ä½“åŒ–å‡ºçš„ä¸ä¾èµ–äºæ¨¡æ¿å‚æ•°çš„å‡½æ•°ä¼šå¯¼è‡´ç¨‹åºè†¨èƒ€</p><ul><li>è‹¥ç”±éç±»å‹å‚æ•°å¯¼è‡´ï¼Œå°†æ¨¡æ¿å‚æ•°æ¢ä¸ºå‡½æ•°å‚æ•°æˆ–è€…ç±»æˆå‘˜å˜é‡</li><li>è‹¥ç”±ç±»å‹å‚æ•°å¯¼è‡´ï¼Œå¯ä»¥å°†æ•°æ®è½¬åŒ–ä¸º æ— ç±»å‹æŒ‡é’ˆ <code>eg: static_cast&lt;void*&gt;</code> ç„¶åç»Ÿä¸€è°ƒç”¨</li></ul></li><li><p>åœ¨æ¨¡æ¿ç±»ä¸­ä½¿ç”¨æ¨¡æ¿æˆå‘˜å‡½æ•°æ¥æ¥å—æ‰€æœ‰åˆæ³•å‚æ•°</p><ul><li>eg: åŒæ¨¡æ¿ä¸åŒå…·ä½“åŒ–ç±»çš„å®ä¾‹åŒ–çš„å¤åˆ¶æ„é€ å‡½æ•°å’Œå¤åˆ¶è¿ç®—ç¬¦</li><li>æ³¨æ„ï¼šå³ä½¿å£°æ˜äº†æ¨¡æ¿å¤åˆ¶æ„é€ å‡½æ•°ï¼Œä¹Ÿè¦å£°æ˜ä¸€èˆ¬çš„å¤åˆ¶æ„é€ å‡½æ•°</li></ul></li><li><p>æˆ‘ä¸çŸ¥é“ä»–æƒ³è¯´æ˜å•¥</p></li><li><p>ç‰¹åŒ–æ¨¡æ¿ç±»ä½¿å…¶å¯¹ç‰¹å®šç±»å‹ä½¿ç”¨ç‰¹å®šå‡½æ•°</p><ul><li>é€šè¿‡ <code>tyepid()</code> æ£€æŸ¥â€”wrong, canâ€™t compile<ul><li>ç”±äºä¸åŒçš„ç±»å‹æ”¯æŒä¸åŒçš„å‡½æ•°ï¼Œä¸€äº›ä¸æ”¯æŒçš„å‡½æ•°æ— æ³•è¢«ç¼–è¯‘ï¼ˆå³ä½¿<code>if else</code>æ°¸è¿œä¸ä¼šè¿›å…¥)ç¼–è¯‘è¿‡ç¨‹è¦æ±‚æ‰€æœ‰ä»£ç åˆæ³•</li></ul></li><li>é€šè¿‡å’Œå‡½æ•°é‡è½½(ç¼–è¯‘æ—¶)</li></ul></li><li><p>TMP(template metaprogramming)</p><ul><li>å°†ä¸€éƒ¨åˆ†è¿è¡Œæ—¶å·¥ä½œæ”¾åˆ°ç¼–è¯‘æ—¶è¿›è¡Œ</li></ul></li><li><p>é€šè¿‡ <code>set_new_handler(*new_handler)</code> è‡ªå®šä¹‰newçš„è¡Œä¸º <code>typedef void (*new_handler)()</code> declear in std, use as <code>std::new_handler</code></p><ul><li>é€šè¿‡è¿é”è°ƒç”¨åœ¨å¤±è´¥åå°è¯•å…¶ä»– <code>handler</code> åˆ†é…å†…å­˜ï¼Œæœ€åå…¨éƒ¨å¤±è´¥å†throw bad_alloc</li><li>è‡ªå®šä¹‰ç±»newçš„è¡Œä¸º: modify <code>void* operator new(std::size)throw(std::bad_alloc)</code> and <code>set_new_handler</code></li><li>C++93å‰newåˆ†é…å¤±è´¥ä¼šè¿”å›0ï¼Œä½¿ç”¨ <code>new(std::nothrow)</code> æ¥å¯ç”¨è¿™ä¸€è¡Œä¸ºï¼ˆåªä½œç”¨äºå†…å­˜åˆ†é…æ—¶ï¼Œåˆå§‹åŒ–ç›¸å…³å¯¹è±¡ä»å¯èƒ½throw</li></ul></li><li><p>é‡è½½new/deleteæ“ä½œç¬¦çš„å‡ ç§æƒ…å†µ</p><ol><li>ä¼˜åŒ–æ“ä½œé€Ÿåº¦</li><li>æ”¶é›†å†…å­˜ä½¿ç”¨ä¿¡æ¯</li><li>å‡å°‘å¼€å¤´å’Œæœ«å°¾çš„å†…å­˜å ç”¨</li><li>è‡ªå®šä¹‰å†…å­˜å¯¹é½</li><li>å°†ç±»é›†æŸæ‘†æ”¾</li><li>å…¶ä»–æœªåˆ—å‡ºnewè¡Œä¸º</li></ol></li><li><p>é‡è½½newå’Œdelete</p><ul><li>é‡è½½newéœ€è¦ä¸€ä¸ªæ— é™å¾ªç¯æ¥åˆ†é…å†…å­˜ï¼Œå¹¶åœ¨å¤±è´¥æ—¶è°ƒç”¨ <code>set_new_handler</code> æˆ–è€…åˆ†é…0ç©ºé—´å¹¶throw</li><li>å¯¹äºç±»ç±»å‹ï¼Œåº”è¯¥åˆ†é…æ¯”é¢„æœŸæ›´å¤§ç©ºé—´</li><li>deleteå¯¹nullpträ»€ä¹ˆä¹Ÿä¸åšï¼Œå¯¹ç±»ç±»å‹åº”è¯¥åˆ é™¤æ¯”é¢„æœŸæ›´å¤§ç©ºé—´</li></ul></li><li><p>é‡å†™newäº†è®°å¾—é‡å†™deleteï¼Œå¹¶ä¸”ä¸è¦æ— æ„é—´éšè—äº†é»˜è®¤çš„new&amp;delete</p></li><li><p>æ³¨æ„ç¼–è¯‘è­¦å‘Šï¼Œä¹Ÿä¸è¦è¿‡åº¦ä¾èµ–ç¼–è¯‘å™¨</p></li><li><p>ç†Ÿæ‚‰æ ‡å‡†åº“ï¼ŒåŒ…æ‹¬</p><ul><li>STL(standard template library)</li><li>Iostream</li><li>Internationlization(like wchar_t,wstring)</li><li>numeric provessing(valarray, complex)</li><li>exception hierarchy</li><li>C89 standard library</li><li>tr1(2005,Technical report 1), add smartPointers,function pointers(tr1::function,std::function now)å°±æ˜¯std::expermental::xxx</li></ul></li><li><p>Boost organization and Boost library</p></li></ol><hr><p>This is just a begining, C++ learning will never end</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»vimwikiè¿ç§»è¿‡æ¥çš„å¤æ—©ç¬”è®°,ä»”ç»†çœ‹çœ‹å‘ç°å¥½å¤šå¿˜äº†(&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Items from 1 to 55
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å°†cppçœ‹ä½œCï¼Œé¢å‘å¯¹è±¡çš„cppï¼Œæ¨¡æ¿å’ŒSTLå››ä¸ªéƒ¨åˆ†ï¼›æ ¹æ®å„ä¸ªéƒ¨åˆ†çš„ä¸åŒç‰¹æ€§é€‰æ‹©</summary>
      
    
    
    
    <category term="Knowledge" scheme="http://blog.vollate.top/categories/Knowledge/"/>
    
    
    <category term="Notes" scheme="http://blog.vollate.top/tags/Notes/"/>
    
    <category term="C++" scheme="http://blog.vollate.top/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>Book List</title>
    <link href="http://blog.vollate.top/2023/08/30/book-list/"/>
    <id>http://blog.vollate.top/2023/08/30/book-list/</id>
    <published>2023-08-30T07:33:26.000Z</published>
    <updated>2024-03-03T10:46:58.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Reading">Reading</h2><ul><li>C++ Currency in Action</li></ul><h2 id="Schedule">Schedule</h2><ul><li>Effective Modern C++</li><li>C++ Templates ed.2</li></ul><h2 id="Stash">Stash</h2><ul><li>Deep learning</li></ul><h2 id="Finished">Finished</h2><table><thead><tr><th>Name</th><th>Finish date</th></tr></thead><tbody><tr><td>C++ Primer Plus</td><td>2021.12</td></tr><tr><td>Effective C++</td><td>2022.7</td></tr><tr><td>1984</td><td>2022.6</td></tr><tr><td>æ²™ä¸˜</td><td>2022.6</td></tr><tr><td>èµ„æœ¬è®º</td><td>2022.8.1</td></tr><tr><td>åœ°é“ç³»åˆ—(203[3,5])</td><td>2022.9.25</td></tr><tr><td>More Effective C++</td><td>2023.1.22</td></tr><tr><td>The Fast Guide towards Modern C++</td><td>2023.7.15</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Reading&quot;&gt;Reading&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;C++ Currency in Action&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;Schedule&quot;&gt;Schedule&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Effective Modern C++&lt;/li&gt;
</summary>
      
    
    
    
    
    <category term="Books" scheme="http://blog.vollate.top/tags/Books/"/>
    
  </entry>
  
  <entry>
    <title>Tool List</title>
    <link href="http://blog.vollate.top/2023/03/27/tool-list/"/>
    <id>http://blog.vollate.top/2023/03/27/tool-list/</id>
    <published>2023-03-27T00:17:41.000Z</published>
    <updated>2024-07-06T09:56:57.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ”¶å½•äº†Linuxä¸‹ä½¿ç”¨çš„ä¸€äº›å·¥å…·</p></blockquote><h2 id="Screen-Shot-Recorder">Screen Shot/Recorder</h2><ul><li><a href="https://www.maartenbaert.be/simplescreenrecorder/">SimpleScreenRecorder</a></li><li><a href="https://obsproject.com/">OBS studio</a></li><li><a href="https://flameshot.org/">Flameshot</a></li></ul><h2 id="Cloud-Drive">Cloud Drive</h2><ul><li><a href="https://github.com/abraunegg/onedrive/tree/master">Onedrive</a></li><li><a href="https://github.com/bpozdena/OneDriveGUI">OnedriveGUI</a>: GUI for client above</li><li><a href="https://rclone.org/">Rclone</a>: better than above</li></ul><h2 id="Proxy">Proxy</h2><h3 id="Clash-Client">Clash Client</h3><ul><li><s><a href="https://github.com/Fndroid/clash_for_windows_pkg">cfw</a>(closed-source)</s> ä¸å»ºè®®ä½¿ç”¨</li><li><s><a href="https://github.com/zzzgydi/clash-verge">clash-verge</a>(open-source)</s></li><li><a href="https://github.com/clash-verge-rev/clash-verge-rev">clash verge rev</a>; å› ä¸ºæŸäº›çƒ‚äººçš„åŸå› ï¼Œè¢«é“æ‹³åˆ¶è£åé‡ç”Ÿçš„ç‰ˆæœ¬</li></ul><blockquote><p><s>æ³¨æ„ Clash å’Œ Clash.Meta æ˜¯å¼€æºè½¯ä»¶ï¼Œclash.Premium ä¸º Clash åŸä½œè€…åœ¨ Clash åŸºç¡€ä¸Šå¼€å‘çš„é—­æºè½¯ä»¶ï¼Œä»‹æ„è¯¯ç”¨</s> åªå‰© Meta äº†ä¸”æ”¹åäº†ã€‚åŸç¥ï¼Œå¯åŠ¨!!!</p></blockquote><h3 id="V2ray-Client">V2ray Client</h3><ul><li><a href="https://github.com/v2rayA/v2rayA">v2rayA</a>(open-source)</li></ul><h2 id="Diagram">Diagram</h2><ul><li><a href="https://app.diagrams.net/">drawio</a></li></ul><h2 id="Office">Office</h2><ul><li><a href="https://github.com/LibreOffice/core">libreoffice</a></li><li><a href="https://github.com/ONLYOFFICE/DesktopEditors">onlyoffice</a></li><li><a href="https://github.com/xournalpp/xournalpp/">xournal++</a> å…¨å¹³å°æ‰‹å†™æ¿å·¥å…·ï¼Œä½†æ˜¯å®‰å“ç«¯è¿˜å¾ˆçƒ‚</li></ul><h2 id="Resource-Monitor">Resource Monitor</h2><ul><li><a href="https://github.com/aristocratos/btop">btop</a> or <a href="https://github.com/aristocratos/bpytop">bpytop</a></li><li><a href="https://github.com/htop-dev/htop">htop</a></li></ul><h2 id="Diff-Tools">Diff Tools</h2><ul><li><a href="https://gitlab.gnome.org/GNOME/meld">meld</a></li><li><a href="https://kdiff3.sourceforge.net/">kdiff3</a></li></ul><h2 id="Mouse">Mouse</h2><ul><li><a href="https://github.com/libratbag/piper">piper</a> è§£å†³äº† LogitechG ç³»åˆ—é¼ æ ‡åœ¨ Linux ä¸‹æ— æ³•è®¾ç½® DPIï¼Œç¯å…‰ä¸äº®çš„é—®é¢˜ã€‚ç›¸å½“äºä¸€ä¸ªéå®˜æ–¹ Logitech G Hub</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ”¶å½•äº†Linuxä¸‹ä½¿ç”¨çš„ä¸€äº›å·¥å…·&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;Screen-Shot-Recorder&quot;&gt;Screen Shot/Recorder&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.maa</summary>
      
    
    
    
    
    <category term="Linux" scheme="http://blog.vollate.top/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Article Archive</title>
    <link href="http://blog.vollate.top/2022/11/10/article-archives/"/>
    <id>http://blog.vollate.top/2022/11/10/article-archives/</id>
    <published>2022-11-10T20:10:57.000Z</published>
    <updated>2024-02-15T14:09:46.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="OS">OS</h2><ul><li><a href="https://bbs.huaweicloud.com/blogs/279735">å†…å­˜ç®¡ç†</a></li></ul><h2 id="Program">Program</h2><ul><li><a href="https://www.foonathan.net/2016/03/cmake-install/">CMake export lib</a></li><li><a href="https://www.cnblogs.com/pcdack/p/16019319.html">oneAPI|DPC++å½’æ¡£</a></li><li><a href="https://www.youtube.com/@CppCon">CppCon</a></li></ul><h2 id="Network">Network</h2><ul><li><a href="https://gfw.report/">GFW report</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;OS&quot;&gt;OS&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://bbs.huaweicloud.com/blogs/279735&quot;&gt;å†…å­˜ç®¡ç†&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;Program&quot;&gt;Program&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;</summary>
      
    
    
    
    
    <category term="Archive" scheme="http://blog.vollate.top/tags/Archive/"/>
    
  </entry>
  
  <entry>
    <title>Happy Runner (ä¹é“ä¸è·‘)</title>
    <link href="http://blog.vollate.top/2022/11/03/happy-runner/"/>
    <id>http://blog.vollate.top/2022/11/03/happy-runner/</id>
    <published>2022-11-03T02:57:19.000Z</published>
    <updated>2024-05-10T18:01:09.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Requirement">Requirement</h2><p>ä¸€éƒ¨rootäº†çš„å®‰å“æ‰‹æœº(è§£ä¸äº†blçš„å¯ä»¥è¯•è¯•å¤ªæ)</p><blockquote><p>å¦‚ä½•rootå»ºè®®google,æ®è¯´å°ç±³å¼€æ¨¡ç³Šå®šä½ä¸rootä¹Ÿè¡Œï¼Œä½†æ˜¯æ²¡è¯•è¿‡(æ²¡æœ‰æ²¡rootçš„æ‰‹æœº)</p></blockquote><h2 id="Steps">Steps</h2><ol><li>ä¸‹è½½<a href="http://fakeloc.cc/app">fake location</a>ï¼Œé“¾æ¥æŒ‚äº†å°±ä¸Š github æœ</li><li>ä¹°é«˜çº§ç‰ˆ (èŠ±é’±)</li><li>è®¾ç½®é‡Œé¢æŠŠåœ°å›¾æ¢æˆç™¾åº¦</li><li>è·¯çº¿æ¨¡æ‹Ÿé‡Œé¢ç”»è·¯çº¿ï¼Œ<s>å»ºè®®æŠŠæ¯ä¸ªå¯èƒ½çš„æ‰“å¡ç‚¹éƒ½è¿‡ä¸€é</s> ç°åœ¨ä¸ç”¨æ‰“å¡äº†,å·®ä¸å¤šå°±è¡Œï¼Œæ³¨æ„åˆ«è¶…è¿‡å•æ¬¡æœ€å¤§è·¯ç¨‹</li><li>å¼€å¯è·¯çº¿æ¨¡æ‹Ÿå’Œä¹è·‘ï¼Œè®¾ç½®é€Ÿåº¦(æ³¨æ„åˆ«å¤ªå¿«äº†)ï¼Œå»ºè®®å¼€å¯æµ®åŠ¨é€Ÿåº¦å’Œæ¨¡æ‹Ÿæ­¥é¢‘</li><li>è®°å¾—åˆ°æ—¶é—´æ¥å…³ä¹è·‘å…å¾—è¶…æ—¶</li></ol><h2 id="é—®é¢˜æ’æŸ¥">é—®é¢˜æ’æŸ¥</h2><ul><li>å¼€äº†æ¨¡æ‹Ÿæ²¡ååº”: æ¢è¿è¡Œæ¨¡å¼(root/no root)</li><li>ä¹è·‘é—ªé€€(rootäº†çš„æ‰‹æœº/æ¨¡æ‹Ÿå™¨): å¯¹ä¹è·‘éšè—root(Magisk/fake location å†…ç½®)</li><li>ç›®å‰æœ€æ–°ç‰ˆä¹è·‘å¥½åƒä¸èƒ½åœ¨æ¨¡æ‹Ÿå™¨ä¸­è¿è¡Œï¼Œå¤§æ¦‚æ˜¯æ£€æµ‹æ¨¡æ‹Ÿå™¨ï¼Ÿ</li><li>å…¶ä»–: çœ‹æ–‡æ¡£, googleï¼Œ<s>æˆ‘æœ‰ä¸€ä¸ªæœ‹å‹</s></li></ul><p><strong>æœ¬æ•™ç¨‹ä»…ä¾›å‚è€ƒï¼Œä½¿ç”¨æœ‰é£é™©ï¼Œå¯¹äºæŒ‰ç…§æœ¬æ•™ç¨‹æ“ä½œé€ æˆè¢«æ£€æµ‹ç­‰ç­‰é—®é¢˜æ¦‚ä¸è´Ÿè´£</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Requirement&quot;&gt;Requirement&lt;/h2&gt;
&lt;p&gt;ä¸€éƒ¨rootäº†çš„å®‰å“æ‰‹æœº(è§£ä¸äº†blçš„å¯ä»¥è¯•è¯•å¤ªæ)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚ä½•rootå»ºè®®google,æ®è¯´å°ç±³å¼€æ¨¡ç³Šå®šä½ä¸rootä¹Ÿè¡Œï¼Œä½†æ˜¯æ²¡è¯•è¿‡(æ²¡æœ‰æ²¡rootçš„æ‰‹æœº)&lt;/p</summary>
      
    
    
    
    <category term="Trick" scheme="http://blog.vollate.top/categories/Trick/"/>
    
    
  </entry>
  
</feed>
